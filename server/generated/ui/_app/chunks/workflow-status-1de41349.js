var F=Object.defineProperty,N=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var x=(t,e,n)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,f=(t,e)=>{for(var n in e||(e={}))g.call(e,n)&&x(t,n,e[n]);if(m)for(var n of m(e))v.call(e,n)&&x(t,n,e[n]);return t},y=(t,e)=>N(t,R(e));var b=(t,e)=>{var n={};for(var s in t)g.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&m)for(var s of m(t))e.indexOf(s)<0&&v.call(t,s)&&(n[s]=t[s]);return n};import{am as $,an as j,ao as q,ap as D,S as J,i as L,s as z,e as H,t as K,c as M,a as Q,g as B,d as E,b as _,a5 as T,f as G,K as V,h as X,R as A}from"./vendor-8450f4eb.js";import{h as Y,r as w}from"./request-from-api-da859ff0.js";import{s as h,a as Z,d as U}from"./data-converter-config-7491540a.js";const P=t=>{var u,k;const e=t.workflowExecutionInfo.type.name,n=t.workflowExecutionInfo.execution.workflowId,s=t.workflowExecutionInfo.execution.runId,r=String(t.workflowExecutionInfo.startTime),o=String(t.workflowExecutionInfo.closeTime),c=t.workflowExecutionInfo.status,i=t.workflowExecutionInfo.historyLength,a=`/workflows/${n}/${s}`,d=(k=(u=t==null?void 0:t.executionConfig)==null?void 0:u.taskQueue)==null?void 0:k.name,l=t.pendingActivities||[];return{name:e,id:n,runId:s,startTime:r,endTime:o,status:c,historyEvents:i,url:a,taskQueue:d,pendingActivities:l}},tt=t=>(t.executions||[]).map(e=>P({workflowExecutionInfo:e}));function et(t){const e=Object.keys(t).find(n=>n.includes("Attributes"));return f({type:e},t[e])}const nt=t=>t.history.events.map(e=>y(f({},e),{id:String(e.eventId),eventType:e.eventType,attributes:et(e)})),p=t=>typeof t=="function",C=(t={},e={})=>{const n=f({},t);for(const s of Object.keys(e)){const r=n[s];Array.isArray(r)?n[s]=n[s].concat(e[s]):typeof r=="object"&&!Array.isArray(r)?n[s]=C(n[s],e[s]):n[s]=e[s]}return n},I=async(t,{onStart:e,onUpdate:n,onComplete:s,onError:r=Y,token:o,previousProps:c}={})=>{!c&&p(e)&&e();try{const i=await t(o),{nextPageToken:d}=i,l=b(i,["nextPageToken"]),u=C(c,l);return p(n)&&n(u,l),d?I(t,{onStart:e,onUpdate:n,onComplete:s,token:d,previousProps:u}):(p(s)&&s(u),u)}catch(a){r(a)}},st=async({namespace:t,executionId:e,runId:n,rawPayloads:s=!1,onStart:r,onUpdate:o,onComplete:c},i=fetch)=>{let a={};return s&&(a={params:{rawPayloads:JSON.stringify(!0)}}),await I(async l=>w(`/namespaces/${t}/workflows/${e}/executions/${n}/events`,f({token:l,request:i},a)),{onStart:r,onUpdate:o,onComplete:c})},rt=async(t,e)=>{let n=null;try{n=new $(`ws://localhost:${e}/`,{packMessage:s=>JSON.stringify(s),unpackMessage:s=>JSON.parse(s),attachRequestId:(s,r)=>Object.assign({requestId:r},s),extractRequestId:s=>s&&s.requestId})}catch(s){return h(),Promise.reject(s)}try{await n.open();const s=[];return t.forEach(r=>{let o=[];switch(r.attributes.type){case"activityTaskCompletedEventAttributes":o=r.attributes.result.payloads;break;case"signalExternalWorkflowExecutionInitiatedEventAttributes":case"workflowExecutionStartedEventAttributes":case"activityTaskScheduledEventAttributes":o=r.attributes.input.payloads;break}o.forEach(c=>{s.push(n.sendRequest({payload:JSON.stringify(c)}).then(i=>{let a=null;try{a=JSON.parse(i.content),Z()}catch{a=i.content,h()}switch(r.attributes.type){case"activityTaskCompletedEventAttributes":r.attributes.result.payloads=a;break;case"signalExternalWorkflowExecutionInitiatedEventAttributes":case"workflowExecutionStartedEventAttributes":case"activityTaskScheduledEventAttributes":r.attributes.input.payloads=a;break}}))})}),await Promise.all(s),Promise.resolve(t)}catch(s){const r=`Unable to convert event payload: ${s}`;return h(),Promise.reject({message:r})}finally{n.isOpened&&await n.close()}},ot=/(\d+)\s(years|months|weeks|days|hours|minutes|seconds)/,at=t=>{const[,e,n]=t.match(ot);return{[n]:parseInt(e,10)}},it=t=>t==="Running"?"1":t==="Completed"?"2":t==="Failed"?"3":t==="Canceled"?"4":t==="Terminated"?"5":t==="ContinuedAsNew"?"6":t==="TimedOut"?"7":null,ct=t=>{const e=typeof t=="string"?at(t):t;return j(q(new Date,e))},S=({workflowId:t,workflowType:e,timeRange:n,status:s}={})=>{const r={},o=it(s);return r["start_time_filter.earliest_time"]=ct(n||{hours:24}),t&&(r["execution_filter.workflow_id"]=t),e&&(r["type_filter.name"]=e),o&&(r["status_filter.status"]=o),r},O=()=>Promise.resolve({executions:[]}),W=(t,e)=>({status:n})=>n?n===t?e:!e:!1,ut=W("Running",!0),lt=W("Running",!1),ft=(t,e,n=fetch)=>{if(lt(e))return O();const s=S(e);return w(`/namespaces/${t}/workflows/open`,{params:s,request:n})},dt=(t,e,n=fetch)=>{if(ut(e))return O();const s=S(e);return w(`/namespaces/${t}/workflows/closed`,{params:s,request:n})},vt=async(t,e,n=fetch)=>{const[s,r]=await Promise.all([ft(t,e,n),dt(t,e,n)]),o=[...s==null?void 0:s.executions,...r==null?void 0:r.executions];return{workflows:tt({executions:o}),nextPageTokens:{open:s.nextPageToken,closed:r.nextPageToken}}};async function mt({executionId:t,runId:e,namespace:n},s=fetch){return w(`/namespaces/${n}/workflows/${t}/executions/${e}`,{request:s}).then(P)}async function xt(t,e=fetch){const n=D(U),[s,r]=await Promise.all([mt(t,e),st(y(f({},t),{rawPayloads:Boolean(n)}),e).then(nt).then(async o=>{if(n!==null)try{await rt(o,n)}catch{}return Promise.resolve(o)})]);return{workflow:s,events:r}}function wt(t){let e,n,s;return{c(){e=H("span"),n=K(t[0]),this.h()},l(r){e=M(r,"SPAN",{class:!0});var o=Q(e);n=B(o,t[0]),o.forEach(E),this.h()},h(){_(e,"class",s=""+(T(`${t[1]} rounded-md text-center px-2 text-sm`)+" svelte-159bzvh"))},m(r,o){G(r,e,o),V(e,n)},p(r,[o]){o&1&&X(n,r[0]),o&2&&s!==(s=""+(T(`${r[1]} rounded-md text-center px-2 text-sm`)+" svelte-159bzvh"))&&_(e,"class",s)},i:A,o:A,d(r){r&&E(e)}}}function yt(t,e,n){let s,r,{status:o}=e;const c={Running:"Running",TimedOut:"Timed",Completed:"Completed",Failed:"Failed",ContinuedAsNew:"Continued",Canceled:"Canceled",Terminated:"Terminated"},i={Running:"green",TimedOut:"yellow",Completed:"blue",Failed:"red",ContinuedAsNew:"indigo",Canceled:"purple",Terminated:"pink"};return t.$$set=a=>{"status"in a&&n(2,o=a.status)},t.$$.update=()=>{t.$$.dirty&4&&n(1,s=i[o]),t.$$.dirty&4&&n(0,r=c[o])},[r,s,o]}class bt extends J{constructor(e){super();L(this,e,yt,wt,z,{status:2})}}export{bt as W,xt as a,vt as f,p as i};
