import{d as _,w as N}from"./index-73e3ae8e.js";import{p as I}from"./stores-ae349ac7.js";import{e as J}from"./event-view-0d98deae.js";import{l as S}from"./route-for-9e2a964e.js";import{r as R}from"./workflow-run-d328b797.js";import{a as L}from"./auth-user-867edd3a.js";import{S as O,i as Q,s as W,k as E,a as D,q as X,l as k,m as y,c as P,r as Y,h as v,n as w,b as q,K as g,f as d,g as T,t as p,d as V,u as Z,ae as U,M as z,N as C,w as x,x as $,y as ee,z as te,F as se,G as ne,H as ae,I as re}from"./index-9c2f34db.js";import{I as oe}from"./icon-1d11e133.js";import{p as j}from"./paginated-08f37f70.js";import{r as A,a as F}from"./route-for-api-048ec189.js";import{t as b}from"./index-8d3d8d65.js";import{i as ie}from"./is-46eb4772.js";const le=_([I],([t])=>t.params.namespace?S(t.params.namespace):""),ce=_([I],([t])=>t.params.workflow?S(t.params.workflow):""),fe=_([I],([t])=>t.params.run?S(t.params.run):""),ue=_([I],([t])=>{var e;return(e=t.data)==null?void 0:e.settings}),me=_([L],([t])=>t==null?void 0:t.accessToken),de=_([le,ce,fe,J],([t,e,n,r])=>({namespace:t,workflowId:e,runId:n,sort:r}));_([de,ue,me,R],([t,e,n,r])=>({...t,settings:e,accessToken:n,refresh:R,$refresh:r}));const ve={start:[],end:[]},He=N(ve),Re=N(null);function G(t){let e,n,r;return n=new oe({props:{name:t[2]}}),{c(){e=E("div"),x(n.$$.fragment)},l(s){e=k(s,"DIV",{});var a=y(e);$(n.$$.fragment,a),a.forEach(v)},m(s,a){q(s,e,a),ee(n,e,null),r=!0},p(s,a){const l={};a&4&&(l.name=s[2]),n.$set(l)},i(s){r||(d(n.$$.fragment,s),r=!0)},o(s){p(n.$$.fragment,s),r=!1},d(s){s&&v(e),te(n)}}}function K(t){let e,n;const r=t[6].default,s=se(r,t,t[5],null);return{c(){e=E("div"),s&&s.c(),this.h()},l(a){e=k(a,"DIV",{class:!0});var l=y(e);s&&s.l(l),l.forEach(v),this.h()},h(){w(e,"class","content svelte-gvl7iw")},m(a,l){q(a,e,l),s&&s.m(e,null),n=!0},p(a,l){s&&s.p&&(!n||l&32)&&ne(s,r,a,a[5],n?re(r,a[5],l,null):ae(a[5]),null)},i(a){n||(d(s,a),n=!0)},o(a){p(s,a),n=!1},d(a){a&&v(e),s&&s.d(a)}}}function _e(t){let e,n,r,s,a,l,u,m,o=t[2]&&G(t),i=t[4].default&&K(t);return{c(){e=E("div"),o&&o.c(),n=D(),r=E("div"),s=E("h5"),a=X(t[1]),l=D(),i&&i.c(),this.h()},l(c){e=k(c,"DIV",{class:!0});var f=y(e);o&&o.l(f),n=P(f),r=k(f,"DIV",{class:!0});var h=y(r);s=k(h,"H5",{class:!0});var H=y(s);a=Y(H,t[1]),H.forEach(v),l=P(h),i&&i.l(h),h.forEach(v),f.forEach(v),this.h()},h(){w(s,"class","font-semibold leading-6"),w(r,"class","ml-1"),w(e,"class",u="alert rounded-md border "+t[0]+" "+t[3].class+" svelte-gvl7iw")},m(c,f){q(c,e,f),o&&o.m(e,null),g(e,n),g(e,r),g(r,s),g(s,a),g(r,l),i&&i.m(r,null),m=!0},p(c,[f]){c[2]?o?(o.p(c,f),f&4&&d(o,1)):(o=G(c),o.c(),d(o,1),o.m(e,n)):o&&(T(),p(o,1,1,()=>{o=null}),V()),(!m||f&2)&&Z(a,c[1]),c[4].default?i?(i.p(c,f),f&16&&d(i,1)):(i=K(c),i.c(),d(i,1),i.m(r,null)):i&&(T(),p(i,1,1,()=>{i=null}),V()),(!m||f&9&&u!==(u="alert rounded-md border "+c[0]+" "+c[3].class+" svelte-gvl7iw"))&&w(e,"class",u)},i(c){m||(d(o),d(i),m=!0)},o(c){p(o),p(i),m=!1},d(c){c&&v(e),o&&o.d(),i&&i.d()}}}function he(t,e,n){let{$$slots:r={},$$scope:s}=e;const a=U(r);let{intent:l}=e,{title:u}=e,{icon:m=null}=e;return t.$$set=o=>{n(3,e=z(z({},e),C(o))),"intent"in o&&n(0,l=o.intent),"title"in o&&n(1,u=o.title),"icon"in o&&n(2,m=o.icon),"$$scope"in o&&n(5,s=o.$$scope)},e=C(e),[l,u,m,e,a,s,r]}class De extends O{constructor(e){super(),Q(this,e,he,_e,W,{intent:0,title:1,icon:2})}}const B=t=>!ie(t)||t==="descending"?"events.descending":t==="ascending"?"events.ascending":"events.descending",Pe=async({namespace:t,workflowId:e,runId:n,sort:r,onStart:s,onUpdate:a,onComplete:l})=>{const u=B(r),m=await A(u,{namespace:t,workflowId:e,runId:n});return(await j(async i=>F(m,{token:i,request:fetch}),{onStart:s,onUpdate:a,onComplete:l})).history.events},Te=async({namespace:t,workflowId:e,runId:n,sort:r,settings:s,accessToken:a,onStart:l,onUpdate:u,onComplete:m})=>{const o=B(r),i=await A(o,{namespace:t,workflowId:e,runId:n}),c=await j(async h=>F(i,{token:h,request:fetch}),{onStart:l,onUpdate:u,onComplete:m});return await b({response:c.history.events,namespace:t,settings:s,accessToken:a})},M=async({namespace:t,workflowId:e,runId:n,sort:r})=>{const s=await A(`events.${r}`,{namespace:t,workflowId:e,runId:n});try{return(await F(s,{request:fetch,params:{maximumPageSize:"20"}})).history.events}catch{return[]}},Ve=async t=>{const{settings:e,namespace:n,accessToken:r}=t,s=await M({...t,sort:"ascending"}),a=await M({...t,sort:"descending"}),[l,u]=await Promise.all([b({response:s,namespace:n,settings:e,accessToken:r}),b({response:a,namespace:n,settings:e,accessToken:r})]);return{start:l,end:u}};export{De as A,Pe as a,Te as b,He as e,Ve as f,ve as i,Re as t};
