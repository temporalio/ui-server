import{X as S}from"./index-f283717a.js";import{s as C}from"./settings-16907be6.js";import{s as D}from"./simplify-attributes-61797c15.js";import{r as h,a as A,h as q}from"./route-for-api-dc210169.js";import{b as F,e as K,h as I,j as P}from"./to-duration-a5f6615f.js";const Q=(t=C)=>!S(t).disableWriteActions,R=(t=[])=>t.map(o=>{const e=D(o,!0),n=o.activityId;return{...e,id:n}}),W=t=>{var m,x,g,y,E,T;const o=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,n=t.workflowExecutionInfo.execution.runId,a=String(t.workflowExecutionInfo.startTime),l=String(t.workflowExecutionInfo.closeTime),r=t.workflowExecutionInfo.status,f=t.workflowExecutionInfo.status==="Running",w=t.workflowExecutionInfo.historyLength,d=`/workflows/${e}/${n}`,k=(x=(m=t==null?void 0:t.executionConfig)==null?void 0:m.taskQueue)==null?void 0:x.name,c=(g=t==null?void 0:t.workflowExecutionInfo)==null?void 0:g.parentNamespaceId,i=(y=t==null?void 0:t.workflowExecutionInfo)==null?void 0:y.parentExecution,u=t.workflowExecutionInfo.stateTransitionCount,s=(E=t.executionConfig)==null?void 0:E.defaultWorkflowTaskTimeout,$=R(t.pendingActivities),b=(T=t==null?void 0:t.pendingChildren)!=null?T:[];return{name:o,id:e,runId:n,startTime:a,endTime:l,status:r,historyEvents:w,url:d,taskQueue:k,pendingActivities:$,pendingChildren:b,parentNamespaceId:c,parent:i,stateTransitionCount:u,isRunning:f,defaultWorkflowTaskTimeout:s,get canBeTerminated(){return f&&Q()}}},N=t=>(t.executions||[]).map(o=>W({workflowExecutionInfo:o})),j={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},B=["workflowId","workflowType","timeRange","executionStatus","closeTime"],L=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),O=t=>{if(typeof t!="string")return!1;for(const o of B)if(o===t)return!0;return!1},U=(t,o,e)=>{const n=j[t];return o==="All"?"":F(o)||K(o)?e?`${n} > "${I(o)}"`:`${n} BETWEEN "${I(o)}" AND "${P()}"`:`${n}="${o}"`},_=(t,o)=>Object.entries(t).map(([e,n])=>{if(O(e)&&L(n))return U(e,n,o)}).filter(Boolean),z=(t,o=!1)=>_(t,o).join(" and "),V=async(t,o,e=fetch,n=!1)=>{var c;const a=decodeURIComponent(o.query||z(o,n)),l=n?"workflows.archived":"workflows";let r="";const f=i=>{var u,s;q(i),r=(s=(u=i==null?void 0:i.body)==null?void 0:u.message)!=null?s:`Error fetching workflows: ${i.status}: ${i.statusText}`},w=()=>{r="Failed to fetch workflows"},{executions:d,nextPageToken:k}=(c=await h(A(l,{namespace:t}),{params:{query:a},onError:f,handleError:w,request:e}))!=null?c:{executions:[],nextPageToken:""};return{workflows:N({executions:d}),nextPageToken:String(k),error:r}},Y=async(t,o,e=fetch)=>V(t,o,e,!0);async function Z(t,o=fetch){return h(A("workflow",t),{request:o}).then(W)}export{V as a,Y as b,Z as f,z as t};
