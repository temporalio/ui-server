import{a5 as P,B as d}from"./index-9c2f34db.js";import{s as S}from"./settings-f3508ca1.js";import{s as v}from"./simplify-attributes-badfcd03.js";import{r as u,a as f,b as F,i as O,c as z}from"./route-for-api-048ec189.js";import{t as U}from"./list-workflow-query-3861c197.js";import{s as E}from"./parse-with-big-int-02e81897.js";import{e as $}from"./route-for-9e2a964e.js";const B=(o=S)=>!P(o).disableWriteActions,Q=(o=[])=>o.map(t=>{const n=v(t,!0),r=t.activityId;return{...n,id:r}}),g=o=>{var y,x,I,T,b;const t=o.workflowExecutionInfo.type.name,n=o.workflowExecutionInfo.execution.workflowId,r=o.workflowExecutionInfo.execution.runId,a=String(o.workflowExecutionInfo.startTime),e=String(o.workflowExecutionInfo.closeTime),c=o.workflowExecutionInfo.status,s=o.workflowExecutionInfo.status==="Running",l=o.workflowExecutionInfo.historyLength,w=`/workflows/${n}/${r}`,h=(x=(y=o==null?void 0:o.executionConfig)==null?void 0:y.taskQueue)==null?void 0:x.name,i=(I=o==null?void 0:o.workflowExecutionInfo)==null?void 0:I.parentNamespaceId,m=(T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.parentExecution,k=o.workflowExecutionInfo.stateTransitionCount,A=(b=o.executionConfig)==null?void 0:b.defaultWorkflowTaskTimeout,p=Q(o.pendingActivities),C=(o==null?void 0:o.pendingChildren)??[];return{name:t,id:n,runId:r,startTime:a,endTime:e,status:c,historyEvents:l,url:w,taskQueue:h,pendingActivities:p,pendingChildren:C,parentNamespaceId:i,parent:m,stateTransitionCount:k,isRunning:s,defaultWorkflowTaskTimeout:A,get canBeTerminated(){return s&&B()}}},R=o=>(o.executions||[]).map(t=>g({workflowExecutionInfo:t})),D=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),W=(o,t=$)=>t?D(o):o,K=async(o,t,n=fetch)=>{let r=0,a=0;try{const e=await u("workflows.count",{namespace:o});if(t){const c=f(e,{params:{query:t},onError:d,handleError:d,request:n}),s=f(e,{params:{query:""},onError:d,handleError:d,request:n}),[l,w]=await Promise.all([c,s]);a=l==null?void 0:l.count,r=w==null?void 0:w.count}else{const c=await f(e,{params:{},onError:d,handleError:d,request:n});r=c==null?void 0:c.count}}catch{}return{count:a,totalCount:r}},L=async(o,t,n=fetch,r=!1)=>{const a=decodeURIComponent(t.query||U(t,r)),e=r?"workflows.archived":"workflows";let c="";const s=i=>{var m,k;F(i),(m=i==null?void 0:i.body)!=null&&m.message||i!=null&&i.status?c=((k=i==null?void 0:i.body)==null?void 0:k.message)??`Error fetching workflows: ${i.status}: ${i.statusText}`:c="Error fetching workflows: Server failed to respond"},l=await u(e,{namespace:o}),{executions:w,nextPageToken:h}=await f(l,{params:{query:a},onError:s,handleError:s,request:n})??{executions:[],nextPageToken:""};return{workflows:R({executions:w}),nextPageToken:String(h),error:c}},M=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let a=!0;const e=s=>{(O(s)||z(s))&&(a=!1)},c=await u(r,{namespace:o});return await f(c,{params:{pageSize:"1"},onError:e,handleError:e,request:t}),{authorized:a}},V=async(o,t,n=fetch)=>L(o,t,n,!0);async function X(o,t=fetch){const n=await u("workflow",o);return f(n,{request:t}).then(g)}async function Y({workflow:o,namespace:t,reason:n}){const r=await u("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await f(r,{options:{method:"POST",body:E({reason:n})},shouldRetry:!1,notifyOnError:!1})}async function Z({namespace:o,workflowId:t,runId:n},r=fetch){const a=await u("workflow.cancel",{namespace:o,workflowId:t,runId:n});return f(a,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function oo({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:a}){const e=await u("workflow.signal",{namespace:o,workflowId:t,runId:n});return f(e,{notifyOnError:!1,options:{method:"POST",body:E({signalName:r,input:{payloads:a?[{metadata:{encoding:W("json/plain")},data:W(E(a))}]:null}})}})}async function to(o,t=fetch){const n=a=>{console.error(a)},r=await u("workflow",o);return f(r,{request:t,onError:n,handleError:n}).then(g)}export{L as a,K as b,Z as c,M as d,V as e,X as f,to as g,oo as s,Y as t,B as w};
