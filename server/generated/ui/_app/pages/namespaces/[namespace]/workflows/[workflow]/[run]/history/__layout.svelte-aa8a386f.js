var ue=Object.defineProperty,me=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var X=(n,t,e)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,D=(n,t)=>{for(var e in t||(t={}))Q.call(t,e)&&X(n,e,t[e]);if(L)for(var e of L(t))U.call(t,e)&&X(n,e,t[e]);return n},Y=(n,t)=>me(n,de(t));var Z=(n,t)=>{var e={};for(var s in n)Q.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&L)for(var s of L(n))t.indexOf(s)<0&&U.call(n,s)&&(e[s]=n[s]);return e};import{az as ge,aA as he,S as W,i as V,s as B,O as pe,e as S,j,c as R,a as q,m as $,d as w,b as I,T as P,f as F,o as E,V as _e,aB as we,x as v,u as k,v as b,G as x,H as ve,aC as ke,R as ye,J as A,L as ee,M as te,N as ne,y as se,t as Ie,k as J,g as je,n as C,K as O,aD as $e,aE as Ee,aF as be}from"../../../../../../../chunks/vendor-ea4e1b17.js";import{r as N}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as Oe,a as G,r as re}from"../../../../../../../chunks/request-from-api-fc543812.js";import{r as oe}from"../../../../../../../chunks/route-for-api-a5ba59e5.js";import{s as K,d as Se,a as Re}from"../../../../../../../chunks/data-converter-config-07f19e1a.js";import{r as qe}from"../../../../../../../chunks/refreshable-758ff727.js";import{p as Pe}from"../../../../../../../chunks/stores-f21dbfd4.js";import{a as ae}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import"../../../../../../../chunks/notifications-2aab2c71.js";const ce=(n={},t={})=>{const e=D({},n);for(const s of Object.keys(t)){const o=e[s];Array.isArray(o)?e[s]=e[s].concat(t[s]):typeof o=="object"&&!Array.isArray(o)?e[s]=ce(e[s],t[s]):e[s]=t[s]}return e},z=async(n,{onStart:t,onUpdate:e,onComplete:s,onError:o=Oe,token:a,previousProps:c}={})=>{!c&&G(t)&&t();try{const r=await n(a),{nextPageToken:f}=r,p=Z(r,["nextPageToken"]),d=ce(c,p);return G(e)&&e(d,p),f?z(n,{onStart:t,onUpdate:e,onComplete:s,token:f,previousProps:d}):(G(s)&&s(d),d)}catch(l){o(l)}},Ne=(n,t)=>{if(!n)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{T=new he(`ws://localhost:${n}/`,D({packMessage:e=>JSON.stringify(e),unpackMessage:e=>JSON.parse(e),attachRequestId:(e,s)=>Object.assign({requestId:s},e),extractRequestId:e=>e&&e.requestId},t)),T.onError(()=>{console.log("oh snap")})}catch{K()}return T.open(),{hasWebsocket:!0,websocket:T,closeSocket:function(){return T.close()}}};let T=null;var le;const De=(le=ge(Se))!=null?le:null,Fe=Ne(De);async function Je(n,t){if(!t.isOpened)try{await t.open()}catch{K()}return t.isOpened?t.sendRequest({payload:JSON.stringify(n)}).then(s=>{Re();try{return JSON.parse(s.content)}catch{return s.content}}).catch(()=>{K()}):Promise.resolve(n)}function H(n){const t=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=t,t){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const Ce=async(n,t)=>{var o,a,c,r,l,f,p,d,y,m,i,g;const e=n,s=(r=(c=(o=e==null?void 0:e.input)==null?void 0:o.payloads)!=null?c:(a=e==null?void 0:e.result)==null?void 0:a.payloads)!=null?r:null;if(s){let u;const h=t!=null?t:Fe;(t==null?void 0:t.hasWebsocket)?u=await Promise.all((s!=null?s:[]).map(async ie=>await Je(ie,h.websocket))):u=s.map(H),((l=e==null?void 0:e.input)==null?void 0:l.payloads)&&(e.input.payloads=u),((f=e==null?void 0:e.result)==null?void 0:f.payloads)&&(e.result.payloads=u)}if((p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields){const u=(d=e==null?void 0:e.searchAttributes)==null?void 0:d.indexedFields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if((y=e==null?void 0:e.memo)==null?void 0:y.fields){const u=(m=e==null?void 0:e.memo)==null?void 0:m.fields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if((i=e==null?void 0:e.header)==null?void 0:i.fields){const u=(g=e==null?void 0:e.header)==null?void 0:g.fields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if(e==null?void 0:e.queryResult){const u=e==null?void 0:e.queryResult;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}return e};async function Te(n){const t=Object.keys(n).find(s=>s.includes("Attributes")),e=await Ce(n[t]);return D({type:t},e)}const He=async n=>Promise.all(n.history.events.map(async t=>Y(D({},t),{id:String(t.eventId),eventType:t.eventType,attributes:await Te(t)}))),fe=async({namespace:n,executionId:t,runId:e,onStart:s,onUpdate:o,onComplete:a},c=fetch)=>await z(async l=>re(oe("events",{namespace:n,executionId:t,runId:e}),{token:l,request:c}),{onStart:s,onUpdate:o,onComplete:a}).then(He),Le=async({namespace:n,executionId:t,runId:e,onStart:s,onUpdate:o,onComplete:a},c=fetch)=>(await z(async l=>re(oe("events",{namespace:n,executionId:t,runId:e}),{token:l,request:c}),{onStart:s,onUpdate:o,onComplete:a})).history.events;function We(n){let t,e,s,o,a,c;return e=new pe({props:{icon:n[0],scale:n[2]}}),{c(){t=S("a"),j(e.$$.fragment),this.h()},l(r){t=R(r,"A",{class:!0,href:!0});var l=q(t);$(e.$$.fragment,l),l.forEach(w),this.h()},h(){I(t,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1t4vnef"),I(t,"href",s=ae(n[3],n[5].query)),P(t,"rounded-lg",!n[1]),P(t,"active",n[5].path.includes(n[3])),P(t,"group",n[1])},m(r,l){F(r,t,l),E(e,t,null),o=!0,a||(c=_e(t,"click",function(){we(n[4])&&n[4].apply(this,arguments)}),a=!0)},p(r,[l]){n=r;const f={};l&1&&(f.icon=n[0]),l&4&&(f.scale=n[2]),e.$set(f),(!o||l&40&&s!==(s=ae(n[3],n[5].query)))&&I(t,"href",s),l&2&&P(t,"rounded-lg",!n[1]),l&40&&P(t,"active",n[5].path.includes(n[3])),l&2&&P(t,"group",n[1])},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){k(e.$$.fragment,r),o=!1},d(r){r&&w(t),b(e),a=!1,c()}}}function Ve(n,t,e){let s;x(n,Pe,f=>e(5,s=f));let{icon:o}=t,{group:a=ve("group")}=t,{scale:c=1}=t,{href:r}=t,{onclick:l=void 0}=t;return n.$$set=f=>{"icon"in f&&e(0,o=f.icon),"group"in f&&e(1,a=f.group),"scale"in f&&e(2,c=f.scale),"href"in f&&e(3,r=f.href),"onclick"in f&&e(4,l=f.onclick)},[o,a,c,r,l,s]}class M extends W{constructor(t){super();V(this,t,Ve,We,B,{icon:0,group:1,scale:2,href:3,onclick:4})}}function Be(n){let t,e;return t=new M({props:{icon:ke,onclick:n[0],href:"#"}}),{c(){j(t.$$.fragment)},l(s){$(t.$$.fragment,s)},m(s,o){E(t,s,o),e=!0},p:ye,i(s){e||(v(t.$$.fragment,s),e=!0)},o(s){k(t.$$.fragment,s),e=!1},d(s){b(t,s)}}}function Me(n,t,e){const s=async()=>{const r=await Le({namespace:o,executionId:a,runId:c}),l=JSON.stringify(r,null,2);f(l,`${c}/events.json`,"text/plain");function f(p,d,y){const m=document.createElement("a"),i=new Blob([p],{type:y});m.href=URL.createObjectURL(i),m.download=d,m.click()}};let{namespace:o}=t,{workflowId:a}=t,{runId:c}=t;return n.$$set=r=>{"namespace"in r&&e(1,o=r.namespace),"workflowId"in r&&e(2,a=r.workflowId),"runId"in r&&e(3,c=r.runId)},[s,o,a,c]}class Ge extends W{constructor(t){super();V(this,t,Me,Be,B,{namespace:1,workflowId:2,runId:3})}}function Ke(n){let t,e;const s=n[1].default,o=A(s,n,n[0],null);return{c(){t=S("div"),o&&o.c(),this.h()},l(a){t=R(a,"DIV",{class:!0});var c=q(t);o&&o.l(c),c.forEach(w),this.h()},h(){I(t,"class","flex")},m(a,c){F(a,t,c),o&&o.m(t,null),e=!0},p(a,[c]){o&&o.p&&(!e||c&1)&&ee(o,s,a,a[0],e?ne(s,a[0],c,null):te(a[0]),null)},i(a){e||(v(o,a),e=!0)},o(a){k(o,a),e=!1},d(a){a&&w(t),o&&o.d(a)}}}function ze(n,t,e){let{$$slots:s={},$$scope:o}=t;return se("group",!0),n.$$set=a=>{"$$scope"in a&&e(0,o=a.$$scope)},[o,s]}class Qe extends W{constructor(t){super();V(this,t,ze,Ke,B,{})}}function Ue(n){let t,e,s,o,a,c;return t=new M({props:{icon:$e,href:N("workflow.events.full",n[0])}}),s=new M({props:{icon:Ee,href:N("workflow.events.compact",n[0])}}),a=new M({props:{icon:be,href:N("workflow.events.json",n[0])}}),{c(){j(t.$$.fragment),e=J(),j(s.$$.fragment),o=J(),j(a.$$.fragment)},l(r){$(t.$$.fragment,r),e=C(r),$(s.$$.fragment,r),o=C(r),$(a.$$.fragment,r)},m(r,l){E(t,r,l),F(r,e,l),E(s,r,l),F(r,o,l),E(a,r,l),c=!0},p(r,l){const f={};l&1&&(f.href=N("workflow.events.full",r[0])),t.$set(f);const p={};l&1&&(p.href=N("workflow.events.compact",r[0])),s.$set(p);const d={};l&1&&(d.href=N("workflow.events.json",r[0])),a.$set(d)},i(r){c||(v(t.$$.fragment,r),v(s.$$.fragment,r),v(a.$$.fragment,r),c=!0)},o(r){k(t.$$.fragment,r),k(s.$$.fragment,r),k(a.$$.fragment,r),c=!1},d(r){b(t,r),r&&w(e),b(s,r),r&&w(o),b(a,r)}}}function Xe(n){let t,e,s,o,a,c,r,l,f,p,d;r=new Qe({props:{$$slots:{default:[Ue]},$$scope:{ctx:n}}}),f=new Ge({props:{namespace:n[1].namespace,workflowId:n[1].executionId,runId:n[1].runId}});const y=n[4].default,m=A(y,n,n[5],null);return{c(){t=S("section"),e=S("nav"),s=S("h3"),o=Ie("Event History"),a=J(),c=S("div"),j(r.$$.fragment),l=J(),j(f.$$.fragment),p=J(),m&&m.c(),this.h()},l(i){t=R(i,"SECTION",{class:!0});var g=q(t);e=R(g,"NAV",{class:!0});var u=q(e);s=R(u,"H3",{class:!0});var h=q(s);o=je(h,"Event History"),h.forEach(w),a=C(u),c=R(u,"DIV",{class:!0});var _=q(c);$(r.$$.fragment,_),l=C(_),$(f.$$.fragment,_),_.forEach(w),u.forEach(w),p=C(g),m&&m.l(g),g.forEach(w),this.h()},h(){I(s,"class","text-lg font-medium"),I(c,"class","flex gap-4"),I(e,"class","flex gap-4 justify-between items-end"),I(t,"class","flex flex-col gap-4")},m(i,g){F(i,t,g),O(t,e),O(e,s),O(s,o),O(e,a),O(e,c),E(r,c,null),O(c,l),E(f,c,null),O(t,p),m&&m.m(t,null),d=!0},p(i,[g]){const u={};g&33&&(u.$$scope={dirty:g,ctx:i}),r.$set(u);const h={};g&2&&(h.namespace=i[1].namespace),g&2&&(h.workflowId=i[1].executionId),g&2&&(h.runId=i[1].runId),f.$set(h),m&&m.p&&(!d||g&32)&&ee(m,y,i,i[5],d?ne(y,i[5],g,null):te(i[5]),null)},i(i){d||(v(r.$$.fragment,i),v(f.$$.fragment,i),v(m,i),d=!0)},o(i){k(r.$$.fragment,i),k(f.$$.fragment,i),k(m,i),d=!1},d(i){i&&w(t),b(r),b(f),m&&m.d(i)}}}async function ct({page:n}){const{workflow:t,run:e,namespace:s}=n.params,o={namespace:s,executionId:t,runId:e};return await fe(o),{props:{workflow:{workflowId:t,runId:e,namespace:s},parameters:o}}}function Ye(n,t,e){let s,{$$slots:o={},$$scope:a}=t,{workflow:c}=t,{parameters:r}=t,l=qe(()=>fe(r));return x(n,l,f=>e(3,s=f)),n.$$set=f=>{"workflow"in f&&e(0,c=f.workflow),"parameters"in f&&e(1,r=f.parameters),"$$scope"in f&&e(5,a=f.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&se("events",s)},[c,r,l,s,o,a]}class ft extends W{constructor(t){super();V(this,t,Ye,Xe,B,{workflow:0,parameters:1})}}export{ft as default,ct as load};
