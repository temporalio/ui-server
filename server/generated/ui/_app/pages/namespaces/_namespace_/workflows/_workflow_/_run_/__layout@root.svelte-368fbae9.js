var We=Object.defineProperty;var $e=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var ve=(r,e,t)=>e in r?We(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e)=>{for(var t in e||(e={}))Ne.call(e,t)&&ve(r,t,e[t]);if($e)for(var t of $e(e))Re.call(e,t)&&ve(r,t,e[t]);return r};import{S as Z,i as x,s as ee,w as T,k as y,x as I,m as E,y as A,g as S,q as d,o as p,B as Q,d as u,l as Te,n as Ce,p as je,t as L,h as q,e as _,c as k,a as b,b as w,M as m,E as te,ab as ye,T as Oe,R as Ie,N as Pe,C as Ee,U as Ae,j as ne,f as Ve,I as De,J as He,K as Me,L as Le}from"../../../../../../chunks/index-e4881ae7.js";import{e as Qe,f as qe,g as Ue,h as Be,i as Je,j as Ke}from"../../../../../../chunks/route-for-9a2d1abe.js";import{r as ue,a as ce,h as Ye}from"../../../../../../chunks/route-for-api-54dbccb3.js";import{W as ze,f as Ge}from"../../../../../../chunks/workflow-status-6a2f0f07.js";import{m as Xe,F as Ze,n as xe}from"../../../../../../chunks/index.es-2b23329e.js";import{e as et}from"../../../../../../chunks/event-view-d6220b12.js";import{n as tt}from"../../../../../../chunks/notifications-0d3ffac1.js";import{B as Fe}from"../../../../../../chunks/button-cc82970b.js";import{M as nt}from"../../../../../../chunks/modal-edb62eb3.js";import{f as st}from"../../../../../../chunks/events-service-5e82aba5.js";import{p as at}from"../../../../../../chunks/stores-7881199b.js";import"../../../../../../chunks/index-1910a742.js";import"../../../../../../chunks/is-network-error-ac7c8caf.js";import"../../../../../../chunks/simplify-attributes-6710d3ed.js";import"../../../../../../chunks/format-date-4b1bc9ef.js";import"../../../../../../chunks/persist-store-9945befd.js";import"../../../../../../chunks/index-41b4537f.js";import"../../../../../../chunks/is-http-2893a8e8.js";import"../../../../../../chunks/data-converter-config-c59b4456.js";import"../../../../../../chunks/atob-eb4fc9a1.js";import"../../../../../../chunks/index-3a666cc5.js";import"../../../../../../chunks/get-event-categorization-20095c1b.js";async function rt(r,e=fetch){const t=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"1"}}),s=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"2"}});s.pollers.forEach(n=>{n.taskQueueTypes=["ACTIVITY"]}),t.pollers.forEach(n=>{n.taskQueueTypes=["WORKFLOW"]});const a=n=>(o,f)=>{const l=o[f.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return o[f.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<f.lastAccessTime?f.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([n])},o};return s.pollers.filter(n=>t.pollers.some(o=>{if(n.identity===o.identity)return n.taskQueueTypes=[...o.taskQueueTypes,...n.taskQueueTypes],n})),s.pollers.reduce(a("ACTIVITY"),t.pollers.reduce(a("WORKFLOW"),{})),{pollers:s.pollers,taskQueueStatus:s.taskQueueStatus}}async function ot({workflow:r,namespace:e,reason:t}){return await ue(ce("workflow.terminate",{namespace:e,workflowId:r.id,runId:r.runId}),{options:{method:"POST",body:JSON.stringify({reason:t})},shouldRetry:!1})}function Se(r){let e,t,s,a;return e=new Fe({props:{destroy:!0,$$slots:{default:[lt]},$$scope:{ctx:r}}}),e.$on("click",r[3]),s=new nt({props:{open:r[2],confirmText:"Terminate",$$slots:{content:[it],title:[ft]},$$scope:{ctx:r}}}),s.$on("cancelModal",r[4]),s.$on("confirmModal",r[6]),{c(){T(e.$$.fragment),t=y(),T(s.$$.fragment)},l(n){I(e.$$.fragment,n),t=E(n),I(s.$$.fragment,n)},m(n,o){A(e,n,o),S(n,t,o),A(s,n,o),a=!0},p(n,o){const f={};o&1024&&(f.$$scope={dirty:o,ctx:n}),e.$set(f);const l={};o&4&&(l.open=n[2]),o&1026&&(l.$$scope={dirty:o,ctx:n}),s.$set(l)},i(n){a||(d(e.$$.fragment,n),d(s.$$.fragment,n),a=!0)},o(n){p(e.$$.fragment,n),p(s.$$.fragment,n),a=!1},d(n){Q(e,n),n&&u(t),Q(s,n)}}}function lt(r){let e;return{c(){e=L("Terminate")},l(t){e=q(t,"Terminate")},m(t,s){S(t,e,s)},d(t){t&&u(e)}}}function ft(r){let e,t;return{c(){e=_("h3"),t=L("Terminate Workflow"),this.h()},l(s){e=k(s,"H3",{slot:!0});var a=b(e);t=q(a,"Terminate Workflow"),a.forEach(u),this.h()},h(){w(e,"slot","title")},m(s,a){S(s,e,a),m(e,t)},p:te,d(s){s&&u(e)}}}function it(r){let e,t,s,a,n,o,f;return{c(){e=_("div"),t=_("p"),s=L(`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),a=y(),n=_("input"),this.h()},l(l){e=k(l,"DIV",{slot:!0});var c=b(e);t=k(c,"P",{});var P=b(t);s=q(P,`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),P.forEach(u),a=E(c),n=k(c,"INPUT",{class:!0,placeholder:!0}),c.forEach(u),this.h()},h(){w(n,"class","block w-full border border-gray-200 rounded-md p-2 mt-4"),w(n,"placeholder","Enter a reason"),w(e,"slot","content")},m(l,c){S(l,e,c),m(e,t),m(t,s),m(e,a),m(e,n),ye(n,r[1]),o||(f=Oe(n,"input",r[8]),o=!0)},p(l,c){c&2&&n.value!==l[1]&&ye(n,l[1])},d(l){l&&u(e),o=!1,f()}}}function ut(r){let e=r[5](r[0]),t,s,a=e&&Se(r);return{c(){a&&a.c(),t=Te()},l(n){a&&a.l(n),t=Te()},m(n,o){a&&a.m(n,o),S(n,t,o),s=!0},p(n,[o]){o&1&&(e=n[5](n[0])),e?a?(a.p(n,o),o&1&&d(a,1)):(a=Se(n),a.c(),d(a,1),a.m(t.parentNode,t)):a&&(Ce(),p(a,1,1,()=>{a=null}),je())},i(n){s||(d(a),s=!0)},o(n){p(a),s=!1},d(n){a&&a.d(n),n&&u(t)}}}function ct(r,e,t){let{workflow:s}=e,{namespace:a}=e,n="",o=!1;const f=()=>t(2,o=!0),l=()=>t(2,o=!1),c=g=>String(g.status)==="Running",P=()=>{t(2,o=!1),t(1,n=""),tt.add("success","Workflow Terminated"),window.location.reload()},F=()=>{ot({workflow:s,namespace:a,reason:n}).then(P).catch(Ye)};function W(){n=this.value,t(1,n)}return r.$$set=g=>{"workflow"in g&&t(0,s=g.workflow),"namespace"in g&&t(7,a=g.namespace)},[s,n,o,f,l,c,F,a,W]}class mt extends Z{constructor(e){super(),x(this,e,ct,ut,ee,{workflow:0,namespace:7})}}function wt(r){let e,t;return{c(){e=_("span"),t=L("Download"),this.h()},l(s){e=k(s,"SPAN",{class:!0});var a=b(e);t=q(a,"Download"),a.forEach(u),this.h()},h(){w(e,"class","hidden md:inline")},m(s,a){S(s,e,a),m(e,t)},p:te,d(s){s&&u(e)}}}function ht(r){let e,t;return e=new Fe({props:{secondary:!0,icon:Xe,$$slots:{default:[wt]},$$scope:{ctx:r}}}),e.$on("click",r[0]),{c(){T(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,a){A(e,s,a),t=!0},p(s,[a]){const n={};a&16&&(n.$$scope={dirty:a,ctx:s}),e.$set(n)},i(s){t||(d(e.$$.fragment,s),t=!0)},o(s){p(e.$$.fragment,s),t=!1},d(s){Q(e,s)}}}function dt(r,e,t){let{namespace:s}=e,{workflowId:a}=e,{runId:n}=e;const o=async()=>{const f=await st({namespace:s,workflowId:a,runId:n}),l=JSON.stringify({events:f},null,2);c(l,`${n}/events.json`,"text/plain");function c(P,F,W){const g=document.createElement("a"),z=new Blob([P],{type:W});g.href=URL.createObjectURL(z),g.download=F,g.click()}};return r.$$set=f=>{"namespace"in f&&t(1,s=f.namespace),"workflowId"in f&&t(2,a=f.workflowId),"runId"in f&&t(3,n=f.runId)},[o,s,a,n]}class pt extends Z{constructor(e){super(),x(this,e,dt,ht,ee,{namespace:1,workflowId:2,runId:3})}}function _t(r){let e;return{c(){e=L(r[1])},l(t){e=q(t,r[1])},m(t,s){S(t,e,s)},p(t,s){s&2&&ne(e,t[1])},d(t){t&&u(e)}}}function kt(r){let e,t,s,a;return{c(){e=L(r[1]),t=y(),s=_("span"),a=L(r[2]),this.h()},l(n){e=q(n,r[1]),t=E(n),s=k(n,"SPAN",{class:!0});var o=b(s);a=q(o,r[2]),o.forEach(u),this.h()},h(){w(s,"class","px-2 text-blue-700 bg-blue-100 rounded-sm")},m(n,o){S(n,e,o),S(n,t,o),S(n,s,o),m(s,a)},p(n,o){o&2&&ne(e,n[1]),o&4&&ne(a,n[2])},d(n){n&&u(e),n&&u(t),n&&u(s)}}}function gt(r){let e,t;function s(o,f){return o[2]||o[2]===0?kt:_t}let a=s(r),n=a(r);return{c(){e=_("a"),n.c(),this.h()},l(o){e=k(o,"A",{class:!0,href:!0,"data-cy":!0});var f=b(e);n.l(f),f.forEach(u),this.h()},h(){w(e,"class","block text-sm md:text-base border-b-2 whitespace-nowrap svelte-sf1jtj"),w(e,"href",r[0]),w(e,"data-cy",t=r[4].dataCy),Ie(e,"active",r[3])},m(o,f){S(o,e,f),n.m(e,null)},p(o,[f]){a===(a=s(o))&&n?n.p(o,f):(n.d(1),n=a(o),n&&(n.c(),n.m(e,null))),f&1&&w(e,"href",o[0]),f&16&&t!==(t=o[4].dataCy)&&w(e,"data-cy",t),f&8&&Ie(e,"active",o[3])},i:te,o:te,d(o){o&&u(e),n.d()}}}function bt(r,e,t){let s,a;Pe(r,at,l=>t(5,a=l));let{href:n}=e,{label:o}=e,{amount:f=null}=e;return r.$$set=l=>{t(4,e=Ee(Ee({},e),Ae(l))),"href"in l&&t(0,n=l.href),"label"in l&&t(1,o=l.label),"amount"in l&&t(2,f=l.amount)},r.$$.update=()=>{r.$$.dirty&33&&t(3,s=a.url.pathname.includes(n))},e=Ae(e),[n,o,f,s,e,a]}class X extends Z{constructor(e){super(),x(this,e,bt,gt,ee,{href:0,label:1,amount:2})}}function $t(r){var me,we,he,de,pe;let e,t,s,a,n,o,f,l,c,P,F,W=r[1].id+"",g,z,R,C,se,j,ae,$,O,re,V,oe,D,le,U,fe,B,Y;return a=new Ze({props:{icon:xe}}),c=new ze({props:{status:(me=r[1])==null?void 0:me.status}}),C=new pt({props:{namespace:r[0],workflowId:r[1].id,runId:r[1].runId}}),j=new mt({props:{workflow:r[1],namespace:r[0]}}),O=new X({props:{label:"History",href:Qe(ie({view:r[3]},r[4])),amount:(we=r[1])==null?void 0:we.historyEvents}}),V=new X({props:{label:"Workers",href:qe(r[4]),amount:(de=(he=r[2])==null?void 0:he.pollers)==null?void 0:de.length,dataCy:"workers-tab"}}),D=new X({props:{label:"Pending Activities",href:Ue(r[4]),amount:(pe=r[1].pendingActivities)==null?void 0:pe.length}}),U=new X({props:{label:"Stack Trace",href:Be(r[4])}}),B=new X({props:{label:"Queries",href:Je(r[4])}}),{c(){e=_("header"),t=_("main"),s=_("a"),T(a.$$.fragment),o=y(),f=_("div"),l=_("h1"),T(c.$$.fragment),P=y(),F=_("span"),g=L(W),z=y(),R=_("div"),T(C.$$.fragment),se=y(),T(j.$$.fragment),ae=y(),$=_("nav"),T(O.$$.fragment),re=y(),T(V.$$.fragment),oe=y(),T(D.$$.fragment),le=y(),T(U.$$.fragment),fe=y(),T(B.$$.fragment),this.h()},l(i){e=k(i,"HEADER",{class:!0});var h=b(e);t=k(h,"MAIN",{class:!0});var N=b(t);s=k(N,"A",{href:!0,class:!0,style:!0});var J=b(s);I(a.$$.fragment,J),J.forEach(u),o=E(N),f=k(N,"DIV",{class:!0});var H=b(f);l=k(H,"H1",{class:!0});var M=b(l);I(c.$$.fragment,M),P=E(M),F=k(M,"SPAN",{class:!0});var G=b(F);g=q(G,W),G.forEach(u),M.forEach(u),z=E(H),R=k(H,"DIV",{class:!0});var K=b(R);I(C.$$.fragment,K),se=E(K),I(j.$$.fragment,K),K.forEach(u),H.forEach(u),ae=E(N),$=k(N,"NAV",{class:!0});var v=b($);I(O.$$.fragment,v),re=E(v),I(V.$$.fragment,v),oe=E(v),I(D.$$.fragment,v),le=E(v),I(U.$$.fragment,v),fe=E(v),I(B.$$.fragment,v),v.forEach(u),N.forEach(u),h.forEach(u),this.h()},h(){w(s,"href",n="/namespaces/"+r[0]+"/workflows"),w(s,"class","absolute top-2 back-to-workflows"),Ve(s,"left","-1.5rem"),w(F,"class","font-medium select-all"),w(l,"class","text-2xl flex relative items-center gap-4"),w(R,"class","ml-8 flex justify-end items-center gap-4"),w(f,"class","flex justify-between items-center mb-8"),w($,"class","flex gap-6 flex-wrap"),w(t,"class","flex flex-col gap-1 relative"),w(e,"class","flex flex-col gap-4")},m(i,h){S(i,e,h),m(e,t),m(t,s),A(a,s,null),m(t,o),m(t,f),m(f,l),A(c,l,null),m(l,P),m(l,F),m(F,g),m(f,z),m(f,R),A(C,R,null),m(R,se),A(j,R,null),m(t,ae),m(t,$),A(O,$,null),m($,re),A(V,$,null),m($,oe),A(D,$,null),m($,le),A(U,$,null),m($,fe),A(B,$,null),Y=!0},p(i,[h]){var v,_e,ke,ge,be;(!Y||h&1&&n!==(n="/namespaces/"+i[0]+"/workflows"))&&w(s,"href",n);const N={};h&2&&(N.status=(v=i[1])==null?void 0:v.status),c.$set(N),(!Y||h&2)&&W!==(W=i[1].id+"")&&ne(g,W);const J={};h&1&&(J.namespace=i[0]),h&2&&(J.workflowId=i[1].id),h&2&&(J.runId=i[1].runId),C.$set(J);const H={};h&2&&(H.workflow=i[1]),h&1&&(H.namespace=i[0]),j.$set(H);const M={};h&8&&(M.href=Qe(ie({view:i[3]},i[4]))),h&2&&(M.amount=(_e=i[1])==null?void 0:_e.historyEvents),O.$set(M);const G={};h&4&&(G.amount=(ge=(ke=i[2])==null?void 0:ke.pollers)==null?void 0:ge.length),V.$set(G);const K={};h&2&&(K.amount=(be=i[1].pendingActivities)==null?void 0:be.length),D.$set(K)},i(i){Y||(d(a.$$.fragment,i),d(c.$$.fragment,i),d(C.$$.fragment,i),d(j.$$.fragment,i),d(O.$$.fragment,i),d(V.$$.fragment,i),d(D.$$.fragment,i),d(U.$$.fragment,i),d(B.$$.fragment,i),Y=!0)},o(i){p(a.$$.fragment,i),p(c.$$.fragment,i),p(C.$$.fragment,i),p(j.$$.fragment,i),p(O.$$.fragment,i),p(V.$$.fragment,i),p(D.$$.fragment,i),p(U.$$.fragment,i),p(B.$$.fragment,i),Y=!1},d(i){i&&u(e),Q(a),Q(c),Q(C),Q(j),Q(O),Q(V),Q(D),Q(U),Q(B)}}}function vt(r,e,t){let s;Pe(r,et,l=>t(3,s=l));let{namespace:a}=e,{workflow:n}=e,{workers:o}=e;const f={namespace:a,workflow:n.id,run:n.runId};return r.$$set=l=>{"namespace"in l&&t(0,a=l.namespace),"workflow"in l&&t(1,n=l.workflow),"workers"in l&&t(2,o=l.workers)},[a,n,o,s,f]}class Tt extends Z{constructor(e){super(),x(this,e,vt,$t,ee,{namespace:0,workflow:1,workers:2})}}function yt(r){let e,t,s,a;t=new Tt({props:{namespace:r[1],workflow:r[0],workers:r[2]}});const n=r[4].default,o=De(n,r,r[3],null);return{c(){e=_("main"),T(t.$$.fragment),s=y(),o&&o.c(),this.h()},l(f){e=k(f,"MAIN",{class:!0});var l=b(e);I(t.$$.fragment,l),s=E(l),o&&o.l(l),l.forEach(u),this.h()},h(){w(e,"class","flex flex-col gap-6 h-full")},m(f,l){S(f,e,l),A(t,e,null),m(e,s),o&&o.m(e,null),a=!0},p(f,[l]){const c={};l&2&&(c.namespace=f[1]),l&1&&(c.workflow=f[0]),l&4&&(c.workers=f[2]),t.$set(c),o&&o.p&&(!a||l&8)&&He(o,n,f,f[3],a?Le(n,f[3],l,null):Me(f[3]),null)},i(f){a||(d(t.$$.fragment,f),d(o,f),a=!0)},o(f){p(t.$$.fragment,f),p(o,f),a=!1},d(f){f&&u(e),Q(t),o&&o.d(f)}}}const zt=async function({params:r,fetch:e}){const{workflow:t,run:s,namespace:a}=r,n={namespace:a,workflowId:Ke(t),runId:s},o=await Ge(n,e),{taskQueue:f}=o,l=await rt({queue:f,namespace:a});return{props:{workflow:o,namespace:a,workers:l},stuff:{workflow:o,workers:l}}};function It(r,e,t){let{$$slots:s={},$$scope:a}=e,{workflow:n}=e,{namespace:o}=e,{workers:f}=e;return r.$$set=l=>{"workflow"in l&&t(0,n=l.workflow),"namespace"in l&&t(1,o=l.namespace),"workers"in l&&t(2,f=l.workers),"$$scope"in l&&t(3,a=l.$$scope)},[n,o,f,a,s]}class Gt extends Z{constructor(e){super(),x(this,e,It,yt,ee,{workflow:0,namespace:1,workers:2})}}export{Gt as default,zt as load};
