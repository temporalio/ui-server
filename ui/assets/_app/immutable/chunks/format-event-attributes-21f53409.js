import{a7 as w}from"./index-3630b6f8.js";import{t as p}from"./time-format-3d30e6b7.js";import{i as h}from"./index-20fdbd0b.js";import{c}from"./format-camel-case-704a0419.js";import{h as u}from"./has-871f7cda.js";import{B as E}from"./is-event-type-eb1c7f9d.js";import{f as x}from"./format-date-c30acbf3.js";const T={key:"",value:""},I=new Set(["activityId","attempt","binaryChecksum","identity","parentInitiatedEventId","requestId","scheduledEventId","startedEventId","lastHeartbeatTime","scheduledTime","expirationTime"]),g=t=>I.has(t),l=(t,e)=>!(e===null||e===void 0||e===""||e==="0s"||t==="type"),S=t=>!(t===null||t===void 0||t===""||Array.isArray(t)&&!t.length),q=t=>typeof t=="string"?t:(t==null?void 0:t.payloads)??(t==null?void 0:t.indexedFields)??(t==null?void 0:t.points)??t,D=["baseRunId","continuedExecutionRunId","firstExecutionRunId","newExecutionRunId","newRunId","originalExecutionRunId"],z=t=>{for(const e of D)if(t===e)return!0;return!1},R=["taskQueueName"],H=t=>{for(const e of R)if(t===e)return!0;return!1},j=["workflowExecutionWorkflowId","workflowExecutionRunId"],J=(t,e)=>{const r=Boolean((e==null?void 0:e.workflowExecutionWorkflowId)&&(e==null?void 0:e.workflowExecutionRunId));for(const o of j)if(t===o&&r)return!0;return!1},f=(t,e)=>{if(typeof e=="object"){const[r]=Object.keys(e);return{key:t+c(r),value:e[r]}}else return{key:t,value:e.toString()}},A=["failure","input","activityType","parentInitiatedEventId","workflowExecution","workflowType","taskQueue"],b=({attributes:t})=>{for(const[e,r]of Object.entries(t))if(l(e,r))return f(e,r)},L=t=>{if(u(t,"ActivityType"))return t.ActivityType;if(u(t,"activity_type"))return t.activity_type},k=t=>{var r,o,n,s;const e=b(t);if(E(t)){const i=(s=(n=(o=(r=t.markerRecordedEventAttributes)==null?void 0:r.details)==null?void 0:o.data)==null?void 0:n.payloads)==null?void 0:s[0],a=L(i);if(a)return f("ActivityType",a)}for(const[i,a]of Object.entries(t.attributes))for(const d of A)if(i===d&&l(i,a))return f(i,a);return e},Q=({lastEvent:t})=>k(t),X=t=>t?h(t)?Q(t):k(t):T,G=new Set(["header"]),O=new Set(["taskQueue","retryPolicy","parentWorkflowExecution","workflowExecution"]),P=new Set(["maximumAttempts"]),y="Unlimited",W="No Expiration",Y=(t,e)=>t===0?W:e,Z=(t,e)=>t?t-e:y,tt=t=>t||y,F=(t,e)=>t==="maximumAttempts"&&!e?y:e,K=(t,e)=>{if(O.has(e)&&typeof t[e]=="object"){for(const[r,o]of Object.entries(t[e]))S(o)&&(P.has(r)?t[`${e}${c(r)}`]=F(r,o):t[`${e}${c(r)}`]=o);delete t[e]}},et=(t,{compact:e}={compact:!1})=>{const r={};e&&(r.eventTime=x(t.eventTime,w(p)));for(const[o,n]of Object.entries(t.attributes)){const s=l(o,n);!G.has(o)&&s&&(r[o]=n),K(r,o)}return r},m=["summary","parent","activity","taskQueue","schedule","retryPolicy","workflow","searchAttributes"],rt={activity:{label:"Activity"},parent:{label:"Parent"},retryPolicy:{label:"Retry Policy"},schedule:{label:"Schedule"},searchAttributes:{label:"Search Attributes"},summary:{label:"Summary"},taskQueue:{label:"Task Queue"},workflow:{label:"Workflow"}},N=(t,e)=>{var r,o;t.category==="activity"&&((r=e==null?void 0:e.activity)!=null&&r.length)&&(e.summary=[...e.activity,...e.summary],e.activity=[]),t.category==="activity"&&((o=e==null?void 0:e.workflow)!=null&&o.length)&&(e.summary=[...e.summary,...e.workflow],e.workflow=[])},v=t=>{const e=new Set(["summary","searchAttributes"]);for(const[r,o]of Object.entries(t))o.length===1&&!e.has(r)&&(t.summary=[...t.summary,...o],t[r]=[])},ot=(t,e)=>{const r={};m.forEach(o=>{o==="summary"?r[o]=Object.keys(e):r[o]=[]});for(const o in e){const n=m.find(s=>o.includes(s));n&&(r[n]=[o,...r[n]],r.summary=r.summary.filter(s=>s!==o))}return N(t,r),v(r),r};export{Z as a,J as b,H as c,g as d,rt as e,Y as f,q as g,et as h,ot as i,X as j,tt as k,z as s};
