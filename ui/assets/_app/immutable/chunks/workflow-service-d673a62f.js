import{a7 as v,B as d}from"./index-3630b6f8.js";import{s as C}from"./settings-3c4b85fe.js";import{s as S}from"./simplify-attributes-254db8ee.js";import{r as u,a as s,b as O,i as F,c as z}from"./route-for-api-0a805b65.js";import{t as U}from"./list-workflow-query-407de9fb.js";import{s as h}from"./parse-with-big-int-0036a80a.js";import{e as $}from"./route-for-b71c2be4.js";import{v as B}from"./toaster-ae3b14ff.js";const Q=(o=C)=>!v(o).disableWriteActions,R=(o=[])=>o.map(t=>{const n=S(t,!0),r=t.activityId;return{...n,id:r}}),g=o=>{var y,x,I,T,b;const t=o.workflowExecutionInfo.type.name,n=o.workflowExecutionInfo.execution.workflowId,r=o.workflowExecutionInfo.execution.runId,e=String(o.workflowExecutionInfo.startTime),i=String(o.workflowExecutionInfo.closeTime),a=o.workflowExecutionInfo.status,f=o.workflowExecutionInfo.status==="Running",l=o.workflowExecutionInfo.historyLength,w=`/workflows/${n}/${r}`,E=(x=(y=o==null?void 0:o.executionConfig)==null?void 0:y.taskQueue)==null?void 0:x.name,c=(I=o==null?void 0:o.workflowExecutionInfo)==null?void 0:I.parentNamespaceId,k=(T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.parentExecution,m=o.workflowExecutionInfo.stateTransitionCount,A=(b=o.executionConfig)==null?void 0:b.defaultWorkflowTaskTimeout,p=R(o.pendingActivities),P=(o==null?void 0:o.pendingChildren)??[];return{name:t,id:n,runId:r,startTime:e,endTime:i,status:a,historyEvents:l,url:w,taskQueue:E,pendingActivities:p,pendingChildren:P,parentNamespaceId:c,parent:k,stateTransitionCount:m,isRunning:f,defaultWorkflowTaskTimeout:A,get canBeTerminated(){return f&&Q()}}},_=o=>(o.executions||[]).map(t=>g({workflowExecutionInfo:t})),q=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),W=(o,t=$)=>t?q(o):o,V=async(o,t,n=fetch)=>{let r=0,e=0;try{const i=u("workflows.count",{namespace:o});if(t){const a=s(i,{params:{query:t},onError:d,handleError:d,request:n}),f=s(i,{params:{query:""},onError:d,handleError:d,request:n}),[l,w]=await Promise.all([a,f]);e=l==null?void 0:l.count,r=w==null?void 0:w.count}else{const a=await s(i,{params:{},onError:d,handleError:d,request:n});r=a==null?void 0:a.count}}catch{}return{count:e,totalCount:r}},D=async(o,t,n=fetch,r=!1)=>{const e=decodeURIComponent(t.query||U(t,r)),i=r?"workflows.archived":"workflows";let a="";const f=c=>{var k,m;O(c),(k=c==null?void 0:c.body)!=null&&k.message||c!=null&&c.status?a=((m=c==null?void 0:c.body)==null?void 0:m.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:a="Error fetching workflows: Server failed to respond"},l=u(i,{namespace:o}),{executions:w,nextPageToken:E}=await s(l,{params:{query:e},onError:f,handleError:f,request:n})??{executions:[],nextPageToken:""};return{workflows:_({executions:w}),nextPageToken:String(E),error:a}},X=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const i=f=>{(F(f)||z(f))&&(e=!1)},a=u(r,{namespace:o});return await s(a,{params:{pageSize:"1"},onError:i,handleError:i,request:t}),{authorized:e}},Y=async(o,t,n=fetch)=>D(o,t,n,!0);async function Z(o,t=fetch){const n=u("workflow",o);return s(n,{request:t}).then(g)}async function oo({workflow:o,namespace:t,reason:n}){const r=u("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await s(r,{options:{method:"POST",body:h({reason:n})},shouldRetry:!1,notifyOnError:!1})}async function to({namespace:o,workflowId:t,runId:n},r=fetch){const e=u("workflow.cancel",{namespace:o,workflowId:t,runId:n});return s(e,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function no({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:e}){const i=u("workflow.signal",{namespace:o,workflowId:t,runId:n});return s(i,{notifyOnError:!1,options:{method:"POST",body:h({signalName:r,input:{payloads:e?[{metadata:{encoding:W("json/plain")},data:W(h(e))}]:null}})}})}async function ro({namespace:o,workflowId:t,runId:n,eventId:r,reason:e}){const i=u("workflow.reset",{namespace:o,workflowId:t,runId:n}),a={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,requestId:B(),reason:e};return s(i,{notifyOnError:!1,options:{method:"POST",body:h(a)}})}async function eo(o,t=fetch){const n=e=>{console.error(e)},r=u("workflow",o);return s(r,{request:t,onError:n,handleError:n}).then(g)}export{D as a,V as b,to as c,X as d,Y as e,Z as f,eo as g,ro as r,no as s,oo as t,Q as w};
