import{g}from"./navigation.e1e39077.js";import{w as v}from"./index.deae5bd4.js";import{c as y,p as M}from"./route-for.079809f2.js";import{c as C,e as O,b as Q}from"./schedule-frequency.e03cf56f.js";const f=e=>e?parseInt(e):0,W=(e,a,t,s)=>`${f(e)*60*60*24+f(a)*60*60+f(t)*60+f(s)}s`,j=({months:e=[],daysOfMonth:a=[],daysOfWeek:t=[]})=>{var l,n;const s=e.sort((o,i)=>parseInt(o)-parseInt(i)).join(","),r=a.sort((o,i)=>o-i).join(","),u=(((n=(l=t==null?void 0:t[0])==null?void 0:l.split(","))==null?void 0:n.length)>1?t[0].split(","):t).sort((o,i)=>parseInt(o)-parseInt(i)).join(",");return{month:s,dayOfMonth:r,dayOfWeek:u}},I=(e,a,t)=>{const{hour:s,minute:r,second:c,phase:u,cronString:l}=a,{preset:n,months:o,days:i,daysOfMonth:p,daysOfWeek:h}=t;if(n==="string"){const m=`${l}#${l}`;e.schedule.spec.cronString=[m],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(n==="interval"){const m=W(i,s,r,c);e.schedule.spec.interval=[{interval:m,phase:u||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:m,dayOfMonth:k,dayOfWeek:S}=j({months:o,daysOfMonth:p,daysOfWeek:h}),T=Q({preset:n,month:m,dayOfMonth:k,dayOfWeek:S,hour:s,minute:r,second:c});e.schedule.spec.calendar=[{year:"*",month:n==="month"?m:"",dayOfMonth:n==="month"?k:"",dayOfWeek:n==="week"?S:"",hour:s,minute:r,second:c,comment:T}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},F=async({action:e,spec:a,presets:t})=>{const{namespace:s,name:r,workflowId:c,workflowType:u,taskQueue:l}=e,n={schedule_id:r,schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:c,workflowType:{name:u},taskQueue:{name:l}}}}};I(n,a,t),d.set(!0);const{error:o}=await C({namespace:s,body:n});o?(w.set(o),d.set(!1)):setTimeout(()=>{w.set(""),d.set(!1),g(y({namespace:s}))},2e3)},A=async({action:e,spec:a,presets:t},s,r)=>{const{namespace:c,name:u,workflowId:l,workflowType:n,taskQueue:o}=e,{preset:i}=t,p={schedule:{...s,action:{startWorkflow:{...s.action.startWorkflow,workflowId:l,workflowType:{name:n},taskQueue:{name:o}}}}};i==="existing"?p.schedule.spec=s.spec:(I(p,a,t),p.schedule.spec.structuredCalendar=[]),d.set(!0);const{error:h}=await O({namespace:c,scheduleId:r,body:p});h?(w.set(h),d.set(!1)):setTimeout(()=>{g(M({namespace:c,scheduleId:u})),w.set(""),d.set(!1)},2e3)},d=v(!1),w=v("");export{F as a,w as e,d as l,A as s};
