import{g as S,d as v,w as p}from"./DIJxQKhU.js";import{p as $}from"./CRTn9FRk.js";import{t as P}from"./DEjs8ZrU.js";import{A as g}from"./ClzYi2Ei.js";import{b as _o,c as Ro,a as ko}from"./CkOZlzt8.js";import{h as bo,i as Wo,j as po,k as Lo}from"./DNNVWk-J.js";import{s as Co,t as yo}from"./BZL4ehd_.js";import{X as Do}from"./Dv1JtHFQ.js";import{i as Io,s as No}from"./BtTWWzY2.js";import{a as Yo}from"./Cr79p1AK.js";import{m as Po,r as w,a as f,b as Uo,p as $o,c as Oo,d as Fo,e as G,i as qo}from"./BNX8QuUT.js";import{e as W,s as Bo}from"./8GLR7rJF.js";import{p as Qo}from"./BLvxuJH_.js";import{s as h}from"./ikbOq2O5.js";import{i as jo,b as zo,t as ho,c as vo}from"./CtQjrHKC.js";import{a as Go}from"./BvePjuxV.js";const Vo=["json/plain","json/protobuf"],Xo=o=>Vo.includes(o),Mo=(o=Co)=>!S(o).disableWriteActions,Ko=(o=[])=>o.map(t=>{const n=Do(t,!0),r=t.activityId,e=t.state;return{...n,id:r,state:Wo(e)}}),Ho=o=>o?o.map(t=>({...t,state:po(t.state)})):[],Jo=o=>o?o.map(t=>({...t,state:Lo(t.state)})):[],Zo=o=>!o||!o.indexedFields?{}:{indexedFields:Object.entries(o.indexedFields).reduce((n,[r,e])=>({...n,[r]:_o(e)}),{})},ot=({executionTime:o,startTime:t})=>{if(!o||!t)return;const n=new Date(o).getTime()-new Date(t).getTime();if(n>0)return Math.round(n/1e3)+"s"},V=o=>{var J,Z,oo,to,no,ro,eo,ao,so,io,co,uo,lo,fo,wo,Eo,mo;const t=Zo(o.workflowExecutionInfo.searchAttributes),n=o.workflowExecutionInfo.memo,r=o.workflowExecutionInfo.type.name,e=o.workflowExecutionInfo.execution.workflowId,a=o.workflowExecutionInfo.execution.runId,c=o.workflowExecutionInfo.startTime,s=o.workflowExecutionInfo.closeTime,i=o.workflowExecutionInfo.executionTime,d=bo(o.workflowExecutionInfo.status),l=d==="Running",E=d==="Paused",u=o.workflowExecutionInfo.historyLength,k=o.workflowExecutionInfo.historySizeBytes,y=`/workflows/${e}/${a}`,x=((Z=(J=o==null?void 0:o.executionConfig)==null?void 0:J.taskQueue)==null?void 0:Z.name)||((oo=o==null?void 0:o.workflowExecutionInfo)==null?void 0:oo.taskQueue),I=(to=o==null?void 0:o.workflowExecutionInfo)==null?void 0:to.mostRecentWorkerVersionStamp,F=(no=o==null?void 0:o.workflowExecutionInfo)==null?void 0:no.assignedBuildId,q=(ro=o==null?void 0:o.workflowExecutionInfo)==null?void 0:ro.parentNamespaceId,_=(eo=o==null?void 0:o.workflowExecutionInfo)==null?void 0:eo.parentExecution,L=o.workflowExecutionInfo.stateTransitionCount,C=(ao=o.executionConfig)==null?void 0:ao.defaultWorkflowTaskTimeout,T=(so=o.executionConfig)==null?void 0:so.workflowExecutionTimeout,M=Ko(o.pendingActivities),b=(o==null?void 0:o.pendingChildren)??[],m=Ho(o==null?void 0:o.pendingNexusOperations),D=o==null?void 0:o.pendingWorkflowTask,N=Jo(o==null?void 0:o.callbacks),B=(io=o.workflowExecutionInfo)==null?void 0:io.rootExecution,Q=(co=o.workflowExecutionInfo)==null?void 0:co.versioningInfo,j=(uo=o.workflowExecutionInfo)==null?void 0:uo.priority,A=o.workflowExtendedInfo??{},Ao=ot({executionTime:i,startTime:c});let K,H;return(lo=o==null?void 0:o.executionConfig)!=null&&lo.userMetadata&&(K=(wo=(fo=o==null?void 0:o.executionConfig)==null?void 0:fo.userMetadata)==null?void 0:wo.summary,H=(mo=(Eo=o==null?void 0:o.executionConfig)==null?void 0:Eo.userMetadata)==null?void 0:mo.details),{name:r,id:e,runId:a,startTime:c,endTime:s,executionTime:i,status:d,historyEvents:u,historySizeBytes:k,searchAttributes:t,memo:n,rootExecution:B,url:y,taskQueue:x,assignedBuildId:F,mostRecentWorkerVersionStamp:I,pendingActivities:M,pendingChildren:b,pendingNexusOperations:m,pendingWorkflowTask:D,callbacks:N,versioningInfo:Q,priority:j,summary:K,details:H,parentNamespaceId:q,parent:_,stateTransitionCount:L,isRunning:l,isPaused:E,defaultWorkflowTaskTimeout:C,workflowExecutionTimeout:T,workflowExtendedInfo:A,startDelay:Ao,get canBeTerminated(){return l&&Mo()}}},R=o=>(o.executions||[]).map(t=>V({workflowExecutionInfo:t})),Ct=p(0),tt=v([$],([o])=>{var t,n;return(n=(t=o.data)==null?void 0:t.settings)==null?void 0:n.hideWorkflowQueryErrors}),Dt=v([$],([o])=>{var t,n;return(n=(t=o.data)==null?void 0:t.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),nt=v([Io,yo],([o,t])=>o||Po("1.23.0",t)),Nt=p(""),Yt=p({count:0,newCount:0}),z=p(""),Ut=p("");var Y=(o=>(o[o.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",o[o.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",o[o.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",o))(Y||{}),U=(o=>(o[o.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",o[o.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",o[o.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",o[o.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",o))(U||{});const rt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},et=["workflowId","workflowType","timeRange","executionStatus","closeTime"],at=o=>!(o===null||o===void 0||o===""||typeof o=="string"&&o==="undefined"),st=o=>{if(typeof o!="string")return!1;for(const t of et)if(t===o)return!0;return!1},it=(o,t,n)=>{const r=rt[o];return t==="All"?"":jo(t)||zo(t)?n||S(No)?`${r} > "${ho(t)}"`:`${r} BETWEEN "${ho(t)}" AND "${vo()}"`:`${r}="${t}"`},ct=(o,t)=>Object.entries(o).map(([n,r])=>{if(st(n)&&at(r))return it(n,r,t)}).filter(Boolean),go=(o,t=!1)=>ct(o,t).join(" and ");function ut(o){console.error("Unhandled action:",o)}const dt=(o,t)=>{let n;switch(o){case g.Cancel:n=P("workflows.canceled");break;case g.Reset:n=P("workflows.reset");break;case g.Terminate:n=P("workflows.terminated");break;case g.Pause:n=P("workflows.paused");break;case g.Unpause:n=P("workflows.unpaused");break;case g.Signal:n=P("workflows.signaled");break;default:ut(o)}return P("workflows.workflow-action-reason-placeholder",{action:n,identity:t||P("common.unknown")})},O=({action:o,reason:t,identity:n})=>{const r=dt(o,n);return t?[t.trim(),r].join(" "):r},To=["category=WorkflowTaskFailed","category=WorkflowTaskTimedOut"],lt=`\`ExecutionStatus\`="Running" AND \`TemporalReportedProblems\` IN (${To.map(o=>'"'+o+'"').join(", ")})`,$t=o=>{var n,r;return!o.searchAttributes||o.status!=="Running"?!1:(((r=(n=o.searchAttributes)==null?void 0:n.indexedFields)==null?void 0:r.TemporalReportedProblems)||[]).some(e=>To.includes(e))},Ot=async(o,t=fetch)=>{try{const n=w("workflows.count",{namespace:o}),r=await f(n,{params:{query:lt},onError:()=>{},handleError:()=>{},request:t});return parseInt((r==null?void 0:r.count)||"0")}catch{}},So=async({namespace:o,query:t})=>{const n="GROUP BY ExecutionStatus",r=w("workflows.count",{namespace:o}),{count:e,groups:a}=await f(r,{params:{query:t?`${t} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},Ft=async({namespace:o,query:t})=>{const n='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',r=t?`${n} AND ${t}`:n,e=w("workflows.count",{namespace:o}),{count:a}=await f(e,{params:{query:r},notifyOnError:!1});return a??"0"},ft=async(o,t,n=fetch,r=!1)=>{const e=t.query||go(t,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=r?"workflows.archived":"workflows";let s="";const i=u=>{var k,y;G(u),(k=u==null?void 0:u.body)!=null&&k.message||u!=null&&u.status?s=((y=u==null?void 0:u.body)==null?void 0:y.message)??`Error fetching workflows: ${u.status}: ${u.statusText}`:s="Error fetching workflows: Server failed to respond"},d=w(c,{namespace:o}),{executions:l,nextPageToken:E}=await f(d,{params:{query:a},onError:i,handleError:i,request:n})??{executions:[],nextPageToken:""};return{workflows:R({executions:l}),nextPageToken:String(E),error:s}},qt=async({namespace:o,workflowId:t,url:n},r=fetch)=>{var l;const e="workflows",a=n??Uo(o),c=$o(e,{namespace:o}),s=a+c,{executions:i}=await f(s,{params:{query:`WorkflowId="${t}"`,pageSize:"1"},request:r})??{executions:[]},d=(l=R({executions:i}))==null?void 0:l[0];return{runId:d==null?void 0:d.runId}},Bt=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=s=>{(Oo(s)||Fo(s))&&(e=!1)},c=w(r,{namespace:o});return await f(c,{params:{pageSize:"1"},onError:a,handleError:a,request:t}),{authorized:e}};async function X(o,t=fetch){const n=w("workflow",{namespace:o.namespace,workflowId:o.workflowId});return f(n,{request:t,notifyOnError:!1,params:o.runId?{"execution.runId":o.runId}:{}}).then(r=>({workflow:V(r)})).catch(r=>({error:r}))}async function Qt({workflow:o,namespace:t,reason:n,first:r,identity:e}){const a=w("workflow.terminate",{namespace:t,workflowId:o.id}),c=O({reason:n,action:g.Terminate,identity:e});return await f(a,{options:{method:"POST",body:h({reason:c,...e&&{identity:e},firstExecutionRunId:r})},notifyOnError:!1,params:r?{}:{"execution.runId":o.runId}})}async function jt({namespace:o,workflow:{id:t,runId:n},identity:r},e=fetch){const a={namespace:o,workflowExecution:{workflowId:t,runId:n},requestId:crypto.randomUUID(),...r&&{identity:r}},c=w("workflow.cancel",{namespace:o,workflowId:t});return f(c,{request:e,notifyOnError:!1,options:{method:"POST",body:h(a)},params:{"execution.runId":n}})}async function zt({namespace:o,workflow:{id:t,runId:n},name:r,input:e,encoding:a,messageType:c,identity:s}){const i=w("workflow.signal",{namespace:o,workflowId:t,signalName:r}),d=await W({input:e,encoding:a,messageType:c}),l=S($).data.settings,E=(l==null?void 0:l.version)??"",u=qo(E,"2.22"),k={signalName:r,input:{payloads:d},...s&&{identity:s},...u?{workflowExecution:{workflowId:t,runId:n}}:{params:{"execution.runId":n}}};return f(i,{notifyOnError:!1,options:{method:"POST",body:h(k)}})}async function vt({namespace:o,workflow:{workflowId:t,runId:n},name:r,identity:e,updateId:a,input:c="",encoding:s}){const i=w("workflow.update",{namespace:o,workflowId:t,updateName:r}),d=await W({input:c,encoding:s});return f(i,{notifyOnError:!1,options:{method:"POST",body:h({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:e},input:{args:{payloads:d}}}})}})}async function Gt({namespace:o,workflow:{id:t,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:c,excludeUpdates:s,identity:i}){const d=w("workflow.reset",{namespace:o,workflowId:t}),l=O({action:g.Reset,reason:e,identity:i}),E={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,requestId:crypto.randomUUID(),reason:l,...i&&{identity:i}};if(S(Io)||Po("1.24.0",S(yo))){const u=[];!c&&!s&&u.push(Y.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),c&&u.push(Y.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),s&&u.push(Y.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),E.resetReapplyExcludeTypes=u,E.resetReapplyType=U.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let u;a?u=U.RESET_REAPPLY_TYPE_SIGNAL:u=U.RESET_REAPPLY_TYPE_NONE,E.resetReapplyType=u}return f(d,{notifyOnError:!1,options:{method:"POST",body:h(E)},params:{"execution.runId":n}})}async function Vt({namespace:o,workflow:{id:t,runId:n},reason:r,identity:e},a=fetch){const c=O({action:g.Pause,reason:r,identity:e}),s={namespace:o,workflowId:t,runId:n,reason:c,requestId:crypto.randomUUID(),...e&&{identity:e}},i=w("workflow.pause",{namespace:o,workflowId:t});return f(i,{request:a,notifyOnError:!1,options:{method:"POST",body:h(s)},params:{"execution.runId":n}})}async function Xt({namespace:o,workflow:{id:t,runId:n},reason:r,identity:e},a=fetch){const c=O({action:g.Unpause,reason:r,identity:e}),s={namespace:o,workflowId:t,runId:n,reason:c,requestId:crypto.randomUUID(),...e&&{identity:e}},i=w("workflow.unpause",{namespace:o,workflowId:t});return f(i,{request:a,notifyOnError:!1,options:{method:"POST",body:h(s)},params:{"execution.runId":n}})}async function Mt(o,t=fetch){const n=e=>{console.error(e)},r=w("workflow",o);return f(r,{request:t,onError:n,handleError:n}).then(V)}async function Kt(o,t,n){if(!S(nt))return[];try{let r=`ParentWorkflowId = "${t}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await ft(o,{query:r});return e}catch{return[]}}const wt=o=>{if(!o.length)return{};const t={};return o.forEach(n=>{t[n.label]=Bo(n.value)}),t};async function Ht({namespace:o,workflowId:t,taskQueue:n,workflowType:r,input:e,summary:a,details:c,encoding:s,messageType:i,searchAttributes:d,identity:l,workflowStartDelay:E}){const u=w("workflow",{namespace:o,workflowId:t});let k,y,x;if(e)try{k=await W({input:e,encoding:s,messageType:i})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(y=(await W({input:h(a),encoding:"json/plain"}))[0]),c&&(x=(await W({input:h(c),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const I=h({workflowId:t,taskQueue:{name:n},workflowType:{name:r},input:k?{payloads:k}:null,userMetadata:{summary:y,details:x},searchAttributes:d.length===0?null:{indexedFields:{...wt(d)}},...l&&{identity:l},...E&&{workflowStartDelay:E}});return f(u,{notifyOnError:!1,options:{method:"POST",body:I}})}const Jt=async({namespace:o,runId:t,workflowType:n,workflowId:r})=>{var c,s,i,d,l,E,u,k,y,x;const e=I=>{console.error(I)},a={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{const I=[];t&&I.push(`RunId = "${t}"`),n&&I.push(`WorkflowType = "${n}"`),r&&I.push(`WorkflowId = "${r}"`);const F=I.join(" AND "),q=w("workflows",{namespace:o}),_=await f(q,{params:{query:F,pageSize:"1"},handleError:e});if(!((c=_==null?void 0:_.executions)!=null&&c[0]))return a;const L=R(_)[0],C={namespace:o,workflowId:L.id,runId:L.runId},{workflow:T}=await X(C),b=await Go(C),m=await Ro((s=b==null?void 0:b.attributes)==null?void 0:s.input,o,S($).data.settings,S(Yo).accessToken,"readable",!1);let D="";if(T.summary){const A=await ko(T.summary);typeof A=="string"&&(D=A)}let N="";if(T.details){const A=await ko(T.details);typeof A=="string"&&(N=A)}const B=m!=null&&m.payloads?h((i=m.payloads[0])==null?void 0:i.data):"",Q=m!=null&&m.payloads&&Xo((l=(d=m.payloads[0])==null?void 0:d.metadata)==null?void 0:l.encoding)?(u=(E=m.payloads[0])==null?void 0:E.metadata)==null?void 0:u.encoding:"json/plain",j=m!=null&&m.payloads?(y=(k=m.payloads[0])==null?void 0:k.metadata)==null?void 0:y.messageType:"";return{input:B,encoding:Q,messageType:j,searchAttributes:(x=T==null?void 0:T.searchAttributes)==null?void 0:x.indexedFields,summary:D,details:N}}catch{return a}},Et=(o,t)=>{const n=new Map;t.forEach(e=>{if(e.parent){const a=`${e.parent.workflowId}:${e.parent.runId}`,c=n.get(a)||[];c.push(e),n.set(a,c)}});const r=(e,a)=>{var d,l;const c=`${e.id}:${e.runId}`,s=n.get(c)||[],i={workflow:e,scheduleId:(l=(d=e==null?void 0:e.searchAttributes)==null?void 0:d.indexedFields)==null?void 0:l.TemporalScheduledById,children:[],rootPaths:[...a,{runId:e.runId,workflowId:e.id}]};return i.children=s.map(E=>r(E,i.rootPaths)),i};return r(o,[])},mt=({parent:o,workflow:t,children:n,siblingCount:r})=>{const e=n.map(s=>{const i=o?[{runId:o.runId,workflowId:o.id},{runId:t.runId,workflowId:t.id},{runId:s.runId,workflowId:s.id}]:[{runId:t.runId,workflowId:t.id},{runId:s.runId,workflowId:s.id}];return{workflow:s,siblingCount:r,children:[],rootPaths:i}}),a={workflow:t,children:e,rootPaths:o?[{runId:o.runId,workflowId:o.id},{runId:t.runId,workflowId:t.id}]:[{runId:t.runId,workflowId:t.id}]};return o?{workflow:o,children:[a],rootPaths:[{runId:o.runId,workflowId:o.id}]}:a};async function Zt(o,t,n){let r=`RootWorkflowId = "${t}"`;return n&&(r+=` AND RootRunId = "${n}"`),await So({namespace:o,query:r})}async function on(o,t,n){let r=`RootWorkflowId = "${t}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await X({namespace:o,workflowId:t,runId:n}),a=await xo(o,{query:r});return Et(e==null?void 0:e.workflow,a)}async function tn({namespace:o,parentWorkflowId:t,parentRunId:n,workflow:r}){let e;const a=async(i,d)=>{const l=`ParentWorkflowId = "${i}" AND ParentRunId = "${d}"`;return await xo(o,{query:l})};let c=0;if(t){e=await X({namespace:o,workflowId:t,runId:n});const i=`ParentWorkflowId = "${t}" AND ParentRunId = "${n}"`,{count:d}=await So({namespace:o,query:i});c=parseInt(d)}const s=await a(r.id,r.runId);return mt({parent:e==null?void 0:e.workflow,workflow:r,children:s,siblingCount:c})}const xo=async(o,t,n=fetch,r=!1)=>{const e=t.query||go(t,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=w("workflows",{namespace:o}),{executions:s}=await Qo(async i=>f(c,{token:i,request:n,params:{query:a}}));return R({executions:s})},nn=async(o,t="",n=fetch)=>(r=100,e="")=>{z.set("");const a=s=>{var i;G(s),S(tt)?z.set(P("workflows.workflows-error-querying")):z.set(((i=s==null?void 0:s.body)==null?void 0:i.message)||P("workflows.workflows-error-querying"))},c=w("workflows",{namespace:o});return f(c,{params:{pageSize:String(r),nextPageToken:e,...t?{query:t}:{}},request:n,onError:a,handleError:a}).then(({executions:s=[],nextPageToken:i=""})=>({items:R({executions:s}),nextPageToken:i?String(i):""}))},rn=async(o,t="",n=fetch)=>(r=100,e="")=>{const a=s=>{G(s)},c=w("workflows.archived",{namespace:o});return f(c,{params:{pageSize:String(r),nextPageToken:e,...t?{query:t}:{}},request:n,onError:a,handleError:a}).then(({executions:s=[],nextPageToken:i=""})=>({items:R({executions:s}),nextPageToken:i?String(i):""}))};export{zt as A,Xt as B,vt as C,dt as D,z as E,nn as F,Ot as G,Vo as H,lt as T,Bt as a,So as b,Ht as c,Dt as d,Jt as e,qt as f,Nt as g,Ut as h,rn as i,jt as j,$t as k,Xo as l,Mo as m,tn as n,Kt as o,Zt as p,on as q,Ct as r,wt as s,Qt as t,Mt as u,Ft as v,Yt as w,X as x,Vt as y,Gt as z};
