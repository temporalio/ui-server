import{h as K}from"./BJzbPR4R.js";import{o as g,k as p,g as _,p as z,f as v,q as W,r as C,s as H,d as N,u as h,v as F,w as L,x as J,y as Q,z as G,A as V,c as P,e as M,B as X,C as Y,D as x,E as Z,F as tt,G as it,H as et,I as rt,b as st,J as nt,K as at,L as dt,M as ot,N as ut,O as lt,P as U,Q as R,R as k,S as T,T as w,U as S,h as f,V as m,j as b,W as ct}from"./BK33eyBo.js";import{i as Et,b as ft,g as gt}from"./CO6S6ldn.js";import{k as pt}from"./CtQjrHKC.js";const kt=(t,i)=>{let e;return g(t)&&(e=i.find(s=>s.activityId===t.attributes.activityId)),e},mt=(t,i)=>{let e;return p(t)&&(e=i.find(s=>String(s.scheduledEventId)===t.id)),e},It=(t,i)=>t.find(e=>{var s,r;if(_(i))return e.eventIds.has(i.id);if(Et(i))return((s=e.pendingActivity)==null?void 0:s.id)===i.id;if(ft(i))return((r=e==null?void 0:e.pendingNexusOperation)==null?void 0:r.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),j=t=>F(t)||L(t)||J(t)||Q(t)||G(t)||V(t)||P(t)||M(t)||X(t)||Y(t)||x(t)||Z(t),Ot=t=>I(t)?t.isFailureOrTimedOut:j(t),q=t=>W(t)||C(t)||H(t)||N(t)||h(t),vt=t=>I(t)?t.isCanceled:q(t),B=t=>z(t)||v(t),Wt=t=>I(t)?t.isTerminated:B(t),y=t=>tt(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):W(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):L(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):et(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):rt(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):v(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):st(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):N(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):P(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):M(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):nt(t)?String(t.timerFiredEventAttributes.startedEventId):C(t)?String(t.timerCanceledEventAttributes.startedEventId):at(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):dt(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):ot(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):lt(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):G(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):U(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):R(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):x(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):h(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,$=t=>{var i,e,s,r,u,n,E,d,l,a,c,O;if(!t)return"";if(g(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(k(t))return`${(s=t.timerStartedEventAttributes)==null?void 0:s.timerId} (${pt(String((r=t.timerStartedEventAttributes)==null?void 0:r.startToFireTimeout))})`;if(T(t))return(u=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.signalName;if(w(t))return(n=t.workflowExecutionSignaledEventAttributes)==null?void 0:n.signalName;if(S(t))return f(t)?"Local Activity":(E=t.markerRecordedEventAttributes)==null?void 0:E.markerName;if(m(t))return(l=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:l.name;if(b(t))return(O=(c=(a=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:a.acceptedRequest)==null?void 0:c.input)==null?void 0:O.name;if(p(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},At=t=>{if(!t)return"";if(g(t))return"Activity";if(k(t))return"Timer";if(T(t))return"Signal";if(w(t))return"Signal received";if(f(t))return"Local Activity";if(S(t))return"Marker";if(m(t))return"Child Workflow";if(b(t))return"Workflow Update";if(p(t)||U(t))return"Nexus Operation"},ht=t=>{var i,e;return t?f(t)?((e=(i=gt(t))==null?void 0:i.value)==null?void 0:e.toString())??"Local Activity":$(t):""},A=({events:t})=>{let i=0,e;for(const s of t.values()){const r=Number(s.id);r>=i&&(i=r,e=s)}return e},o=t=>{const i=y(t),e=$(t),s=At(t),r=ht(t),{timestamp:u,category:n,classification:E}=t,d=new Map,l=new Set;return d.set(t.id,t),l.add(t.id),{id:i,name:e,label:s,displayName:r,events:d,eventIds:l,initialEvent:t,timestamp:u,category:f(t)?"local-activity":n,classification:E,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,userMetadata:t==null?void 0:t.userMetadata,get eventTime(){var a;return(a=this.lastEvent)==null?void 0:a.eventTime},get attributes(){var a;return(a=A(this))==null?void 0:a.attributes},get eventList(){return Array.from(this.events,([a,c])=>c)},get links(){return Array.from(this.events,([a,c])=>c.links).flat()},get lastEvent(){return A(this)},get finalClassification(){return A(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||k(this.initialEvent)&&this.eventList.length===1||m(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(j)},get isCanceled(){return!!this.eventList.find(q)},get isTerminated(){return!!this.eventList.find(B)},get billableActions(){return this.eventList.reduce((a,c)=>c.billableActions+a,0)}}},xt=t=>{if(g(t)||m(t)||k(t)||T(t)||w(t))return o(t);if(S(t))return f(t),o(t);if(b(t)||p(t))return o(t)},Tt=t=>{if(ct(t))return o(t)},D=(t,i,e=void 0,s=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,e&&(t.pendingActivity=e),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,s&&(t.pendingNexusOperation=s);const r=R(i)||x(i)||h(i);t.pendingNexusOperation&&r&&delete t.pendingNexusOperation},Ct=(t,i="ascending",e=[],s=[])=>{const r={},u=n=>{const E=y(n),d=xt(n),l=kt(n,e),a=mt(n,s);d?(r[d.id]=d,l&&(d.pendingActivity=l),a&&(d.pendingNexusOperation=a)):D(r[E],n,l,a)};if(i==="ascending")for(const n of t)u(n);else for(let n=t.length-1;n>=0;n--)u(t[n]);return i==="descending"?Object.values(r).reverse():Object.values(r)},I=t=>t==null?!1:K(t,"events"),Nt=(t,i="ascending")=>{const e={},s=r=>{const u=y(r),n=Tt(r);n?e[n.id]=n:D(e[u],r)};if(i==="ascending")for(const r of t)s(r);else for(let r=t.length-1;r>=0;r--)s(t[r]);return i==="descending"?Object.values(e).reverse():Object.values(e)};export{Nt as a,It as b,vt as c,Wt as d,Ot as e,Ct as g,I as i};
