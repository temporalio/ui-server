import{t as Y,x as F,y as M,ai as G,bj as J,Q as R,R as K,a6 as X,bk as Z,bl as ee,ah as C,B as te,bm as se,P as O}from"./B6CF0p-B.js";import{w as P}from"./CfXw_P7u.js";import{g as z}from"./DnBsIdq8.js";import{b as B,s as oe,t as re}from"./DRvaxOdj.js";import{t as A}from"./DEjs8ZrU.js";import"./DAcYyk2F.js";import{s as w}from"./ikbOq2O5.js";import{r as p,a as f}from"./6VjwDyXo.js";import{s as D}from"./qGBPmX0J.js";import{e as E}from"./-SvDEFxd.js";function Se(e,r,s=!1,t=!1,a=!1){var n=e,i="";Y(()=>{var c=G;if(i===(i=r()??"")){F&&M();return}if(c.nodes!==null&&(J(c.nodes.start,c.nodes.end),c.nodes=null),i!==""){if(F){R.data;for(var o=M(),u=o;o!==null&&(o.nodeType!==K||o.data!=="");)u=o,o=X(o);if(o===null)throw Z(),ee;C(R,u),n=te(o);return}var l=i+"";s?l=`<svg>${l}</svg>`:t&&(l=`<math>${l}</math>`);var d=se(l);if((s||t)&&(d=O(d)),C(O(d),d.lastChild),s||t)for(;O(d);)n.before(O(d));else n.before(d)}})}const be=async(e,r,s,t=fetch)=>(a=100,n="")=>{const i=p("schedules",{namespace:e});return f(i,{params:{maximumPageSize:String(a),nextPageToken:n,...r?{query:r}:{}},request:t,onError:s}).then(({schedules:c,nextPageToken:o})=>({items:c,nextPageToken:o?String(o):""}))};async function Te(e,r=fetch){const s=p("schedule",e);return f(s,{request:r})}async function _e({namespace:e,scheduleId:r,identity:s},t=fetch){const a=p("schedule",{namespace:e,scheduleId:r});return f(a,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function ae({namespace:e,scheduleId:r,body:s,identity:t}){let a="";const n=o=>{var u;return a=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=p("schedule",{namespace:e,scheduleId:r}),{conflictToken:c}=await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:n});return{conflictToken:c,error:a}}async function ne({namespace:e,scheduleId:r,body:s,identity:t}){let a="";const n=c=>{var o;return a=((o=c==null?void 0:c.body)==null?void 0:o.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=p("schedule.edit",{namespace:e,scheduleId:r});return await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:n}),{error:a}}async function ke({namespace:e,scheduleId:r,reason:s,identity:t}){const a={patch:{pause:s}},n=p("schedule.patch",{namespace:e,scheduleId:r});return await f(n,{options:{method:"POST",body:w({...a,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function ve({namespace:e,scheduleId:r,reason:s,identity:t}){const a={patch:{unpause:s}},n=p("schedule.patch",{namespace:e,scheduleId:r});return await f(n,{options:{method:"POST",body:w({...a,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Ie({namespace:e,scheduleId:r,overlapPolicy:s,identity:t}){const a={patch:{triggerImmediately:{overlapPolicy:s}}},n=p("schedule.patch",{namespace:e,scheduleId:r});return await f(n,{options:{method:"POST",body:w({...a,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Oe({namespace:e,scheduleId:r,overlapPolicy:s,identity:t,startTime:a,endTime:n}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:a,endTime:n}]}},c=p("schedule.patch",{namespace:e,scheduleId:r});return await f(c,{options:{method:"POST",body:w({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const $=e=>e?parseInt(e):0,ce=(e,r,s,t)=>`${$(e)*60*60*24+$(r)*60*60+$(s)*60+$(t)}s`,ie=({months:e=[],daysOfMonth:r=[],daysOfWeek:s=[]})=>{var c,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),a=r.sort((u,l)=>u-l).join(","),i=(((o=(c=s==null?void 0:s[0])==null?void 0:c.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:a,dayOfWeek:i}},W=e=>e.length===0?null:{indexedFields:{...D(e)}},N=(e,r,s)=>{const{hour:t,minute:a,second:n,phase:i,cronString:c}=r,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${c}#${c}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=ce(l,t,a,n);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:b}=ie({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?b:"",hour:t,minute:a,second:n}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}};let Q,x;const $e=async({action:e,spec:r,presets:s})=>{const{identity:t,namespace:a,name:n,workflowId:i,workflowType:c,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await E({input:u,encoding:l,messageType:d})}catch(k){y.set(`${A("data-encoder.encode-error")}: ${k==null?void 0:k.message}`);return}const b={schedule_id:n.trim(),searchAttributes:S.length===0?null:{indexedFields:{...D(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...D(h)}}}}}};N(b,r,s),_.set(!0);const{error:T}=await ae({identity:t,scheduleId:n,namespace:a,body:b});T?(y.set(T),_.set(!1)):(clearTimeout(Q),Q=setTimeout(()=>{y.set(""),_.set(!1),z(B(re({namespace:a}),{}))},2e3))},Ae=async({action:e,spec:r,presets:s},t,a)=>{var q,j;const{identity:n,namespace:i,name:c,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:b}=e;let T;if(d)try{T=await E({input:d,encoding:S,messageType:h})}catch(m){y.set(`${A("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}const{preset:k}=s,v={schedule_id:a,searchAttributes:W(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:T?{payloads:T}:null},searchAttributes:W(b)}}}},I=(j=(q=v.schedule.action.startWorkflow)==null?void 0:q.header)==null?void 0:j.fields;if(I&&Object.keys(I).length>0)try{const m=Object.entries(I);for(const[H,L]of m){const V=await E({input:w(L),encoding:"json/plain"});I[H]=V[0]}}catch(m){y.set(`${A("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}k==="existing"?v.schedule.spec=t.spec:(N(v,r,s),v.schedule.spec.structuredCalendar=[]),_.set(!0);const{error:U}=await ne({identity:n,namespace:i,scheduleId:a,body:v});U?(y.set(U),_.set(!1)):(clearTimeout(x),x=setTimeout(()=>{z(B(oe({namespace:i,scheduleId:c}),{})),y.set(""),_.set(!1)},2e3))},_=P(!1),y=P(""),De=P("0");export{$e as a,Oe as b,De as c,_e as d,y as e,Te as f,be as g,Se as h,_ as l,ke as p,Ae as s,Ie as t,ve as u};
