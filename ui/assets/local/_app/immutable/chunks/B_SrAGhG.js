import"./CWj6FrbW.js";import{a as at}from"./DsVF0eUi.js";import{p as nt,al as k,am as Q,aN as ut,g as t,f as K,e as W,b as ct,u as p,s as c,G as f,r as A,i as it,c as lt,j as ft}from"./CckrFwdx.js";import{d as mt}from"./_IQD3yTx.js";import{i as pt}from"./CoMawi-e.js";import{e as wt}from"./BTEtt5uP.js";import{p as B,a as g,s as dt,e as P,c as ht}from"./BioCYJcK.js";import{p as v}from"./j9zg6QAh.js";import{S as yt}from"./CfczflME.js";import{r as kt,w as _,b as D,d as gt}from"./C2yDo0aG.js";import{w as G}from"./Cb8_DOM-.js";import{c as vt}from"./B3P80PfG.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as N}from"./CzQaMwA0.js";import{b as xt}from"./BaPH8xFG.js";import{t as Ct,c as St}from"./SaVKtE1U.js";import{u as bt}from"./54pEi8p7.js";import{W as Et}from"./DMYAVgzQ.js";const O=(i=[])=>i.map(e=>{const o=xt(e==null?void 0:e.groupValues[0]),r=parseInt(e.count);return{status:o,count:r}}).sort((e,o)=>N.indexOf(e.status)-N.indexOf(o.status)),Wt=(i,e)=>{if(e<=1)return i*1e3;const o=300,w=i*Math.pow(1.2,e-1);return Math.min(o,Math.round(w))*1e3};var Pt=K("<button><!></button>"),Tt=K('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function Ut(i,e){nt(e,!0);const o=()=>g(G,"$workflowFilters",d),r=()=>g(_,"$workflowCount",d),w=()=>g(gt,"$disableWorkflowCountsRefresh",d),T=()=>g(kt,"$refresh",d),[d,Y]=dt();let j=B(e,"staticQuery",3,""),F=B(e,"refreshTime",15);const H=p(()=>v.url.searchParams.get("query")),x=p(()=>v.params.namespace),C=p(()=>j()||t(H)),L=p(()=>v.url.searchParams.get("per-page"));let I=k(Q([])),h=k(Q([])),q,m=k(1),S=k(!1);const U=60,V=20,z=s=>{if(!o().some(n=>n.attribute==="ExecutionStatus"&&n.value===s)){const n={attribute:"ExecutionStatus",type:_t.KEYWORD,value:s,operator:"",conditional:"=",parenthesis:""};ht(G,[...o(),n]);const u=Ct(St(o()));bt({url:v.url,parameter:"query",value:u,clearParameters:[vt]})}},R=()=>{clearTimeout(q),c(h,[],!0),P(_,f(r).newCount=0,f(r)),c(m,1)},J=async()=>{c(S,!0);try{const{count:s,groups:a}=await D({namespace:t(x),query:t(C)}).catch(n=>({count:"0",groups:[]}));P(_,f(r).count=parseInt(s),f(r)),c(I,O(a),!0)}finally{F(new Date),c(S,!1)}},X=async()=>{try{const{count:s,groups:a}=await D({namespace:t(x),query:t(C)}).catch(n=>({count:"0",groups:[]}));P(_,f(r).newCount=parseInt(s)-r().count,f(r)),c(h,O(a),!0)}finally{F(new Date),c(m,t(m)+1)}},$=()=>{const s=Wt(U,t(m));q=setTimeout(async()=>{await X(),!w()&&t(m)<=V&&$()},s)},Z=async()=>{R(),await J(),w()||$()};ut(()=>{t(x),t(C),t(L),T(),Z()}),at(()=>{R()});var b=Tt();wt(b,21,()=>t(I),({count:s,status:a})=>a,(s,a)=>{let n=()=>t(a).count,u=()=>t(a).status;var M=it(),tt=lt(M);{var et=l=>{var y=Pt();y.__click=()=>z(u());var rt=ft(y);{let ot=p(()=>t(h).find(E=>E.status===u())?t(h).find(E=>E.status===u()).count-n():0);Et(rt,{get status(){return u()},get count(){return n()},get newCount(){return t(ot)},get"test-id"(){return`workflow-status-${u()??""}`}})}A(y),W(l,y)},st=l=>{yt(l,{class:"h-6 w-24 rounded-sm"})};pt(tt,l=>{t(S)?l(st,!1):l(et)})}W(s,M)}),A(b),W(i,b),ct(),Y()}mt(["click"]);export{Ut as W};
