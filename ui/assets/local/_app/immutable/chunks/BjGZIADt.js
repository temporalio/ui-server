import"./Bzak7iHL.js";import{p as at,u as w,ah as k,ai as $,aI as nt,t as N,r as A,e as W,b as ut,g as t,s as i,K as f,h as ct,f as it,i as lt}from"./DOHD4F2H.js";import{d as ft}from"./iKtCZmbp.js";import{i as mt}from"./4jpKiR-7.js";import{e as pt}from"./h55qdt6V.js";import{p as B,s as wt,a as v,e as P,c as dt}from"./CgvkIcHY.js";import{a as ht}from"./BsnfN2fh.js";import{p as g}from"./CxL7Tr3C.js";import{S as yt}from"./BLcK_6Kv.js";import{r as kt,w as _,b as D,d as vt}from"./DjuHjTsZ.js";import{w as O}from"./DxqCgfHX.js";import{c as gt}from"./CyjWABYi.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as G}from"./CBC8ua9K.js";import{b as xt}from"./BtbwEbd_.js";import{t as Ct,c as St}from"./CF__OUIi.js";import{u as bt}from"./CqGSvt1-.js";import{W as Et}from"./BLj37aqX.js";const K=(u=[])=>u.map(e=>{const s=xt(e==null?void 0:e.groupValues[0]),d=parseInt(e.count);return{status:s,count:d}}).sort((e,s)=>G.indexOf(e.status)-G.indexOf(s.status)),Wt=(u,e)=>{if(e<=1)return u*1e3;const s=300,m=u*Math.pow(1.2,e-1);return Math.min(s,Math.round(m))*1e3};var Pt=(u,e,s)=>e(s()),It=N("<button><!></button>"),Tt=N('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function jt(u,e){at(e,!0);const[s,d]=wt(),m=()=>v(O,"$workflowFilters",s),n=()=>v(_,"$workflowCount",s),I=()=>v(vt,"$disableWorkflowCountsRefresh",s),Y=()=>v(kt,"$refresh",s);let H=B(e,"staticQuery",3,""),T=B(e,"refreshTime",15);const L=w(()=>g.url.searchParams.get("query")),x=w(()=>g.params.namespace),C=w(()=>H()||t(L)),U=w(()=>g.url.searchParams.get("per-page"));let F=k($([])),h=k($([])),q,p=k(1),S=k(!1);const V=60,j=20,z=r=>{if(!m().some(a=>a.attribute==="ExecutionStatus"&&a.value===r)){const a={attribute:"ExecutionStatus",type:_t.KEYWORD,value:r,operator:"",conditional:"=",parenthesis:""};dt(O,[...m(),a]);const c=Ct(St(m()));bt({url:g.url,parameter:"query",value:c,clearParameters:[gt]})}},R=()=>{clearTimeout(q),i(h,[],!0),P(_,f(n).newCount=0,f(n)),i(p,1)},J=async()=>{i(S,!0);try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).count=parseInt(r),f(n)),i(F,K(o),!0)}finally{T(new Date),i(S,!1)}},X=async()=>{try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).newCount=parseInt(r)-n().count,f(n)),i(h,K(o),!0)}finally{T(new Date),i(p,t(p)+1)}},M=()=>{const r=Wt(V,t(p));q=setTimeout(async()=>{await X(),!I()&&t(p)<=j&&M()},r)},Z=async()=>{R(),await J(),I()||M()};nt(()=>{t(x),t(C),t(U),Y(),Z()}),ht(()=>{R()});var b=Tt();pt(b,21,()=>t(F),({count:r,status:o})=>o,(r,o)=>{let a=()=>t(o).count,c=()=>t(o).status;var Q=ct(),tt=it(Q);{var et=l=>{var y=It();y.__click=[Pt,z,c];var rt=lt(y);const ot=w(()=>t(h).find(E=>E.status===c())?t(h).find(E=>E.status===c()).count-a():0);Et(rt,{get status(){return c()},get count(){return a()},get newCount(){return t(ot)},get"test-id"(){return`workflow-status-${c()??""}`}}),A(y),W(l,y)},st=l=>{yt(l,{class:"h-6 w-24 rounded-sm"})};mt(tt,l=>{t(S)?l(st,!1):l(et)})}W(r,Q)}),A(b),W(u,b),ut(),d()}ft(["click"]);export{jt as W};
