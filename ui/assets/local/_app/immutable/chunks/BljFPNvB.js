import{t as V,x as C,y as j,al as Y,bq as J,G as F,T as K,a8 as X,br as Z,bs as ee,ak as R,C as te,aj as se,an as oe,bt as ne,R as E}from"./DZ1-1a5q.js";import{w as D}from"./D7JzDj9r.js";import{g as Q}from"./B6q_Dlna.js";import{b as z,t as re,u as ae}from"./DCDVNMgg.js";import{t as O}from"./DEjs8ZrU.js";import"./DAcYyk2F.js";import{s as S}from"./ikbOq2O5.js";import{r as m,a as g}from"./Cy0A1TgT.js";import{s as P}from"./CpHp7-gC.js";import{e as $}from"./BAUAFOHM.js";function be(e,n,s=!1,t=!1,r=!1){var a=e,i="";V(()=>{var c=Y;if(i===(i=n()??"")){C&&j();return}if(c.nodes!==null&&(J(c.nodes.start,c.nodes.end),c.nodes=null),i!==""){if(C){F.data;for(var o=j(),u=o;o!==null&&(o.nodeType!==K||o.data!=="");)u=o,o=X(o);if(o===null)throw Z(),ee;R(F,u),a=te(o);return}var l=s?oe:t?ne:void 0,h=se(s?"svg":t?"math":"template",l);h.innerHTML=i;var d=s||t?h:h.content;if(R(E(d),d.lastChild),s||t)for(;E(d);)a.before(E(d));else a.before(d)}})}const _e=async(e,n,s,t=fetch)=>(r=100,a="")=>{const i=m("schedules",{namespace:e});return g(i,{params:{maximumPageSize:String(r),nextPageToken:a,...n?{query:n}:{}},request:t,onError:s}).then(({schedules:c,nextPageToken:o})=>({items:c,nextPageToken:o?String(o):""}))};async function ke(e,n=fetch){const s=m("schedule",e);return g(s,{request:n})}async function ve({namespace:e,scheduleId:n,identity:s},t=fetch){const r=m("schedule",{namespace:e,scheduleId:n});return g(r,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function ce({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const a=o=>{var u;return r=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=m("schedule",{namespace:e,scheduleId:n}),{conflictToken:c}=await g(i,{options:{method:"POST",body:S({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:a});return{conflictToken:c,error:r}}async function ie({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const a=c=>{var o;return r=((o=c==null?void 0:c.body)==null?void 0:o.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:n});return await g(i,{options:{method:"POST",body:S({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:a}),{error:r}}async function Ie({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{pause:s}},a=m("schedule.patch",{namespace:e,scheduleId:n});return await g(a,{options:{method:"POST",body:S({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function Ae({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{unpause:s}},a=m("schedule.patch",{namespace:e,scheduleId:n});return await g(a,{options:{method:"POST",body:S({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Ee({namespace:e,scheduleId:n,overlapPolicy:s,identity:t}){const r={patch:{triggerImmediately:{overlapPolicy:s}}},a=m("schedule.patch",{namespace:e,scheduleId:n});return await g(a,{options:{method:"POST",body:S({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Oe({namespace:e,scheduleId:n,overlapPolicy:s,identity:t,startTime:r,endTime:a}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:r,endTime:a}]}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await g(c,{options:{method:"POST",body:S({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const A=e=>e?parseInt(e):0,ue=(e,n,s,t)=>`${A(e)*60*60*24+A(n)*60*60+A(s)*60+A(t)}s`,le=({months:e=[],daysOfMonth:n=[],daysOfWeek:s=[]})=>{var c,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),r=n.sort((u,l)=>u-l).join(","),i=(((o=(c=s==null?void 0:s[0])==null?void 0:c.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:i}},W=e=>e.length===0?null:{indexedFields:{...P(e)}},H=(e,n,s)=>{const{hour:t,minute:r,second:a,phase:i,cronString:c}=n,{preset:o,months:u,days:l,daysOfMonth:h,daysOfWeek:d}=s;if(o==="string"){const p=`${c}#${c}`;e.schedule.spec.cronString=[p],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const p=ue(l,t,r,a);e.schedule.spec.interval=[{interval:p,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:p,dayOfMonth:y,dayOfWeek:T}=le({months:u,daysOfMonth:h,daysOfWeek:d});e.schedule.spec.calendar=[{year:"*",month:o==="month"?p:"",dayOfMonth:o==="month"?y:"",dayOfWeek:o==="week"?T:"",hour:t,minute:r,second:a}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}};let N,x;const Pe=async({action:e,spec:n,presets:s})=>{const{identity:t,namespace:r,name:a,workflowId:i,workflowType:c,taskQueue:o,input:u,encoding:l,messageType:h,searchAttributes:d,workflowSearchAttributes:p}=e;let y;if(u)try{y=await $({input:u,encoding:l,messageType:h})}catch(k){w.set(`${O("data-encoder.encode-error")}: ${k==null?void 0:k.message}`);return}const T={schedule_id:a.trim(),searchAttributes:d.length===0?null:{indexedFields:{...P(d)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:o},input:y?{payloads:y}:null,searchAttributes:p.length===0?null:{indexedFields:{...P(p)}}}}}};H(T,n,s),_.set(!0);const{error:b}=await ce({identity:t,scheduleId:a,namespace:r,body:T});b?(w.set(b),_.set(!1)):(clearTimeout(N),N=setTimeout(()=>{w.set(""),_.set(!1),Q(z(ae({namespace:r}),{}))},2e3))},$e=async({action:e,spec:n,presets:s},t,r)=>{var U,q;const{identity:a,namespace:i,name:c,workflowId:o,workflowType:u,taskQueue:l,input:h,encoding:d,messageType:p,searchAttributes:y,workflowSearchAttributes:T}=e;let b;if(h)try{b=await $({input:h,encoding:d,messageType:p})}catch(f){w.set(`${O("data-encoder.encode-error")}: ${f==null?void 0:f.message}`);return}const{preset:k}=s,v={schedule_id:r,searchAttributes:W(y),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...h!==void 0&&{input:b?{payloads:b}:null},searchAttributes:W(T)}}}},I=(q=(U=v.schedule.action.startWorkflow)==null?void 0:U.header)==null?void 0:q.fields;if(I&&Object.keys(I).length>0)try{const f=Object.entries(I);for(const[L,B]of f){const G=await $({input:S(B),encoding:"json/plain"});I[L]=G[0]}}catch(f){w.set(`${O("data-encoder.encode-error")}: ${f==null?void 0:f.message}`);return}k==="existing"?v.schedule.spec=t.spec:(H(v,n,s),v.schedule.spec.structuredCalendar=[]),_.set(!0);const{error:M}=await ie({identity:a,namespace:i,scheduleId:r,body:v});M?(w.set(M),_.set(!1)):(clearTimeout(x),x=setTimeout(()=>{Q(z(re({namespace:i,scheduleId:c}),{})),w.set(""),_.set(!1)},2e3))},_=D(!1),w=D(""),De=D("0");export{Pe as a,Oe as b,De as c,ve as d,w as e,ke as f,_e as g,be as h,_ as l,Ie as p,$e as s,Ee as t,Ae as u};
