import{B as e}from"./CoG0geaG.js";import{g}from"./CoDfbHBk.js";import{w as C,g as I}from"./D12POdU-.js";import{t as O}from"./D9gMh8gV.js";import{h as v}from"./rlUF3pky.js";import{i as F}from"./CXxME4Cq.js";import{v as k,w as L,e as W}from"./B77Y4v_U.js";import{i as j}from"./9nawnOgc.js";import{p as T}from"./CgnK0o2R.js";const P=C(null),S=(o,n=O,i=P,s=e)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),U(o)&&s&&window.location.assign(k(o==null?void 0:o.message)),q(o)&&s&&window.location.assign(k(o==null?void 0:o.message)),F(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),i.set(o)),o},un=(o,n=e)=>{var s;const i=`${o==null?void 0:o.status} ${(s=o==null?void 0:o.body)==null?void 0:s.message}`;if(U(o)&&n){window.location.assign(k(i));return}if(q(o)&&n){window.location.assign(k(i));return}},U=o=>x(o,401),q=o=>x(o,403),x=(o,n)=>v(o,"statusCode")?o.statusCode===n:v(o,"status")?o.status===n:!1,_=15e3,tn=async(o,n={})=>{const{params:i={},request:s=fetch,token:t,notifyOnError:c=!0,handleError:u=S,onError:l,isBrowser:y=e}=n;let{options:w}=n,d=new URLSearchParams;if(i!=null&&i.entries)d=i,t&&d.set("nextPageToken",t);else{const h=t?{next_page_token:t}:{};d=new URLSearchParams({...i,...h})}const N=L(o,d);try{w=z(w,y),o.endsWith("api/v1/settings")||(w=await J(w,y));const f=[...d.values()].some(R=>R.length>_)?new Response(JSON.stringify({message:"Query string is too long"}),{status:414,statusText:"URI Too Long"}):await s(N,w),$=await f.json(),{status:E,statusText:A}=f;if(!f.ok)if(l&&j(l))l({status:E,statusText:A,body:$});else throw{statusCode:f.status,statusText:f.statusText,response:f,message:($==null?void 0:$.message)??f.statusText};return $}catch(h){if(c)u(h);else throw h}},z=(o,n=e)=>{const i={credentials:"include",...o};return i.headers=B(o==null?void 0:o.headers,n),i},J=async(o,n=e)=>(globalThis!=null&&globalThis.AccessToken?o.headers=await b(o==null?void 0:o.headers,globalThis.AccessToken,n):g().accessToken&&(o.headers=await b(o==null?void 0:o.headers,async()=>g().accessToken,n),o.headers=M(o==null?void 0:o.headers,g().idToken,n)),o),b=async(o,n,i=e)=>{if(o||(o={}),!i)return o;try{const s=await n();s&&(o.Authorization=`Bearer ${s}`)}catch(s){console.error(s)}return o},M=(o={},n,i=e)=>(i&&n&&(o["Authorization-Extras"]=n),o),B=(o,n=e)=>{if(o||(o={}),o["Caller-Type"]="operator",!n)return o;const i="_csrf=",s="X-CSRF-TOKEN";try{let c=document.cookie.split(";").find(u=>u.includes(i));c&&!o[s]&&(c=c.trim().slice(i.length),o[s]=c)}catch(t){console.error(t)}return o};function H(o=e){const n="",i=!n.startsWith("http");let s="";return i?s=o?window.location.origin+n:"":s=n,s.endsWith("/")&&(s=s.slice(0,-1)),s}const ln=(o,n)=>{if(!o||!n)return!1;const[i,s,t]=o.split(".").map(Number),[c,u,l]=n.split(".").map(Number);return i!==c?i>c:s!==u?s>u:t>l},Q=(o,n)=>{if(!o||!n)return!1;const[i,s,t]=o.split(".").map(Number),[c,u,l]=n.split(".").map(Number);return i!==c?c>i:s!==u?s===void 0&&u||s===void 0&&u===void 0?!0:u>s:t===void 0&&l||t===void 0&&(l===void 0||isNaN(l))?!0:l>=t},X=(o,n)=>o?o.replace("%namespace%",n):"",D=o=>{var c,u;let n="";const i=(c=I(T).data)==null?void 0:c.webUrl,s=i&&o,t=((u=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:u.apiUrl)&&o;return s?n=i:t?(console.warn("Using fallback api url, web url not found"),n=X(globalThis.AppConfig.apiUrl,o)):n=H(),n=`${n}${W("",{})}`,n.endsWith("/")&&(n=n.slice(0,-1)),n},G=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),K=(o,n)=>`${D(n)}${o}`,Y=o=>{var i,s,t;const n=(t=(s=(i=I(T))==null?void 0:i.data)==null?void 0:s.settings)==null?void 0:t.version;return Object.keys(o??{}).reduce((c,u)=>(n&&Q("2.23.0",n)?c[u]=encodeURIComponent(o[u]):c[u]=encodeURIComponent(encodeURIComponent(o[u])),c),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",runId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function Z(o,n,i=!0){i&&(n=Y(n));const s={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.raw":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/run/${n==null?void 0:n.runId}/history.json`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.update":`/namespaces/${n.namespace}/workflows/${n.workflowId}/update/${n.updateName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"activity.pause":`/namespaces/${n.namespace}/activities/pause`,"activity.unpause":`/namespaces/${n.namespace}/activities/unpause`,"activity.reset":`/namespaces/${n.namespace}/activities/reset`,"activity.update-options":`/namespaces/${n.namespace}/activities/update-options`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`,"worker-deployments":`/namespaces/${n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n.namespace}/worker-deployments/${n.deploymentName}`,"worker-deployment-version":`/namespaces/${n.namespace}/worker-deployment-versions/${n.version}`};return G(s[o])}function en(o,n,i=!0){const s=Z(o,n,i);return K(s,n==null?void 0:n.namespace)}export{_ as M,tn as a,D as b,U as c,q as d,un as e,H as g,S as h,ln as i,Q as m,Z as p,en as r};
