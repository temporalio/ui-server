import"./CWj6FrbW.js";import{a as ot}from"./CfXw_P7u.js";import{p as nt,at as h,au as O,aO as ut,g as t,f as K,e as E,b as ct,v as m,s as c,I as l,r as Q,i as it,c as lt,j as ft}from"./B6CF0p-B.js";import{d as mt}from"./BSSJzwu8.js";import{i as pt}from"./DVfqY6Lp.js";import{e as wt}from"./DNXtLIpi.js";import{p as A,a as y,s as dt,e as W,b as ht}from"./BrOjBIf0.js";import{p as k}from"./54G4BJrX.js";import{S as yt}from"./BFF_e7em.js";import{r as kt,w as g,b as D,d as gt}from"./qGBPmX0J.js";import{w as B}from"./BTYDKgXU.js";import{c as vt}from"./Cpz1pHG5.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as G}from"./DDSNsabO.js";import{b as Ct}from"./CpkAVYt_.js";import{t as xt,c as bt}from"./Cz38GgJv.js";import{g as St}from"./BNcA6Hpw.js";import{u as Et}from"./C-hkFBdy.js";import{W as Wt}from"./CA5yP-F8.js";const N=(v=[])=>v.map(s=>{const n=Ct(s==null?void 0:s.groupValues[0]),r=parseInt(s.count);return{status:n,count:r}}).sort((s,n)=>G.indexOf(s.status)-G.indexOf(n.status));var Pt=K("<button><!></button>"),It=K('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function zt(v,s){nt(s,!0);const n=()=>y(B,"$workflowFilters",p),r=()=>y(g,"$workflowCount",p),P=()=>y(gt,"$disableWorkflowCountsRefresh",p),Y=()=>y(kt,"$refresh",p),[p,j]=dt();let H=A(s,"staticQuery",3,""),I=A(s,"refreshTime",15);const L=m(()=>k.url.searchParams.get("query")),_=m(()=>k.params.namespace),C=m(()=>H()||t(L)),U=m(()=>k.url.searchParams.get("per-page"));let T=h(O([])),w=h(O([])),F,f=h(1),x=h(!1);const V=60,z=20,J=e=>{if(!n().some(o=>o.attribute==="ExecutionStatus"&&o.value===e)){const o={attribute:"ExecutionStatus",type:_t.KEYWORD,value:e,operator:"",conditional:"=",parenthesis:""};ht(B,[...n(),o]);const u=xt(bt(n()));Et({url:k.url,parameter:"query",value:u,clearParameters:[vt]})}},q=()=>{clearTimeout(F),c(w,[],!0),W(g,l(r).newCount=0,l(r)),c(f,1)},M=async()=>{c(x,!0);try{const{count:e,groups:a}=await D({namespace:t(_),query:t(C)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).count=parseInt(e),l(r)),c(T,N(a),!0)}finally{I(new Date),c(x,!1)}},X=async()=>{try{const{count:e,groups:a}=await D({namespace:t(_),query:t(C)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).newCount=parseInt(e)-r().count,l(r)),c(w,N(a),!0)}finally{I(new Date),c(f,t(f)+1)}},R=()=>{const e=St(V,t(f));F=setTimeout(async()=>{await X(),!P()&&t(f)<=z&&R()},e)},Z=async()=>{q(),await M(),P()||R()};ut(()=>{t(_),t(C),t(U),Y(),Z()}),ot(()=>{q()});var b=It();wt(b,21,()=>t(T),({count:e,status:a})=>a,(e,a)=>{let o=()=>t(a).count,u=()=>t(a).status;var $=it(),tt=lt($);{var et=i=>{var d=Pt();d.__click=()=>J(u());var rt=ft(d);{let at=m(()=>t(w).find(S=>S.status===u())?t(w).find(S=>S.status===u()).count-o():0);Wt(rt,{get status(){return u()},get count(){return o()},get newCount(){return t(at)},get"test-id"(){return`workflow-status-${u()??""}`}})}Q(d),E(i,d)},st=i=>{yt(i,{class:"h-6 w-24 rounded-sm"})};pt(tt,i=>{t(x)?i(st,!1):i(et)})}E(e,$)}),Q(b),E(v,b),ct(),j()}mt(["click"]);export{zt as W};
