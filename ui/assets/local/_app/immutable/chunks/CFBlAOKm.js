import{x as L,v as F,w as R,D as N,G as j,a7 as V,aQ as Y,aR as J,ae as W,A as K,aS as X,P as Z,a5 as ee}from"./C-0kx8Rl.js";import{w as P}from"./Dl-yZlXH.js";import{g as x}from"./4Ty-iDS5.js";import{t as O}from"./BXv1jDVW.js";import"./D0Jyh3oV.js";import{s as w}from"./BDfAQ6r3.js";import{r as p,a as f}from"./Ceej4-su.js";import{i as $}from"./DHkKW-ie.js";import{e as D}from"./Btjl2rBL.js";import{s as te,t as se}from"./UB0htMZJ.js";function ye(e,r,s,t,n){var c=e,i="",a;L(()=>{if(i===(i=r()??"")){F&&R();return}a!==void 0&&(ee(a),a=void 0),i!==""&&(a=N(()=>{if(F){j.data;for(var o=R(),u=o;o!==null&&(o.nodeType!==8||o.data!=="");)u=o,o=V(o);if(o===null)throw Y(),J;W(j,u),c=K(o);return}var l=i+"",d=X(l);W(Z(d),d.lastChild),c.before(d)}))})}const we=async(e,r,s,t=fetch)=>(n=100,c="")=>{const i=p("schedules",{namespace:e});return f(i,{params:{maximumPageSize:String(n),nextPageToken:c,...r?{query:r}:{}},request:t,onError:s}).then(({schedules:a,nextPageToken:o})=>({items:a,nextPageToken:o?String(o):""}))};async function Se(e,r=fetch){const s=p("schedule",e);return f(s,{request:r})}async function Te({namespace:e,scheduleId:r,identity:s},t=fetch){const n=p("schedule",{namespace:e,scheduleId:r});return f(n,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function oe({namespace:e,scheduleId:r,body:s,identity:t}){let n="";const c=o=>{var u;return n=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=p("schedule",{namespace:e,scheduleId:r}),{conflictToken:a}=await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:c});return{conflictToken:a,error:n}}async function re({namespace:e,scheduleId:r,body:s,identity:t}){let n="";const c=a=>{var o;return n=((o=a==null?void 0:a.body)==null?void 0:o.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=p("schedule.edit",{namespace:e,scheduleId:r});return await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:c}),{error:n}}async function ke({namespace:e,scheduleId:r,reason:s,identity:t}){const n={patch:{pause:s}},c=p("schedule.patch",{namespace:e,scheduleId:r});return await f(c,{options:{method:"POST",body:w({...n,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function be({namespace:e,scheduleId:r,reason:s,identity:t}){const n={patch:{unpause:s}},c=p("schedule.patch",{namespace:e,scheduleId:r});return await f(c,{options:{method:"POST",body:w({...n,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function _e({namespace:e,scheduleId:r,overlapPolicy:s,identity:t}){const n={patch:{triggerImmediately:{overlapPolicy:s}}},c=p("schedule.patch",{namespace:e,scheduleId:r});return await f(c,{options:{method:"POST",body:w({...n,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function ve({namespace:e,scheduleId:r,overlapPolicy:s,identity:t,startTime:n,endTime:c}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:n,endTime:c}]}},a=p("schedule.patch",{namespace:e,scheduleId:r});return await f(a,{options:{method:"POST",body:w({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const A=e=>e?parseInt(e):0,ne=(e,r,s,t)=>`${A(e)*60*60*24+A(r)*60*60+A(s)*60+A(t)}s`,ae=({months:e=[],daysOfMonth:r=[],daysOfWeek:s=[]})=>{var a,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),n=r.sort((u,l)=>u-l).join(","),i=(((o=(a=s==null?void 0:s[0])==null?void 0:a.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:n,dayOfWeek:i}},C=e=>e.length===0?null:{indexedFields:{...$(e)}},z=(e,r,s)=>{const{hour:t,minute:n,second:c,phase:i,cronString:a}=r,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${a}#${a}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=ne(l,t,n,c);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:T}=ae({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?T:"",hour:t,minute:n,second:c}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}};let M,Q;const Ie=async({action:e,spec:r,presets:s})=>{const{identity:t,namespace:n,name:c,workflowId:i,workflowType:a,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await D({input:u,encoding:l,messageType:d})}catch(_){y.set(`${O("data-encoder.encode-error")}: ${_==null?void 0:_.message}`);return}const T={schedule_id:c.trim(),searchAttributes:S.length===0?null:{indexedFields:{...$(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...$(h)}}}}}};z(T,r,s),b.set(!0);const{error:k}=await oe({identity:t,scheduleId:c,namespace:n,body:T});k?(y.set(k),b.set(!1)):(clearTimeout(M),M=setTimeout(()=>{y.set(""),b.set(!1),x(se({namespace:n}))},2e3))},Ae=async({action:e,spec:r,presets:s},t,n)=>{var E,q;const{identity:c,namespace:i,name:a,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:T}=e;let k;if(d)try{k=await D({input:d,encoding:S,messageType:h})}catch(m){y.set(`${O("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}const{preset:_}=s,v={schedule_id:n,searchAttributes:C(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:k?{payloads:k}:null},searchAttributes:C(T)}}}},I=(q=(E=v.schedule.action.startWorkflow)==null?void 0:E.header)==null?void 0:q.fields;if(I&&Object.keys(I).length>0)try{const m=Object.entries(I);for(const[B,G]of m){const H=await D({input:w(G),encoding:"json/plain"});I[B]=H[0]}}catch(m){y.set(`${O("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}_==="existing"?v.schedule.spec=t.spec:(z(v,r,s),v.schedule.spec.structuredCalendar=[]),b.set(!0);const{error:U}=await re({identity:c,namespace:i,scheduleId:n,body:v});U?(y.set(U),b.set(!1)):(clearTimeout(Q),Q=setTimeout(()=>{x(te({namespace:i,scheduleId:a})),y.set(""),b.set(!1)},2e3))},b=P(!1),y=P(""),Oe=P("0");export{Ie as a,ve as b,Oe as c,Te as d,y as e,Se as f,we as g,ye as h,b as l,ke as p,Ae as s,_e as t,be as u};
