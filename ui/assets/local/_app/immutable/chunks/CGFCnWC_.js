import{B as d}from"./CoG0geaG.js";import{s as P,g as T}from"./DEsUSA2c.js";import{a as S}from"./Dsr8fVFs.js";import{p as L}from"./DMvnBdKo.js";import{w as _,g as q}from"./r33Ll6et.js";import{t as z}from"./BTcyvo72.js";import{h as A}from"./BJzbPR4R.js";import{i as B}from"./DRcmmJhF.js";import{D as v,E as D,d as J}from"./D9iZU2pd.js";import{i as M}from"./DPLmpjfv.js";import{p as R}from"./D0YMuDhF.js";const b="user",G=(o=d)=>{if(!o)return{};const n=document.cookie.split(";");let i=0,s=n.find(c=>c.includes(b+i)),t="";for(;s;){const[c,e]=s.split("=");t+=e,i++,s=n.find(u=>u.includes(b+i))}if(t)try{const c=S(t),e=L(c);return{accessToken:e==null?void 0:e.AccessToken,idToken:e==null?void 0:e.IDToken,name:e==null?void 0:e.Name,picture:e==null?void 0:e.Picture,email:e==null?void 0:e.Email}}catch(c){console.error(c)}return{}},H=(o=d)=>{if(!o)return;const n=document.cookie.split(";");let i=0,s=n.find(t=>t.includes(b+i));for(;s;){const[t]=s.split("=");document.cookie=`${t}=; max-age=-1; path=/`,i++,s=n.find(c=>c.includes(b+i))}};function C(o=d){const n="",i=!n.startsWith("http");let s="";return i?s=o?window.location.origin+n:"":s=n,s.endsWith("/")&&(s=s.slice(0,-1)),s}let g=null;const Q=async()=>{if(g)return console.debug("[Auth] Reusing existing token refresh promise"),g;const o=performance.now();return console.info("[Auth] Initiating token refresh..."),g=(async()=>{try{const n=await fetch(`${C()}/auth/refresh`,{method:"GET",credentials:"include"});if(!n.ok){const t=performance.now()-o;return console.warn(`[Auth] Token refresh failed with status ${n.status}: ${n.statusText} (duration: ${t.toFixed(2)}ms)`),!1}const i=G(!0);if(i!=null&&i.accessToken){P(i),H(!0);const t=performance.now()-o,c=i.expiresAt?new Date(i.expiresAt).toISOString():"unknown";return console.info(`[Auth] Token refresh successful (duration: ${t.toFixed(2)}ms, expires: ${c})`),!0}const s=performance.now()-o;return console.warn(`[Auth] Token refresh returned no access token (duration: ${s.toFixed(2)}ms)`),!1}catch(n){const i=performance.now()-o;return console.error(`[Auth] Token refresh network error (duration: ${i.toFixed(2)}ms):`,n),!1}finally{g=null}})(),g},X=_(null),K=(o,n=z,i=X,s=d)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),F(o)&&s&&window.location.assign(v()),O(o)&&s&&window.location.assign(v()),B(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),i.set(o)),o},gn=(o,n=d)=>{if(F(o)&&n){window.location.assign(v());return}if(O(o)&&n){window.location.assign(v());return}},F=o=>W(o,401),O=o=>W(o,403),W=(o,n)=>A(o,"statusCode")?o.statusCode===n:A(o,"status")?o.status===n:!1,Y=15e3,yn=async(o,n={})=>{const{params:i={},request:s=fetch,token:t,notifyOnError:c=!0,handleError:e=K,onError:u,isBrowser:w=d}=n;let{options:f}=n,h=new URLSearchParams;if(i!=null&&i.entries)h=i,t&&h.set("nextPageToken",t);else{const y=Object.fromEntries(Object.entries({...i,...t?{next_page_token:t}:{}}).filter(([l,k])=>k!==void 0));h=new URLSearchParams(y)}const j=D(o,h);try{f=U(f,w),o.endsWith("api/v1/settings")||(f=await E(f,w));const a=[...h.values()].some(x=>x.length>Y),y=async()=>a?new Response(JSON.stringify({message:"Query string is too long"}),{status:414,statusText:"URI Too Long"}):await s(j,f);let l=await y(),{status:k,statusText:I}=l;w&&k===401&&await Q()&&(f=U(n.options,w),o.endsWith("api/v1/settings")||(f=await E(f,w)),l=await y(),k=l.status,I=l.statusText);const $=await l.json();if(!l.ok)if(u&&M(u))u({status:k,statusText:I,body:$});else throw{statusCode:l.status,statusText:l.statusText,response:l,message:($==null?void 0:$.message)??l.statusText};return $}catch(a){if(c)e(a);else throw a}},U=(o,n=d)=>{const i={credentials:"include",...o};return i.headers=Z(i.headers,n),i},E=async(o,n=d)=>{const i=o.headers??{};if(globalThis!=null&&globalThis.AccessToken){const s=globalThis.AccessToken;o.headers=await N(i,s,n)}else T().accessToken&&(o.headers=await N(i,async()=>T().accessToken??"",n),o.headers=p(o.headers,T().idToken??"",n));return o},N=async(o,n,i=d)=>{if(!i)return o;try{const s=await n();s&&(o.Authorization=`Bearer ${s}`)}catch(s){console.error(s)}return o},p=(o,n,i=d)=>(i&&n&&(o["Authorization-Extras"]=n),o),Z=(o,n=d)=>{const i=o??{};if(i["Caller-Type"]="operator",!n)return i;const s="_csrf=",t="X-CSRF-TOKEN";try{let e=document.cookie.split(";").find(u=>u.includes(s));e&&!i[t]&&(e=e.trim().slice(s.length),i[t]=e)}catch(c){console.error(c)}return i},vn=(o,n)=>{if(!o||!n)return!1;const[i,s,t]=o.split(".").map(Number),[c,e,u]=n.split(".").map(Number);return i!==c?i>c:s!==e?s>e:t>u},V=(o,n)=>{if(!o||!n)return!1;const[i,s,t]=o.split(".").map(Number),[c,e,u]=n.split(".").map(Number);return i!==c?c>i:s!==e?s===void 0&&e||s===void 0&&e===void 0?!0:e>s:t===void 0&&u||t===void 0&&(u===void 0||isNaN(u))?!0:u>=t},m=(o,n)=>o?o.replace("%namespace%",n):"",r=o=>{var c,e;let n="";const i=(c=q(R).data)==null?void 0:c.webUrl,s=i&&o,t=((e=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:e.apiUrl)&&o;return s?n=i:t?(console.warn("Using fallback api url, web url not found"),n=m(globalThis.AppConfig.apiUrl,o)):n=C(),n=`${n}${J("",{})}`,n.endsWith("/")&&(n=n.slice(0,-1)),n},nn=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),on=(o,n)=>`${r(n)}${o}`,sn=o=>{var i,s,t;const n=(t=(s=(i=q(R))==null?void 0:i.data)==null?void 0:s.settings)==null?void 0:t.version;return Object.keys(o??{}).reduce((c,e)=>(n&&V("2.23.0",n)?c[e]=encodeURIComponent(o[e]):c[e]=encodeURIComponent(encodeURIComponent(o[e])),c),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",runId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function en(o,n,i=!0){i&&(n=sn(n));const s={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.raw":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/run/${n==null?void 0:n.runId}/history.json`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.update":`/namespaces/${n.namespace}/workflows/${n.workflowId}/update/${n.updateName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"activity.pause":`/namespaces/${n.namespace}/activities/pause`,"activity.unpause":`/namespaces/${n.namespace}/activities/unpause`,"activity.reset":`/namespaces/${n.namespace}/activities/reset`,"activity.update-options":`/namespaces/${n.namespace}/activities/update-options`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`,"worker-deployments":`/namespaces/${n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n.namespace}/worker-deployments/${n.deploymentName}`,"worker-deployment-version":`/namespaces/${n.namespace}/worker-deployment-versions/${n.version}`,"standalone-activity":`/namespaces/${n.namespace}/activities/${n.activityId}`,"standalone-activities":`/namespaces/${n.namespace}/activities`,"standalone-activities.count":`/namespaces/${n.namespace}/activity-count`,"standalone-activity.cancel":`/namespaces/${n.namespace}/activities/${n.activityId}/cancel`,"standalone-activity.terminate":`/namespaces/${n.namespace}/activities/${n.activityId}/terminate`};return nn(s[o])}function bn(o,n,i=!0){const s=en(o,n,i);return on(s,n==null?void 0:n.namespace)}export{Y as M,yn as a,r as b,F as c,O as d,gn as e,H as f,C as g,K as h,vn as i,G as j,V as m,en as p,bn as r};
