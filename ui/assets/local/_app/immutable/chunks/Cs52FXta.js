import"./CWj6FrbW.js";import{a as ot}from"./D7JzDj9r.js";import{p as nt,ax as h,ay as Q,aS as ut,g as t,f as N,e as E,b as ct,v as m,s as c,K as l,r as A,i as it,c as lt,j as ft}from"./DZ1-1a5q.js";import{d as mt,a as pt}from"./DxwvfIkW.js";import{i as wt}from"./DnKg3jxh.js";import{e as dt}from"./DGhzC9On.js";import{p as D,a as y,s as ht,e as W,b as yt}from"./TaaIktnz.js";import{p as k}from"./aARsTTMf.js";import{S as kt}from"./BUscNSy1.js";import{r as gt,w as g,b as O,d as vt}from"./Rufvr3cg.js";import{w as B}from"./CyyOj8SN.js";import{c as _t}from"./D4oZ1vFI.js";import{S as xt}from"./S6Q2Q0ub.js";import{w as G}from"./8mliBfvk.js";import{b as Ct}from"./B-npT5LB.js";import{t as bt,c as St}from"./BIIjE09r.js";import{g as Et}from"./BNcA6Hpw.js";import{a as Wt}from"./CFa-Mhm6.js";import{W as Pt}from"./DPVSJDnS.js";const K=(v=[])=>v.map(s=>{const n=Ct(s==null?void 0:s.groupValues[0]),r=parseInt(s.count);return{status:n,count:r}}).sort((s,n)=>G.indexOf(s.status)-G.indexOf(n.status));var Tt=N("<button><!></button>"),Ft=N('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function Jt(v,s){nt(s,!0);const n=()=>y(B,"$workflowFilters",p),r=()=>y(g,"$workflowCount",p),P=()=>y(vt,"$disableWorkflowCountsRefresh",p),Y=()=>y(gt,"$refresh",p),[p,j]=ht();let H=D(s,"staticQuery",3,""),T=D(s,"refreshTime",15);const L=m(()=>k.url.searchParams.get("query")),_=m(()=>k.params.namespace),x=m(()=>H()||t(L)),U=m(()=>k.url.searchParams.get("per-page"));let F=h(Q([])),w=h(Q([])),I,f=h(1),C=h(!1);const V=60,z=20,J=e=>{if(!n().some(o=>o.attribute==="ExecutionStatus"&&o.value===e)){const o={attribute:"ExecutionStatus",type:xt.KEYWORD,value:e,operator:"",conditional:"=",parenthesis:""};yt(B,[...n(),o]);const u=bt(St(n()));Wt({url:k.url,parameter:"query",value:u,clearParameters:[_t]})}},q=()=>{clearTimeout(I),c(w,[],!0),W(g,l(r).newCount=0,l(r)),c(f,1)},M=async()=>{c(C,!0);try{const{count:e,groups:a}=await O({namespace:t(_),query:t(x)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).count=parseInt(e),l(r)),c(F,K(a),!0)}finally{T(new Date),c(C,!1)}},X=async()=>{try{const{count:e,groups:a}=await O({namespace:t(_),query:t(x)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).newCount=parseInt(e)-r().count,l(r)),c(w,K(a),!0)}finally{T(new Date),c(f,t(f)+1)}},R=()=>{const e=Et(V,t(f));I=setTimeout(async()=>{await X(),!P()&&t(f)<=z&&R()},e)},Z=async()=>{q(),await M(),P()||R()};ut(()=>{t(_),t(x),t(U),Y(),Z()}),ot(()=>{q()});var b=Ft();dt(b,21,()=>t(F),({count:e,status:a})=>a,(e,a)=>{let o=()=>t(a).count,u=()=>t(a).status;var $=it(),tt=lt($);{var et=i=>{var d=Tt(),rt=ft(d);{let at=m(()=>t(w).find(S=>S.status===u())?t(w).find(S=>S.status===u()).count-o():0);Pt(rt,{get status(){return u()},get count(){return o()},get newCount(){return t(at)},get"test-id"(){return`workflow-status-${u()??""}`}})}A(d),pt("click",d,()=>J(u())),E(i,d)},st=i=>{kt(i,{class:"h-6 w-24 rounded-sm"})};wt(tt,i=>{t(C)?i(st,!1):i(et)})}E(e,$)}),A(b),E(v,b),ct(),j()}mt(["click"]);export{Jt as W};
