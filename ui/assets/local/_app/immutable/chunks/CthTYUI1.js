import"./CTB0oJ-z.js";import"./D0Jyh3oV.js";import"./CugiL4oY.js";import"./BuRZGomK.js";import{h as b}from"./BDfAQ6r3.js";import{f as C}from"./BnZXuwac.js";import{e as U,f as N,g as K}from"./DNNVWk-J.js";import{w as q}from"./2uWpc1Jl.js";const D=["workflowExecutionStartedEventAttributes","workflowExecutionCompletedEventAttributes","workflowExecutionFailedEventAttributes","workflowExecutionTimedOutEventAttributes","workflowExecutionOptionsUpdatedEventAttributes","workflowTaskStartedEventAttributes","workflowTaskScheduledEventAttributes","workflowTaskCompletedEventAttributes","workflowTaskTimedOutEventAttributes","workflowTaskFailedEventAttributes","activityTaskScheduledEventAttributes","activityTaskCompletedEventAttributes","activityTaskStartedEventAttributes","activityTaskFailedEventAttributes","activityTaskTimedOutEventAttributes","timerStartedEventAttributes","timerFiredEventAttributes","activityTaskCancelRequestedEventAttributes","activityTaskCanceledEventAttributes","timerCanceledEventAttributes","markerRecordedEventAttributes","workflowExecutionSignaledEventAttributes","workflowExecutionTerminatedEventAttributes","workflowExecutionUpdateAdmittedEventAttributes","workflowExecutionUpdateAcceptedEventAttributes","workflowExecutionUpdateCompletedEventAttributes","workflowExecutionUpdateRejectedEventAttributes","workflowExecutionCancelRequestedEventAttributes","workflowExecutionCanceledEventAttributes","requestCancelExternalWorkflowExecutionInitiatedEventAttributes","requestCancelExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionCancelRequestedEventAttributes","workflowExecutionContinuedAsNewEventAttributes","startChildWorkflowExecutionInitiatedEventAttributes","startChildWorkflowExecutionFailedEventAttributes","childWorkflowExecutionStartedEventAttributes","childWorkflowExecutionCompletedEventAttributes","childWorkflowExecutionFailedEventAttributes","childWorkflowExecutionCanceledEventAttributes","childWorkflowExecutionTimedOutEventAttributes","childWorkflowExecutionTerminatedEventAttributes","signalExternalWorkflowExecutionInitiatedEventAttributes","signalExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionSignaledEventAttributes","upsertWorkflowSearchAttributesEventAttributes","nexusOperationScheduledEventAttributes","nexusOperationStartedEventAttributes","nexusOperationCompletedEventAttributes","nexusOperationFailedEventAttributes","nexusOperationCanceledEventAttributes","nexusOperationTimedOutEventAttributes","nexusOperationCancelRequestedEventAttributes","nexusOperationCancelRequestCompletedEventAttributes","nexusOperationCancelRequestFailedEventAttributes","workflowExecutionOptionsUpdatedEventAttributes","workflowPropertiesModifiedEventAttributes"],V=["WorkflowTaskCompleted","WorkflowTaskFailed","WorkflowTaskTimedOut"],H=t=>{for(const o of D)if(o in t)return o},_=(t,o)=>t[o],B=t=>{const o=H(t),n=_(t,o);return{key:o,attributes:n}},i=t=>o=>!!(o!=null&&o[t]),R=i("workflowExecutionStartedEventAttributes"),St=i("workflowExecutionCompletedEventAttributes"),Ft=i("workflowExecutionFailedEventAttributes"),It=i("workflowExecutionTimedOutEventAttributes"),yt=i("workflowTaskScheduledEventAttributes"),ht=i("workflowTaskStartedEventAttributes"),M=i("workflowTaskCompletedEventAttributes"),gt=i("workflowTaskTimedOutEventAttributes"),S=i("workflowTaskFailedEventAttributes"),Lt=t=>{var o,n,r,s;return S(t)&&((n=(o=t.workflowTaskFailedEventAttributes)==null?void 0:o.failure)==null?void 0:n.message)!=="UnhandledCommand"&&!((s=(r=t.workflowTaskFailedEventAttributes)==null?void 0:r.failure)!=null&&s.resetWorkflowFailureInfo)},Y=i("activityTaskScheduledEventAttributes"),P=i("activityTaskStartedEventAttributes"),Ut=i("activityTaskCompletedEventAttributes"),Nt=i("activityTaskFailedEventAttributes"),Kt=i("activityTaskTimedOutEventAttributes"),X=i("timerStartedEventAttributes"),qt=i("timerFiredEventAttributes"),Dt=i("activityTaskCancelRequestedEventAttributes"),Vt=i("activityTaskCanceledEventAttributes"),Ht=i("timerCanceledEventAttributes"),F=i("markerRecordedEventAttributes"),I=i("workflowExecutionOptionsUpdatedEventAttributes"),j=i("workflowExecutionSignaledEventAttributes"),_t=i("workflowExecutionTerminatedEventAttributes"),Bt=i("workflowExecutionCanceledEventAttributes"),Mt=i("workflowExecutionContinuedAsNewEventAttributes"),G=i("startChildWorkflowExecutionInitiatedEventAttributes"),Yt=i("childWorkflowExecutionStartedEventAttributes"),Pt=i("childWorkflowExecutionCompletedEventAttributes"),Xt=i("childWorkflowExecutionFailedEventAttributes"),jt=i("childWorkflowExecutionCanceledEventAttributes"),Gt=i("childWorkflowExecutionTimedOutEventAttributes"),Jt=i("childWorkflowExecutionTerminatedEventAttributes"),Qt=i("signalExternalWorkflowExecutionInitiatedEventAttributes"),Zt=i("signalExternalWorkflowExecutionFailedEventAttributes"),$t=i("externalWorkflowExecutionSignaledEventAttributes"),J=i("upsertWorkflowSearchAttributesEventAttributes"),zt=t=>V.includes(t.eventType),Q=["LocalActivity","core_local_activity"],te=t=>!(!F(t)||!Q.includes(t.markerRecordedEventAttributes.markerName)),Z=i("workflowExecutionUpdateAcceptedEventAttributes"),$=i("workflowExecutionUpdateRejectedEventAttributes"),z=i("workflowExecutionUpdateCompletedEventAttributes"),ee=t=>{var o;return z(t)&&!!((o=t.workflowExecutionUpdateCompletedEventAttributes.outcome)!=null&&o.failure)},tt=i("nexusOperationScheduledEventAttributes"),oe=i("nexusOperationStartedEventAttributes"),ie=i("nexusOperationCompletedEventAttributes"),ne=i("nexusOperationFailedEventAttributes"),re=i("nexusOperationCanceledEventAttributes"),se=i("nexusOperationTimedOutEventAttributes"),et=i("nexusOperationCancelRequestedEventAttributes"),ot=t=>t.eventType==="WorkflowTaskFailed",y=t=>t.eventType==="WorkflowTaskTimedOut",it=t=>t.eventType==="WorkflowTaskCompleted",h=t=>S(t)&&g(t)==="ResetWorkflow",g=t=>{var r;if(y(t))return"WorkflowTaskTimedOut";const{workflowTaskFailedEventAttributes:{failure:o,cause:n}={}}=t;return((r=o==null?void 0:o.applicationFailureInfo)==null?void 0:r.type)==="workflowTaskHeartbeatError"?"WorkflowTaskHeartbeatError":U(n)},O=t=>{const o=t.findIndex(ot),n=t.findIndex(y),r=o<0?n:o;if(r<0)return;const s=t.findIndex(it),u=t[r];if(g(u)!=="ResetWorkflow"&&(s<0||r<s))return u},ae=(t,o)=>{if(o==="descending")return O(t);{const n=[...t].reverse();return O(n)}},nt=(t,o)=>{var n,r,s,u,c,f,k,w,T,v,A,m,d,E;try{if(R(t)){const a=((n=t.attributes)==null?void 0:n.attempt)||1,l=(r=t.attributes)==null?void 0:r.firstExecutionRunId,p=(s=t.attributes)==null?void 0:s.originalExecutionRunId,L=l===p&&((f=(c=(u=t.attributes)==null?void 0:u.searchAttributes)==null?void 0:c.indexedFields)==null?void 0:f.TemporalScheduledById);return a>1?0:L?3:1}if(Y(t)||X(t)||j(t)&&t.id!=="2"||tt(t)||et(t)||Z(t)||$(t)||I(t))return 1;if(J(t)){const a=Object.keys(t.attributes.searchAttributes.indexedFields);return(a==null?void 0:a.length)===1&&((T=(w=(k=t.attributes)==null?void 0:k.searchAttributes)==null?void 0:w.indexedFields)!=null&&T.TemporalChangeVersion)?0:1}if(F(t)){if(["core_patch","Version"].includes((v=t==null?void 0:t.attributes)==null?void 0:v.markerName))return 0;const l=(A=t.attributes)==null?void 0:A.workflowTaskCompletedEventId;if(l&&o)return o.has(String(l))?0:(o.add(String(l)),1);if(l)return 1}return h(t)?1:G(t)?2:P(t)?(((m=t.attributes)==null?void 0:m.attempt)||1)-1:M(t)?Math.min(((E=(d=t.attributes)==null?void 0:d.meteringMetadata)==null?void 0:E.nonfirstLocalActivityExecutionAttempts)||0,100):0}catch{return 0}},e={ACTIVITY:"activity",CHILD_WORKFLOW:"child-workflow",LOCAL_ACTIVITY:"local-activity",NEXUS:"nexus",SIGNAL:"signal",TIMER:"timer",UPDATE:"update",WORKFLOW:"workflow",OTHER:"other"},W={ActivityTaskCanceled:e.ACTIVITY,ActivityTaskCancelRequested:e.ACTIVITY,ActivityTaskCompleted:e.ACTIVITY,ActivityTaskFailed:e.ACTIVITY,ActivityTaskScheduled:e.ACTIVITY,ActivityTaskStarted:e.ACTIVITY,ActivityTaskTimedOut:e.ACTIVITY,ChildWorkflowExecutionCanceled:e.CHILD_WORKFLOW,ChildWorkflowExecutionCompleted:e.CHILD_WORKFLOW,ChildWorkflowExecutionFailed:e.CHILD_WORKFLOW,ChildWorkflowExecutionStarted:e.CHILD_WORKFLOW,ChildWorkflowExecutionTerminated:e.CHILD_WORKFLOW,ChildWorkflowExecutionTimedOut:e.CHILD_WORKFLOW,StartChildWorkflowExecutionFailed:e.CHILD_WORKFLOW,StartChildWorkflowExecutionInitiated:e.CHILD_WORKFLOW,SignalExternalWorkflowExecutionFailed:e.SIGNAL,SignalExternalWorkflowExecutionInitiated:e.SIGNAL,WorkflowExecutionSignaled:e.SIGNAL,ExternalWorkflowExecutionSignaled:e.SIGNAL,TimerCanceled:e.TIMER,TimerFired:e.TIMER,TimerStarted:e.TIMER,WorkflowExecutionCanceled:e.WORKFLOW,WorkflowExecutionCancelRequested:e.WORKFLOW,WorkflowExecutionCompleted:e.WORKFLOW,WorkflowExecutionContinuedAsNew:e.WORKFLOW,WorkflowExecutionFailed:e.WORKFLOW,WorkflowExecutionStarted:e.WORKFLOW,WorkflowExecutionTerminated:e.WORKFLOW,WorkflowExecutionTimedOut:e.WORKFLOW,WorkflowExecutionOptionsUpdated:e.WORKFLOW,WorkflowTaskCompleted:e.WORKFLOW,WorkflowTaskFailed:e.WORKFLOW,WorkflowTaskScheduled:e.WORKFLOW,WorkflowTaskStarted:e.WORKFLOW,WorkflowTaskTimedOut:e.WORKFLOW,ExternalWorkflowExecutionCancelRequested:e.WORKFLOW,RequestCancelExternalWorkflowExecutionFailed:e.WORKFLOW,RequestCancelExternalWorkflowExecutionInitiated:e.WORKFLOW,WorkflowExecutionUpdateAccepted:e.UPDATE,WorkflowExecutionUpdateCompleted:e.UPDATE,WorkflowExecutionUpdateRequested:e.UPDATE,WorkflowExecutionUpdateRejected:e.UPDATE,WorkflowExecutionUpdateAdmitted:e.UPDATE,NexusOperationScheduled:e.NEXUS,NexusOperationStarted:e.NEXUS,NexusOperationCompleted:e.NEXUS,NexusOperationFailed:e.NEXUS,NexusOperationCanceled:e.NEXUS,NexusOperationTimedOut:e.NEXUS,NexusOperationCancelRequested:e.NEXUS,NexusOperationCancelRequestCompleted:e.NEXUS,NexusOperationCancelRequestFailed:e.NEXUS,MarkerRecorded:e.OTHER,UpsertWorkflowSearchAttributes:e.OTHER,WorkflowPropertiesModified:e.OTHER},rt=[{label:"events.category.activity",value:e.ACTIVITY,description:"events.category.activity-tooltip"},{label:"events.category.child-workflow",value:e.CHILD_WORKFLOW,description:"events.category.child-workflow-tooltip"},{label:"events.category.local-activity",value:e.LOCAL_ACTIVITY,description:"events.category.local-activity-tooltip"},{label:"events.category.signal",value:e.SIGNAL,description:"events.category.signal-tooltip"},{label:"events.category.timer",value:e.TIMER,description:"events.category.timer-tooltip"},{label:"events.category.update",value:e.UPDATE,description:"events.category.update-tooltip"},{label:"events.category.nexus",value:e.NEXUS,description:"events.category.nexus-tooltip"},{label:"events.category.workflow",value:e.WORKFLOW,description:"events.category.workflow-tooltip"},{label:"events.category.other",value:e.OTHER,description:"events.category.other-tooltip"}],st=[e.ACTIVITY,e.LOCAL_ACTIVITY,e.CHILD_WORKFLOW,e.SIGNAL,e.TIMER,e.UPDATE,e.NEXUS,e.OTHER],le=rt.filter(({value:t})=>st.includes(t)),at=t=>(W==null?void 0:W[t])||e.OTHER,lt=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],ut=t=>{if(typeof t=="number")return"Unspecified";if(t.includes("RequestCancel"))return"CancelRequested";for(const o of lt)if(t.includes(o))return o;return"Unspecified"},ct=["closeTime","createTime","currentAttemptScheduledTime","earliestTime","eventTime","executionTime","expirationTime","expireTime","lastAccessTime","lastHeartbeatTime","lastStartedTime","lastUpdateTime","latestTime","releaseTime","scheduledTime","startedTime","startTime","workflowExecutionExpirationTime"],dt=["backoffStartInterval","defaultWorkflowTaskTimeout","firstWorkflowTaskBackoff","heartbeatTimeout","initialInterval","maximumInterval","scheduleToCloseTimeout","scheduleToStartTimeout","startToCloseTimeout","startToFireTimeout","workflowExecutionRetentionPeriod","workflowExecutionRetentionTtl","workflowExecutionTimeout","workflowRunTimeout","workflowTaskTimeout"],Et=t=>{for(const o of ct)if(o===t)return!0;return!1},ft=t=>{for(const o of dt)if(o===t)return!0;return!1},kt=t=>{if(t===null||t===void 0||typeof t!="object")return!1;const o=Object.keys(t),[n]=o;return!(o.length!==1||typeof t[n]!="string")},wt=t=>{for(const o of Object.values(t))return o};function Tt(t,o=!1){for(const[n,r]of Object.entries(t))kt(r)&&(t[n]=wt(r)),Et(n)&&!o&&(t[n]=C(r)),ft(n)&&(t[n]=q(r)),n==="versioningBehavior"&&(t[n]=N(r,"VersioningBehavior"));return b(t,"workerVersion")&&b(t,"deploymentVersion")&&delete t.workerVersion,t}const vt=(t,o=()=>!1,n)=>({...t,billableActions:o(t)?0:nt(t,n)}),At=(t,o={})=>{var d,E,a,l,p,x;const n=String(t.eventId),r=K(t.eventType),s=C(String(t.eventTime)),u=ut(r),c=at(r),{key:f,attributes:k}=B(t),w=R(t)&&((a=(E=(d=t.workflowExecutionStartedEventAttributes)==null?void 0:d.completionCallbacks)==null?void 0:E[0])==null?void 0:a.links),T=I(t)&&((x=(p=(l=t.workflowExecutionOptionsUpdatedEventAttributes)==null?void 0:l.attachedCompletionCallbacks)==null?void 0:p[0])==null?void 0:x.links),v=w||T,A=(t==null?void 0:t.links)||v||[],m={...t,name:r,id:n,eventType:r,timestamp:s,classification:u,category:c,links:A,billableActions:0,attributes:Tt({type:f,...k})};return vt(m,o.shouldNotAddBillableAction,o.processedWorkflowTaskIds)},ue=t=>{const o=t.findLast(h),n=s=>o?Number(s.id)<Number(o.eventId):!1,r=new Set;return t.map(s=>At(s,{shouldNotAddBillableAction:n,processedWorkflowTaskIds:r}))},ce=t=>t===null||typeof t!="object"||Array.isArray(t)?!1:!!b(t,"eventType"),de=t=>{const o={...t};return delete o.name,delete o.id,delete o.timestamp,delete o.classification,delete o.category,delete o.attributes,o};export{y as $,Lt as A,Zt as B,ee as C,ne as D,se as E,P as F,Dt as G,Ut as H,Yt as I,qt as J,z as K,$t as L,ht as M,M as N,S as O,oe as P,ie as Q,X as R,Qt as S,j as T,F as U,G as V,yt as W,Tt as X,le as Y,g as Z,ot as _,I as a,Mt as a0,St as a1,ae as a2,Pt as b,Xt as c,jt as d,Gt as e,Jt as f,ce as g,te as h,R as i,Z as j,tt as k,rt as l,zt as m,de as n,Y as o,_t as p,Vt as q,Ht as r,Bt as s,ue as t,re as u,Kt as v,Nt as w,Ft as x,It as y,gt as z};
