import{d as Q,w as z,g as S}from"./BBGlwGsK.js";import{p as V}from"./B2sskHD-.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as Yt,l as Dt,a as $t,t as Z,h as X,r as M,c as j,f as kt,i as yt,d as K,b as Ot,ac as Ut,g as It,j as Pt}from"./CtXwlho8.js";import{s as Ft}from"./BXc8M6y4.js";import{i as _t}from"./yjFgoZ2z.js";import{s as jt}from"./CykH9iyL.js";import{s as qt}from"./CiDpyPci.js";import{i as Bt}from"./D4D3ThYu.js";import{p as A}from"./DdhuX4yd.js";import{s as Qt,a as zt}from"./CI9zuxJp.js";import{C as Vt}from"./uH6vHrjH.js";import{I as Gt}from"./DdpG80Q9.js";import{R as Xt,a as Tt}from"./IUfGj65Y.js";import{t as x}from"./D2OY9xdY.js";import{P as Mt}from"./Cvf62kfH.js";import{v as pt}from"./Dz_GI0CC.js";import{A as q}from"./TBME1SPK.js";import{b as Kt,c as Ht,a as xt}from"./BVF9Rd5l.js";import{h as Jt,i as Zt,j as to,k as oo}from"./DNNVWk-J.js";import{t as At,s as no}from"./D8UuxXsv.js";import{s as eo}from"./HwMTZFUi.js";import{i as bt,s as ro}from"./DRKZAMDO.js";import{a as ao}from"./Ip-blrGX.js";import{m as Rt,r as m,a as E,b as io,p as so,c as co,d as uo,e as nt,i as lo}from"./Br2L5wzs.js";import{h as fo}from"./BoC3FgNk.js";import{e as B,s as wo}from"./CFj2sB-O.js";import{p as Eo}from"./B2EoZA9y.js";import{s as b}from"./byHaz_JD.js";import{i as mo,a as go,t as St,b as ho}from"./CeMbHz9m.js";import{a as ko}from"./DD49cUY0.js";const xn=z(0),yo=Q([V],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),Sn=Q([V],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),Wt=Q([bt,At],([t,o])=>t||Rt("1.23.0",o)),Io=Q([V],([t])=>t.url.searchParams.get("query")),pn=Q([Io,Wt,fo],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),An=z(""),bn=z({count:0,newCount:0}),ot=z(""),Rn=z(""),Po=["json/plain","json/protobuf"],_o=t=>Po.includes(t);var To=Z("<!> <!>",1),xo=Z('<div class="flex w-full flex-col gap-2"><!> <!></div>'),So=Z("<!> <div><!> <!></div>",1),po=Z('<div><h5 class="pb-1 text-sm font-medium"> </h5> <!></div>');function Wn(t,o){Yt(o,!1);const[n,r]=Qt(),e=()=>zt(i(),"$encoding",n);let a=A(o,"id",24,pt),c=A(o,"input",12),i=A(o,"encoding",12),s=A(o,"messageType",12),l=A(o,"error",8,!1),d=A(o,"loading",12,!1),f=A(o,"label",24,()=>x("workflows.input")),u=A(o,"editing",8,!0);Dt(()=>(e(),Ut(s())),()=>{e()==="json/plain"&&s()&&s("")}),$t(),Bt();var g=po(),h=X(g),k=X(h,!0);M(h);var R=j(h,2);Vt(R,{class:"flex flex-col gap-2",children:(P,$)=>{var W=So(),y=kt(W);Mt(y,{get error(){return l()},get id(){return a()},get editing(){return u()},get input(){return c()},set input(I){c(I)},get loading(){return d()},set loading(I){d(I)},$$legacy:!0});var v=j(y,2),p=X(v);{var w=I=>{var L=xo(),Y=X(L);const O=Pt(()=>x("workflows.encoding"));Xt(Y,{get description(){return It(O)},name:"encoding",get group(){return i()},set group(_){i(_)},children:(_,U)=>{var C=To(),F=kt(C);Tt(F,{id:"json/plain",value:"json/plain",label:"json/plain"});var G=j(F,2);Tt(G,{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}),K(_,C)},$$slots:{default:!0},$$legacy:!0});var T=j(Y,2);{var tt=_=>{const U=Pt(()=>x("workflows.message-type"));Gt(_,{get label(){return It(U)},get error(){return l()},id:"messageType",get value(){return s()},set value(C){s(C)},$$legacy:!0})};_t(T,_=>{e()==="json/protobuf"&&_(tt)})}M(L),K(I,L)};_t(p,I=>{u()&&I(w)})}var N=j(p,2);jt(N,o,"action",{},null),M(v),yt(()=>qt(v,1,`flex items-end gap-2 ${(u()?"justify-between":"justify-end")??""}`)),K(P,W)},$$slots:{default:!0}}),M(g),yt(()=>Ft(k,f())),K(t,g),Ot(),r()}const Ao=(t=no)=>!S(t).disableWriteActions,bo=(t=[])=>t.map(o=>{const n=eo(o,!0),r=o.activityId,e=o.state;return{...n,id:r,state:Zt(e)}}),Ro=t=>t?t.map(o=>({...o,state:to(o.state)})):[],Wo=t=>t?t.map(o=>({...o,state:oo(o.state)})):[],Lo=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:Kt(e)}),{})},Co=({executionTime:t,startTime:o})=>{if(!t||!o)return;const n=new Date(t).getTime()-new Date(o).getTime();if(n>0)return Math.round(n/1e3)+"s"},et=t=>{var C,F,G,at,it,st,ct,ut,lt,dt,ft,wt,Et,mt,gt,ht;const o=Lo(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,c=t.workflowExecutionInfo.startTime,i=t.workflowExecutionInfo.closeTime,s=t.workflowExecutionInfo.executionTime,l=Jt(t.workflowExecutionInfo.status),d=l==="Running",f=t.workflowExecutionInfo.historyLength,u=t.workflowExecutionInfo.historySizeBytes,g=`/workflows/${e}/${a}`,h=((F=(C=t==null?void 0:t.executionConfig)==null?void 0:C.taskQueue)==null?void 0:F.name)||((G=t==null?void 0:t.workflowExecutionInfo)==null?void 0:G.taskQueue),k=(at=t==null?void 0:t.workflowExecutionInfo)==null?void 0:at.mostRecentWorkerVersionStamp,R=(it=t==null?void 0:t.workflowExecutionInfo)==null?void 0:it.assignedBuildId,P=(st=t==null?void 0:t.workflowExecutionInfo)==null?void 0:st.parentNamespaceId,$=(ct=t==null?void 0:t.workflowExecutionInfo)==null?void 0:ct.parentExecution,W=t.workflowExecutionInfo.stateTransitionCount,y=(ut=t.executionConfig)==null?void 0:ut.defaultWorkflowTaskTimeout,v=bo(t.pendingActivities),p=(t==null?void 0:t.pendingChildren)??[],w=Ro(t==null?void 0:t.pendingNexusOperations),N=t==null?void 0:t.pendingWorkflowTask,I=Wo(t==null?void 0:t.callbacks),L=(lt=t.workflowExecutionInfo)==null?void 0:lt.rootExecution,Y=(dt=t.workflowExecutionInfo)==null?void 0:dt.versioningInfo,O=(ft=t.workflowExecutionInfo)==null?void 0:ft.priority,T=t.workflowExtendedInfo??{},tt=Co({executionTime:s,startTime:c});let _,U;return(wt=t==null?void 0:t.executionConfig)!=null&&wt.userMetadata&&(_=(mt=(Et=t==null?void 0:t.executionConfig)==null?void 0:Et.userMetadata)==null?void 0:mt.summary,U=(ht=(gt=t==null?void 0:t.executionConfig)==null?void 0:gt.userMetadata)==null?void 0:ht.details),{name:r,id:e,runId:a,startTime:c,endTime:i,executionTime:s,status:l,historyEvents:f,historySizeBytes:u,searchAttributes:o,memo:n,rootExecution:L,url:g,taskQueue:h,assignedBuildId:R,mostRecentWorkerVersionStamp:k,pendingActivities:v,pendingChildren:p,pendingNexusOperations:w,pendingWorkflowTask:N,callbacks:I,versioningInfo:Y,priority:O,summary:_,details:U,parentNamespaceId:P,parent:$,stateTransitionCount:W,isRunning:d,defaultWorkflowTaskTimeout:y,workflowExtendedInfo:T,startDelay:tt,get canBeTerminated(){return d&&Ao()}}},D=t=>(t.executions||[]).map(o=>et({workflowExecutionInfo:o}));var H=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(H||{}),J=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(J||{});const vo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},No=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Yo=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Do=t=>{if(typeof t!="string")return!1;for(const o of No)if(o===t)return!0;return!1},$o=(t,o,n)=>{const r=vo[t];return o==="All"?"":mo(o)||go(o)?n||S(ro)?`${r} > "${St(o)}"`:`${r} BETWEEN "${St(o)}" AND "${ho()}"`:`${r}="${o}"`},Oo=(t,o)=>Object.entries(t).map(([n,r])=>{if(Do(n)&&Yo(r))return $o(n,r,o)}).filter(Boolean),Lt=(t,o=!1)=>Oo(t,o).join(" and ");function Uo(t){console.error("Unhandled action:",t)}const Fo=(t,o)=>{let n;switch(t){case q.Cancel:n=x("workflows.canceled");break;case q.Reset:n=x("workflows.reset");break;case q.Terminate:n=x("workflows.terminated");break;default:Uo(t)}return x("workflows.workflow-action-reason-placeholder",{action:n,identity:o,count:o?1:0})},Ct=({action:t,reason:o,identity:n})=>{const r=Fo(t,n);return o?[o.trim(),r].join(" "):r},vt=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=m("workflows.count",{namespace:t}),{count:e,groups:a}=await E(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},Ln=async({namespace:t,query:o})=>{const n='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',r=o?`${n} AND ${o}`:n,e=m("workflows.count",{namespace:t}),{count:a}=await E(e,{params:{query:r},notifyOnError:!1});return a??"0"},jo=async(t,o,n=fetch,r=!1)=>{const e=o.query||Lt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=r?"workflows.archived":"workflows";let i="";const s=u=>{var g,h;nt(u),(g=u==null?void 0:u.body)!=null&&g.message||u!=null&&u.status?i=((h=u==null?void 0:u.body)==null?void 0:h.message)??`Error fetching workflows: ${u.status}: ${u.statusText}`:i="Error fetching workflows: Server failed to respond"},l=m(c,{namespace:t}),{executions:d,nextPageToken:f}=await E(l,{params:{query:a},onError:s,handleError:s,request:n})??{executions:[],nextPageToken:""};return{workflows:D({executions:d}),nextPageToken:String(f),error:i}},Cn=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var d;const e="workflows",a=n??io(t),c=so(e,{namespace:t}),i=a+c,{executions:s}=await E(i,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},l=(d=D({executions:s}))==null?void 0:d[0];return{runId:l==null?void 0:l.runId}},vn=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=i=>{(co(i)||uo(i))&&(e=!1)},c=m(r,{namespace:t});return await E(c,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}};async function rt(t,o=fetch){const n=m("workflow",{namespace:t.namespace,workflowId:t.workflowId});return E(n,{request:o,notifyOnError:!1,params:t.runId?{"execution.runId":t.runId}:{}}).then(r=>({workflow:et(r)})).catch(r=>({error:r}))}async function Nn({workflow:t,namespace:o,reason:n,first:r,identity:e}){const a=m("workflow.terminate",{namespace:o,workflowId:t.id}),c=Ct({reason:n,action:q.Terminate,identity:e});return await E(a,{options:{method:"POST",body:b({reason:c,...e&&{identity:e},firstExecutionRunId:r})},notifyOnError:!1,params:r?{}:{"execution.runId":t.runId}})}async function Yn({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=m("workflow.cancel",{namespace:t,workflowId:o});return E(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Dn({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a,messageType:c}){const i=m("workflow.signal",{namespace:t,workflowId:o,signalName:r}),s=await B({input:e,encoding:a,messageType:c}),l=S(V).data.settings,d=(l==null?void 0:l.version)??"",u=lo(d,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:s}}:{signalName:r,input:{payloads:s},params:{"execution.runId":n}};return E(i,{notifyOnError:!1,options:{method:"POST",body:b(u)}})}async function $n({namespace:t,workflow:{workflowId:o,runId:n},name:r,identity:e,updateId:a,input:c="",encoding:i}){const s=m("workflow.update",{namespace:t,workflowId:o,updateName:r}),l=await B({input:c,encoding:i});return E(s,{notifyOnError:!1,options:{method:"POST",body:b({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:e},input:{args:{payloads:l}}}})}})}async function On({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:c,excludeUpdates:i,identity:s}){const l=m("workflow.reset",{namespace:t,workflowId:o}),d=Ct({action:q.Reset,reason:e,identity:s}),f={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:pt(),reason:d};if(S(bt)||Rt("1.24.0",S(At))){const u=[];!c&&!i&&u.push(H.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),c&&u.push(H.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),i&&u.push(H.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),f.resetReapplyExcludeTypes=u,f.resetReapplyType=J.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let u;a?u=J.RESET_REAPPLY_TYPE_SIGNAL:u=J.RESET_REAPPLY_TYPE_NONE,f.resetReapplyType=u}return E(l,{notifyOnError:!1,options:{method:"POST",body:b(f)},params:{"execution.runId":n}})}async function Un(t,o=fetch){const n=e=>{console.error(e)},r=m("workflow",t);return E(r,{request:o,onError:n,handleError:n}).then(et)}async function Fn(t,o,n){if(!S(Wt))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await jo(t,{query:r});return e}catch{return[]}}const qo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=wo(n.value)}),o};async function jn({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:c,encoding:i,messageType:s,searchAttributes:l,identity:d,workflowStartDelay:f}){const u=m("workflow",{namespace:t,workflowId:o});let g,h,k;if(e)try{g=await B({input:e,encoding:i,messageType:s})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(h=(await B({input:b(a),encoding:"json/plain"}))[0]),c&&(k=(await B({input:b(c),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const R=b({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:g?{payloads:g}:null,userMetadata:{summary:h,details:k},searchAttributes:l.length===0?null:{indexedFields:{...qo(l)}},...d&&{identity:d},...f&&{workflowStartDelay:f}});return E(u,{notifyOnError:!1,options:{method:"POST",body:R}})}const qn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,c,i,s,l,d,f,u,g,h;const r=k=>{console.error(k)},e={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let k="";o&&n?k=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?k=`WorkflowType = "${o}"`:n&&(k=`WorkflowId = "${n}"`);const R=m("workflows",{namespace:t}),P=await E(R,{params:{query:k,pageSize:"1"},handleError:r});if(!((a=P==null?void 0:P.executions)!=null&&a[0]))return e;const $=D(P)[0],W={namespace:t,workflowId:$.id,runId:$.runId},{workflow:y}=await rt(W),p=await ko(W),w=await Ht((c=p==null?void 0:p.attributes)==null?void 0:c.input,t,S(V).data.settings,S(ao).accessToken,"readable",!1);let N="";if(y.summary){const T=await xt(y.summary);typeof T=="string"&&(N=T)}let I="";if(y.details){const T=await xt(y.details);typeof T=="string"&&(I=T)}const L=w!=null&&w.payloads?b((i=w.payloads[0])==null?void 0:i.data):"",Y=w!=null&&w.payloads&&_o((l=(s=w.payloads[0])==null?void 0:s.metadata)==null?void 0:l.encoding)?(f=(d=w.payloads[0])==null?void 0:d.metadata)==null?void 0:f.encoding:"json/plain",O=w!=null&&w.payloads?(g=(u=w.payloads[0])==null?void 0:u.metadata)==null?void 0:g.messageType:"";return{input:L,encoding:Y,messageType:O,searchAttributes:(h=y==null?void 0:y.searchAttributes)==null?void 0:h.indexedFields,summary:N,details:I}}catch{return e}},Bo=(t,o)=>{const n=new Map;o.forEach(e=>{if(e.parent){const a=`${e.parent.workflowId}:${e.parent.runId}`,c=n.get(a)||[];c.push(e),n.set(a,c)}});const r=(e,a)=>{var l,d;const c=`${e.id}:${e.runId}`,i=n.get(c)||[],s={workflow:e,scheduleId:(d=(l=e==null?void 0:e.searchAttributes)==null?void 0:l.indexedFields)==null?void 0:d.TemporalScheduledById,children:[],rootPaths:[...a,{runId:e.runId,workflowId:e.id}]};return s.children=i.map(f=>r(f,s.rootPaths)),s};return r(t,[])},Qo=({parent:t,workflow:o,children:n,siblingCount:r})=>{const e=n.map(i=>{const s=t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}]:[{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}];return{workflow:i,siblingCount:r,children:[],rootPaths:s}}),a={workflow:o,children:e,rootPaths:t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id}]:[{runId:o.runId,workflowId:o.id}]};return t?{workflow:t,children:[a],rootPaths:[{runId:t.runId,workflowId:t.id}]}:a};async function Bn(t,o,n){let r=`RootWorkflowId = "${o}"`;return n&&(r+=` AND RootRunId = "${n}"`),await vt({namespace:t,query:r})}async function Qn(t,o,n){let r=`RootWorkflowId = "${o}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await rt({namespace:t,workflowId:o,runId:n}),a=await Nt(t,{query:r});return Bo(e==null?void 0:e.workflow,a)}async function zn({namespace:t,parentWorkflowId:o,parentRunId:n,workflow:r}){let e;const a=async(s,l)=>{const d=`ParentWorkflowId = "${s}" AND ParentRunId = "${l}"`;return await Nt(t,{query:d})};let c=0;if(o){e=await rt({namespace:t,workflowId:o,runId:n});const s=`ParentWorkflowId = "${o}" AND ParentRunId = "${n}"`,{count:l}=await vt({namespace:t,query:s});c=parseInt(l)}const i=await a(r.id,r.runId);return Qo({parent:e==null?void 0:e.workflow,workflow:r,children:i,siblingCount:c})}const Nt=async(t,o,n=fetch,r=!1)=>{const e=o.query||Lt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=m("workflows",{namespace:t}),{executions:i}=await Eo(async s=>E(c,{token:s,request:n,params:{query:a}}));return D({executions:i})},Vn=async(t,o="",n=fetch)=>(r=100,e="")=>{ot.set("");const a=i=>{var s;nt(i),S(yo)?ot.set(x("workflows.workflows-error-querying")):ot.set(((s=i==null?void 0:i.body)==null?void 0:s.message)||x("workflows.workflows-error-querying"))},c=m("workflows",{namespace:t});return E(c,{params:{pageSize:String(r),nextPageToken:e,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:i=[],nextPageToken:s=""})=>({items:D({executions:i}),nextPageToken:s?String(s):""}))},Gn=async(t,o="",n=fetch)=>(r=100,e="")=>{const a=i=>{nt(i)},c=m("workflows.archived",{namespace:t});return E(c,{params:{pageSize:String(r),nextPageToken:e,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:i=[],nextPageToken:s=""})=>({items:D({executions:i}),nextPageToken:s?String(s):""}))};export{rt as A,On as B,Dn as C,$n as D,Wn as P,vn as a,Gn as b,vt as c,Sn as d,qn as e,Cn as f,An as g,qo as h,Yn as i,Ln as j,Ao as k,Rn as l,_o as m,zn as n,Fn as o,Bn as p,pn as q,xn as r,jn as s,Nn as t,Qn as u,Un as v,bn as w,Fo as x,ot as y,Vn as z};
