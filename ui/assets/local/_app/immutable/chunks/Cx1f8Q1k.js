import"./Bzak7iHL.js";import{p as at,u as w,ag as k,ah as $,aH as nt,t as N,r as A,e as W,b as ut,g as t,s as i,K as f,h as ct,f as it,i as lt}from"./DtSMpxPp.js";import{d as ft}from"./ChP_J8fE.js";import{i as mt}from"./BUX2ey9N.js";import{e as pt}from"./D_0FA0ti.js";import{p as B,s as wt,a as g,e as P,c as dt}from"./QkTQNHha.js";import{a as ht}from"./C_fvR0pn.js";import{p as v}from"./CxELrfop.js";import{S as yt}from"./DzBtnuBY.js";import{r as kt,w as _,b as D,d as gt}from"./5ckKCPgu.js";import{w as O}from"./jVnDf57R.js";import{c as vt}from"./DqOmzRv5.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as G}from"./BwtrHNwN.js";import{b as xt}from"./U4uc0KJ2.js";import{t as Ct,c as St}from"./D2yDiWur.js";import{u as bt}from"./CNu-hzmd.js";import{W as Et}from"./D2AUmkDq.js";const K=(u=[])=>u.map(e=>{const s=xt(e==null?void 0:e.groupValues[0]),d=parseInt(e.count);return{status:s,count:d}}).sort((e,s)=>G.indexOf(e.status)-G.indexOf(s.status)),Wt=(u,e)=>{if(e<=1)return u*1e3;const s=300,m=u*Math.pow(1.2,e-1);return Math.min(s,Math.round(m))*1e3};var Pt=(u,e,s)=>e(s()),Tt=N("<button><!></button>"),Ft=N('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function jt(u,e){at(e,!0);const[s,d]=wt(),m=()=>g(O,"$workflowFilters",s),n=()=>g(_,"$workflowCount",s),T=()=>g(gt,"$disableWorkflowCountsRefresh",s),H=()=>g(kt,"$refresh",s);let Y=B(e,"staticQuery",3,""),F=B(e,"refreshTime",15);const L=w(()=>v.url.searchParams.get("query")),x=w(()=>v.params.namespace),C=w(()=>Y()||t(L)),U=w(()=>v.url.searchParams.get("per-page"));let I=k($([])),h=k($([])),q,p=k(1),S=k(!1);const V=60,j=20,z=r=>{if(!m().some(a=>a.attribute==="ExecutionStatus"&&a.value===r)){const a={attribute:"ExecutionStatus",type:_t.KEYWORD,value:r,operator:"",conditional:"=",parenthesis:""};dt(O,[...m(),a]);const c=Ct(St(m()));bt({url:v.url,parameter:"query",value:c,clearParameters:[vt]})}},R=()=>{clearTimeout(q),i(h,[],!0),P(_,f(n).newCount=0,f(n)),i(p,1)},J=async()=>{i(S,!0);try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).count=parseInt(r),f(n)),i(I,K(o),!0)}finally{F(new Date),i(S,!1)}},X=async()=>{try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).newCount=parseInt(r)-n().count,f(n)),i(h,K(o),!0)}finally{F(new Date),i(p,t(p)+1)}},M=()=>{const r=Wt(V,t(p));q=setTimeout(async()=>{await X(),!T()&&t(p)<=j&&M()},r)},Z=async()=>{R(),await J(),T()||M()};nt(()=>{t(x),t(C),t(U),H(),Z()}),ht(()=>{R()});var b=Ft();pt(b,21,()=>t(I),({count:r,status:o})=>o,(r,o)=>{let a=()=>t(o).count,c=()=>t(o).status;var Q=ct(),tt=it(Q);{var et=l=>{var y=Tt();y.__click=[Pt,z,c];var rt=lt(y);const ot=w(()=>t(h).find(E=>E.status===c())?t(h).find(E=>E.status===c()).count-a():0);Et(rt,{get status(){return c()},get count(){return a()},get newCount(){return t(ot)},get"test-id"(){return`workflow-status-${c()??""}`}}),A(y),W(l,y)},st=l=>{yt(l,{class:"h-6 w-24 rounded-sm"})};mt(tt,l=>{t(S)?l(st,!1):l(et)})}W(r,Q)}),A(b),W(u,b),ut(),d()}ft(["click"]);export{jt as W};
