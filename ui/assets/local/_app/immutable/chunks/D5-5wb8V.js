import{g as P,d as x,w as Y,r as Ct}from"./Dm8LSs3h.js";import{p as W}from"./BtJgAUwM.js";import{t as T}from"./D2OY9xdY.js";import{r as E,a as m,b as Lt,p as vt,c as Yt,i as Nt,d as Dt}from"./DbsKnv_n.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as $t,l as Ot,a as Ut,c as B,e as X,f as yt,t as kt,b as Ft,ag as qt,r as M,g as gt,d as ht}from"./BZ1i_Yzi.js";import{s as jt}from"./BtIgVYD3.js";import{i as _t}from"./Pfo2U1_a.js";import{t as Z,a as K}from"./B11KKQxI.js";import{s as Bt}from"./DBXxAZ3D.js";import{s as Qt}from"./BqyZnqh5.js";import{i as Vt}from"./EXou6kTq.js";import{p as S}from"./DQFlnzBt.js";import{s as Gt,a as zt}from"./nHCSEYHe.js";import{C as Xt}from"./Bga7QKHu.js";import{I as Mt}from"./hrSCmHMw.js";import{R as Kt,a as Pt}from"./BEdqJc0w.js";import{P as Ht}from"./D1U_3Kuj.js";import{v as Tt}from"./Dz_GI0CC.js";import{A as Q}from"./TBME1SPK.js";import{a as Jt,c as Zt,b as pt}from"./BT_MGchh.js";import{g as to,h as oo,i as no}from"./BPGLcykw.js";import{s as eo,t as nt}from"./C5XFlnAO.js";import{s as ro}from"./DLT2f7XN.js";import{s as xt,i as bt}from"./BSpa7b02.js";import{a as et}from"./BipkNA2r.js";import{m as rt,i as ao}from"./HVeMsM_a.js";import{h as so}from"./Of0UIi2K.js";import{e as V,s as io}from"./B6EMBDxa.js";import{p as co}from"./DVdmEWwf.js";import{s as R}from"./CTBtQUu0.js";import{i as lo,c as uo,d as It,e as fo}from"./qEOT7B5E.js";import{a as wo}from"./zItI6sfR.js";const mo=async(t,o,n=fetch)=>{let e=0;try{const r=E("workflows.count",{namespace:t}),a=await m(r,{params:o?{query:o}:{},onError:()=>{},handleError:()=>{},request:n});e=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:e}},Eo=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",e=E("workflows.count",{namespace:t}),{count:r,groups:a}=await m(e,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:r??"0",groups:a}},vn=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=E("workflows.count",{namespace:t}),{count:e}=await m(n,{params:{query:o},notifyOnError:!1});return e??"0"},yo=["json/plain","json/protobuf"],ko=t=>yo.includes(t);var go=Z("<!> <!>",1),ho=Z('<div class="flex w-full flex-col gap-2"><!> <!></div>'),_o=Z("<!> <div><!> <!></div>",1),Po=Z('<div><h5 class="pb-1 text-sm font-medium"> </h5> <!></div>');function Yn(t,o){$t(o,!1);const[n,e]=Gt(),r=()=>zt(c(),"$encoding",n);let a=S(o,"id",24,Tt),s=S(o,"input",12),c=S(o,"encoding",12),l=S(o,"messageType",12),u=S(o,"error",8,!1),f=S(o,"loading",12,!1),d=S(o,"label",24,()=>T("workflows.input")),i=S(o,"editing",8,!0);Ot(()=>(r(),qt(l())),()=>{r()==="json/plain"&&l()&&l("")}),Ut(),Vt();var y=Po(),k=X(y),g=X(k,!0);M(k);var U=B(k,2);Xt(U,{class:"flex flex-col gap-2",children:(b,F)=>{var C=_o(),h=yt(C);Ht(h,{get error(){return u()},get id(){return a()},get editing(){return i()},get input(){return s()},set input(_){s(_)},get loading(){return f()},set loading(_){f(_)},$$legacy:!0});var N=B(h,2),A=X(N);{var w=_=>{var L=ho(),$=X(L);const O=ht(()=>T("workflows.encoding"));Kt($,{get description(){return gt(O)},name:"encoding",get group(){return c()},set group(I){c(I)},children:(I,q)=>{var v=go(),j=yt(v);Pt(j,{id:"json/plain",value:"json/plain",label:"json/plain"});var z=B(j,2);Pt(z,{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}),K(I,v)},$$slots:{default:!0},$$legacy:!0});var p=B($,2);{var G=I=>{const q=ht(()=>T("workflows.message-type"));Mt(I,{get label(){return gt(q)},get error(){return u()},id:"messageType",get value(){return l()},set value(v){l(v)},$$legacy:!0})};_t(p,I=>{r()==="json/protobuf"&&I(G)})}M(L),K(_,L)};_t(A,_=>{i()&&_(w)})}var D=B(A,2);Bt(D,o,"action",{},null),M(N),kt(()=>Qt(N,1,`flex items-end gap-2 ${(i()?"justify-between":"justify-end")??""}`)),K(b,C)},$$slots:{default:!0}}),M(y),kt(()=>jt(g,d())),K(t,y),Ft(),e()}const po=(t=eo)=>!P(t).disableWriteActions,Io=(t=[])=>t.map(o=>{const n=ro(o,!0),e=o.activityId;return{...n,id:e}}),To=t=>t?t.map(o=>({...o,state:oo(o.state)})):[],xo=t=>t?t.map(o=>({...o,state:no(o.state)})):[],bo=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[e,r])=>({...n,[e]:Jt(r)}),{})},at=t=>{var G,I,q,v,j,z,it,ct,lt,ut,ft,dt,wt,mt,Et;const o=bo(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,e=t.workflowExecutionInfo.type.name,r=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,s=t.workflowExecutionInfo.startTime,c=t.workflowExecutionInfo.closeTime,l=t.workflowExecutionInfo.executionTime,u=to(t.workflowExecutionInfo.status),f=u==="Running",d=t.workflowExecutionInfo.historyLength,i=t.workflowExecutionInfo.historySizeBytes,y=`/workflows/${r}/${a}`,k=((I=(G=t==null?void 0:t.executionConfig)==null?void 0:G.taskQueue)==null?void 0:I.name)||((q=t==null?void 0:t.workflowExecutionInfo)==null?void 0:q.taskQueue),g=(v=t==null?void 0:t.workflowExecutionInfo)==null?void 0:v.mostRecentWorkerVersionStamp,U=(j=t==null?void 0:t.workflowExecutionInfo)==null?void 0:j.assignedBuildId,b=(z=t==null?void 0:t.workflowExecutionInfo)==null?void 0:z.parentNamespaceId,F=(it=t==null?void 0:t.workflowExecutionInfo)==null?void 0:it.parentExecution,C=t.workflowExecutionInfo.stateTransitionCount,h=(ct=t.executionConfig)==null?void 0:ct.defaultWorkflowTaskTimeout,N=Io(t.pendingActivities),A=(t==null?void 0:t.pendingChildren)??[],w=To(t==null?void 0:t.pendingNexusOperations),D=t==null?void 0:t.pendingWorkflowTask,_=xo(t==null?void 0:t.callbacks),L=(lt=t.workflowExecutionInfo)==null?void 0:lt.rootExecution,$=(ut=t.workflowExecutionInfo)==null?void 0:ut.versioningInfo;let O,p;return(ft=t==null?void 0:t.executionConfig)!=null&&ft.userMetadata&&(O=(wt=(dt=t==null?void 0:t.executionConfig)==null?void 0:dt.userMetadata)==null?void 0:wt.summary,p=(Et=(mt=t==null?void 0:t.executionConfig)==null?void 0:mt.userMetadata)==null?void 0:Et.details),{name:e,id:r,runId:a,startTime:s,endTime:c,executionTime:l,status:u,historyEvents:d,historySizeBytes:i,searchAttributes:o,memo:n,rootExecution:L,url:y,taskQueue:k,assignedBuildId:U,mostRecentWorkerVersionStamp:g,pendingActivities:N,pendingChildren:A,pendingNexusOperations:w,pendingWorkflowTask:D,callbacks:_,versioningInfo:$,summary:O,details:p,parentNamespaceId:b,parent:F,stateTransitionCount:C,isRunning:f,defaultWorkflowTaskTimeout:h,get canBeTerminated(){return f&&po()}}},tt=t=>(t.executions||[]).map(o=>at({workflowExecutionInfo:o}));var H=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(H||{}),J=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(J||{});const Ao={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},So=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Ro=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Wo=t=>{if(typeof t!="string")return!1;for(const o of So)if(o===t)return!0;return!1},Co=(t,o,n)=>{const e=Ao[t];return o==="All"?"":lo(o)||uo(o)?n||P(xt)?`${e} > "${It(o)}"`:`${e} BETWEEN "${It(o)}" AND "${fo()}"`:`${e}="${o}"`},Lo=(t,o)=>Object.entries(t).map(([n,e])=>{if(Wo(n)&&Ro(e))return Co(n,e,o)}).filter(Boolean),At=(t,o=!1)=>Lo(t,o).join(" and ");function vo(t){console.error("Unhandled action:",t)}const Yo=(t,o)=>{let n;switch(t){case Q.Cancel:n=T("workflows.canceled");break;case Q.Reset:n=T("workflows.reset");break;case Q.Terminate:n=T("workflows.terminated");break;default:vo(t)}return o?T("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):T("workflows.workflow-action-reason-placeholder",{action:n})},St=({action:t,reason:o,email:n})=>{const e=Yo(t,n);return o?[o.trim(),e].join(" "):e},st=async(t,o,n=fetch,e=!1)=>{const r=o.query||At(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=e?"workflows.archived":"workflows";let c="";const l=i=>{var y,k;Yt(i),(y=i==null?void 0:i.body)!=null&&y.message||i!=null&&i.status?c=((k=i==null?void 0:i.body)==null?void 0:k.message)??`Error fetching workflows: ${i.status}: ${i.statusText}`:c="Error fetching workflows: Server failed to respond"},u=E(s,{namespace:t}),{executions:f,nextPageToken:d}=await m(u,{params:{query:a},onError:l,handleError:l,request:n})??{executions:[],nextPageToken:""};return{workflows:tt({executions:f}),nextPageToken:String(d),error:c}},Nn=async({namespace:t,workflowId:o,url:n},e=fetch)=>{var f;const r="workflows",a=n??Lt(t),s=vt(r,{namespace:t}),c=a+s,{executions:l}=await m(c,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:e})??{executions:[]},u=(f=tt({executions:l}))==null?void 0:f[0];return{runId:u==null?void 0:u.runId}},Dn=async(t,o=fetch,n=!1)=>{const e=n?"workflows.archived":"workflows";let r=!0;const a=c=>{(Nt(c)||Dt(c))&&(r=!1)},s=E(e,{namespace:t});return await m(s,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:r}},$n=async(t,o,n=fetch)=>st(t,o,n,!0);async function Rt(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return m(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(e=>({workflow:at(e)})).catch(e=>({error:e}))}async function On({workflow:t,namespace:o,reason:n}){const e=E("workflow.terminate",{namespace:o,workflowId:t.id}),r=P(et).email,a=St({reason:n,action:Q.Terminate,email:r});return await m(e,{options:{method:"POST",body:R({reason:a,...r&&{identity:r}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Un({namespace:t,workflow:{id:o,runId:n}},e=fetch){const r=E("workflow.cancel",{namespace:t,workflowId:o});return m(r,{request:e,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Fn({namespace:t,workflow:{id:o,runId:n},name:e,input:r,encoding:a,messageType:s}){const c=E("workflow.signal",{namespace:t,workflowId:o,signalName:e}),l=await V({input:r,encoding:a,messageType:s}),u=P(W).data.settings,f=(u==null?void 0:u.version)??"",i=ao(f,"2.22")?{signalName:e,workflowExecution:{workflowId:o,runId:n},input:{payloads:l}}:{signalName:e,input:{payloads:l},params:{"execution.runId":n}};return m(c,{notifyOnError:!1,options:{method:"POST",body:R(i)}})}async function qn({namespace:t,workflow:{workflowId:o,runId:n},name:e,identity:r,updateId:a,input:s="",encoding:c}){const l=E("workflow.update",{namespace:t,workflowId:o,updateName:e}),u=await V({input:s,encoding:c});return m(l,{notifyOnError:!1,options:{method:"POST",body:R({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:r},input:{args:{payloads:u}}}})}})}async function jn({namespace:t,workflow:{id:o,runId:n},eventId:e,reason:r,includeSignals:a,excludeSignals:s,excludeUpdates:c}){const l=E("workflow.reset",{namespace:t,workflowId:o}),u=P(et).email,f=St({action:Q.Reset,reason:r,email:u}),d={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:e,requestId:Tt(),reason:f};if(P(bt)||rt("1.24.0",P(nt))){const i=[];!s&&!c&&i.push(H.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),s&&i.push(H.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),c&&i.push(H.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),d.resetReapplyExcludeTypes=i,d.resetReapplyType=J.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let i;a?i=J.RESET_REAPPLY_TYPE_SIGNAL:i=J.RESET_REAPPLY_TYPE_NONE,d.resetReapplyType=i}return m(l,{notifyOnError:!1,options:{method:"POST",body:R(d)},params:{"execution.runId":n}})}async function Bn(t,o=fetch){const n=r=>{console.error(r)},e=E("workflow",t);return m(e,{request:o,onError:n,handleError:n}).then(at)}async function Qn(t,o,n){if(!P(Wt))return[];try{let e=`ParentWorkflowId = "${o}"`;n&&(e+=` AND ParentRunId = "${n}"`);const{workflows:r}=await st(t,{query:e});return r}catch{return[]}}const No=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=io(n.value)}),o};async function Vn({namespace:t,workflowId:o,taskQueue:n,workflowType:e,input:r,summary:a,details:s,encoding:c,messageType:l,searchAttributes:u}){const f=E("workflow",{namespace:t,workflowId:o});let d,i,y;if(r)try{d=await V({input:r,encoding:c,messageType:l})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(i=(await V({input:R(a),encoding:"json/plain"}))[0]),s&&(y=(await V({input:R(s),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const k=R({workflowId:o,taskQueue:{name:n},workflowType:{name:e},input:d?{payloads:d}:null,userMetadata:{summary:i,details:y},searchAttributes:u.length===0?null:{indexedFields:{...No(u)}}});return m(f,{notifyOnError:!1,options:{method:"POST",body:k}})}const Gn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,s,c,l,u,f,d,i,y,k;const e=g=>{console.error(g)},r={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let g="";o&&n?g=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?g=`WorkflowType = "${o}"`:n&&(g=`WorkflowId = "${n}"`);const U=E("workflows",{namespace:t}),b=await m(U,{params:{query:g,pageSize:"1"},handleError:e});if(!((a=b==null?void 0:b.executions)!=null&&a[0]))return r;const F=tt(b)[0],C={namespace:t,workflowId:F.id,runId:F.runId},{workflow:h}=await Rt(C),A=await wo(C),w=await Zt((s=A==null?void 0:A.attributes)==null?void 0:s.input,t,P(W).data.settings,P(et).accessToken,"readable",!1);let D="";if(h.summary){const p=await pt(h.summary);typeof p=="string"&&(D=p)}let _="";if(h.details){const p=await pt(h.details);typeof p=="string"&&(_=p)}const L=w!=null&&w.payloads?R((c=w.payloads[0])==null?void 0:c.data):"",$=w!=null&&w.payloads&&ko((u=(l=w.payloads[0])==null?void 0:l.metadata)==null?void 0:u.encoding)?(d=(f=w.payloads[0])==null?void 0:f.metadata)==null?void 0:d.encoding:"json/plain",O=w!=null&&w.payloads?(y=(i=w.payloads[0])==null?void 0:i.metadata)==null?void 0:y.messageType:"";return{input:L,encoding:$,messageType:O,searchAttributes:(k=h==null?void 0:h.searchAttributes)==null?void 0:k.indexedFields,summary:D,details:_}}catch{return r}},Do=(t,o)=>{const n=new Map;o.forEach(r=>{if(r.parent){const a=`${r.parent.workflowId}:${r.parent.runId}`,s=n.get(a)||[];s.push(r),n.set(a,s)}});const e=(r,a)=>{const s=`${r.id}:${r.runId}`,c=n.get(s)||[],l={workflow:r,children:[],rootPaths:[...a,{runId:r.runId,workflowId:r.id}]};return l.children=c.map(u=>e(u,l.rootPaths)),l};return e(t,[])};async function zn(t,o,n){let e=`RootWorkflowId = "${o}"`;return n&&(e+=` AND RootRunId = "${n}"`),await Eo({namespace:t,query:e})}async function Xn(t,o,n){let e=`RootWorkflowId = "${o}"`;n&&(e+=` AND RootRunId = "${n}"`);const r=await Rt({namespace:t,workflowId:o,runId:n}),a=await $o(t,{query:e});return Do(r==null?void 0:r.workflow,a)}const $o=async(t,o,n=fetch,e=!1)=>{const r=o.query||At(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=E("workflows",{namespace:t}),{executions:c}=await co(async l=>m(s,{token:l,request:n,params:{query:a}}));return tt({executions:c})},Oo=300,Uo=async(t,o,n)=>{o.set(!0);try{await n()}catch(e){console.error(e)}t.set(!1),setTimeout(()=>{o.set(!1)},Oo)},Fo=x([W],([t])=>{var o,n,e;return!!((e=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&e.countGroupByExecutionStatus)}),Mn=x([W,nt],([t,o])=>{var r,a,s;const n=rt("1.23.0",o),e=!!((s=(a=(r=t.data)==null?void 0:r.systemInfo)==null?void 0:a.capabilities)!=null&&s.prefixSearch);return n||e}),qo=Y(0),jo=x([W],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),Kn=x([W],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),Wt=x([bt,nt],([t,o])=>t||rt("1.23.0",o)),Bo=x([W],([t])=>t.url.searchParams.get("query")),Qo=x([Bo,Wt,so],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),Vo=x([W],([t])=>t.params.namespace),Go=x([Vo,Qo,qo,xt,jo],([t,o,n,e,r])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})),zo=t=>{Ho.set({...t,newCount:0})},Xo=t=>Go.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})=>{Uo(Ko,Mo,async()=>{const{workflows:a,error:s}=await st(o,{query:n});if(t(a),e&&!P(Fo)){const c=await mo(o,n);zo(c)}s?r?ot.set(T("workflows.workflows-error-querying")):ot.set(s):ot.set("")})}),Hn=Y(""),Mo=Y(!0),Ko=Y(!0),Ho=Y({count:0,newCount:0}),ot=Y(""),Jn=Ct([],Xo),Zn=Y("");export{Rt as A,Zn as B,Yo as C,Ko as D,Mo as E,ot as F,Jn as G,Mn as H,Yn as P,Dn as a,Eo as b,Gn as c,Kn as d,Hn as e,Nn as f,No as g,Un as h,vn as i,po as j,$n as k,At as l,ko as m,Bn as n,Fo as o,Qn as p,Qo as q,qo as r,Vn as s,On as t,Xn as u,zn as v,Ho as w,jn as x,Fn as y,qn as z};
