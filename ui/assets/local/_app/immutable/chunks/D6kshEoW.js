import{g as l}from"./Ctfij28z.js";import{p as u}from"./CBYB84ZK.js";import{g as E,d as W}from"./BEmk2BcD.js";import{a as R}from"./CfxVOEQA.js";import{a as P}from"./DDXQMJHw.js";import{h as i,i as j}from"./BqNaQ_Wm.js";import{p as b}from"./CTBtQUu0.js";const g=e=>Array.isArray(e)?e:[e],C=e=>Object.entries(e).reduce((c,[s,o])=>(c[s]=P(String(o)),c),{});function m(e,c=!0){var o;if(e===null)return e;try{const r=b(P(String((e==null?void 0:e.data)??"")));return c?r:{metadata:C(e==null?void 0:e.metadata),data:r}}catch(r){console.warn("Could not parse payload: ",r)}return P(String(((o=e==null?void 0:e.metadata)==null?void 0:o.encoding)??""))==="binary/null"?c?null:{metadata:C(e==null?void 0:e.metadata),data:null}:e}const U=(e,c=!0)=>{if(i(e,"searchAttributes")&&i(e.searchAttributes,"indexedFields")){const s=e.searchAttributes.indexedFields;Object.entries(s).forEach(([o,r])=>{s[o]=m(r,c)})}else if(i(e,"searchAttributes")){const s=e.searchAttributes;Object.entries(s).forEach(([o,r])=>{s[o]=m(r,c)})}if(i(e,"memo")&&i(e.memo,"fields")){const s=e.memo.fields;Object.entries(s).forEach(([o,r])=>{s[o]=m(r,c)})}if(i(e,"header")&&i(e.header,"fields")){const s=e.header.fields;Object.entries(s).forEach(([o,r])=>{s[o]=m(r,c)})}if(i(e,"queryResult")){const s=e==null?void 0:e.queryResult;Object.entries(s).forEach(([o,r])=>{s[o]=m(r,c)})}return e},k=e=>async(c,s=!0)=>{if(E(e)){const o=await W({payloads:{payloads:c},settings:e});return((o==null?void 0:o.payloads)??[]).map(r=>m(r,s))}else return c.map(o=>m(o,s))},S=e=>async c=>{if(E(e)){const s=await W({payloads:{payloads:c},settings:e});return(s==null?void 0:s.payloads)??[]}else return c},h=(e,...c)=>{for(const s of c)if(e===s)return!0;return!1},_=async(e,c=l(u).data.settings)=>{try{return(await k(c)([e]))[0]||""}catch{return""}},x=async(e,c=l(u).params.namespace,s=l(u).data.settings,o=l(R).accessToken)=>{const r=k(s);if(e)for(const t of Object.keys(e))if(h(t,"payloads","encodedAttributes")&&e[t]){const f=g(e[t]),a=await r(f);e[t]=h(t,"encodedAttributes")?a[0]:a}else{const f=e[t];j(f)&&(e[t]=await x(f,c,s,o))}return e},q=e=>{if(!j(e))return!1;const c=Object.keys(e);return c.length===2&&c.includes("metadata")&&c.includes("data")},F=async(e,c,s,o,r="readable",t=!0)=>{if(!e)return e;const f=r==="readable"?k(s):S(s),a={...e};if(e){if(q(a)){const d=g(a),n=await f(d,t);return(n==null?void 0:n[0])||a}for(const d of Object.keys(a))if(h(d,"payloads","encodedAttributes")&&a[d]){const n=g(a[d]),w=await f(n,t);a[d]=h(d,"encodedAttributes")?w[0]:w}else{const n=a[d];j(n)&&(a[d]=await F(n,c,s,o,r,t))}}return a},z=async({attributes:e,namespace:c,settings:s,accessToken:o})=>await x(e,c,s,o);export{_ as a,m as b,F as c,U as d,z as e,q as i};
