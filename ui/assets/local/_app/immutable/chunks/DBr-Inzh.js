import{t as V,w as M,x as R,ai as Y,aR as G,P as j,Q as J,a5 as K,aS as X,aT as Z,ah as C,A as ee,aU as te,O}from"./CckrFwdx.js";import{w as E}from"./DsVF0eUi.js";import{g as z}from"./9mT-jHva.js";import{t as $}from"./DEjs8ZrU.js";import"./DAcYyk2F.js";import{s as w}from"./DSbgyoV1.js";import{r as f,a as m}from"./CB9bXUc7.js";import{i as U}from"./mn7LIc_2.js";import{e as D}from"./k6y9aMY3.js";import{s as se,t as oe}from"./D2OhByKS.js";function we(e,a,s=!1,t=!1,r=!1){var n=e,i="";V(()=>{var c=Y;if(i===(i=a()??"")){M&&R();return}if(c.nodes!==null&&(G(c.nodes.start,c.nodes.end),c.nodes=null),i!==""){if(M){j.data;for(var o=R(),u=o;o!==null&&(o.nodeType!==J||o.data!=="");)u=o,o=K(o);if(o===null)throw X(),Z;C(j,u),n=ee(o);return}var l=i+"";s?l=`<svg>${l}</svg>`:t&&(l=`<math>${l}</math>`);var d=te(l);if((s||t)&&(d=O(d)),C(O(d),d.lastChild),s||t)for(;O(d);)n.before(O(d));else n.before(d)}})}const Se=async(e,a,s,t=fetch)=>(r=100,n="")=>{const i=f("schedules",{namespace:e});return m(i,{params:{maximumPageSize:String(r),nextPageToken:n,...a?{query:a}:{}},request:t,onError:s}).then(({schedules:c,nextPageToken:o})=>({items:c,nextPageToken:o?String(o):""}))};async function Te(e,a=fetch){const s=f("schedule",e);return m(s,{request:a})}async function _e({namespace:e,scheduleId:a,identity:s},t=fetch){const r=f("schedule",{namespace:e,scheduleId:a});return m(r,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function ae({namespace:e,scheduleId:a,body:s,identity:t}){let r="";const n=o=>{var u;return r=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=f("schedule",{namespace:e,scheduleId:a}),{conflictToken:c}=await m(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:n});return{conflictToken:c,error:r}}async function re({namespace:e,scheduleId:a,body:s,identity:t}){let r="";const n=c=>{var o;return r=((o=c==null?void 0:c.body)==null?void 0:o.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=f("schedule.edit",{namespace:e,scheduleId:a});return await m(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:n}),{error:r}}async function ke({namespace:e,scheduleId:a,reason:s,identity:t}){const r={patch:{pause:s}},n=f("schedule.patch",{namespace:e,scheduleId:a});return await m(n,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function be({namespace:e,scheduleId:a,reason:s,identity:t}){const r={patch:{unpause:s}},n=f("schedule.patch",{namespace:e,scheduleId:a});return await m(n,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function ve({namespace:e,scheduleId:a,overlapPolicy:s,identity:t}){const r={patch:{triggerImmediately:{overlapPolicy:s}}},n=f("schedule.patch",{namespace:e,scheduleId:a});return await m(n,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Ie({namespace:e,scheduleId:a,overlapPolicy:s,identity:t,startTime:r,endTime:n}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:r,endTime:n}]}},c=f("schedule.patch",{namespace:e,scheduleId:a});return await m(c,{options:{method:"POST",body:w({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const A=e=>e?parseInt(e):0,ne=(e,a,s,t)=>`${A(e)*60*60*24+A(a)*60*60+A(s)*60+A(t)}s`,ce=({months:e=[],daysOfMonth:a=[],daysOfWeek:s=[]})=>{var c,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),r=a.sort((u,l)=>u-l).join(","),i=(((o=(c=s==null?void 0:s[0])==null?void 0:c.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:i}},W=e=>e.length===0?null:{indexedFields:{...U(e)}},N=(e,a,s)=>{const{hour:t,minute:r,second:n,phase:i,cronString:c}=a,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${c}#${c}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=ne(l,t,r,n);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:T}=ce({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?T:"",hour:t,minute:r,second:n}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}};let Q,x;const Oe=async({action:e,spec:a,presets:s})=>{const{identity:t,namespace:r,name:n,workflowId:i,workflowType:c,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await D({input:u,encoding:l,messageType:d})}catch(b){y.set(`${$("data-encoder.encode-error")}: ${b==null?void 0:b.message}`);return}const T={schedule_id:n.trim(),searchAttributes:S.length===0?null:{indexedFields:{...U(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...U(h)}}}}}};N(T,a,s),k.set(!0);const{error:_}=await ae({identity:t,scheduleId:n,namespace:r,body:T});_?(y.set(_),k.set(!1)):(clearTimeout(Q),Q=setTimeout(()=>{y.set(""),k.set(!1),z(oe({namespace:r}))},2e3))},Ae=async({action:e,spec:a,presets:s},t,r)=>{var q,F;const{identity:n,namespace:i,name:c,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:T}=e;let _;if(d)try{_=await D({input:d,encoding:S,messageType:h})}catch(p){y.set(`${$("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:b}=s,v={schedule_id:r,searchAttributes:W(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:_?{payloads:_}:null},searchAttributes:W(T)}}}},I=(F=(q=v.schedule.action.startWorkflow)==null?void 0:q.header)==null?void 0:F.fields;if(I&&Object.keys(I).length>0)try{const p=Object.entries(I);for(const[B,H]of p){const L=await D({input:w(H),encoding:"json/plain"});I[B]=L[0]}}catch(p){y.set(`${$("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}b==="existing"?v.schedule.spec=t.spec:(N(v,a,s),v.schedule.spec.structuredCalendar=[]),k.set(!0);const{error:P}=await re({identity:n,namespace:i,scheduleId:r,body:v});P?(y.set(P),k.set(!1)):(clearTimeout(x),x=setTimeout(()=>{z(se({namespace:i,scheduleId:c})),y.set(""),k.set(!1)},2e3))},k=E(!1),y=E(""),$e=E("0");export{Oe as a,Ie as b,$e as c,_e as d,y as e,Te as f,Se as g,we as h,k as l,ke as p,Ae as s,ve as t,be as u};
