import"./C7UJxxoo.js";import"./BLjkLUx2.js";import"./Ip-blrGX.js";import"./BiMlMv8r.js";import{h as E}from"./byHaz_JD.js";import{f as S}from"./cq7hwzrg.js";import{m as y,i as C,n as h,o as I,p as B,j as O,q as N,h as U,r as j,a as R,s as V,t as v,u as q,v as D,w as K,x as L,y as M}from"./DPZf26_M.js";import{e as H,f as P,g as _}from"./DNNVWk-J.js";import{h as z}from"./CeMbHz9m.js";const g=e=>e.eventType==="WorkflowTaskFailed",G=e=>e.eventType==="WorkflowTaskCompleted",W=e=>y(e)&&F(e)==="ResetWorkflow",F=e=>{var i;const{workflowTaskFailedEventAttributes:{failure:t,cause:r}}=e;return((i=t==null?void 0:t.applicationFailureInfo)==null?void 0:i.type)==="workflowTaskHeartbeatError"?"WorkflowTaskHeartbeatError":H(r)},A=e=>{const t=e.findIndex(g);if(t<0)return;const r=e.findIndex(G),i=e.find(a=>g(a));if(F(i)!=="ResetWorkflow"&&(r<0||t<r))return i},Te=(e,t)=>{if(t==="descending")return A(e);{const r=[...e].reverse();return A(r)}},J=(e,t)=>{var r,i,s,a,c,u,f,d,m,k,T,p,l;try{if(C(e)){const o=(r=e.attributes)==null?void 0:r.firstExecutionRunId,n=(i=e.attributes)==null?void 0:i.originalExecutionRunId;return o===n&&((c=(a=(s=e.attributes)==null?void 0:s.searchAttributes)==null?void 0:a.indexedFields)==null?void 0:c.TemporalScheduledById)?3:1}if(h(e)||I(e)||B(e)&&e.id!=="2"||O(e)||N(e)||U(e)||j(e)||R(e))return 1;if(V(e)){const o=Object.keys(e.attributes.searchAttributes.indexedFields);return(o==null?void 0:o.length)===1&&((d=(f=(u=e.attributes)==null?void 0:u.searchAttributes)==null?void 0:f.indexedFields)!=null&&d.TemporalChangeVersion)?0:1}if(v(e)){if(["core_patch","Version"].includes((m=e==null?void 0:e.attributes)==null?void 0:m.markerName))return 0;const n=(k=e.attributes)==null?void 0:k.workflowTaskCompletedEventId;if(n&&t)return t.has(String(n))?0:(t.add(String(n)),1);if(n)return 1}return W(e)?1:q(e)?2:D(e)?(((T=e.attributes)==null?void 0:T.attempt)||1)-1:K(e)?Math.min(((l=(p=e.attributes)==null?void 0:p.meteringMetadata)==null?void 0:l.nonfirstLocalActivityExecutionAttempts)||0,100):0}catch{return 0}},Q=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],X=e=>{if(typeof e=="number")return"Unspecified";if(e.includes("RequestCancel"))return"CancelRequested";for(const t of Q)if(e.includes(t))return t;return"Unspecified"},Y=["closeTime","createTime","currentAttemptScheduledTime","earliestTime","eventTime","executionTime","expirationTime","expireTime","lastAccessTime","lastHeartbeatTime","lastStartedTime","lastUpdateTime","latestTime","releaseTime","scheduledTime","startedTime","startTime","workflowExecutionExpirationTime"],Z=["backoffStartInterval","defaultWorkflowTaskTimeout","firstWorkflowTaskBackoff","heartbeatTimeout","initialInterval","maximumInterval","scheduleToCloseTimeout","scheduleToStartTimeout","startToCloseTimeout","startToFireTimeout","workflowExecutionRetentionPeriod","workflowExecutionRetentionTtl","workflowExecutionTimeout","workflowRunTimeout","workflowTaskTimeout"],$=e=>{for(const t of Y)if(t===e)return!0;return!1},ee=e=>{for(const t of Z)if(t===e)return!0;return!1},te=e=>{if(e===null||e===void 0||typeof e!="object")return!1;const t=Object.keys(e),[r]=t;return!(t.length!==1||typeof e[r]!="string")},re=e=>{for(const t of Object.values(e))return t};function ie(e,t=!1){for(const[r,i]of Object.entries(e))te(i)&&(e[r]=re(i)),$(r)&&!t&&(e[r]=S(i)),ee(r)&&(e[r]=z(i)),r==="versioningBehavior"&&(e[r]=P(i,"VersioningBehavior"));return E(e,"workerVersion")&&E(e,"deploymentVersion")&&delete e.workerVersion,e}const oe=(e,t=()=>!1,r)=>({...e,billableActions:t(e)?0:J(e,r)}),se=(e,t={})=>{var l,o,n,w,b,x;const r=String(e.eventId),i=_(e.eventType),s=S(String(e.eventTime)),a=X(i),c=M(i),{key:u,attributes:f}=L(e),d=C(e)&&((n=(o=(l=e.workflowExecutionStartedEventAttributes)==null?void 0:l.completionCallbacks)==null?void 0:o[0])==null?void 0:n.links),m=R(e)&&((x=(b=(w=e.workflowExecutionOptionsUpdatedEventAttributes)==null?void 0:w.attachedCompletionCallbacks)==null?void 0:b[0])==null?void 0:x.links),k=d||m,T=(e==null?void 0:e.links)||k||[],p={...e,name:i,id:r,eventType:i,timestamp:s,classification:a,category:c,links:T,billableActions:0,attributes:ie({type:u,...f})};return oe(p,t.shouldNotAddBillableAction,t.processedWorkflowTaskIds)},pe=e=>{const t=e.findLast(W),r=s=>t?Number(s.id)<Number(t.eventId):!1,i=new Set;return e.map(s=>se(s,{shouldNotAddBillableAction:r,processedWorkflowTaskIds:i}))},we=e=>e===null||typeof e!="object"||Array.isArray(e)?!1:!!E(e,"eventType"),be=e=>{const t={...e};return delete t.name,delete t.id,delete t.timestamp,delete t.classification,delete t.category,delete t.attributes,t};export{Te as a,be as f,F as g,we as i,ie as s,pe as t};
