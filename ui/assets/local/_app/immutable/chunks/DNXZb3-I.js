import{x as G,v as F,w as R,D as H,G as j,a7 as L,aQ as N,aR as V,ad as W,A as Y,aS as J,P as K,a5 as X}from"./DtSMpxPp.js";import{w as P}from"./C_fvR0pn.js";import{g as M}from"./ndZP_Lp7.js";import{t as O}from"./BXv1jDVW.js";import"./D0Jyh3oV.js";import{s as w}from"./BDfAQ6r3.js";import{r as m,a as f}from"./Jmw_Tzmt.js";import{i as $}from"./DwTIK7sC.js";import{e as D}from"./BQGGJSaM.js";import{p as Z,q as ee}from"./Cj2Ca3zr.js";function fe(e,n,s,t,r){var c=e,i="",a;G(()=>{if(i===(i=n()??"")){F&&R();return}a!==void 0&&(X(a),a=void 0),i!==""&&(a=H(()=>{if(F){j.data;for(var o=R(),u=o;o!==null&&(o.nodeType!==8||o.data!=="");)u=o,o=L(o);if(o===null)throw N(),V;W(j,u),c=Y(o);return}var l=i+"",d=J(l);W(K(d),d.lastChild),c.before(d)}))})}const ge=async(e,n,s,t=fetch)=>(r=100,c="")=>{const i=m("schedules",{namespace:e});return f(i,{params:{maximumPageSize:String(r),nextPageToken:c,...n?{query:n}:{}},request:t,onError:s}).then(({schedules:a,nextPageToken:o})=>({items:a,nextPageToken:o?String(o):""}))};async function ye(e,n=fetch){const s=m("schedule",e);return f(s,{request:n})}async function we({namespace:e,scheduleId:n,identity:s},t=fetch){const r=m("schedule",{namespace:e,scheduleId:n});return f(r,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function te({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const c=o=>{var u;return r=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=m("schedule",{namespace:e,scheduleId:n}),{conflictToken:a}=await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:c});return{conflictToken:a,error:r}}async function se({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const c=a=>{var o;return r=((o=a==null?void 0:a.body)==null?void 0:o.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:n});return await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:c}),{error:r}}async function Se({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{pause:s}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function ke({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{unpause:s}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function be({namespace:e,scheduleId:n,overlapPolicy:s,identity:t}){const r={patch:{triggerImmediately:{overlapPolicy:s}}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function _e({namespace:e,scheduleId:n,overlapPolicy:s,identity:t,startTime:r,endTime:c}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:r,endTime:c}]}},a=m("schedule.patch",{namespace:e,scheduleId:n});return await f(a,{options:{method:"POST",body:w({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const A=e=>e?parseInt(e):0,oe=(e,n,s,t)=>`${A(e)*60*60*24+A(n)*60*60+A(s)*60+A(t)}s`,ne=({months:e=[],daysOfMonth:n=[],daysOfWeek:s=[]})=>{var a,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),r=n.sort((u,l)=>u-l).join(","),i=(((o=(a=s==null?void 0:s[0])==null?void 0:a.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:i}},C=e=>e.length===0?null:{indexedFields:{...$(e)}},Q=(e,n,s)=>{const{hour:t,minute:r,second:c,phase:i,cronString:a}=n,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${a}#${a}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=oe(l,t,r,c);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:k}=ne({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?k:"",hour:t,minute:r,second:c}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Te=async({action:e,spec:n,presets:s})=>{const{identity:t,namespace:r,name:c,workflowId:i,workflowType:a,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await D({input:u,encoding:l,messageType:d})}catch(T){y.set(`${O("data-encoder.encode-error")}: ${T==null?void 0:T.message}`);return}const k={schedule_id:c.trim(),searchAttributes:S.length===0?null:{indexedFields:{...$(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...$(h)}}}}}};Q(k,n,s),_.set(!0);const{error:b}=await te({identity:t,scheduleId:c,namespace:r,body:k});b?(y.set(b),_.set(!1)):setTimeout(()=>{y.set(""),_.set(!1),M(ee({namespace:r}))},2e3)},ve=async({action:e,spec:n,presets:s},t,r)=>{var E,q;const{identity:c,namespace:i,name:a,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:k}=e;let b;if(d)try{b=await D({input:d,encoding:S,messageType:h})}catch(p){y.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:T}=s,v={schedule_id:r,searchAttributes:C(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:b?{payloads:b}:null},searchAttributes:C(k)}}}},I=(q=(E=v.schedule.action.startWorkflow)==null?void 0:E.header)==null?void 0:q.fields;if(I&&Object.keys(I).length>0)try{const p=Object.entries(I);for(const[x,z]of p){const B=await D({input:w(z),encoding:"json/plain"});I[x]=B[0]}}catch(p){y.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}T==="existing"?v.schedule.spec=t.spec:(Q(v,n,s),v.schedule.spec.structuredCalendar=[]),_.set(!0);const{error:U}=await se({identity:c,namespace:i,scheduleId:r,body:v});U?(y.set(U),_.set(!1)):setTimeout(()=>{M(Z({namespace:i,scheduleId:a})),y.set(""),_.set(!1)},2e3)},_=P(!1),y=P(""),Ie=P("0");export{Te as a,_e as b,Ie as c,we as d,y as e,ye as f,ge as g,fe as h,_ as l,Se as p,ve as s,be as t,ke as u};
