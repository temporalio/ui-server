import{t as V,x as M,y as R,ai as Y,bk as G,Q as j,R as J,a6 as K,bl as X,bm as Z,ah as C,B as ee,bn as te,P as O}from"./DPYmeJXN.js";import{w as P}from"./DIJxQKhU.js";import{g as z}from"./BZkVbFNg.js";import{t as A}from"./DEjs8ZrU.js";import"./DAcYyk2F.js";import{s as w}from"./DMvnBdKo.js";import{r as p,a as f}from"./CwQRaZcq.js";import{s as D}from"./D4c3sLaV.js";import{e as E}from"./CVsbKRkf.js";import{s as se,t as oe}from"./KdwXAyyc.js";function we(e,n,s=!1,t=!1,r=!1){var a=e,i="";V(()=>{var c=Y;if(i===(i=n()??"")){M&&R();return}if(c.nodes!==null&&(G(c.nodes.start,c.nodes.end),c.nodes=null),i!==""){if(M){j.data;for(var o=R(),u=o;o!==null&&(o.nodeType!==J||o.data!=="");)u=o,o=K(o);if(o===null)throw X(),Z;C(j,u),a=ee(o);return}var l=i+"";s?l=`<svg>${l}</svg>`:t&&(l=`<math>${l}</math>`);var d=te(l);if((s||t)&&(d=O(d)),C(O(d),d.lastChild),s||t)for(;O(d);)a.before(O(d));else a.before(d)}})}const Se=async(e,n,s,t=fetch)=>(r=100,a="")=>{const i=p("schedules",{namespace:e});return f(i,{params:{maximumPageSize:String(r),nextPageToken:a,...n?{query:n}:{}},request:t,onError:s}).then(({schedules:c,nextPageToken:o})=>({items:c,nextPageToken:o?String(o):""}))};async function Te(e,n=fetch){const s=p("schedule",e);return f(s,{request:n})}async function _e({namespace:e,scheduleId:n,identity:s},t=fetch){const r=p("schedule",{namespace:e,scheduleId:n});return f(r,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function ne({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const a=o=>{var u;return r=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=p("schedule",{namespace:e,scheduleId:n}),{conflictToken:c}=await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:a});return{conflictToken:c,error:r}}async function re({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const a=c=>{var o;return r=((o=c==null?void 0:c.body)==null?void 0:o.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=p("schedule.edit",{namespace:e,scheduleId:n});return await f(i,{options:{method:"POST",body:w({request_id:crypto.randomUUID(),...s,...t&&{identity:t}})},onError:a}),{error:r}}async function be({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{pause:s}},a=p("schedule.patch",{namespace:e,scheduleId:n});return await f(a,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function ke({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{unpause:s}},a=p("schedule.patch",{namespace:e,scheduleId:n});return await f(a,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function ve({namespace:e,scheduleId:n,overlapPolicy:s,identity:t}){const r={patch:{triggerImmediately:{overlapPolicy:s}}},a=p("schedule.patch",{namespace:e,scheduleId:n});return await f(a,{options:{method:"POST",body:w({...r,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}async function Ie({namespace:e,scheduleId:n,overlapPolicy:s,identity:t,startTime:r,endTime:a}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:r,endTime:a}]}},c=p("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...i,request_id:crypto.randomUUID(),...t&&{identity:t}})}})}const $=e=>e?parseInt(e):0,ae=(e,n,s,t)=>`${$(e)*60*60*24+$(n)*60*60+$(s)*60+$(t)}s`,ce=({months:e=[],daysOfMonth:n=[],daysOfWeek:s=[]})=>{var c,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),r=n.sort((u,l)=>u-l).join(","),i=(((o=(c=s==null?void 0:s[0])==null?void 0:c.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:i}},W=e=>e.length===0?null:{indexedFields:{...D(e)}},B=(e,n,s)=>{const{hour:t,minute:r,second:a,phase:i,cronString:c}=n,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${c}#${c}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=ae(l,t,r,a);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:T}=ce({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?T:"",hour:t,minute:r,second:a}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}};let Q,x;const Oe=async({action:e,spec:n,presets:s})=>{const{identity:t,namespace:r,name:a,workflowId:i,workflowType:c,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await E({input:u,encoding:l,messageType:d})}catch(k){y.set(`${A("data-encoder.encode-error")}: ${k==null?void 0:k.message}`);return}const T={schedule_id:a.trim(),searchAttributes:S.length===0?null:{indexedFields:{...D(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...D(h)}}}}}};B(T,n,s),b.set(!0);const{error:_}=await ne({identity:t,scheduleId:a,namespace:r,body:T});_?(y.set(_),b.set(!1)):(clearTimeout(Q),Q=setTimeout(()=>{y.set(""),b.set(!1),z(oe({namespace:r}))},2e3))},$e=async({action:e,spec:n,presets:s},t,r)=>{var q,F;const{identity:a,namespace:i,name:c,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:T}=e;let _;if(d)try{_=await E({input:d,encoding:S,messageType:h})}catch(m){y.set(`${A("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}const{preset:k}=s,v={schedule_id:r,searchAttributes:W(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:_?{payloads:_}:null},searchAttributes:W(T)}}}},I=(F=(q=v.schedule.action.startWorkflow)==null?void 0:q.header)==null?void 0:F.fields;if(I&&Object.keys(I).length>0)try{const m=Object.entries(I);for(const[N,H]of m){const L=await E({input:w(H),encoding:"json/plain"});I[N]=L[0]}}catch(m){y.set(`${A("data-encoder.encode-error")}: ${m==null?void 0:m.message}`);return}k==="existing"?v.schedule.spec=t.spec:(B(v,n,s),v.schedule.spec.structuredCalendar=[]),b.set(!0);const{error:U}=await re({identity:a,namespace:i,scheduleId:r,body:v});U?(y.set(U),b.set(!1)):(clearTimeout(x),x=setTimeout(()=>{z(se({namespace:i,scheduleId:c})),y.set(""),b.set(!1)},2e3))},b=P(!1),y=P(""),Ae=P("0");export{Oe as a,Ie as b,Ae as c,_e as d,y as e,Te as f,Se as g,we as h,b as l,be as p,$e as s,ve as t,ke as u};
