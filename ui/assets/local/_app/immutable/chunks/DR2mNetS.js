import"./CWj6FrbW.js";import{p as at,ac as w,ah as k,ai as $,aI as nt,t as K,r as A,e as W,b as ut,g as t,s as i,J as f,h as ct,f as it,i as lt}from"./U_G9-AHJ.js";import{d as ft}from"./CVVZ9xwv.js";import{i as mt}from"./DIFdH0Rm.js";import{e as pt}from"./CbnBDLOu.js";import{p as B,s as wt,a as v,e as P,b as dt}from"./DNW1xCX_.js";import{a as ht}from"./D1QWZ-ZU.js";import{p as g}from"./CM_2JwtB.js";import{S as yt}from"./DBKq9VF9.js";import{r as kt,w as _,b as D,d as vt}from"./C3D7dHmJ.js";import{w as O}from"./C5uP_BhQ.js";import{c as gt}from"./DIErjWS3.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as G}from"./ijUxpU0G.js";import{b as xt}from"./yjRYn6kX.js";import{t as Ct,c as St}from"./DTviswFA.js";import{u as bt}from"./Dl6r_ice.js";import{W as Et}from"./HxYhkKgM.js";const N=(u=[])=>u.map(e=>{const s=xt(e==null?void 0:e.groupValues[0]),d=parseInt(e.count);return{status:s,count:d}}).sort((e,s)=>G.indexOf(e.status)-G.indexOf(s.status)),Wt=(u,e)=>{if(e<=1)return u*1e3;const s=300,m=u*Math.pow(1.2,e-1);return Math.min(s,Math.round(m))*1e3};var Pt=(u,e,s)=>e(s()),It=K("<button><!></button>"),Tt=K('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function Vt(u,e){at(e,!0);const[s,d]=wt(),m=()=>v(O,"$workflowFilters",s),n=()=>v(_,"$workflowCount",s),I=()=>v(vt,"$disableWorkflowCountsRefresh",s),Y=()=>v(kt,"$refresh",s);let H=B(e,"staticQuery",3,""),T=B(e,"refreshTime",15);const J=w(()=>g.url.searchParams.get("query")),x=w(()=>g.params.namespace),C=w(()=>H()||t(J)),L=w(()=>g.url.searchParams.get("per-page"));let F=k($([])),h=k($([])),q,p=k(1),S=k(!1);const U=60,V=20,j=r=>{if(!m().some(a=>a.attribute==="ExecutionStatus"&&a.value===r)){const a={attribute:"ExecutionStatus",type:_t.KEYWORD,value:r,operator:"",conditional:"=",parenthesis:""};dt(O,[...m(),a]);const c=Ct(St(m()));bt({url:g.url,parameter:"query",value:c,clearParameters:[gt]})}},R=()=>{clearTimeout(q),i(h,[],!0),P(_,f(n).newCount=0,f(n)),i(p,1)},z=async()=>{i(S,!0);try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).count=parseInt(r),f(n)),i(F,N(o),!0)}finally{T(new Date),i(S,!1)}},X=async()=>{try{const{count:r,groups:o}=await D({namespace:t(x),query:t(C)}).catch(a=>({count:"0",groups:[]}));P(_,f(n).newCount=parseInt(r)-n().count,f(n)),i(h,N(o),!0)}finally{T(new Date),i(p,t(p)+1)}},M=()=>{const r=Wt(U,t(p));q=setTimeout(async()=>{await X(),!I()&&t(p)<=V&&M()},r)},Z=async()=>{R(),await z(),I()||M()};nt(()=>{t(x),t(C),t(L),Y(),Z()}),ht(()=>{R()});var b=Tt();pt(b,21,()=>t(F),({count:r,status:o})=>o,(r,o)=>{let a=()=>t(o).count,c=()=>t(o).status;var Q=ct(),tt=it(Q);{var et=l=>{var y=It();y.__click=[Pt,j,c];var rt=lt(y);const ot=w(()=>t(h).find(E=>E.status===c())?t(h).find(E=>E.status===c()).count-a():0);Et(rt,{get status(){return c()},get count(){return a()},get newCount(){return t(ot)},get"test-id"(){return`workflow-status-${c()??""}`}}),A(y),W(l,y)},st=l=>{yt(l,{class:"h-6 w-24 rounded-sm"})};mt(tt,l=>{t(S)?l(st,!1):l(et)})}W(r,Q)}),A(b),W(u,b),ut(),d()}ft(["click"]);export{Vt as W};
