import{g,d as z,w as C}from"./r33Ll6et.js";import{p as U}from"./D0YMuDhF.js";import{t as S}from"./DEjs8ZrU.js";import{A as W}from"./TBME1SPK.js";import{b as At,c as St,a as Et}from"./Temu8zyn.js";import{h as _t,i as Rt,j as bt,k as Wt}from"./DNNVWk-J.js";import{s as Lt,t as kt}from"./BUq_mk5f.js";import{X as Ct}from"./Tj4XTIfQ.js";import{i as ht,s as Nt}from"./BUgj0dX6.js";import{a as Dt}from"./DEsUSA2c.js";import{m as It,r as E,a as w,b as Yt,p as pt,c as $t,d as Ft,e as v,i as Ut}from"./CGFCnWC_.js";import{e as L,s as Ot}from"./D_ONC9PZ.js";import{p as qt}from"./CbOBDAzH.js";import{s as P}from"./DMvnBdKo.js";import{i as Bt,b as Qt,t as mt,c as jt}from"./CtQjrHKC.js";import{a as zt}from"./CHSmiEEv.js";const vt=["json/plain","json/protobuf"],Gt=t=>vt.includes(t),Vt=(t=Lt)=>!g(t).disableWriteActions,Xt=(t=[])=>t.map(o=>{const n=Ct(o,!0),r=o.activityId,e=o.state;return{...n,id:r,state:Rt(e)}}),Mt=t=>t?t.map(o=>({...o,state:bt(o.state)})):[],Kt=t=>t?t.map(o=>({...o,state:Wt(o.state)})):[],Ht=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:At(e)}),{})},Jt=({executionTime:t,startTime:o})=>{if(!t||!o)return;const n=new Date(t).getTime()-new Date(o).getTime();if(n>0)return Math.round(n/1e3)+"s"},G=t=>{var H,J,Z,tt,ot,nt,rt,et,at,st,it,ct,ut,dt,lt,ft,wt;const o=Ht(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,c=t.workflowExecutionInfo.startTime,s=t.workflowExecutionInfo.closeTime,i=t.workflowExecutionInfo.executionTime,d=_t(t.workflowExecutionInfo.status),l=d==="Running",f=t.workflowExecutionInfo.historyLength,u=t.workflowExecutionInfo.historySizeBytes,k=`/workflows/${e}/${a}`,I=((J=(H=t==null?void 0:t.executionConfig)==null?void 0:H.taskQueue)==null?void 0:J.name)||((Z=t==null?void 0:t.workflowExecutionInfo)==null?void 0:Z.taskQueue),T=(tt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:tt.mostRecentWorkerVersionStamp,h=(ot=t==null?void 0:t.workflowExecutionInfo)==null?void 0:ot.assignedBuildId,R=(nt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:nt.parentNamespaceId,O=(rt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:rt.parentExecution,A=t.workflowExecutionInfo.stateTransitionCount,N=(et=t.executionConfig)==null?void 0:et.defaultWorkflowTaskTimeout,D=(at=t.executionConfig)==null?void 0:at.workflowExecutionTimeout,y=Xt(t.pendingActivities),X=(t==null?void 0:t.pendingChildren)??[],b=Mt(t==null?void 0:t.pendingNexusOperations),m=t==null?void 0:t.pendingWorkflowTask,Y=Kt(t==null?void 0:t.callbacks),p=(st=t.workflowExecutionInfo)==null?void 0:st.rootExecution,q=(it=t.workflowExecutionInfo)==null?void 0:it.versioningInfo,B=(ct=t.workflowExecutionInfo)==null?void 0:ct.priority,Q=t.workflowExtendedInfo??{},x=Jt({executionTime:i,startTime:c});let M,K;return(ut=t==null?void 0:t.executionConfig)!=null&&ut.userMetadata&&(M=(lt=(dt=t==null?void 0:t.executionConfig)==null?void 0:dt.userMetadata)==null?void 0:lt.summary,K=(wt=(ft=t==null?void 0:t.executionConfig)==null?void 0:ft.userMetadata)==null?void 0:wt.details),{name:r,id:e,runId:a,startTime:c,endTime:s,executionTime:i,status:d,historyEvents:f,historySizeBytes:u,searchAttributes:o,memo:n,rootExecution:p,url:k,taskQueue:I,assignedBuildId:h,mostRecentWorkerVersionStamp:T,pendingActivities:y,pendingChildren:X,pendingNexusOperations:b,pendingWorkflowTask:m,callbacks:Y,versioningInfo:q,priority:B,summary:M,details:K,parentNamespaceId:R,parent:O,stateTransitionCount:A,isRunning:l,defaultWorkflowTaskTimeout:N,workflowExecutionTimeout:D,workflowExtendedInfo:Q,startDelay:x,get canBeTerminated(){return l&&Vt()}}},_=t=>(t.executions||[]).map(o=>G({workflowExecutionInfo:o})),Co=C(0),Zt=z([U],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),No=z([U],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),to=z([ht,kt],([t,o])=>t||It("1.23.0",o)),Do=C(""),Yo=C({count:0,newCount:0}),j=C(""),po=C("");var $=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))($||{}),F=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(F||{});const oo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},no=["workflowId","workflowType","timeRange","executionStatus","closeTime"],ro=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),eo=t=>{if(typeof t!="string")return!1;for(const o of no)if(o===t)return!0;return!1},ao=(t,o,n)=>{const r=oo[t];return o==="All"?"":Bt(o)||Qt(o)?n||g(Nt)?`${r} > "${mt(o)}"`:`${r} BETWEEN "${mt(o)}" AND "${jt()}"`:`${r}="${o}"`},so=(t,o)=>Object.entries(t).map(([n,r])=>{if(eo(n)&&ro(r))return ao(n,r,o)}).filter(Boolean),yt=(t,o=!1)=>so(t,o).join(" and ");function io(t){console.error("Unhandled action:",t)}const co=(t,o)=>{let n;switch(t){case W.Cancel:n=S("workflows.canceled");break;case W.Reset:n=S("workflows.reset");break;case W.Terminate:n=S("workflows.terminated");break;default:io(t)}return S("workflows.workflow-action-reason-placeholder",{action:n,identity:o})},Pt=({action:t,reason:o,identity:n})=>{const r=co(t,n);return o?[o.trim(),r].join(" "):r},gt=["category=WorkflowTaskFailed","category=WorkflowTaskTimedOut"],uo=`\`ExecutionStatus\`="Running" AND \`TemporalReportedProblems\` IN (${gt.map(t=>'"'+t+'"').join(", ")})`,$o=t=>{var n,r;return!t.searchAttributes||t.status!=="Running"?!1:(((r=(n=t.searchAttributes)==null?void 0:n.indexedFields)==null?void 0:r.TemporalReportedProblems)||[]).some(e=>gt.includes(e))},Fo=async(t,o=fetch)=>{try{const n=E("workflows.count",{namespace:t}),r=await w(n,{params:{query:uo},onError:()=>{},handleError:()=>{},request:o});return parseInt((r==null?void 0:r.count)||"0")}catch{}},Tt=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=E("workflows.count",{namespace:t}),{count:e,groups:a}=await w(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},Uo=async({namespace:t,query:o})=>{const n='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',r=o?`${n} AND ${o}`:n,e=E("workflows.count",{namespace:t}),{count:a}=await w(e,{params:{query:r},notifyOnError:!1});return a??"0"},lo=async(t,o,n=fetch,r=!1)=>{const e=o.query||yt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=r?"workflows.archived":"workflows";let s="";const i=u=>{var k,I;v(u),(k=u==null?void 0:u.body)!=null&&k.message||u!=null&&u.status?s=((I=u==null?void 0:u.body)==null?void 0:I.message)??`Error fetching workflows: ${u.status}: ${u.statusText}`:s="Error fetching workflows: Server failed to respond"},d=E(c,{namespace:t}),{executions:l,nextPageToken:f}=await w(d,{params:{query:a},onError:i,handleError:i,request:n})??{executions:[],nextPageToken:""};return{workflows:_({executions:l}),nextPageToken:String(f),error:s}},Oo=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var l;const e="workflows",a=n??Yt(t),c=pt(e,{namespace:t}),s=a+c,{executions:i}=await w(s,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},d=(l=_({executions:i}))==null?void 0:l[0];return{runId:d==null?void 0:d.runId}},qo=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=s=>{($t(s)||Ft(s))&&(e=!1)},c=E(r,{namespace:t});return await w(c,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}};async function V(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return w(n,{request:o,notifyOnError:!1,params:t.runId?{"execution.runId":t.runId}:{}}).then(r=>({workflow:G(r)})).catch(r=>({error:r}))}async function Bo({workflow:t,namespace:o,reason:n,first:r,identity:e}){const a=E("workflow.terminate",{namespace:o,workflowId:t.id}),c=Pt({reason:n,action:W.Terminate,identity:e});return await w(a,{options:{method:"POST",body:P({reason:c,...e&&{identity:e},firstExecutionRunId:r})},notifyOnError:!1,params:r?{}:{"execution.runId":t.runId}})}async function Qo({namespace:t,workflow:{id:o,runId:n},identity:r},e=fetch){const a={namespace:t,workflowExecution:{workflowId:o,runId:n},requestId:crypto.randomUUID(),...r&&{identity:r}},c=E("workflow.cancel",{namespace:t,workflowId:o});return w(c,{request:e,notifyOnError:!1,options:{method:"POST",body:P(a)},params:{"execution.runId":n}})}async function jo({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a,messageType:c,identity:s}){const i=E("workflow.signal",{namespace:t,workflowId:o,signalName:r}),d=await L({input:e,encoding:a,messageType:c}),l=g(U).data.settings,f=(l==null?void 0:l.version)??"",u=Ut(f,"2.22"),k={signalName:r,input:{payloads:d},...s&&{identity:s},...u?{workflowExecution:{workflowId:o,runId:n}}:{params:{"execution.runId":n}}};return w(i,{notifyOnError:!1,options:{method:"POST",body:P(k)}})}async function zo({namespace:t,workflow:{workflowId:o,runId:n},name:r,identity:e,updateId:a,input:c="",encoding:s}){const i=E("workflow.update",{namespace:t,workflowId:o,updateName:r}),d=await L({input:c,encoding:s});return w(i,{notifyOnError:!1,options:{method:"POST",body:P({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:e},input:{args:{payloads:d}}}})}})}async function vo({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:c,excludeUpdates:s,identity:i}){const d=E("workflow.reset",{namespace:t,workflowId:o}),l=Pt({action:W.Reset,reason:e,identity:i}),f={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:crypto.randomUUID(),reason:l,...i&&{identity:i}};if(g(ht)||It("1.24.0",g(kt))){const u=[];!c&&!s&&u.push($.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),c&&u.push($.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),s&&u.push($.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),f.resetReapplyExcludeTypes=u,f.resetReapplyType=F.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let u;a?u=F.RESET_REAPPLY_TYPE_SIGNAL:u=F.RESET_REAPPLY_TYPE_NONE,f.resetReapplyType=u}return w(d,{notifyOnError:!1,options:{method:"POST",body:P(f)},params:{"execution.runId":n}})}async function Go(t,o=fetch){const n=e=>{console.error(e)},r=E("workflow",t);return w(r,{request:o,onError:n,handleError:n}).then(G)}async function Vo(t,o,n){if(!g(to))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await lo(t,{query:r});return e}catch{return[]}}const fo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=Ot(n.value)}),o};async function Xo({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:c,encoding:s,messageType:i,searchAttributes:d,identity:l,workflowStartDelay:f}){const u=E("workflow",{namespace:t,workflowId:o});let k,I,T;if(e)try{k=await L({input:e,encoding:s,messageType:i})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(I=(await L({input:P(a),encoding:"json/plain"}))[0]),c&&(T=(await L({input:P(c),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const h=P({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:k?{payloads:k}:null,userMetadata:{summary:I,details:T},searchAttributes:d.length===0?null:{indexedFields:{...fo(d)}},...l&&{identity:l},...f&&{workflowStartDelay:f}});return w(u,{notifyOnError:!1,options:{method:"POST",body:h}})}const Mo=async({namespace:t,runId:o,workflowType:n,workflowId:r})=>{var c,s,i,d,l,f,u,k,I,T;const e=h=>{console.error(h)},a={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{const h=[];o&&h.push(`RunId = "${o}"`),n&&h.push(`WorkflowType = "${n}"`),r&&h.push(`WorkflowId = "${r}"`);const R=h.join(" AND "),O=E("workflows",{namespace:t}),A=await w(O,{params:{query:R,pageSize:"1"},handleError:e});if(!((c=A==null?void 0:A.executions)!=null&&c[0]))return a;const N=_(A)[0],D={namespace:t,workflowId:N.id,runId:N.runId},{workflow:y}=await V(D),b=await zt(D),m=await St((s=b==null?void 0:b.attributes)==null?void 0:s.input,t,g(U).data.settings,g(Dt).accessToken,"readable",!1);let Y="";if(y.summary){const x=await Et(y.summary);typeof x=="string"&&(Y=x)}let p="";if(y.details){const x=await Et(y.details);typeof x=="string"&&(p=x)}const q=m!=null&&m.payloads?P((i=m.payloads[0])==null?void 0:i.data):"",B=m!=null&&m.payloads&&Gt((l=(d=m.payloads[0])==null?void 0:d.metadata)==null?void 0:l.encoding)?(u=(f=m.payloads[0])==null?void 0:f.metadata)==null?void 0:u.encoding:"json/plain",Q=m!=null&&m.payloads?(I=(k=m.payloads[0])==null?void 0:k.metadata)==null?void 0:I.messageType:"";return{input:q,encoding:B,messageType:Q,searchAttributes:(T=y==null?void 0:y.searchAttributes)==null?void 0:T.indexedFields,summary:Y,details:p}}catch{return a}},wo=(t,o)=>{const n=new Map;o.forEach(e=>{if(e.parent){const a=`${e.parent.workflowId}:${e.parent.runId}`,c=n.get(a)||[];c.push(e),n.set(a,c)}});const r=(e,a)=>{var d,l;const c=`${e.id}:${e.runId}`,s=n.get(c)||[],i={workflow:e,scheduleId:(l=(d=e==null?void 0:e.searchAttributes)==null?void 0:d.indexedFields)==null?void 0:l.TemporalScheduledById,children:[],rootPaths:[...a,{runId:e.runId,workflowId:e.id}]};return i.children=s.map(f=>r(f,i.rootPaths)),i};return r(t,[])},Eo=({parent:t,workflow:o,children:n,siblingCount:r})=>{const e=n.map(s=>{const i=t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id},{runId:s.runId,workflowId:s.id}]:[{runId:o.runId,workflowId:o.id},{runId:s.runId,workflowId:s.id}];return{workflow:s,siblingCount:r,children:[],rootPaths:i}}),a={workflow:o,children:e,rootPaths:t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id}]:[{runId:o.runId,workflowId:o.id}]};return t?{workflow:t,children:[a],rootPaths:[{runId:t.runId,workflowId:t.id}]}:a};async function Ko(t,o,n){let r=`RootWorkflowId = "${o}"`;return n&&(r+=` AND RootRunId = "${n}"`),await Tt({namespace:t,query:r})}async function Ho(t,o,n){let r=`RootWorkflowId = "${o}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await V({namespace:t,workflowId:o,runId:n}),a=await xt(t,{query:r});return wo(e==null?void 0:e.workflow,a)}async function Jo({namespace:t,parentWorkflowId:o,parentRunId:n,workflow:r}){let e;const a=async(i,d)=>{const l=`ParentWorkflowId = "${i}" AND ParentRunId = "${d}"`;return await xt(t,{query:l})};let c=0;if(o){e=await V({namespace:t,workflowId:o,runId:n});const i=`ParentWorkflowId = "${o}" AND ParentRunId = "${n}"`,{count:d}=await Tt({namespace:t,query:i});c=parseInt(d)}const s=await a(r.id,r.runId);return Eo({parent:e==null?void 0:e.workflow,workflow:r,children:s,siblingCount:c})}const xt=async(t,o,n=fetch,r=!1)=>{const e=o.query||yt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=E("workflows",{namespace:t}),{executions:s}=await qt(async i=>w(c,{token:i,request:n,params:{query:a}}));return _({executions:s})},Zo=async(t,o="",n=fetch)=>(r=100,e="")=>{j.set("");const a=s=>{var i;v(s),g(Zt)?j.set(S("workflows.workflows-error-querying")):j.set(((i=s==null?void 0:s.body)==null?void 0:i.message)||S("workflows.workflows-error-querying"))},c=E("workflows",{namespace:t});return w(c,{params:{pageSize:String(r),nextPageToken:e,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:s=[],nextPageToken:i=""})=>({items:_({executions:s}),nextPageToken:i?String(i):""}))},tn=async(t,o="",n=fetch)=>(r=100,e="")=>{const a=s=>{v(s)},c=E("workflows.archived",{namespace:t});return w(c,{params:{pageSize:String(r),nextPageToken:e,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:s=[],nextPageToken:i=""})=>({items:_({executions:s}),nextPageToken:i?String(i):""}))};export{zo as A,co as B,j as C,Zo as D,Fo as E,vt as F,uo as T,qo as a,Tt as b,Xo as c,No as d,Mo as e,Oo as f,Do as g,po as h,tn as i,Qo as j,$o as k,Gt as l,Vt as m,Jo as n,Vo as o,Ko as p,Ho as q,Co as r,fo as s,Bo as t,Go as u,Uo as v,Yo as w,V as x,vo as y,jo as z};
