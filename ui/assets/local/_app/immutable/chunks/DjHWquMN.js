import{y as N,q as D,u as R,z as V,C as W,av as Y,aS as G,aT as J,w as M,I as K,v as U,D as X,B as Z}from"./DSxqszTl.js";import{w as E}from"./Cb3VdkNs.js";import{g as Q}from"./MdRI3aAD.js";import{t as $}from"./D2OY9xdY.js";import"./BLjkLUx2.js";import{s as w}from"./byHaz_JD.js";import{r as m,a as f}from"./DXdT95Gl.js";import{v as T}from"./Dz_GI0CC.js";import{h as P}from"./Nu5OHywA.js";import{e as q}from"./73pMv5kv.js";import{p as ee,q as te}from"./CVmz9Luj.js";function ye(e,n,s,t,r){var c=e,i="",a;N(()=>{if(i===(i=n()??"")){D&&R();return}a!==void 0&&(Z(a),a=void 0),i!==""&&(a=V(()=>{if(D){W.data;for(var o=R(),u=o;o!==null&&(o.nodeType!==8||o.data!=="");)u=o,o=Y(o);if(o===null)throw G(),J;M(W,u),c=K(o);return}var l=i+"",d=U(l);M(X(d),d.lastChild),c.before(d)}))})}const we=async(e,n,s,t=fetch)=>(r=100,c="")=>{const i=m("schedules",{namespace:e});return f(i,{params:{maximumPageSize:String(r),nextPageToken:c,...n?{query:n}:{}},request:t,onError:s}).then(({schedules:a,nextPageToken:o})=>({items:a,nextPageToken:o?String(o):""}))};async function Se(e,n=fetch){const s=m("schedule",e);return f(s,{request:n})}async function ke({namespace:e,scheduleId:n,identity:s},t=fetch){const r=m("schedule",{namespace:e,scheduleId:n});return f(r,{request:t,options:{method:"DELETE"},params:s?{identity:s}:{}})}async function se({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const c=o=>{var u;return r=((u=o==null?void 0:o.body)==null?void 0:u.message)??`Error creating schedule: ${o.status}: ${o.statusText}`},i=m("schedule",{namespace:e,scheduleId:n}),{conflictToken:a}=await f(i,{options:{method:"POST",body:w({request_id:T(),...s,...t&&{identity:t}})},onError:c});return{conflictToken:a,error:r}}async function oe({namespace:e,scheduleId:n,body:s,identity:t}){let r="";const c=a=>{var o;return r=((o=a==null?void 0:a.body)==null?void 0:o.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:n});return await f(i,{options:{method:"POST",body:w({request_id:T(),...s,...t&&{identity:t}})},onError:c}),{error:r}}async function ve({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{pause:s}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:T(),...t&&{identity:t}})},onError:i=>console.error(i)})}async function be({namespace:e,scheduleId:n,reason:s,identity:t}){const r={patch:{unpause:s}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:T(),...t&&{identity:t}})}})}async function Te({namespace:e,scheduleId:n,overlapPolicy:s,identity:t}){const r={patch:{triggerImmediately:{overlapPolicy:s}}},c=m("schedule.patch",{namespace:e,scheduleId:n});return await f(c,{options:{method:"POST",body:w({...r,request_id:T(),...t&&{identity:t}})}})}async function _e({namespace:e,scheduleId:n,overlapPolicy:s,identity:t,startTime:r,endTime:c}){const i={patch:{backfillRequest:[{overlapPolicy:s,startTime:r,endTime:c}]}},a=m("schedule.patch",{namespace:e,scheduleId:n});return await f(a,{options:{method:"POST",body:w({...i,request_id:T(),...t&&{identity:t}})}})}const O=e=>e?parseInt(e):0,ne=(e,n,s,t)=>`${O(e)*60*60*24+O(n)*60*60+O(s)*60+O(t)}s`,re=({months:e=[],daysOfMonth:n=[],daysOfWeek:s=[]})=>{var a,o;const t=e.sort((u,l)=>parseInt(u)-parseInt(l)).join(","),r=n.sort((u,l)=>u-l).join(","),i=(((o=(a=s==null?void 0:s[0])==null?void 0:a.split(","))==null?void 0:o.length)>1?s[0].split(","):s).sort((u,l)=>parseInt(u)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:i}},z=e=>e.length===0?null:{indexedFields:{...P(e)}},x=(e,n,s)=>{const{hour:t,minute:r,second:c,phase:i,cronString:a}=n,{preset:o,months:u,days:l,daysOfMonth:d,daysOfWeek:S}=s;if(o==="string"){const h=`${a}#${a}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const h=ne(l,t,r,c);e.schedule.spec.interval=[{interval:h,phase:i||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:g,dayOfWeek:k}=re({months:u,daysOfMonth:d,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:o==="month"?h:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?k:"",hour:t,minute:r,second:c}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Ie=async({action:e,spec:n,presets:s})=>{const{identity:t,namespace:r,name:c,workflowId:i,workflowType:a,taskQueue:o,input:u,encoding:l,messageType:d,searchAttributes:S,workflowSearchAttributes:h}=e;let g;if(u)try{g=await q({input:u,encoding:l,messageType:d})}catch(_){y.set(`${$("data-encoder.encode-error")}: ${_==null?void 0:_.message}`);return}const k={schedule_id:c.trim(),searchAttributes:S.length===0?null:{indexedFields:{...P(S)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:o},input:g?{payloads:g}:null,searchAttributes:h.length===0?null:{indexedFields:{...P(h)}}}}}};x(k,n,s),b.set(!0);const{error:v}=await se({identity:t,scheduleId:c,namespace:r,body:k});v?(y.set(v),b.set(!1)):setTimeout(()=>{y.set(""),b.set(!1),Q(te({namespace:r}))},2e3)},Ae=async({action:e,spec:n,presets:s},t,r)=>{var j,C;const{identity:c,namespace:i,name:a,workflowId:o,workflowType:u,taskQueue:l,input:d,encoding:S,messageType:h,searchAttributes:g,workflowSearchAttributes:k}=e;let v;if(d)try{v=await q({input:d,encoding:S,messageType:h})}catch(p){y.set(`${$("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:_}=s,I={schedule_id:r,searchAttributes:z(g),schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:o,workflowType:{name:u},taskQueue:{name:l},...d!==void 0&&{input:v?{payloads:v}:null},searchAttributes:z(k)}}}},A=(C=(j=I.schedule.action.startWorkflow)==null?void 0:j.header)==null?void 0:C.fields;if(A&&Object.keys(A).length>0)try{const p=Object.entries(A);for(const[B,H]of p){const L=await q({input:w(H),encoding:"json/plain"});A[B]=L[0]}}catch(p){y.set(`${$("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}_==="existing"?I.schedule.spec=t.spec:(x(I,n,s),I.schedule.spec.structuredCalendar=[]),b.set(!0);const{error:F}=await oe({identity:c,namespace:i,scheduleId:r,body:I});F?(y.set(F),b.set(!1)):setTimeout(()=>{Q(ee({namespace:i,scheduleId:a})),y.set(""),b.set(!1)},2e3)},b=E(!1),y=E(""),Oe=E("0");export{Ie as a,Oe as b,we as c,_e as d,y as e,Se as f,ke as g,ye as h,b as l,ve as p,Ae as s,Te as t,be as u};
