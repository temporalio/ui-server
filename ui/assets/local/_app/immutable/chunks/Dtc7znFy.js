import{B as d}from"./CoG0geaG.js";import{g as y}from"./_5ilsK-u.js";import{w as O,g as T}from"./DIJxQKhU.js";import{t as F}from"./DAY2qct0.js";import{h as I}from"./BJzbPR4R.js";import{i as L}from"./DRcmmJhF.js";import{u as v,v as W,d as j}from"./DZSPmokB.js";import{i as P}from"./Brp806Zx.js";import{p as U}from"./DcbA-NfM.js";const S=O(null),_=(i,n=F,o=S,c=d)=>{if(!(i instanceof DOMException&&i.name==="AbortError"))throw typeof i=="string"?n.push({variant:"error",message:i}):i.report=!1,i instanceof Error&&n.push({variant:"error",message:i.message}),q(i)&&c&&window.location.assign(v(i==null?void 0:i.message)),x(i)&&c&&window.location.assign(v(i==null?void 0:i.message)),L(i)&&(n.push({variant:"error",message:`${i.statusCode} ${i.statusText}`}),o.set(i)),i},ln=(i,n=d)=>{var c;const o=`${i==null?void 0:i.status} ${(c=i==null?void 0:i.body)==null?void 0:c.message}`;if(q(i)&&n){window.location.assign(v(o));return}if(x(i)&&n){window.location.assign(v(o));return}},q=i=>N(i,401),x=i=>N(i,403),N=(i,n)=>I(i,"statusCode")?i.statusCode===n:I(i,"status")?i.status===n:!1,z=15e3,wn=async(i,n={})=>{const{params:o={},request:c=fetch,token:w,notifyOnError:u=!0,handleError:l=_,onError:f,isBrowser:b=d}=n;let{options:$}=n,h=new URLSearchParams;if(o!=null&&o.entries)h=o,w&&h.set("nextPageToken",w);else{const k=w?{next_page_token:w}:{};h=new URLSearchParams({...o,...k})}const E=W(i,h);try{$=J($,b),i.endsWith("api/v1/settings")||($=await M($,b));const s=[...h.values()].some(C=>C.length>z)?new Response(JSON.stringify({message:"Query string is too long"}),{status:414,statusText:"URI Too Long"}):await c(E,$),g=await s.json(),{status:A,statusText:R}=s;if(!s.ok)if(f&&P(f))f({status:A,statusText:R,body:g});else throw{statusCode:s.status,statusText:s.statusText,response:s,message:(g==null?void 0:g.message)??s.statusText};return g}catch(k){if(u)l(k);else throw k}},J=(i,n=d)=>{const o={credentials:"include",...i};return o.headers=H(i==null?void 0:i.headers,n),o},M=async(i,n=d)=>(globalThis!=null&&globalThis.AccessToken?i.headers=await t(i==null?void 0:i.headers,globalThis.AccessToken,n):y().accessToken&&(i.headers=await t(i==null?void 0:i.headers,async()=>y().accessToken,n),i.headers=B(i==null?void 0:i.headers,y().idToken,n)),i),t=async(i,n,o=d)=>{if(i||(i={}),!o)return i;try{const c=await n();c&&(i.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return i},B=(i={},n,o=d)=>(o&&n&&(i["Authorization-Extras"]=n),i),H=(i,n=d)=>{if(i||(i={}),i["Caller-Type"]="operator",!n)return i;const o="_csrf=",c="X-CSRF-TOKEN";try{let u=document.cookie.split(";").find(l=>l.includes(o));u&&!i[c]&&(u=u.trim().slice(o.length),i[c]=u)}catch(w){console.error(w)}return i};function Q(i=d){const n="",o=!n.startsWith("http");let c="";return o?c=i?window.location.origin+n:"":c=n,c.endsWith("/")&&(c=c.slice(0,-1)),c}const fn=(i,n)=>{if(!i||!n)return!1;const[o,c,w]=i.split(".").map(Number),[u,l,f]=n.split(".").map(Number);return o!==u?o>u:c!==l?c>l:w>f},X=(i,n)=>{if(!i||!n)return!1;const[o,c,w]=i.split(".").map(Number),[u,l,f]=n.split(".").map(Number);return o!==u?u>o:c!==l?c===void 0&&l||c===void 0&&l===void 0?!0:l>c:w===void 0&&f||w===void 0&&(f===void 0||isNaN(f))?!0:f>=w},D=(i,n)=>i?i.replace("%namespace%",n):"",G=i=>{var u,l;let n="";const o=(u=T(U).data)==null?void 0:u.webUrl,c=o&&i,w=((l=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:l.apiUrl)&&i;return c?n=o:w?(console.warn("Using fallback api url, web url not found"),n=D(globalThis.AppConfig.apiUrl,i)):n=Q(),n=`${n}${j("",{})}`,n.endsWith("/")&&(n=n.slice(0,-1)),n},K=i=>(i.startsWith("/")&&(i=i.slice(1)),`/api/v1/${i}`),Y=(i,n)=>`${G(n)}${i}`,Z=i=>{var o,c,w;const n=(w=(c=(o=T(U))==null?void 0:o.data)==null?void 0:c.settings)==null?void 0:w.version;return Object.keys(i??{}).reduce((u,l)=>(n&&X("2.23.0",n)?u[l]=encodeURIComponent(i[l]):u[l]=encodeURIComponent(encodeURIComponent(i[l])),u),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",runId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function V(i,n,o=!0){o&&n&&(n=Z(n));const c={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n==null?void 0:n.namespace}/search-attributes`,"events.raw":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/run/${n==null?void 0:n.runId}/history.json`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n==null?void 0:n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/signal/${n==null?void 0:n.signalName}`,"workflow.update":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/update/${n==null?void 0:n.updateName}`,"workflow.reset":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/reset`,"workflow.pause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/pause`,"workflow.unpause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/unpause`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n==null?void 0:n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n==null?void 0:n.namespace}/activities/fail-by-id`,"activity.pause":`/namespaces/${n==null?void 0:n.namespace}/activities/pause`,"activity.unpause":`/namespaces/${n==null?void 0:n.namespace}/activities/unpause`,"activity.reset":`/namespaces/${n==null?void 0:n.namespace}/activities/reset`,"activity.update-options":`/namespaces/${n==null?void 0:n.namespace}/activities/update-options`,"batch-operations.list":`/namespaces/${n==null?void 0:n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n==null?void 0:n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n==null?void 0:n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n==null?void 0:n.endpointId}/update`,"worker-deployments":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments/${n==null?void 0:n.deploymentName}`,"worker-deployment-version":`/namespaces/${n==null?void 0:n.namespace}/worker-deployment-versions/${n==null?void 0:n.version}`,"standalone-activity":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}`,"standalone-activities":`/namespaces/${n==null?void 0:n.namespace}/activities`,"standalone-activities.count":`/namespaces/${n==null?void 0:n.namespace}/activity-count`,"standalone-activity.cancel":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/cancel`,"standalone-activity.terminate":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/terminate`};return K(c[i])}function dn(i,n,o=!0){const c=V(i,n,o);return Y(c,n==null?void 0:n.namespace)}export{z as M,wn as a,G as b,q as c,x as d,ln as e,Q as g,_ as h,fn as i,X as m,V as p,dn as r};
