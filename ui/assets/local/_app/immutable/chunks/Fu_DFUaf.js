import{B as d}from"./CoG0geaG.js";import{s as S,g as I}from"./_5ilsK-u.js";import{a as L}from"./Dsr8fVFs.js";import{p as _}from"./DMvnBdKo.js";import{w as z,g as R}from"./DIJxQKhU.js";import{t as B}from"./DAY2qct0.js";import{h as U}from"./BJzbPR4R.js";import{i as D}from"./DRcmmJhF.js";import{D as b,E as J,d as M}from"./Cy8Qnuvf.js";import{i as G}from"./Brp806Zx.js";import{p as C}from"./DwGcruQ-.js";const T="user",H=(o=d)=>{if(!o)return{};const n=document.cookie.split(";");let i=0,c=n.find(l=>l.includes(T+i)),u="";for(;c;){const[l,s]=c.split("=");u+=s,i++,c=n.find(t=>t.includes(T+i))}if(u)try{const l=L(u),s=_(l);return{accessToken:s==null?void 0:s.AccessToken,idToken:s==null?void 0:s.IDToken,name:s==null?void 0:s.Name,picture:s==null?void 0:s.Picture,email:s==null?void 0:s.Email}}catch(l){console.error(l)}return{}},Q=(o=d)=>{if(!o)return;const n=document.cookie.split(";");let i=0,c=n.find(u=>u.includes(T+i));for(;c;){const[u]=c.split("=");document.cookie=`${u}=; max-age=-1; path=/`,i++,c=n.find(l=>l.includes(T+i))}};function F(o=d){const n="",i=!n.startsWith("http");let c="";return i?c=o?window.location.origin+n:"":c=n,c.endsWith("/")&&(c=c.slice(0,-1)),c}let v=null;const X=async()=>{if(v)return console.debug("[Auth] Reusing existing token refresh promise"),v;const o=performance.now();return console.info("[Auth] Initiating token refresh..."),v=(async()=>{try{const n=await fetch(`${F()}/auth/refresh`,{method:"GET",credentials:"include"});if(!n.ok){const u=performance.now()-o;return console.warn(`[Auth] Token refresh failed with status ${n.status}: ${n.statusText} (duration: ${u.toFixed(2)}ms)`),!1}const i=H(!0);if(i!=null&&i.accessToken){S(i),Q(!0);const u=performance.now()-o,l=i.expiresAt?new Date(i.expiresAt).toISOString():"unknown";return console.info(`[Auth] Token refresh successful (duration: ${u.toFixed(2)}ms, expires: ${l})`),!0}const c=performance.now()-o;return console.warn(`[Auth] Token refresh returned no access token (duration: ${c.toFixed(2)}ms)`),!1}catch(n){const i=performance.now()-o;return console.error(`[Auth] Token refresh network error (duration: ${i.toFixed(2)}ms):`,n),!1}finally{v=null}})(),v},K=z(null),Y=(o,n=B,i=K,c=d)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),O(o)&&c&&window.location.assign(b()),W(o)&&c&&window.location.assign(b()),D(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),i.set(o)),o},vn=(o,n=d)=>{if(O(o)&&n){window.location.assign(b());return}if(W(o)&&n){window.location.assign(b());return}},O=o=>j(o,401),W=o=>j(o,403),j=(o,n)=>U(o,"statusCode")?o.statusCode===n:U(o,"status")?o.status===n:!1,Z=15e3,en=async(o,n={})=>{const{params:i={},request:c=fetch,token:u,notifyOnError:l=!0,handleError:s=Y,onError:t,isBrowser:h=d}=n;let{options:w}=n,k=new URLSearchParams;if(i!=null&&i.entries)k=i,u&&k.set("nextPageToken",u);else{const e=Object.fromEntries(Object.entries({...i,...u?{next_page_token:u}:{}}).filter(([f,g])=>g!==void 0));k=new URLSearchParams(e)}const P=J(o,k);try{w=E(w,h),o.endsWith("api/v1/settings")||(w=await N(w,h));const $=[...k.values()].some(A=>A.length>Z),e=async()=>$?new Response(JSON.stringify({message:"Query string is too long"}),{status:414,statusText:"URI Too Long"}):await c(P,w);let f=await e(),{status:g,statusText:x}=f;h&&g===401&&await X()&&(w=E(n.options,h),o.endsWith("api/v1/settings")||(w=await N(w,h)),f=await e(),g=f.status,x=f.statusText);const y=await f.json();if(!f.ok)if(t&&G(t))t({status:g,statusText:x,body:y});else throw{statusCode:f.status,statusText:f.statusText,response:f,message:(y==null?void 0:y.message)??f.statusText};return y}catch($){if(l)s($);else throw $}},E=(o,n=d)=>{const i={credentials:"include",...o};return i.headers=p(i.headers,n),i},N=async(o,n=d)=>{const i=o.headers??{};if(globalThis!=null&&globalThis.AccessToken){const c=globalThis.AccessToken;o.headers=await q(i,c,n)}else I().accessToken&&(o.headers=await q(i,async()=>I().accessToken??"",n),o.headers=V(o.headers,I().idToken??"",n));return o},q=async(o,n,i=d)=>{if(!i)return o;try{const c=await n();c&&(o.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return o},V=(o,n,i=d)=>(i&&n&&(o["Authorization-Extras"]=n),o),p=(o,n=d)=>{const i=o??{};if(i["Caller-Type"]="operator",!n)return i;const c="_csrf=",u="X-CSRF-TOKEN";try{let s=document.cookie.split(";").find(t=>t.includes(c));s&&!i[u]&&(s=s.trim().slice(c.length),i[u]=s)}catch(l){console.error(l)}return i},bn=(o,n)=>{if(!o||!n)return!1;const[i,c,u]=o.split(".").map(Number),[l,s,t]=n.split(".").map(Number);return i!==l?i>l:c!==s?c>s:u>t},m=(o,n)=>{if(!o||!n)return!1;const[i,c,u]=o.split(".").map(Number),[l,s,t]=n.split(".").map(Number);return i!==l?l>i:c!==s?c===void 0&&s||c===void 0&&s===void 0?!0:s>c:u===void 0&&t||u===void 0&&(t===void 0||isNaN(t))?!0:t>=u},a=(o,n)=>o?o.replace("%namespace%",n):"",r=o=>{var l,s;let n="";const i=(l=R(C).data)==null?void 0:l.webUrl,c=i&&o,u=((s=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:s.apiUrl)&&o;return c?n=i:u?(console.warn("Using fallback api url, web url not found"),n=a(globalThis.AppConfig.apiUrl,o)):n=F(),n=`${n}${M("",{})}`,n.endsWith("/")&&(n=n.slice(0,-1)),n},nn=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),on=(o,n)=>`${r(n)}${o}`,cn=o=>{var i,c,u;const n=(u=(c=(i=R(C))==null?void 0:i.data)==null?void 0:c.settings)==null?void 0:u.version;return Object.keys(o??{}).reduce((l,s)=>(n&&m("2.23.0",n)?l[s]=encodeURIComponent(o[s]):l[s]=encodeURIComponent(encodeURIComponent(o[s])),l),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",runId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function sn(o,n,i=!0){i&&n&&(n=cn(n));const c={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n==null?void 0:n.namespace}/search-attributes`,"events.raw":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/run/${n==null?void 0:n.runId}/history.json`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n==null?void 0:n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/signal/${n==null?void 0:n.signalName}`,"workflow.update":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/update/${n==null?void 0:n.updateName}`,"workflow.reset":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/reset`,"workflow.pause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/pause`,"workflow.unpause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/unpause`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n==null?void 0:n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n==null?void 0:n.namespace}/activities/fail-by-id`,"activity.pause":`/namespaces/${n==null?void 0:n.namespace}/activities/pause`,"activity.unpause":`/namespaces/${n==null?void 0:n.namespace}/activities/unpause`,"activity.reset":`/namespaces/${n==null?void 0:n.namespace}/activities/reset`,"activity.update-options":`/namespaces/${n==null?void 0:n.namespace}/activities/update-options`,"batch-operations.list":`/namespaces/${n==null?void 0:n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n==null?void 0:n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n==null?void 0:n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n==null?void 0:n.endpointId}/update`,"worker-deployments":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments/${n==null?void 0:n.deploymentName}`,"worker-deployment-version":`/namespaces/${n==null?void 0:n.namespace}/worker-deployment-versions/${n==null?void 0:n.version}`,"standalone-activity":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}`,"standalone-activities":`/namespaces/${n==null?void 0:n.namespace}/activities`,"standalone-activities.count":`/namespaces/${n==null?void 0:n.namespace}/activity-count`,"standalone-activity.cancel":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/cancel`,"standalone-activity.terminate":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/terminate`};return nn(c[o])}function Tn(o,n,i=!0){const c=sn(o,n,i);return on(c,n==null?void 0:n.namespace)}export{Z as M,en as a,r as b,O as c,W as d,vn as e,Q as f,F as g,Y as h,bn as i,H as j,m,sn as p,Tn as r};
