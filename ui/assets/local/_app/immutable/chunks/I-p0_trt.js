import"./BBTnEn4k.js";import"./D0Jyh3oV.js";import"./CLY-w72C.js";import"./D3uawZcr.js";import{h as E}from"./BDfAQ6r3.js";import{f as A}from"./BDFbSVAj.js";import{m as I,i as W,n as y,o as h,p as O,j as B,q as N,h as U,r as j,a as S,s as v,t as V,u as q,v as D,w as K,x as L,y as M}from"./DPZf26_M.js";import{e as P,f as H,g as _}from"./DNNVWk-J.js";import{h as z}from"./D1mJS6mY.js";const G=e=>e.eventType==="WorkflowTaskFailed",C=e=>e.eventType==="WorkflowTaskTimedOut",J=e=>e.eventType==="WorkflowTaskCompleted",R=e=>I(e)&&F(e)==="ResetWorkflow",F=e=>{var i;if(C(e))return"WorkflowTaskTimedOut";const{workflowTaskFailedEventAttributes:{failure:t,cause:r}={}}=e;return((i=t==null?void 0:t.applicationFailureInfo)==null?void 0:i.type)==="workflowTaskHeartbeatError"?"WorkflowTaskHeartbeatError":P(r)},g=e=>{const t=e.findIndex(G),r=e.findIndex(C),i=t<0?r:t;if(i<0)return;const o=e.findIndex(J),a=e[i];if(F(a)!=="ResetWorkflow"&&(o<0||i<o))return a},pe=(e,t)=>{if(t==="descending")return g(e);{const r=[...e].reverse();return g(r)}},Q=(e,t)=>{var r,i,o,a,l,u,f,d,m,k,T,p,c;try{if(W(e)){const s=(r=e.attributes)==null?void 0:r.firstExecutionRunId,n=(i=e.attributes)==null?void 0:i.originalExecutionRunId;return s===n&&((l=(a=(o=e.attributes)==null?void 0:o.searchAttributes)==null?void 0:a.indexedFields)==null?void 0:l.TemporalScheduledById)?3:1}if(y(e)||h(e)||O(e)&&e.id!=="2"||B(e)||N(e)||U(e)||j(e)||S(e))return 1;if(v(e)){const s=Object.keys(e.attributes.searchAttributes.indexedFields);return(s==null?void 0:s.length)===1&&((d=(f=(u=e.attributes)==null?void 0:u.searchAttributes)==null?void 0:f.indexedFields)!=null&&d.TemporalChangeVersion)?0:1}if(V(e)){if(["core_patch","Version"].includes((m=e==null?void 0:e.attributes)==null?void 0:m.markerName))return 0;const n=(k=e.attributes)==null?void 0:k.workflowTaskCompletedEventId;if(n&&t)return t.has(String(n))?0:(t.add(String(n)),1);if(n)return 1}return R(e)?1:q(e)?2:D(e)?(((T=e.attributes)==null?void 0:T.attempt)||1)-1:K(e)?Math.min(((c=(p=e.attributes)==null?void 0:p.meteringMetadata)==null?void 0:c.nonfirstLocalActivityExecutionAttempts)||0,100):0}catch{return 0}},X=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],Y=e=>{if(typeof e=="number")return"Unspecified";if(e.includes("RequestCancel"))return"CancelRequested";for(const t of X)if(e.includes(t))return t;return"Unspecified"},Z=["closeTime","createTime","currentAttemptScheduledTime","earliestTime","eventTime","executionTime","expirationTime","expireTime","lastAccessTime","lastHeartbeatTime","lastStartedTime","lastUpdateTime","latestTime","releaseTime","scheduledTime","startedTime","startTime","workflowExecutionExpirationTime"],$=["backoffStartInterval","defaultWorkflowTaskTimeout","firstWorkflowTaskBackoff","heartbeatTimeout","initialInterval","maximumInterval","scheduleToCloseTimeout","scheduleToStartTimeout","startToCloseTimeout","startToFireTimeout","workflowExecutionRetentionPeriod","workflowExecutionRetentionTtl","workflowExecutionTimeout","workflowRunTimeout","workflowTaskTimeout"],ee=e=>{for(const t of Z)if(t===e)return!0;return!1},te=e=>{for(const t of $)if(t===e)return!0;return!1},re=e=>{if(e===null||e===void 0||typeof e!="object")return!1;const t=Object.keys(e),[r]=t;return!(t.length!==1||typeof e[r]!="string")},ie=e=>{for(const t of Object.values(e))return t};function oe(e,t=!1){for(const[r,i]of Object.entries(e))re(i)&&(e[r]=ie(i)),ee(r)&&!t&&(e[r]=A(i)),te(r)&&(e[r]=z(i)),r==="versioningBehavior"&&(e[r]=H(i,"VersioningBehavior"));return E(e,"workerVersion")&&E(e,"deploymentVersion")&&delete e.workerVersion,e}const se=(e,t=()=>!1,r)=>({...e,billableActions:t(e)?0:Q(e,r)}),ne=(e,t={})=>{var c,s,n,w,b,x;const r=String(e.eventId),i=_(e.eventType),o=A(String(e.eventTime)),a=Y(i),l=M(i),{key:u,attributes:f}=L(e),d=W(e)&&((n=(s=(c=e.workflowExecutionStartedEventAttributes)==null?void 0:c.completionCallbacks)==null?void 0:s[0])==null?void 0:n.links),m=S(e)&&((x=(b=(w=e.workflowExecutionOptionsUpdatedEventAttributes)==null?void 0:w.attachedCompletionCallbacks)==null?void 0:b[0])==null?void 0:x.links),k=d||m,T=(e==null?void 0:e.links)||k||[],p={...e,name:i,id:r,eventType:i,timestamp:o,classification:a,category:l,links:T,billableActions:0,attributes:oe({type:u,...f})};return se(p,t.shouldNotAddBillableAction,t.processedWorkflowTaskIds)},we=e=>{const t=e.findLast(R),r=o=>t?Number(o.id)<Number(t.eventId):!1,i=new Set;return e.map(o=>ne(o,{shouldNotAddBillableAction:r,processedWorkflowTaskIds:i}))},be=e=>e===null||typeof e!="object"||Array.isArray(e)?!1:!!E(e,"eventType"),Ee=e=>{const t={...e};return delete t.name,delete t.id,delete t.timestamp,delete t.classification,delete t.category,delete t.attributes,t};export{G as a,C as b,pe as c,Ee as f,F as g,be as i,oe as s,we as t};
