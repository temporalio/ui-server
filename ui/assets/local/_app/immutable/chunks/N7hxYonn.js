import{h as K}from"./BDfAQ6r3.js";import{n as p,j as g,z as _,f as v,A as W,B as C,C as z,d as N,D as h,E as F,F as L,G as H,H as J,I as G,J as Q,c as P,e as M,K as V,L as X,M as x,N as Y,v as Z,O as tt,P as it,Q as et,b as rt,R as st,S as nt,T as at,U as dt,w as ot,m as ut,V as U,W as j,o as k,X as T,p as w,t as S,g as f,u as m,h as b,Y as lt}from"./DPZf26_M.js";import{i as ct}from"./vNuyfdo4.js";import{i as Et,a as ft,g as pt}from"./CS8RtG6z.js";import{j as gt}from"./D1mJS6mY.js";const kt=(t,i)=>{let e;return p(t)&&(e=i.find(s=>s.activityId===t.attributes.activityId)),e},mt=(t,i)=>{let e;return g(t)&&(e=i.find(s=>s.scheduledEventId===t.id)),e},yt=(t,i)=>t.find(e=>{var s,r;if(ct(i))return e.eventIds.has(i.id);if(Et(i))return((s=e.pendingActivity)==null?void 0:s.id)===i.id;if(ft(i))return((r=e==null?void 0:e.pendingNexusOperation)==null?void 0:r.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),R=t=>F(t)||L(t)||H(t)||J(t)||G(t)||Q(t)||P(t)||M(t)||V(t)||X(t)||x(t)||Y(t),vt=t=>O(t)?t.isFailureOrTimedOut:R(t),B=t=>W(t)||C(t)||z(t)||N(t)||h(t),Wt=t=>O(t)?t.isCanceled:B(t),$=t=>_(t)||v(t),Ct=t=>O(t)?t.isTerminated:$(t),I=t=>Z(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):W(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):tt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):L(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):et(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):v(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):rt(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):N(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):P(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):M(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):st(t)?String(t.timerFiredEventAttributes.startedEventId):C(t)?String(t.timerCanceledEventAttributes.startedEventId):nt(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):at(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):dt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ot(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):G(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):U(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):j(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):x(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):h(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,q=t=>{var i,e,s,r,u,n,E,d,l,a,c,y;if(!t)return"";if(p(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(k(t))return`${(s=t.timerStartedEventAttributes)==null?void 0:s.timerId} (${gt(String((r=t.timerStartedEventAttributes)==null?void 0:r.startToFireTimeout))})`;if(T(t))return(u=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.signalName;if(w(t))return(n=t.workflowExecutionSignaledEventAttributes)==null?void 0:n.signalName;if(S(t))return f(t)?"Local Activity":(E=t.markerRecordedEventAttributes)==null?void 0:E.markerName;if(m(t))return(l=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:l.name;if(b(t))return(y=(c=(a=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:a.acceptedRequest)==null?void 0:c.input)==null?void 0:y.name;if(g(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},At=t=>{if(!t)return"";if(p(t))return"Activity";if(k(t))return"Timer";if(T(t))return"Signal";if(w(t))return"Signal received";if(f(t))return"Local Activity";if(S(t))return"Marker";if(m(t))return"Child Workflow";if(b(t))return"Workflow Update";if(g(t)||U(t))return"Nexus Operation"},ht=t=>{var i,e;return t?f(t)?((e=(i=pt(t))==null?void 0:i.value)==null?void 0:e.toString())??"Local Activity":q(t):""},A=({events:t})=>{let i=0,e;for(const s of t.values()){const r=Number(s.id);r>=i&&(i=r,e=s)}return e},o=t=>{const i=I(t),e=q(t),s=At(t),r=ht(t),{timestamp:u,category:n,classification:E}=t,d=new Map,l=new Set;return d.set(t.id,t),l.add(t.id),{id:i,name:e,label:s,displayName:r,events:d,eventIds:l,initialEvent:t,timestamp:u,category:f(t)?"local-activity":n,classification:E,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,userMetadata:t==null?void 0:t.userMetadata,get eventTime(){var a;return(a=this.lastEvent)==null?void 0:a.eventTime},get attributes(){var a;return(a=A(this))==null?void 0:a.attributes},get eventList(){return Array.from(this.events,([a,c])=>c)},get links(){return Array.from(this.events,([a,c])=>c.links).flat()},get lastEvent(){return A(this)},get finalClassification(){return A(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||k(this.initialEvent)&&this.eventList.length===1||m(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(R)},get isCanceled(){return!!this.eventList.find(B)},get isTerminated(){return!!this.eventList.find($)},get billableActions(){return this.eventList.reduce((a,c)=>c.billableActions+a,0)}}},xt=t=>{if(p(t)||m(t)||k(t)||T(t)||w(t))return o(t);if(S(t))return f(t),o(t);if(b(t)||g(t))return o(t)},Tt=t=>{if(lt(t))return o(t)},D=(t,i,e=void 0,s=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,e&&(t.pendingActivity=e),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,s&&(t.pendingNexusOperation=s);const r=j(i)||x(i)||h(i);t.pendingNexusOperation&&r&&delete t.pendingNexusOperation},Nt=(t,i="ascending",e=[],s=[])=>{const r={},u=n=>{const E=I(n),d=xt(n),l=kt(n,e),a=mt(n,s);d?(r[d.id]=d,l&&(d.pendingActivity=l),a&&(d.pendingNexusOperation=a)):D(r[E],n,l,a)};if(i==="ascending")for(const n of t)u(n);else for(let n=t.length-1;n>=0;n--)u(t[n]);return i==="descending"?Object.values(r).reverse():Object.values(r)},O=t=>t==null?!1:K(t,"events"),Ft=(t,i="ascending")=>{const e={},s=r=>{const u=I(r),n=Tt(r);n?e[n.id]=n:D(e[u],r)};if(i==="ascending")for(const r of t)s(r);else for(let r=t.length-1;r>=0;r--)s(t[r]);return i==="descending"?Object.values(e).reverse():Object.values(e)};export{Wt as a,Ct as b,yt as c,Ft as d,vt as e,Nt as g,O as i};
