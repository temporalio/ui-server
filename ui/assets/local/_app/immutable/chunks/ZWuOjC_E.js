import{B as t}from"./CoG0geaG.js";import{s as L,g as x}from"./ewzzm9Vv.js";import{a as _}from"./BLTt3wnv.js";import{p as j}from"./ikbOq2O5.js";import{w as z,g as C}from"./SxBBeV83.js";import{t as B}from"./mTWriMIu.js";import{h as E}from"./BJzbPR4R.js";import{i as D}from"./DRcmmJhF.js";import{E as I,F as J,b as M}from"./BufVb_yv.js";import{i as G}from"./Wy5XCPyV.js";import{p as F}from"./DpLr_ny1.js";import{m as H}from"./HVeMsM_a.js";const T="user",Q=(o=t)=>{if(!o)return{};const n=document.cookie.split(";");let i=0,c=n.find(l=>l.includes(T+i)),u="";for(;c;){const[l,s]=c.split("=");u+=s,i++,c=n.find(w=>w.includes(T+i))}if(u)try{const l=_(u),s=j(l);return{accessToken:s==null?void 0:s.AccessToken,idToken:s==null?void 0:s.IDToken,name:s==null?void 0:s.Name,picture:s==null?void 0:s.Picture,email:s==null?void 0:s.Email}}catch(l){console.error(l)}return{}},X=(o=t)=>{if(!o)return;const n=document.cookie.split(";");let i=0,c=n.find(u=>u.includes(T+i));for(;c;){const[u]=c.split("=");document.cookie=`${u}=; max-age=-1; path=/`,i++,c=n.find(l=>l.includes(T+i))}};function O(o=t){const n="",i=!n.startsWith("http");let c="";return i?c=o?window.location.origin+n:"":c=n,c.endsWith("/")&&(c=c.slice(0,-1)),c}let e=null;const K=async()=>{if(e)return console.debug("[Auth] Reusing existing token refresh promise"),e;const o=performance.now();return console.info("[Auth] Initiating token refresh..."),e=(async()=>{try{const n=await fetch(`${O()}/auth/refresh`,{method:"GET",credentials:"include"});if(!n.ok){const u=performance.now()-o;return console.warn(`[Auth] Token refresh failed with status ${n.status}: ${n.statusText} (duration: ${u.toFixed(2)}ms)`),!1}const i=Q(!0);if(i!=null&&i.accessToken){L(i),X(!0);const u=performance.now()-o,l=i.expiresAt?new Date(i.expiresAt).toISOString():"unknown";return console.info(`[Auth] Token refresh successful (duration: ${u.toFixed(2)}ms, expires: ${l})`),!0}const c=performance.now()-o;return console.warn(`[Auth] Token refresh returned no access token (duration: ${c.toFixed(2)}ms)`),!1}catch(n){const i=performance.now()-o;return console.error(`[Auth] Token refresh network error (duration: ${i.toFixed(2)}ms):`,n),!1}finally{e=null}})(),e},V=z(null),Y=(o,n=B,i=V,c=t)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),W(o)&&c&&window.location.assign(I()),P(o)&&c&&window.location.assign(I()),D(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),i.set(o)),o},vn=(o,n=t)=>{if(W(o)&&n){window.location.assign(I());return}if(P(o)&&n){window.location.assign(I());return}},W=o=>b(o,401),P=o=>b(o,403),In=o=>b(o,404),Tn=o=>b(o,501),b=(o,n)=>E(o,"statusCode")?o.statusCode===n:E(o,"status")?o.status===n:!1,Z=15e3,bn=async(o,n={})=>{const{params:i={},request:c=fetch,token:u,notifyOnError:l=!0,handleError:s=Y,onError:w,isBrowser:h=t}=n;let{options:f}=n,k=new URLSearchParams;if(i!=null&&i.entries)k=i,u&&k.set("nextPageToken",u);else{const v=Object.fromEntries(Object.entries({...i,...u?{next_page_token:u}:{}}).filter(([d,g])=>g!==void 0));k=new URLSearchParams(v)}const S=J(o,k);try{f=q(f,h),o.endsWith("api/v1/settings")||(f=await N(f,h));const $=[...k.values()].some(U=>U.length>Z),v=async()=>$?new Response(JSON.stringify({message:"Query string is too long"}),{status:414,statusText:"URI Too Long"}):await c(S,f);let d=await v(),{status:g,statusText:A}=d;h&&g===401&&await K()&&(f=q(n.options,h),o.endsWith("api/v1/settings")||(f=await N(f,h)),d=await v(),g=d.status,A=d.statusText);const y=await d.json();if(!d.ok)if(w&&G(w))w({status:g,statusText:A,body:y});else throw{statusCode:d.status,statusText:d.statusText,response:d,message:(y==null?void 0:y.message)??d.statusText};return y}catch($){if(l)s($);else throw $}},q=(o,n=t)=>{const i={credentials:"include",...o};return i.headers=m(i.headers,n),i},N=async(o,n=t)=>{const i=o.headers??{};if(globalThis!=null&&globalThis.AccessToken){const c=globalThis.AccessToken;o.headers=await R(i,c,n)}else x().accessToken&&(o.headers=await R(i,async()=>x().accessToken??"",n),o.headers=p(o.headers,x().idToken??"",n));return o},R=async(o,n,i=t)=>{if(!i)return o;try{const c=await n();c&&(o.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return o},p=(o,n,i=t)=>(i&&n&&(o["Authorization-Extras"]=n),o),m=(o,n=t)=>{const i=o??{};if(i["Caller-Type"]="operator",!n)return i;const c="_csrf=",u="X-CSRF-TOKEN";try{let s=document.cookie.split(";").find(w=>w.includes(c));s&&!i[u]&&(s=s.trim().slice(c.length),i[u]=s)}catch(l){console.error(l)}return i},a=(o,n)=>o?o.replace("%namespace%",n):"",r=o=>{var l,s;let n="";const i=(l=C(F).data)==null?void 0:l.webUrl,c=i&&o,u=((s=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:s.apiUrl)&&o;return c?n=i:u?(console.warn("Using fallback api url, web url not found"),n=a(globalThis.AppConfig.apiUrl,o)):n=O(),n=`${n}${M("",{})}`,n.endsWith("/")&&(n=n.slice(0,-1)),n},nn=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),on=(o,n)=>`${r(n)}${o}`,cn=o=>{var i,c,u;const n=(u=(c=(i=C(F))==null?void 0:i.data)==null?void 0:c.settings)==null?void 0:u.version;return Object.keys(o??{}).reduce((l,s)=>(n&&H("2.23.0",n)?l[s]=encodeURIComponent(o[s]):l[s]=encodeURIComponent(encodeURIComponent(o[s])),l),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",runId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function sn(o,n,i=!0){i&&n&&(n=cn(n));const c={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n==null?void 0:n.namespace}/search-attributes`,"events.raw":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/run/${n==null?void 0:n.runId}/history.json`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n==null?void 0:n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"schedules.count":`/namespaces/${n==null?void 0:n.namespace}/schedule-count`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/signal/${n==null?void 0:n.signalName}`,"workflow.update":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/update/${n==null?void 0:n.updateName}`,"workflow.reset":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/reset`,"workflow.pause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/pause`,"workflow.unpause":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/unpause`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.pause":`/namespaces/${n==null?void 0:n.namespace}/activities-deprecated/pause`,"activity.unpause":`/namespaces/${n==null?void 0:n.namespace}/activities-deprecated/unpause`,"activity.reset":`/namespaces/${n==null?void 0:n.namespace}/activities-deprecated/reset`,"activity.update-options":`/namespaces/${n==null?void 0:n.namespace}/activities-deprecated/update-options`,"batch-operations.list":`/namespaces/${n==null?void 0:n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n==null?void 0:n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n==null?void 0:n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n==null?void 0:n.endpointId}/update`,"worker-deployments":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n==null?void 0:n.namespace}/worker-deployments/${n==null?void 0:n.deploymentName}`,"worker-deployment-version":`/namespaces/${n==null?void 0:n.namespace}/worker-deployment-versions/${n==null?void 0:n.version}`,"standalone-activity":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}`,"standalone-activities":`/namespaces/${n==null?void 0:n.namespace}/activities`,"standalone-activities.count":`/namespaces/${n==null?void 0:n.namespace}/activity-count`,"standalone-activity.cancel":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/cancel`,"standalone-activity.terminate":`/namespaces/${n==null?void 0:n.namespace}/activities/${n==null?void 0:n.activityId}/terminate`};return nn(c[o])}function xn(o,n,i=!0){const c=sn(o,n,i);return on(c,n==null?void 0:n.namespace)}export{Z as M,bn as a,In as b,r as c,W as d,P as e,vn as f,O as g,Y as h,Tn as i,X as j,Q as k,sn as p,xn as r};
