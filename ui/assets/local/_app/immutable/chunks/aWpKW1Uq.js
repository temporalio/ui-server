import"./CWj6FrbW.js";import{a as ot}from"./r33Ll6et.js";import{p as nt,at as h,au as Q,aN as ut,g as t,f as K,e as E,b as ct,v as m,s as c,I as l,r as A,i as it,c as lt,j as ft}from"./BBjqMsu1.js";import{d as mt}from"./DHOm-mSm.js";import{i as pt}from"./DrCjka1e.js";import{e as wt}from"./B8KdL4-8.js";import{p as D,a as y,s as dt,e as W,b as ht}from"./D42yUzBQ.js";import{p as k}from"./DA-r50VK.js";import{S as yt}from"./BwPfwM7f.js";import{r as kt,w as g,b as N,d as gt}from"./DYuHNcQo.js";import{w as O}from"./B1y51937.js";import{c as vt}from"./EXOzyKv5.js";import{S as _t}from"./S6Q2Q0ub.js";import{w as B}from"./vfzcNlzo.js";import{b as Ct}from"./3yGRYBvY.js";import{t as xt,c as bt}from"./DxVDQ-9y.js";import{g as St}from"./BNcA6Hpw.js";import{u as Et}from"./BZozR9H8.js";import{W as Wt}from"./UTi6nPVY.js";const G=(v=[])=>v.map(s=>{const n=Ct(s==null?void 0:s.groupValues[0]),r=parseInt(s.count);return{status:n,count:r}}).sort((s,n)=>B.indexOf(s.status)-B.indexOf(n.status));var Pt=K("<button><!></button>"),It=K('<div class="flex min-h-[24px] flex-wrap items-center gap-2 pt-1.5"></div>');function zt(v,s){nt(s,!0);const n=()=>y(O,"$workflowFilters",p),r=()=>y(g,"$workflowCount",p),P=()=>y(gt,"$disableWorkflowCountsRefresh",p),Y=()=>y(kt,"$refresh",p),[p,j]=dt();let H=D(s,"staticQuery",3,""),I=D(s,"refreshTime",15);const L=m(()=>k.url.searchParams.get("query")),_=m(()=>k.params.namespace),C=m(()=>H()||t(L)),U=m(()=>k.url.searchParams.get("per-page"));let T=h(Q([])),w=h(Q([])),F,f=h(1),x=h(!1);const V=60,z=20,J=e=>{if(!n().some(o=>o.attribute==="ExecutionStatus"&&o.value===e)){const o={attribute:"ExecutionStatus",type:_t.KEYWORD,value:e,operator:"",conditional:"=",parenthesis:""};ht(O,[...n(),o]);const u=xt(bt(n()));Et({url:k.url,parameter:"query",value:u,clearParameters:[vt]})}},q=()=>{clearTimeout(F),c(w,[],!0),W(g,l(r).newCount=0,l(r)),c(f,1)},M=async()=>{c(x,!0);try{const{count:e,groups:a}=await N({namespace:t(_),query:t(C)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).count=parseInt(e),l(r)),c(T,G(a),!0)}finally{I(new Date),c(x,!1)}},X=async()=>{try{const{count:e,groups:a}=await N({namespace:t(_),query:t(C)}).catch(o=>({count:"0",groups:[]}));W(g,l(r).newCount=parseInt(e)-r().count,l(r)),c(w,G(a),!0)}finally{I(new Date),c(f,t(f)+1)}},R=()=>{const e=St(V,t(f));F=setTimeout(async()=>{await X(),!P()&&t(f)<=z&&R()},e)},Z=async()=>{q(),await M(),P()||R()};ut(()=>{t(_),t(C),t(U),Y(),Z()}),ot(()=>{q()});var b=It();wt(b,21,()=>t(T),({count:e,status:a})=>a,(e,a)=>{let o=()=>t(a).count,u=()=>t(a).status;var $=it(),tt=lt($);{var et=i=>{var d=Pt();d.__click=()=>J(u());var rt=ft(d);{let at=m(()=>t(w).find(S=>S.status===u())?t(w).find(S=>S.status===u()).count-o():0);Wt(rt,{get status(){return u()},get count(){return o()},get newCount(){return t(at)},get"test-id"(){return`workflow-status-${u()??""}`}})}A(d),E(i,d)},st=i=>{yt(i,{class:"h-6 w-24 rounded-sm"})};pt(tt,i=>{t(x)?i(st,!1):i(et)})}E(e,$)}),A(b),E(v,b),ct(),j()}mt(["click"]);export{zt as W};
