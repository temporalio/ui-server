import{w as l}from"./entry.ucn6Zbe1.js";import{z as y}from"./scheduler.yC7E9Oae.js";import{A as n}from"./workflow-actions.-K4W_iAA.js";import{g as I}from"./auth-user.T90XlY3n.js";import{p as w}from"./persist-store.lL9vARtW.js";import{t as T}from"./versions.8pKD9v1W.js";import{s as f}from"./parse-with-big-int.e3oI4SEy.js";import{r as c,a as m}from"./route-for-api.kTH3_BWN.js";import{c as p,d as i}from"./screaming-enums.NBZzZ07O.js";import{i as h}from"./version-check.HLZIw2tw.js";const k=e=>e.map(o=>o.runId).reduce((o,r,s,u)=>(o+=`RunId="${r}"`,s!==u.length-1&&(o+=" OR "),o),""),j=(e,t)=>{const o=I().email;switch(e){case n.Cancel:return{cancellationOperation:{identity:o}};case n.Terminate:return{terminationOperation:{identity:o}};case n.Reset:return{resetOperation:{identity:o,options:t==="first"?{firstWorkflowTask:{}}:{lastWorkflowTask:{}}}}}},R=({id:e,runId:t})=>({workflowId:e,runId:t}),b=(e,t)=>{const o={jobId:t.jobId,namespace:t.namespace,reason:t.reason,...j(e,t.resetType)};if(t.workflows)return h(y(T),"1.19")?{...o,executions:t.workflows.map(R)}:{...o,visibilityQuery:k(t.workflows)};if(t.query)return{...o,visibilityQuery:t.query}};async function Q(e){const t=c("batch-operations",{namespace:e.namespace,batchJobId:e.jobId}),o=b(n.Cancel,e);await m(t,{options:{method:"POST",body:f(o)},notifyOnError:!1}),a.set({jobId:o.jobId,namespace:o.namespace})}async function V(e){const t=c("batch-operations",{namespace:e.namespace,batchJobId:e.jobId}),o=b(n.Terminate,e);await m(t,{options:{method:"POST",body:f(o)},notifyOnError:!1}),a.set({jobId:o.jobId,namespace:o.namespace})}const _=async e=>{const t=c("batch-operations",{namespace:e.namespace,batchJobId:e.jobId}),o=b(n.Reset,e);await m(t,{options:{method:"POST",body:f(o)},notifyOnError:!1}),a.set({jobId:o.jobId,namespace:o.namespace})};async function d({namespace:e,jobId:t}){return new Promise((o,r)=>{C({namespace:e,jobId:t}).then(({state:s,completeOperationCount:u})=>{s==="Failed"?r():s!=="Running"?o(u):setTimeout(()=>{try{o(d({namespace:e,jobId:t}))}catch{r()}},5e3)})})}async function C({jobId:e,namespace:t},o=fetch){const r=c("batch-operations",{namespace:t,batchJobId:e}),s=await m(r,{request:o});return g(s)}const g=e=>({...e,operationType:p(e.operationType),state:i(e.state),startTime:e.startTime,closeTime:e.closeTime,totalOperationCount:parseInt((e==null?void 0:e.totalOperationCount)??"0",10),completeOperationCount:parseInt((e==null?void 0:e.completeOperationCount)??"0",10),failureOperationCount:parseInt((e==null?void 0:e.failureOperationCount)??"0",10)});async function z(e,t=fetch){const o=c("batch-operations.list",{namespace:e,batchJobId:""}),r=await m(o,{request:t});return{nextPageToken:r.nextPageToken,operations:r.operationInfo?r.operationInfo.map(P):[]}}const P=e=>({startTime:e.startTime,closeTime:e.closeTime,jobId:e.jobId,state:i(e.state)}),a=l();a.subscribe(async e=>{e&&await d(e).then(()=>a.set(void 0))});const N=w("auto-refresh-batch-operation",!1);export{N as a,Q as b,_ as c,C as d,V as e,a as i,z as l};
