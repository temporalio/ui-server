import{S as B,b as C,a as I,m as $,w as S,c as g,C as L,p as E,q as k,x as A,k as d,d as w,D as x,u as f,f as _,L as N,E as U,Q as j,j as q,g as G,F as H,K as T,n as D}from"./index.9b814669.js";import{g as K}from"./navigation.552f3f03.js";import{B as P}from"./button.69ab34c0.js";import{t as y}from"./translate.c28e5b4f.js";import{g as Q}from"./index.119f8187.js";import{t as R}from"./index.a709e18d.js";import{i as W,a as z}from"./import-events.bd461414.js";import{l as J}from"./namespaces.e79b71b3.js";import{t as F}from"./toaster.658980c2.js";import{p as M}from"./parse-with-big-int.0036a80a.js";import{f as O}from"./route-for.900cb350.js";function V(m){let o=y("common.import")+"",n;return{c(){n=S(o)},l(i){n=A(i,o)},m(i,r){_(i,n,r)},p:D,d(i){i&&d(n)}}}function X(m){let o,n=y("events.import-event-history-file-upload")+"",i,r,s,v,l,a,p,c;return l=new P({props:{leadingIcon:"file-upload",disabled:!m[0],$$slots:{default:[V]},$$scope:{ctx:m}}}),l.$on("click",m[2]),{c(){o=$("label"),i=S(n),r=g(),s=$("input"),v=g(),L(l.$$.fragment),this.h()},l(t){o=E(t,"LABEL",{class:!0,for:!0});var e=k(o);i=A(e,n),e.forEach(d),r=w(t),s=E(t,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),v=w(t),x(l.$$.fragment,t),this.h()},h(){f(o,"class","sr-only"),f(o,"for","import-event-history-file-upload"),f(s,"id","import-event-history-file-upload"),f(s,"class","import-input block rounded-md border border-gray-200 p-2"),f(s,"type","file"),f(s,"accept",".json")},m(t,e){_(t,o,e),N(o,i),_(t,r,e),_(t,s,e),_(t,v,e),U(l,t,e),a=!0,p||(c=j(s,"change",m[1]),p=!0)},p(t,[e]){const u={};e&1&&(u.disabled=!t[0]),e&32&&(u.$$scope={dirty:e,ctx:t}),l.$set(u)},i(t){a||(q(l.$$.fragment,t),a=!0)},o(t){G(l.$$.fragment,t),a=!1},d(t){t&&d(o),t&&d(r),t&&d(s),t&&d(v),H(l,t),p=!1,c()}}}function Y(m,o,n){let i;T(m,J,a=>n(4,i=a));let r,s=!1;return[s,async a=>{var p;const c=a.target,t=(p=c==null?void 0:c.files)===null||p===void 0?void 0:p[0],e=new FileReader;t&&(e.readAsText(t),e.onload=()=>{var u,h;try{const b=(h=(u=e==null?void 0:e.result)===null||u===void 0?void 0:u.toString())!==null&&h!==void 0?h:"";r=M(b),n(0,s=!0)}catch{F.push({variant:"error",message:y("events.event-history-load-error")}),n(0,s=!1)}})},async()=>{try{const a=await R(Array.isArray(r)?r:r==null?void 0:r.events),p=Q(a);W.set(a),z.set(p),n(0,s=!1);const c=O(i,"feed");K(c)}catch(a){console.error(a),F.push({variant:"error",message:y("events.event-history-import-error")})}}]}class mt extends B{constructor(o){super(),C(this,o,Y,X,I,{})}}export{mt as E};
