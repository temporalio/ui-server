import{t as g}from"./index.tXdAGgNl.js";import{f as w}from"./events.hZborN12.js";import{r as E}from"./workflow-run.xPihaZPA.js";import{a as x}from"./has.rY0Oe_rJ.js";import{p as I}from"./paginated.EoaedqMD.js";import{r as F,a as H}from"./route-for-api.37IetlMm.js";var A=T;function T(r,f,o){var e=null,t=null,n=o&&o.leading,a=o&&o.trailing;n==null&&(n=!0),a==null&&(a=!n),n==!0&&(a=!1);var i=function(){e&&(clearTimeout(e),e=null)},l=function(){var s=t;i(),s&&s()},u=function(){var s=n&&!e,c=this,h=arguments;if(t=function(){return r.apply(c,h)},e||(e=setTimeout(function(){if(e=null,a)return t()},f)),s)return s=!1,t()};return u.cancel=i,u.flush=l,u}const N=r=>!x(r)||r==="descending"?"events.descending":r==="ascending"?"events.ascending":"events.descending",j=async({namespace:r,workflowId:f,runId:o,sort:e,onStart:t,onUpdate:n,onComplete:a})=>{const i=N(e),l=F(i,{namespace:r,workflowId:f});return(await I(async s=>H(l,{token:s,request:fetch,params:{"execution.runId":o}}),{onStart:t,onUpdate:n,onComplete:a})).history.events},D=A(()=>{E.set(Date.now())},5e3),k=async({namespace:r,workflowId:f,runId:o,sort:e="ascending",signal:t,historySize:n})=>{const a=()=>{t&&w.set([])},i=(v,d)=>{var m,y;if(!t)return;w.set([...g((m=v.history)==null?void 0:m.events)]);const p=(y=d==null?void 0:d.history)==null?void 0:y.events;n&&(p==null?void 0:p.every(q=>parseInt(q.eventId)>parseInt(n)))&&D()},l=()=>{t&&E.set(Date.now())},u=N(e),s=F(u,{namespace:r,workflowId:f}),c=await I(async v=>H(s,{token:v,request:fetch,params:{"execution.runId":o,waitNewEvent:t?"true":"false"},options:{signal:t}}),{onStart:a,onUpdate:i,onComplete:l});return c!=null&&c.history?await g(c.history.events):[]};export{j as a,k as f};
