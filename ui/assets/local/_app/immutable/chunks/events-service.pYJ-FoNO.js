import{t as p}from"./index.4udMioNx.js";import{f as I}from"./events.NVJonSpA.js";import{r as x}from"./workflow-run.h5FVbog4.js";import{j as N}from"./has.UXcfBb7X.js";import{p as q}from"./paginated.arDHhyYL.js";import{r as m,a as y}from"./route-for-api.ZqJf7x1f.js";var R=A;function A(e,o,s){var n=null,t=null,r=s&&s.leading,a=s&&s.trailing;r==null&&(r=!0),a==null&&(a=!r),r==!0&&(a=!1);var c=function(){n&&(clearTimeout(n),n=null)},l=function(){var i=t;c(),i&&i()},u=function(){var i=r&&!n,f=this,w=arguments;if(t=function(){return e.apply(f,w)},n||(n=setTimeout(function(){if(n=null,a)return t()},o)),i)return i=!1,t()};return u.cancel=c,u.flush=l,u}const F=e=>!N(e)||e==="descending"?"events.descending":e==="ascending"?"events.ascending":"events.descending",$=async({namespace:e,workflowId:o,runId:s,sort:n,onStart:t,onUpdate:r,onComplete:a})=>{const c=F(n),l=m(c,{namespace:e,workflowId:o});return(await q(async i=>y(l,{token:i,request:fetch,params:{"execution.runId":s}}),{onStart:t,onUpdate:r,onComplete:a})).history.events},P=R(()=>{x.set(Date.now())},5e3),k=async({namespace:e,workflowId:o,runId:s,sort:n="ascending",signal:t,historySize:r})=>{const a=()=>{t&&I.set([])},c=(v,d)=>{var g,E;if(!t)return;I.set([...p((g=v.history)==null?void 0:g.events)]);const h=(E=d==null?void 0:d.history)==null?void 0:E.events;r&&(h==null?void 0:h.every(H=>parseInt(H.eventId)>parseInt(r)))&&P()},l=()=>{t&&x.set(Date.now())},u=F(n),i=m(u,{namespace:e,workflowId:o}),f=await q(async v=>y(i,{token:v,request:fetch,params:{"execution.runId":s,waitNewEvent:t?"true":"false"},options:{signal:t}}),{onStart:a,onUpdate:c,onComplete:l});return f!=null&&f.history?await p(f.history.events):[]},S=async({namespace:e,workflowId:o,runId:s,sort:n,maximumPageSize:t="20"})=>{const r=m(`events.${n}`,{namespace:e,workflowId:o});try{return(await y(r,{request:fetch,params:{maximumPageSize:t,"execution.runId":s}})).history.events}catch{return[]}},z=async e=>{const o=await S({...e,sort:"ascending",maximumPageSize:"1"});return(await p(o))[0]};export{z as a,$ as b,k as f,P as t};
