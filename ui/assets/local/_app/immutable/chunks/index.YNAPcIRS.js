import{h as K}from"./has.HNIa2swf.js";import{m as p,n as g,o as C,p as W,q as _,r as z,s as v,t as H,b as N,d as F,u as J,v as Q,w as h,x as V,y as G,z as L,A as X,c as P,B as x,C as Y,e as M,D as Z,E as tt,F as it,G as et,a as rt,H as nt,I as st,J as at,K as dt,L as ot,M as ut,N as U,O as R,P as k,Q as T,R as w,S,f,T as m,g as b,U as lt}from"./get-event-categorization.BIiaO7R2.js";import{i as ct}from"./index.DXL2YDw5.js";import{i as Et,d as ft,g as pt}from"./get-single-attribute-for-event.Cnvff_IR.js";import{h as gt}from"./format-time.D8nHWdIk.js";const kt=(t,i)=>{let e;return p(t)&&(e=i.find(n=>n.activityId===t.attributes.activityId)),e},mt=(t,i)=>{let e;return g(t)&&(e=i.find(n=>n.scheduledEventId===t.id)),e},Ot=(t,i)=>t.find(e=>{var n,r;if(ct(i))return e.eventIds.has(i.id);if(Et(i))return((n=e.pendingActivity)==null?void 0:n.id)===i.id;if(ft(i))return((r=e==null?void 0:e.pendingNexusOperation)==null?void 0:r.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),j=t=>C(t)||W(t)||_(t)||z(t)||v(t)||H(t)||N(t)||F(t)||J(t)||Q(t)||h(t)||V(t),Ct=t=>I(t)?t.isFailureOrTimedOut:j(t),q=t=>G(t)||L(t)||X(t)||P(t)||x(t),Wt=t=>I(t)?t.isCanceled:q(t),B=t=>Y(t)||M(t),vt=t=>I(t)?t.isTerminated:B(t),y=t=>Z(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):G(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):tt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):W(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):C(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):et(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):M(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):rt(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):P(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):N(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):F(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):nt(t)?String(t.timerFiredEventAttributes.startedEventId):L(t)?String(t.timerCanceledEventAttributes.startedEventId):st(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):at(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):dt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ot(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):v(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):U(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):R(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):h(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):x(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,$=t=>{var i,e,n,r,u,s,c,d,l,a,E,O;if(!t)return"";if(p(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(k(t))return`${(n=t.timerStartedEventAttributes)==null?void 0:n.timerId} (${gt((r=t.timerStartedEventAttributes)==null?void 0:r.startToFireTimeout)})`;if(T(t))return(u=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.signalName;if(w(t))return(s=t.workflowExecutionSignaledEventAttributes)==null?void 0:s.signalName;if(S(t))return f(t)?"Local Activity":(c=t.markerRecordedEventAttributes)==null?void 0:c.markerName;if(m(t))return(l=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:l.name;if(b(t))return(O=(E=(a=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:a.acceptedRequest)==null?void 0:E.input)==null?void 0:O.name;if(g(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},At=t=>{if(!t)return"";if(p(t))return"Activity";if(k(t))return"Timer";if(T(t))return"Signal";if(w(t))return"Signal received";if(f(t))return"Local Activity";if(S(t))return"Marker";if(m(t))return"Child Workflow";if(b(t))return"Workflow Update";if(g(t)||U(t))return"Nexus Operation"},ht=t=>{var i,e;return t?f(t)?((e=(i=pt(t))==null?void 0:i.value)==null?void 0:e.toString())??"Local Activity":$(t):""},A=({events:t})=>{let i=0,e;for(const n of t.values()){const r=Number(n.id);r>=i&&(i=r,e=n)}return e},o=t=>{const i=y(t),e=$(t),n=At(t),r=ht(t),{timestamp:u,category:s,classification:c}=t,d=new Map,l=new Set;return d.set(t.id,t),l.add(t.id),{id:i,name:e,label:n,displayName:r,events:d,eventIds:l,initialEvent:t,timestamp:u,category:f(t)?"local-activity":s,classification:c,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,userMetadata:t==null?void 0:t.userMetadata,get eventTime(){var a;return(a=this.lastEvent)==null?void 0:a.eventTime},get attributes(){var a;return(a=A(this))==null?void 0:a.attributes},get eventList(){return Array.from(this.events,([a,E])=>E)},get links(){return Array.from(this.events,([a,E])=>E.links).flat()},get lastEvent(){return A(this)},get finalClassification(){return A(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||k(this.initialEvent)&&this.eventList.length===1||m(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(j)},get isCanceled(){return!!this.eventList.find(q)},get isTerminated(){return!!this.eventList.find(B)}}},xt=t=>{if(p(t)||m(t)||k(t)||T(t)||w(t))return o(t);if(S(t))return f(t),o(t);if(b(t)||g(t))return o(t)},Tt=t=>{if(lt(t))return o(t)},D=(t,i,e=void 0,n=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,e&&(t.pendingActivity=e),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,n&&(t.pendingNexusOperation=n);const r=R(i)||h(i)||x(i);t.pendingNexusOperation&&r&&delete t.pendingNexusOperation},Nt=(t,i="ascending",e=[],n=[])=>{const r={},u=s=>{const c=y(s),d=xt(s),l=kt(s,e),a=mt(s,n);d?(r[d.id]=d,l&&(d.pendingActivity=l),a&&(d.pendingNexusOperation=a)):D(r[c],s,l,a)};if(i==="ascending")for(const s of t)u(s);else for(let s=t.length-1;s>=0;s--)u(t[s]);return i==="descending"?Object.values(r).reverse():Object.values(r)},I=t=>t==null?!1:K(t,"events"),Ft=(t,i="ascending")=>{const e={},n=r=>{const u=y(r),s=Tt(r);s?e[s.id]=s:D(e[u],r)};if(i==="ascending")for(const r of t)n(r);else for(let r=t.length-1;r>=0;r--)n(t[r]);return i==="descending"?Object.values(e).reverse():Object.values(e)};export{Ot as a,Ft as b,Wt as c,vt as d,Ct as e,Nt as g,I as i};
