import{h as y,i as W}from"./has.Hk4nWl3x.js";import{j as p,k as x,l as F,m as N,n as J,o as X,p as v,q as Y,c as L,e as R,r as Z,s as tt,t as G,u as D,v as it,d as j,w as et,f as K,x as rt,y as nt,z as st,A as ot,b as at,B as dt,C as ut,D as ct,E as lt,F as ft,G as Et,H as pt,I as P,J as q,K as B,i as k,L as w,M as I,N as S,O as b,P as A,Q as m,R as kt}from"./is-event-type.gEdvLIdC.js";import{b as mt}from"./format-time.PmxHXK_V.js";import{c as gt}from"./format-camel-case.z6e2GZpK.js";import{e as yt,i as wt}from"./decode-payload.HvcIwIiD.js";const At=(t,i)=>{let e;return p(t)&&(e=i.find(r=>r.activityId===t.attributes.activityId)),e},Mt=(t,i)=>p(t)&&i?i.activityId===t.attributes.activityId:!1,ht=(t,i)=>{let e;return x(t)&&(e=i.find(r=>!1)),e},Q=t=>F(t)||N(t)||J(t)||X(t)||v(t)||Y(t)||L(t)||R(t)||Z(t)||tt(t),_t=t=>h(t)?t.isFailureOrTimedOut:Q(t),U=t=>G(t)||D(t)||it(t)||j(t),$t=t=>h(t)?t.isCanceled:U(t),M=t=>et(t)||K(t),zt=t=>h(t)?t.isTerminated:M(t),O=t=>rt(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):G(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):nt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):N(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):st(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):ot(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):K(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):at(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):j(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):L(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):R(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):dt(t)?String(t.timerFiredEventAttributes.startedEventId):D(t)?String(t.timerCanceledEventAttributes.startedEventId):ut(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):ct(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):lt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ft(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):Et(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):v(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):pt(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):P(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):q(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):B(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,Tt={key:"",value:""},xt=new Set(["activityId","attempt","binaryChecksum","identity","parentInitiatedEventId","requestId","scheduledEventId","startedEventId","lastHeartbeatTime","scheduledTime","expirationTime"]),Ht=t=>xt.has(t),_=new Set(["suggestContinueAsNew","historySizeBytes"]),$=(t,i)=>!(i===null||i===void 0||i===""||i==="0s"||t==="type"||(!i||i==="0")&&_.has(t)),It=["attempt","maximumAttempts","heartbeatDetails","lastHeartbeatTime","lastFailure","lastStartedTime","scheduledTime","expirationTime","lastWorkerIdentity"],Vt=t=>It.includes(t),Jt=(t,i)=>!(i===null||i===void 0||i===""||i==="0s"||t==="type"||t==="workflowId"||t==="initiatedEventId"||t==="startedEventId"||t==="scheduledEventId"||t==="activityId"||t==="namespace"||t==="namespaceId"||t==="workflowTaskCompletedEventId"||t==="taskQueueKind"||(!i||i==="0")&&_.has(t)),Xt=t=>!(t===null||t===void 0||t===""||Array.isArray(t)&&!t.length),Yt=t=>typeof t=="string"?t:[t==null?void 0:t.payloads,t==null?void 0:t.indexedFields,t==null?void 0:t.points,t].find(i=>i!==void 0),St=t=>{if(W(t)){if(y(t,"stackTrace")&&t.stackTrace)return t.stackTrace;for(const i in t)if(W(t[i]))return St(t[i])}},bt=["baseRunId","continuedExecutionRunId","firstExecutionRunId","newExecutionRunId","newRunId","originalExecutionRunId"],Zt=t=>{for(const i of bt)if(t===i)return!0;return!1},Ot=["taskQueueName"],ti=t=>{for(const i of Ot)if(t===i)return!0;return!1},Ct=["workflowExecutionWorkflowId","workflowExecutionRunId"],ii=(t,i)=>{const e=!!(i!=null&&i.workflowExecutionWorkflowId&&(i!=null&&i.workflowExecutionRunId));for(const r of Ct)if(t===r&&e)return!0;return!1},g=(t,i)=>{if(typeof i=="object"){if(wt(i))return{key:t,value:i};const[e]=Object.keys(i);return e?e==="payloads"?{key:t,value:i}:{key:t+gt(e),value:i[e]}:{key:t,value:{}}}else return{key:t,value:i.toString()}},Wt=["failure","input","activityType","parentInitiatedEventId","workflowExecution","workflowType","taskQueue"],Ft=({attributes:t})=>{for(const[i,e]of Object.entries(t))if($(i,e))return g(i,e)},Nt=t=>{if(y(t,"ActivityType"))return t.ActivityType;if(y(t,"activity_type"))return t.activity_type},vt=t=>{var i,e,r;return!!((r=(e=(i=t.markerRecordedEventAttributes)==null?void 0:i.details)==null?void 0:e.type)!=null&&r.payloads)},C=t=>{var e,r,n,u,s,E;const i=Ft(t);if(k(t)){const o=(((n=(r=(e=t.markerRecordedEventAttributes)==null?void 0:e.details)==null?void 0:r.data)==null?void 0:n.payloads)||((E=(s=(u=t.markerRecordedEventAttributes)==null?void 0:u.details)==null?void 0:s.type)==null?void 0:E.payloads)||[]).map(c=>yt(c)),a=o==null?void 0:o[0];if(vt(t)&&a)return g("ActivityType",a);const l=Nt(a);if(l)return g("ActivityType",l)}for(const[d,o]of Object.entries(t.attributes))for(const a of Wt)if(d===a&&$(d,o))return g(d,o);return i},Lt=({lastEvent:t})=>C(t),ei=t=>t?h(t)?Lt(t):C(t):Tt,z=t=>{var i,e,r,n,u,s,E,d,o,a,l,c;if(!t)return"";if(p(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(w(t))return`${(r=t.timerStartedEventAttributes)==null?void 0:r.timerId} (${mt((n=t.timerStartedEventAttributes)==null?void 0:n.startToFireTimeout)})`;if(I(t))return(u=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.signalName;if(S(t))return(s=t.workflowExecutionSignaledEventAttributes)==null?void 0:s.signalName;if(b(t))return k(t)?"Local Activity":(E=t.markerRecordedEventAttributes)==null?void 0:E.markerName;if(A(t))return(o=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:o.name;if(m(t))return(c=(l=(a=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:a.acceptedRequest)==null?void 0:l.input)==null?void 0:c.name;if(x(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},Rt=t=>{if(!t||p(t))return"";if(w(t))return"Timer";if(I(t))return"Signal";if(S(t))return"Signal received";if(b(t))return"Marker";if(A(t))return"Child Workflow";if(m(t))return""},Gt=t=>{var i,e;return t?k(t)?((e=(i=C(t))==null?void 0:i.value)==null?void 0:e.toString())??"Local Activity":z(t):""},T=({events:t})=>{let i=0,e;for(const r of t.values()){const n=Number(r.id);n>=i&&(i=n,e=r)}return e},Dt=(t,i)=>i!=null&&i.length&&m(t)?i.find(e=>{var r;return e.id===((r=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:r.acceptedRequestSequencingEventId.toString())}):t,f=(t,i)=>{const e=O(t),r=z(t),n=Rt(t),u=Gt(t),{timestamp:s,category:E,classification:d}=t,o=Dt(t,i),a=new Map,l=new Set;return o&&m(t)?(a.set(o.id,o),a.set(t.id,t),l.add(o.id),l.add(t.id)):(a.set(t.id,t),l.add(t.id)),{id:e,name:r,label:n,displayName:u,events:a,eventIds:l,initialEvent:o,timestamp:s,category:k(t)?"local-activity":E,classification:d,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,get eventTime(){var c;return(c=this.lastEvent)==null?void 0:c.eventTime},get attributes(){var c;return(c=T(this))==null?void 0:c.attributes},get eventList(){return Array.from(this.events,([c,V])=>V)},get lastEvent(){return T(this)},get finalClassification(){return T(this).classification},get isPending(){return this.pendingActivity||this.pendingNexusOperation||w(this.initialEvent)&&this.eventList.length===1||A(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(Q)},get isCanceled(){return!!this.eventList.find(U)},get isTerminated(){return!!this.eventList.find(M)}}},jt=(t,i)=>{if(p(t)||A(t)||w(t)||I(t)||S(t))return f(t);if(b(t))return k(t),f(t);if(m(t)||x(t))return f(t,i)},Kt=(t,i)=>{if(kt(t))return f(t,i)},H=(t,i,e=void 0,r=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,e&&(t.pendingActivity=e),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,r&&(t.pendingNexusOperation=r);const n=P(i)||q(i)||B(i);t.pendingNexusOperation&&n&&delete t.pendingNexusOperation},ri=(t,i="ascending",e=[],r=[])=>{const n={},u=s=>{const E=O(s),d=jt(s,t),o=At(s,e),a=ht(s,r);d?(n[d.id]=d,o&&(d.pendingActivity=o),a&&(d.pendingNexusOperation=a)):H(n[E],s,o,a)};if(i==="ascending")for(const s of t)u(s);else for(let s=t.length-1;s>=0;s--)u(t[s]);return i==="descending"?Object.values(n).reverse():Object.values(n)},h=t=>t==null?!1:y(t,"events"),ni=(t,i="ascending")=>{const e={},r=n=>{const u=O(n),s=Kt(n,t);s?e[s.id]=s:H(e[u],n)};if(i==="ascending")for(const n of t)r(n);else for(let n=t.length-1;n>=0;n--)r(t[n]);return i==="descending"?Object.values(e).reverse():Object.values(e)};export{Xt as a,Jt as b,Vt as c,Yt as d,St as e,Zt as f,ri as g,ii as h,ti as i,Ht as j,_t as k,$t as l,zt as m,h as n,ei as o,It as p,Mt as q,ni as r,$ as s,C as t};
