import{t as h}from"./translate.BBe5dcco.js";import{r as m,a as f}from"./route-for-api.BaJYw3UU.js";const k=e=>(e!=null&&e.majorVersionSets?[...e.majorVersionSets]:[]).reverse(),y=e=>{if(!(!e||!e.length))return e[e.length-1]},b=e=>e?e.slice(0,e.length-1).reverse():[],C=e=>{var s;const t=k(e);if(!t.length)return;const n=(s=t[0])==null?void 0:s.buildIds;if(n!=null&&n.length)return y(t[0].buildIds)},T=e=>{var t,n;if((t=e==null?void 0:e.workerVersionCapabilities)!=null&&t.useVersioning)return((n=e.workerVersionCapabilities)==null?void 0:n.buildId)||void 0},A=e=>[...new Set(e==null?void 0:e.map(T).filter(Boolean))],F=e=>e==null?void 0:e.some(t=>{var n;return(n=t==null?void 0:t.workerVersionCapabilities)==null?void 0:n.useVersioning});async function w(e,t=fetch){var i;const n=m("task-queue",e),s=await f(n,{request:t,params:{taskQueueType:"1"}}),r=await f(n,{request:t,params:{taskQueueType:"2"}});s!=null&&s.pollers||(s.pollers=[]),r!=null&&r.pollers||(r.pollers=[]),r.pollers.forEach(u=>{u.taskQueueTypes=["ACTIVITY"]}),s.pollers.forEach(u=>{u.taskQueueTypes=["WORKFLOW"]});const c=u=>(d,g)=>{const l=d[g.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return d[g.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<g.lastAccessTime?g.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([u])},d};r.pollers.filter(u=>s.pollers.some(d=>{if(u.identity===d.identity)return u.taskQueueTypes=[...d.taskQueueTypes,...u.taskQueueTypes],u})),(i=r.pollers)==null||i.reduce(c("ACTIVITY"),s.pollers.reduce(c("WORKFLOW"),{}));const a=r.pollers.length?r.pollers:s.pollers,o=r.pollers.length?r.taskQueueStatus:s.taskQueueStatus;return{pollers:a,taskQueueStatus:o}}async function E(e,t=fetch){const n=await p(e,t),s=await Q(e,t),r=k(s);return{rules:n,compatibility:s,versionSets:r}}async function p(e,t=fetch){const n=m("task-queue.rules",e);return f(n,{request:t,handleError:s=>{}})}async function Q(e,t=fetch){const n=m("task-queue.compatibility",e);return f(n,{request:t,handleError:s=>{}})}async function O(e,t=fetch){const{namespace:n,buildIds:s,queue:r}=e,c=m("worker-task-reachability",{namespace:n}),a=new URLSearchParams;if(s.length)for(const o of s)a.append("buildIds",o);else a.append("buildIds",""),a.append("taskQueues",r);return await f(c,{request:t,params:a,handleError:o=>({buildIdReachability:[]})})}function V(e){return!e||!e.length?h("workers.ready-to-be-retired"):e.length===1&&e.includes("CLOSED")?h("common.maybe"):h("common.no")}function L(e,t,n){var a,o;const s=(a=e==null?void 0:e.buildIdReachability)==null?void 0:a.find(i=>i.buildId===n);if(!s)return"";const r=(o=s==null?void 0:s.taskQueueReachability)==null?void 0:o.find(i=>(i==null?void 0:i.taskQueue)===t);if(!r)return"";const c=r==null?void 0:r.reachability;return V(c)}export{k as a,C as b,T as c,L as d,y as e,b as f,w as g,E as h,A as i,O as j,F as p};
