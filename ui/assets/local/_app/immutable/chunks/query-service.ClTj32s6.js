import{t as c}from"./translate.BBe5dcco.js";import{e as l}from"./decode-payload.nrbjdAPQ.js";import{h as d}from"./has.BnvKvYqj.js";import{s as u}from"./parse-with-big-int.DJQKqIvA.js";import{r as y,a as m}from"./route-for-api.DYyZpYNC.js";const p=t=>{const e=t.indexOf("["),r=t.indexOf("]");return t.slice(e+1,r).split(" ").filter(a=>a!=="__stack_trace").map(a=>a.endsWith(",")?{name:a.slice(0,a.length-1)}:{name:a})},_=async(t,e,r)=>(e=await e,{namespace:t,workflowId:e.id,queryType:r});async function h({workflow:t,namespace:e,queryType:r,queryArgs:a},o){t=await t;const n=await _(e,t,r),s=y("query",n);return await m(s,{options:{method:"POST",body:u({execution:{workflowId:t.id,runId:t.runId},query:{queryType:r,queryArgs:a}}),signal:o},request:fetch,notifyOnError:!1})}async function x(t,e,r,a){var o;try{const n=await f({...t,queryType:"__temporal_workflow_metadata"},e,r,a);return n.currentDetails||(n.currentDetails=c("workflows.no-current-details")),n}catch(n){return(o=n.message)!=null&&o.includes("__temporal_workflow_metadata")?{definition:{queryDefinitions:p(n.message)},currentDetails:c("workflows.no-current-details")}:{error:n,currentDetails:c("workflows.no-current-details")}}}async function f(t,e,r,a){return h(t,a).then(async o=>{const{queryResult:n}=o??{queryResult:{payloads:[]}};let s=n.payloads;try{if(s[0]){const i=await l({attributes:n,namespace:t.namespace,settings:e,accessToken:r});d(i,"payloads")&&Array.isArray(i.payloads)&&(s=i.payloads[0])}return s}catch{return typeof s!="string"?u(s):s}})}async function D(t,e,r){return f({...t,queryType:"__stack_trace"},e,r)}export{x as a,f as b,D as g};
