import{f as l,e as $,t as W}from"./route-for.9d100612.js";import{g}from"./auth-user.3a7bc4db.js";import{n as O,W as P}from"./index.a36c9cb0.js";import{w as N}from"./index.deae5bd4.js";import{t as _}from"./toaster.16c48a98.js";import{i as z}from"./is-network-error.3dd5226d.js";import{h as e}from"./has.8da86d13.js";import{i as S}from"./persist-store.863ae031.js";import{p as L}from"./stores.075807e9.js";import{b as H}from"./paths.28500d8e.js";const K=N(null);function X(c=l){const n="",o=!n.startsWith("http");let s="";return o?s=c?window.location.origin+n:"":s=n,s.endsWith("/")&&(s=s.slice(0,-1)),s}const B=(c,n=_,o=K,s=l)=>{if(typeof c=="string")return n.push({variant:"error",message:c});if(c instanceof Error)return n.push({variant:"error",message:c.message});if(y(c)&&s)return window.location.assign($(c==null?void 0:c.message));if(b(c)&&s)return window.location.assign($(c==null?void 0:c.message));if(z(c))throw n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),o.set(c),c.report=!1,c},wn=(c,n=l)=>{var s;const o=`${c==null?void 0:c.status} ${(s=c==null?void 0:c.body)==null?void 0:s.message}`;if(y(c)&&n){window.location.assign($(o));return}if(b(c)&&n){window.location.assign($(o));return}},y=c=>T(c,401),b=c=>T(c,403),T=(c,n)=>e(c,"statusCode")?c.statusCode===n:e(c,"status")?c.status===n:!1,fn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",D=async(c,n={},o=10)=>{const{params:s={},request:f=fetch,token:i,shouldRetry:t=!1,notifyOnError:U=!0,handleError:E=B,onRetry:A=O,onError:k,retryInterval:x=5e3,isBrowser:I=l}=n;let{options:d}=n;const C=i?{next_page_token:i}:{},q=new URLSearchParams({...s,...C}),R=W(c,q);try{d=G(d,I),d=await J(d,I);const u=await f(R,d),w=await u.json(),{status:h,statusText:F}=u;if(!u.ok)if(k&&S(k))k({status:h,statusText:F,body:w});else throw{statusCode:u.status,statusText:u.statusText,response:u,message:(w==null?void 0:w.message)??u.statusText};return w}catch(u){if(U){if(E(u),t&&o>0)return new Promise(w=>{const h=o-1;A(h),setTimeout(()=>{w(D(c,n,h))},x)})}else throw u}},G=(c,n=l)=>{const o={credentials:"include",...c};return o.headers=Q(c==null?void 0:c.headers,n),o},J=async(c,n=l)=>(g().accessToken?(c.headers=await v(c==null?void 0:c.headers,async()=>g().accessToken,n),c.headers=M(c==null?void 0:c.headers,g().idToken,n)):globalThis!=null&&globalThis.AccessToken&&(c.headers=await v(c==null?void 0:c.headers,globalThis.AccessToken,n)),c),v=async(c,n,o=l)=>{if(c||(c={}),!o)return c;try{const s=await n();s&&(c.Authorization=`Bearer ${s}`)}catch(s){console.error(s)}return c},M=(c={},n,o=l)=>(o&&n&&(c["Authorization-Extras"]=n),c),Q=(c,n=l)=>{if(c||(c={}),!n)return c;const o="_csrf=",s="X-CSRF-TOKEN";try{let i=document.cookie.split(";").find(t=>t.includes(o));i&&!c[s]&&(i=i.trim().slice(o.length),c[s]=i)}catch(f){console.error(f)}return c},V=(c,n)=>c?c.replace("%namespace%",n):"",Y=c=>{var i,t;let n="";const o=(i=P(L).data)==null?void 0:i.webUrl,s=o&&c,f=((t=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:t.apiUrl)&&c;return s?n=o:f?(console.warn("Using fallback api url, web url not found"),n=V(globalThis.AppConfig.apiUrl,c)):n=X(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${H}`,n},Z=(c,n)=>(c.startsWith("/")&&(c=c.slice(1)),`${Y(n)}/api/v1/${c}`),j=c=>Object.keys(c??{}).reduce((n,o)=>(n[o]=encodeURIComponent(encodeURIComponent(c[o])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:"",activityId:""});function tn(c,n,o=!0){o&&(n=j(n));const s={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":"/search-attributes",settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,user:"/me","workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/signal`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"activity.complete":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/complete`,"activity.fail":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/fail`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`};return Z(s[c],n==null?void 0:n.namespace)}export{D as a,wn as b,b as c,fn as d,X as g,B as h,y as i,K as n,tn as r};
