import{W as v,n as d}from"./index.a36c9cb0.js";import{s as C}from"./settings.34723850.js";import{s as F}from"./simplify-attributes.ba9e7501.js";import{r as l,a as f,b as O,i as z,c as U}from"./route-for-api.03799870.js";import{t as $}from"./list-workflow-query.ad087915.js";import{s as y}from"./parse-with-big-int.0036a80a.js";import{f as Q}from"./route-for.091bcb43.js";import{v as R}from"./toaster.16c48a98.js";const q=(o=C)=>!v(o).disableWriteActions,_=(o=[])=>o.map(t=>{const n=F(t,!0),r=t.activityId;return{...n,id:r}}),g=o=>{var I,x,T,W,b;const t=o.workflowExecutionInfo.type.name,n=o.workflowExecutionInfo.execution.workflowId,r=o.workflowExecutionInfo.execution.runId,e=String(o.workflowExecutionInfo.startTime),a=String(o.workflowExecutionInfo.closeTime),i=o.workflowExecutionInfo.status,c=o.workflowExecutionInfo.status==="Running",u=o.workflowExecutionInfo.historyLength,w=`/workflows/${n}/${r}`,h=(x=(I=o==null?void 0:o.executionConfig)==null?void 0:I.taskQueue)==null?void 0:x.name,E=(T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.parentNamespaceId,s=(W=o==null?void 0:o.workflowExecutionInfo)==null?void 0:W.parentExecution,k=o.workflowExecutionInfo.stateTransitionCount,m=(b=o.executionConfig)==null?void 0:b.defaultWorkflowTaskTimeout,P=_(o.pendingActivities),S=(o==null?void 0:o.pendingChildren)??[];return{name:t,id:n,runId:r,startTime:e,endTime:a,status:i,historyEvents:u,url:w,taskQueue:h,pendingActivities:P,pendingChildren:S,parentNamespaceId:E,parent:s,stateTransitionCount:k,isRunning:c,defaultWorkflowTaskTimeout:m,get canBeTerminated(){return c&&q()}}},A=o=>(o.executions||[]).map(t=>g({workflowExecutionInfo:t})),B=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),p=(o,t=Q)=>t?B(o):o,V=async(o,t,n=fetch)=>{let r=0,e=0;try{const a=l("workflows.count",{namespace:o});if(t){const i=f(a,{params:{query:t},onError:d,handleError:d,request:n}),c=f(a,{params:{query:""},onError:d,handleError:d,request:n}),[u,w]=await Promise.all([i,c]);e=u==null?void 0:u.count,r=w==null?void 0:w.count}else{const i=await f(a,{params:{},onError:d,handleError:d,request:n});r=i==null?void 0:i.count}}catch{}return{count:e,totalCount:r}},D=async(o,t,n=fetch,r=!1)=>{const e=t.query||$(t,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const i=r?"workflows.archived":"workflows";let c="";const u=s=>{var k,m;O(s),(k=s==null?void 0:s.body)!=null&&k.message||s!=null&&s.status?c=((m=s==null?void 0:s.body)==null?void 0:m.message)??`Error fetching workflows: ${s.status}: ${s.statusText}`:c="Error fetching workflows: Server failed to respond"},w=l(i,{namespace:o}),{executions:h,nextPageToken:E}=await f(w,{params:{query:a},onError:u,handleError:u,request:n})??{executions:[],nextPageToken:""};return{workflows:A({executions:h}),nextPageToken:String(E),error:c}},X=async(o,t=fetch)=>{var u;const{namespace:n,workflowId:r}=o,a=l("workflows",{namespace:n}),{executions:i}=await f(a,{params:{query:`WorkflowId="${r}"`,pageSize:"1"},request:t})??{executions:[]},c=(u=A({executions:i}))==null?void 0:u[0];return{runId:c==null?void 0:c.runId}},Y=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=c=>{(z(c)||U(c))&&(e=!1)},i=l(r,{namespace:o});return await f(i,{params:{pageSize:"1"},onError:a,handleError:a,request:t}),{authorized:e}},Z=async(o,t,n=fetch)=>D(o,t,n,!0);async function oo(o,t=fetch){const n=l("workflow",o);return f(n,{request:t}).then(g)}async function to({workflow:o,namespace:t,reason:n}){const r=l("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await f(r,{options:{method:"POST",body:y({reason:n})},shouldRetry:!1,notifyOnError:!1})}async function no({namespace:o,workflowId:t,runId:n},r=fetch){const e=l("workflow.cancel",{namespace:o,workflowId:t,runId:n});return f(e,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function ro({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:e}){const a=l("workflow.signal",{namespace:o,workflowId:t,runId:n});return f(a,{notifyOnError:!1,options:{method:"POST",body:y({signalName:r,input:{payloads:e?[{metadata:{encoding:p("json/plain")},data:p(e)}]:null}})}})}async function eo({namespace:o,workflowId:t,runId:n,eventId:r,reason:e}){const a=l("workflow.reset",{namespace:o,workflowId:t,runId:n}),i={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,requestId:R(),reason:e};return f(a,{notifyOnError:!1,options:{method:"POST",body:y(i)}})}async function ao(o,t=fetch){const n=e=>{console.error(e)},r=l("workflow",o);return f(r,{request:t,onError:n,handleError:n}).then(g)}export{D as a,V as b,no as c,Y as d,Z as e,oo as f,ao as g,X as h,eo as r,ro as s,to as t,q as w};
