import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as de,e as r,r as t,b as ue,c as d,t as V,d as i,l as J,s as L,ag as xe,a as Re,f as x,g as e,n as Pe,m as M,aK as Ke}from"../chunks/Dv5jDC8Z.js";import{a,t as w,c as X,b as _e}from"../chunks/BM_uyzAk.js";import{i as ce}from"../chunks/CM2QeVoh.js";import{s as ye,a as ie,b as at}from"../chunks/CEr_ApTH.js";import{p as Fe}from"../chunks/Czn3SK-0.js";import{P as st}from"../chunks/PLLlBlGt.js";import{s as m}from"../chunks/CnnFVxmh.js";import{a as Be}from"../chunks/Cr1-wnh-.js";import{i as oe}from"../chunks/FbCjvpNA.js";import{P as Ne,W as ot}from"../chunks/CVubQK_8.js";import{T as lt,a as nt,b as He}from"../chunks/B2zAALQj.js";import{t as T}from"../chunks/CZMG2GAD.js";import{a as it,b as dt,c as ut,d as ct,e as vt,f as ft,p as _t,h as mt,i as pt,j as gt,g as ht}from"../chunks/DMEHyBx9.js";import{p as wt}from"../chunks/DA_UWTYL.js";import{s as Te}from"../chunks/CevXMagP.js";import{p as Z}from"../chunks/BbkaS_Cl.js";import{e as le,i as ne}from"../chunks/CocFUsaO.js";import{c as Ye,s as Se,a as $t,d as xt}from"../chunks/wdddUT-U.js";import{B as bt}from"../chunks/BXfWvgor.js";import{I as Le}from"../chunks/CrYHGHR9.js";import{t as kt}from"../chunks/Ds6tgvmq.js";import{E as Ie}from"../chunks/lbyfKwPg.js";import{T as be,b as me,a as ke}from"../chunks/BFBdxoz9.js";import{f as Ce,t as ze,r as yt}from"../chunks/9czO_RoD.js";import"../chunks/Cf9asbMp.js";import"../chunks/S8vTd6-A.js";import"../chunks/BtnNTlBX.js";import"../chunks/CZuCR6Gf.js";import{S as Pt}from"../chunks/BQyy25vA.js";const Me=wt("taskQueueView","workers",!0);var Tt=w("<span><!> <!> <!></span>"),It=w('<span class="flex items-center gap-1 rounded-sm border border-subtle px-1 text-sm text-primary"><!> </span>'),Rt=w('<p class="flex select-all gap-2 font-mono"><!></p>');function Ae(z,g){de(g,!1);let U=Z(g,"defaultVersion",8,!1),j=Z(g,"active",8,!1),A=Z(g,"buildId",8);ce();var p=Rt(),I=r(p);{var P=b=>{var $=Tt(),k=r($);Le(k,{name:"merge"});var q=d(k),n=d(q);Te(n,g,"overall-default-worker",{},null);var C=d(n,2);Te(C,g,"default-worker",{},null),t($),V(F=>{Se($,1,F),m(q,`${A()??""} `)},[()=>Ye(kt("flex items-center gap-1 rounded-sm border border-subtle px-1 text-sm text-primary",j()&&"border-green-200 bg-green-200 text-black"))],i),a(b,$)},B=(b,$)=>{{var k=q=>{var n=It(),C=r(n);Le(C,{name:"merge"});var F=d(C,1,!0);t(n),V(()=>m(F,A())),a(q,n)};oe(b,q=>{A()&&q(k)},$)}};oe(I,b=>{U()&&A()?b(P):b(B,!1)})}t(p),a(z,p),ue()}var Qt=w('<td class="text-left" data-testid="version-default"><!></td> <td class="text-left" data-testid="version-compatible-builds"><div class="flex flex-wrap gap-2 font-mono"></div></td>',1),Vt=w('<tr class="w-full"><td colspan="2"><!></td></tr>'),qt=w('<th class="w-3/12"> </th> <th class="w-9/12"> </th>',1),At=w('<td class="text-left" data-testid="worker-identity"><p class="select-all"><!></p></td> <td class="text-left" data-testid="worker-last-access-time"><p><span> </span></p></td>',1),Bt=w('<td class="text-left" data-testid="worker-identity"><p class="select-all"> </p></td> <!> <td class="text-left" data-testid="worker-last-access-time"><p class="select-all"> </p></td> <td data-testid="workflow-poller"><!></td> <td data-testid="activity-poller"><!></td>',1),St=w('<tr class="w-full"><td><!></td></tr>'),Ct=w('<caption class="sr-only" slot="caption"> </caption>'),Ft=w('<th class="w-3/12"> </th> <th class="w-2/12"> </th>',1),Wt=w('<th> </th> <!> <th class="w-2/12"> </th> <th class="w-2/12"><p class="text-center"> </p></th> <th class="w-2/12 text-center"><p class="text-center"> </p></th>',1),Dt=w('<h2 data-testid="version-sets"> </h2> <!> <h2 class="flex items-center gap-2" data-testid="workers"> <!></h2> <!>',1);function Ot(z,g){de(g,!1);const[U,j]=ye(),A=()=>ie(ze,"$timeFormat",U),p=()=>ie(yt,"$relativeTime",U),I=M(),P=M();let B=Z(g,"taskQueue",8),b=Z(g,"workers",8),$=Z(g,"reachability",8,void 0),k=Z(g,"compatibility",8,void 0);J(()=>xe(k()),()=>{L(I,it(k()))}),J(()=>xe(k()),()=>{L(P,dt(k()))}),Re(),ce();var q=Dt(),n=x(q),C=r(n,!0);t(n);var F=d(n,2);be(F,{class:"mb-6 w-full min-w-[600px] table-fixed",children:(y,ee)=>{var l=X(),u=x(l);le(u,1,()=>e(I),ne,(s,o,c)=>{me(s,{"data-testid":"version-row",children:(v,f)=>{var _=Qt(),h=x(_),R=r(h);const W=i(()=>ct(e(o).buildIds));Ae(R,{defaultVersion:!0,active:c===0,get buildId(){return e(W)},$$slots:{"overall-default-worker":(E,G)=>{var Q=X(),H=x(Q);{var S=Y=>{var te=_e();V(re=>m(te,re),[()=>T("workers.overall")],i),a(Y,te)};oe(H,Y=>{c===0&&Y(S)})}a(E,Q)},"default-worker":(E,G)=>{var Q=_e();V(H=>m(Q,H),[()=>T("workers.default")],i),a(E,Q)}}}),t(h);var D=d(h,2),O=r(D);le(O,5,()=>ut(e(o).buildIds),ne,(E,G)=>{Ae(E,{active:!1,get buildId(){return e(G)},$$slots:{"default-worker":(Q,H)=>{var S=_e();V(Y=>m(S,Y),[()=>T("workers.default")],i),a(Q,S)}}})}),t(O),t(D),a(v,_)},$$slots:{default:!0}})},s=>{var o=Vt(),c=r(o),v=r(c);const f=i(()=>T("workers.no-version-sets-found"));Ie(v,{get title(){return e(f)}}),t(c),t(o),a(s,o)}),a(y,l)},$$slots:{default:!0,headers:(y,ee)=>{ke(y,{slot:"headers",children:(l,u)=>{var s=qt(),o=x(s),c=r(o,!0);t(o);var v=d(o,2),f=r(v,!0);t(v),V((_,h)=>{m(c,_),m(f,h)},[()=>T("workers.default"),()=>T("workers.compatible-build-ids")],i),a(l,s)},$$slots:{default:!0}})}}});var K=d(F,2),N=r(K),ae=d(N);bt(ae,{type:"count",children:(y,ee)=>{Pe();var l=_e();V(()=>{var u,s;return m(l,((s=(u=b())==null?void 0:u.pollers)==null?void 0:s.length)||0)}),a(y,l)},$$slots:{default:!0}}),t(K);var se=d(K,2);be(se,{class:"mb-6 w-full min-w-[600px] table-fixed",children:(y,ee)=>{var l=X(),u=x(l);le(u,1,()=>{var s;return(s=b())==null?void 0:s.pollers},s=>s.identity,(s,o)=>{const c=i(()=>vt(e(o))),v=i(()=>ft($(),B(),e(c)));me(s,{"data-testid":"worker-row",children:(f,_)=>{var h=Bt(),R=x(h),W=r(R),D=r(W,!0);t(W),t(R);var O=d(R,2);{var E=ge=>{var he=At(),fe=x(he),We=r(fe),Ge=r(We);const Je=i(()=>e(c)===e(P)),Xe=i(()=>e(c)===e(P));Ae(Ge,{get defaultVersion(){return e(Je)},get active(){return e(Xe)},get buildId(){return e(c)},$$slots:{"overall-default-worker":(we,et)=>{var $e=X(),Ve=x($e);{var tt=qe=>{var je=_e();V(rt=>m(je,rt),[()=>T("workers.overall")],i),a(qe,je)};oe(Ve,qe=>{e(c)===e(P)&&qe(tt)})}a(we,$e)},"default-worker":(we,et)=>{var $e=_e();V(Ve=>m($e,Ve),[()=>T("workers.default")],i),a(we,$e)}}}),t(We),t(fe);var De=d(fe,2),Oe=r(De),Qe=r(Oe);let Ee;var Ze=r(Qe,!0);t(Qe),t(Oe),t(De),V(we=>{Ee=Se(Qe,1,"svelte-kdqm2r",null,Ee,we),m(Ze,e(v))},[()=>({reachability:!!e(v)})],i),a(ge,he)};oe(O,ge=>{var he,fe;(fe=(he=$())==null?void 0:he.buildIdReachability)!=null&&fe.length&&ge(E)})}var G=d(O,2),Q=r(G),H=r(Q,!0);t(Q),t(G);var S=d(G,2),Y=r(S);const te=i(()=>e(o).taskQueueTypes.includes("WORKFLOW"));Ne(Y,{get includesTaskQueueType(){return e(te)}}),t(S);var re=d(S,2),pe=r(re);const ve=i(()=>e(o).taskQueueTypes.includes("ACTIVITY"));Ne(pe,{get includesTaskQueueType(){return e(ve)}}),t(re),V(ge=>{m(D,e(o).identity),m(H,ge)},[()=>Ce(e(o).lastAccessTime,A(),{relative:p()})],i),a(f,h)},$$slots:{default:!0}})},s=>{var o=St(),c=r(o),v=r(c);const f=i(()=>T("workflows.workers-empty-state"));Ie(v,{get title(){return e(f)}}),t(c),t(o),V(()=>{var _,h;return $t(c,"colspan",(h=(_=$())==null?void 0:_.buildIdReachability)!=null&&h.length?6:4)}),a(s,o)}),a(y,l)},$$slots:{default:!0,caption:(y,ee)=>{var l=Ct(),u=r(l,!0);t(l),V(s=>m(u,s),[()=>T("workflows.workers-tab")],i),a(y,l)},headers:(y,ee)=>{ke(y,{slot:"headers",children:(l,u)=>{var s=Wt(),o=x(s),c=r(o,!0);t(o);var v=d(o,2);{var f=Q=>{var H=Ft(),S=x(H),Y=r(S,!0);t(S);var te=d(S,2),re=r(te,!0);t(te),V((pe,ve)=>{m(Y,pe),m(re,ve)},[()=>T("workers.version"),()=>T("workers.retirability")],i),a(Q,H)};oe(v,Q=>{var H,S;(S=(H=$())==null?void 0:H.buildIdReachability)!=null&&S.length&&Q(f)})}var _=d(v,2),h=r(_,!0);t(_);var R=d(_,2),W=r(R),D=r(W,!0);t(W),t(R);var O=d(R,2),E=r(O),G=r(E,!0);t(E),t(O),V((Q,H,S,Y)=>{var te,re;Se(o,1,Ye((re=(te=$())==null?void 0:te.buildIdReachability)!=null&&re.length?"w-3/12":"w-6/12")),m(c,Q),m(h,H),m(D,S),m(G,Y)},[()=>T("common.id"),()=>T("workflows.last-accessed"),()=>T("workflows.workflow-task-handler"),()=>T("workflows.activity-handler")],i),a(l,s)},$$slots:{default:!0}})}}}),V((y,ee)=>{m(C,y),m(N,`${ee??""} `)},[()=>T("workers.version-sets"),()=>T("workers.workers")],i),a(z,q),ue(),j()}var Et=w('<td class="text-left" data-testid="index"></td> <td class="break-all text-left" data-testid="target-build-id"> </td> <td class="text-right" data-testid="target-ramp"> </td> <td class="justfiy-between flex w-full items-center text-right" data-testid="target-create-time"><p> </p></td>',1),jt=w('<tr class="w-full"><td colspan="4"><!></td></tr>'),Kt=w('<td></td> <td class="break-all text-left text-blue-700 underline"> </td> <td></td> <td></td>',1),Nt=w("<!> <!>",1),Ht=w('<th class="w-20">Index</th> <th class="grow">Target Build ID</th> <th class="w-20">Ramp</th> <th class="text-right">Create Time</th>',1),Lt=w('<td class="text-left" data-testid="target-source"> </td> <td class="text-left" data-testid="target-source"> </td> <td class="text-left" data-testid="target-source"> </td>',1),Mt=w('<tr class="w-full"><td colspan="3"><!></td></tr>'),Ut=w('<th class="w-1/3">Source Build ID</th> <th class="w-1/3">Target Build ID</th> <th class="w-1/3">Create Time</th>',1),Yt=w('<h2 data-testid="worker-rules"> </h2> <!> <h2 data-testid="worker-rules"> </h2> <!>',1);function zt(z,g){de(g,!1);const[U,j]=ye(),A=()=>ie(ze,"$timeFormat",U),p=M(),I=M(),P=M(),B=M(),b=M(),$=M(),k=M();let q=Z(g,"rules",8),n=M(!1);const C=l=>{var u,s,o;return!((u=l.rule)===null||u===void 0)&&u.percentageRamp?!((o=(s=l.rule)===null||s===void 0?void 0:s.percentageRamp)===null||o===void 0)&&o.rampPercentage?l.rule.percentageRamp.rampPercentage:0:100};J(()=>(e(p),e(I),xe(q())),()=>{(l=>(L(p,Ke(l.assignmentRules,()=>[],!0)),L(I,Ke(l.compatibleRedirectRules,()=>[],!0))))(q())}),J(()=>e(p),()=>{L(P,e(p).find(l=>C(l)===100))}),J(()=>(e(p),e(P)),()=>{L(B,e(p).indexOf(e(P)))}),J(()=>(e(p),e(B)),()=>{L(b,e(p).filter((l,u)=>u<=e(B)))}),J(()=>(e(p),e(B)),()=>{L($,e(p).filter((l,u)=>u>e(B)))}),J(()=>(e(n),e(b),e($)),()=>{L(k,e(n)?[...e(b),...e($)]:e(b))}),Re(),ce();var F=Yt(),K=x(F),N=r(K,!0);t(K);var ae=d(K,2);be(ae,{class:"mb-6 w-full table-fixed",children:(l,u)=>{var s=Nt(),o=x(s);le(o,1,()=>e(k),ne,(f,_,h)=>{me(f,{"data-testid":"version-row",children:(R,W)=>{var D=Et(),O=x(D);O.textContent=h;var E=d(O,2),G=r(E,!0);t(E);var Q=d(E,2),H=r(Q);t(Q);var S=d(Q,2),Y=r(S),te=r(Y,!0);t(Y),t(S),V((re,pe)=>{var ve;m(G,(ve=e(_).rule)==null?void 0:ve.targetBuildId),m(H,`${re??""}%`),m(te,pe)},[()=>C(e(_)).toFixed(0),()=>Ce(e(_).createTime,A())],i),a(R,D)},$$slots:{default:!0}})},f=>{var _=jt(),h=r(_),R=r(h);const W=i(()=>T("workers.no-assignment-rules-found"));Ie(R,{get title(){return e(W)}}),t(h),t(_),a(f,_)});var c=d(o,2);{var v=f=>{me(f,{"data-testid":"view-all",class:"surface-subtle cursor-pointer",$$events:{click:()=>L(n,!e(n))},children:(_,h)=>{var R=Kt(),W=d(x(R),2),D=r(W,!0);t(W),Pe(4),V(O=>m(D,O),[()=>T("workers.show-inactive-assignment-rules")],i),a(_,R)},$$slots:{default:!0}})};oe(c,f=>{var _;!e(n)&&((_=e($))!=null&&_.length)&&f(v)})}a(l,s)},$$slots:{default:!0,headers:(l,u)=>{ke(l,{slot:"headers",children:(s,o)=>{var c=Ht();Pe(6),a(s,c)},$$slots:{default:!0}})}}});var se=d(ae,2),y=r(se,!0);t(se);var ee=d(se,2);be(ee,{class:"mb-6 w-full table-fixed",children:(l,u)=>{var s=X(),o=x(s);le(o,1,()=>e(I),ne,(c,v)=>{me(c,{"data-testid":"version-row",children:(f,_)=>{var h=Lt(),R=x(h),W=r(R,!0);t(R);var D=d(R,2),O=r(D,!0);t(D);var E=d(D,2),G=r(E,!0);t(E),V(Q=>{m(W,e(v).rule.sourceBuildId),m(O,e(v).rule.targetBuildId),m(G,Q)},[()=>Ce(e(v).createTime,A())],i),a(f,h)},$$slots:{default:!0}})},c=>{var v=Mt(),f=r(v),_=r(f);const h=i(()=>T("workers.no-redirect-rules-found"));Ie(_,{get title(){return e(h)}}),t(f),t(v),a(c,v)}),a(l,s)},$$slots:{default:!0,headers:(l,u)=>{ke(l,{slot:"headers",children:(s,o)=>{var c=Ut();Pe(4),a(s,c)},$$slots:{default:!0}})}}}),V((l,u)=>{m(N,l),m(y,u)},[()=>T("workers.assignment-rules"),()=>T("workers.redirect-rules")],i),a(z,F),ue(),j()}var Gt=w('<td style="padding-right: 0.5rem;"><!></td>'),Jt=w("<th></th>");function Ue(z,g){de(g,!1);let U=Z(g,"rows",8,10),j=Z(g,"columns",8,4),A=Z(g,"columnWidths",24,()=>new Array(j()).fill(100/j()));ce(),be(z,{class:"w-full table-fixed",variant:"fancy",children:(p,I)=>{var P=X(),B=x(P);le(B,1,()=>Array.from(Array(U()).keys()),ne,(b,$)=>{me(b,{children:(k,q)=>{var n=X(),C=x(n);le(C,1,()=>Array.from(new Array(j())),ne,(F,K)=>{var N=Gt(),ae=r(N);Pt(ae,{class:"h-4 w-full"}),t(N),a(F,N)}),a(k,n)},$$slots:{default:!0}})}),a(p,P)},$$slots:{default:!0,headers:(p,I)=>{ke(p,{slot:"headers",class:"h-8",children:(P,B)=>{var b=X(),$=x(b);Te($,g,"headers",{},k=>{var q=X(),n=x(q);le(n,1,()=>Array.from(new Array(j())),ne,(C,F,K)=>{var N=Jt();V(()=>xt(N,`width: ${A()[K]??""}%;`)),a(C,N)}),a(k,q)}),a(P,b)},$$slots:{default:!0}})}}}),ue()}var Xt=w("<!> <!>",1),Zt=w("<p>No versioning configured for task queue.</p>");function er(z,g){de(g,!1);const[U,j]=ye(),A=()=>ie(Fe,"$page",U),p=M(),I=M(),P=M(),B=M();let b=Z(g,"taskQueue",8),$=Z(g,"workers",8);J(()=>(e(p),A()),()=>{(n=>L(p,n.namespace))(A().params)}),J(()=>xe($()),()=>{L(I,_t($().pollers))}),J(()=>xe($()),()=>{L(P,mt($().pollers))}),J(()=>{},()=>{L(B,n=>(n==null?void 0:n.assignmentRules)||(n==null?void 0:n.compatibleRedirectRules))}),Re(),ce();var k=X(),q=x(k);Be(q,()=>gt({namespace:e(p),queue:b()}),n=>{Ue(n,{rows:3})},(n,C)=>{var F=i(()=>{var{rules:u,compatibility:s,versionSets:o}=e(C);return{rules:u,compatibility:s,versionSets:o}}),K=i(()=>e(F).rules),N=i(()=>e(F).compatibility),ae=i(()=>e(F).versionSets),se=X(),y=x(se);{var ee=u=>{zt(u,{get rules(){return e(K)}})},l=(u,s)=>{{var o=v=>{var f=X(),_=x(f);Be(_,()=>pt({namespace:e(p),buildIds:e(P),queue:b()}),h=>{Ue(h,{rows:3})},(h,R)=>{var W=Xt(),D=x(W);Te(D,g,"default",{get compatibility(){return e(N)}},null);var O=d(D,2);Ot(O,{get taskQueue(){return b()},get workers(){return $()},get compatibility(){return e(N)},get reachability(){return e(R)}}),a(h,W)}),a(v,f)},c=v=>{var f=Zt();a(v,f)};oe(u,v=>{var f;e(I)&&((f=e(ae))!=null&&f.length)?v(o):v(c,!1)},s)}};oe(y,u=>{e(B)(e(K))?u(ee):u(l,!1)})}a(n,se)}),a(z,k),ue(),j()}var tr=w("<!> <!>",1),rr=w('<section class="flex flex-col gap-4"><h2 data-testid="task-queue-name"> </h2> <!> <!></section>');function ar(z,g){de(g,!1);const[U,j]=ye(),A=()=>ie(Fe,"$page",U),p=()=>ie(Me,"$taskQueueView",U),I=M(),P=M(),B=k=>{at(Me,k)};J(()=>(e(I),e(P),A()),()=>{(k=>(L(I,k.queue),L(P,k.namespace)))(A().params)}),Re(),ce();var b=X(),$=x(b);Be($,()=>ht({queue:e(I),namespace:e(P)}),null,(k,q)=>{var n=rr(),C=r(n),F=r(C,!0);t(C);var K=d(C,2);lt(K,{children:(y,ee)=>{nt(y,{class:"flex flex-wrap gap-6 p-4 pl-0",label:"task queue detail",children:(l,u)=>{var s=tr(),o=x(s);const c=i(()=>T("workers.workers")),v=i(()=>p()==="workers");He(o,{get label(){return e(c)},id:"worker-tab",onClick:()=>B("workers"),get active(){return e(v)}});var f=d(o,2);const _=i(()=>T("workers.versioning")),h=i(()=>p()==="versioning");He(f,{get label(){return e(_)},id:"versioning-tab",onClick:()=>B("versioning"),get active(){return e(h)}}),a(l,s)},$$slots:{default:!0}})},$$slots:{default:!0}});var N=d(K,2);{var ae=y=>{er(y,{get taskQueue(){return e(I)},get workers(){return e(q)}})},se=y=>{ot(y,{get workers(){return e(q)}})};oe(N,y=>{p()==="versioning"?y(ae):y(se,!1)})}t(n),V(()=>m(F,e(I))),a(k,n)}),a(z,b),ue(),j()}var sr=w("<!> <!>",1);function Fr(z,g){de(g,!1);const[U,j]=ye(),A=()=>ie(Fe,"$page",U),p=A().params.queue;ce();var I=sr(),P=x(I);st(P,{title:`Task Queue | ${p}`,get url(){return A().url.href}});var B=d(P,2);ar(B,{}),a(z,I),ue(),j()}export{Fr as component};
