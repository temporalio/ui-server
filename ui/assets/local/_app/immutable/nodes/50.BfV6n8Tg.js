import"../chunks/Bzak7iHL.js";import"../chunks/69_IOA4Y.js";import{p as A,u as p,ag as X,t as _,i as r,r as t,c as i,j as U,e as w,b as F,aG as aa,g as e,s as L,K as Y,f as Z,q as ea,o as ta}from"../chunks/CYx2j9em.js";import{i as ra}from"../chunks/HoZrOv-6.js";import{p as K}from"../chunks/xzXQL2YA.js";import{P as sa}from"../chunks/DN2Bw11a.js";import{t as D}from"../chunks/BXv1jDVW.js";import{e as oa,s as I}from"../chunks/BjCW00Pv.js";import{i as N}from"../chunks/DeQvpgQS.js";import{k as ia}from"../chunks/Hbsv0g-K.js";import{s as S,a as G,e as la}from"../chunks/DnRAdnAf.js";import{o as da}from"../chunks/CzTm8X19.js";import{T as na}from"../chunks/C5Sw_ggu.js";import{B as va}from"../chunks/DHC-vVGF.js";import{I as fa}from"../chunks/Cgy7lDWn.js";import{P as Q}from"../chunks/CGL_JpVx.js";import{a as ua}from"../chunks/7RshVjOz.js";import{a as ca}from"../chunks/DTBKjfP9.js";import{w as V}from"../chunks/WemCyz5V.js";import{e as ma,i as pa}from"../chunks/C1OgRA7l.js";import{M as wa}from"../chunks/C7P3a02Z.js";import{W as _a}from"../chunks/C6aklHeg.js";import{g as xa}from"../chunks/D7cGO6hp.js";import{f as ga}from"../chunks/DieA4Add.js";var ha=_('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function ya(x,f){A(f,!0);const[n,m]=S(),s=()=>G(V,"$workflowRun",n),u=()=>G(ca,"$authUser",n);var l;const R=p(()=>K.params),P=p(()=>e(R).namespace),g=p(()=>s().workflow),$=p(()=>((l=s()===null||s()===void 0?void 0:s().metadata)===null||l===void 0?void 0:l.currentDetails)||"");let c=X(!1),d=X(null);const o=async()=>{if(!e(c)){L(c,!0);try{const{settings:a}=K.data,v=await ua({namespace:e(P),workflow:{id:e(g).id,runId:e(g).runId}},a,u()===null||u()===void 0?void 0:u().accessToken);la(V,Y(s).metadata=v,Y(s)),L(d,new Date,!0)}catch(a){console.error("Error fetching current details:",a)}finally{L(c,!1)}}};da(()=>{o()});const T=a=>{(a.key==="r"||a.key==="R")&&(a.preventDefault(),o())};var h=ha();oa("keydown",aa,T);var y=r(h),b=r(y),k=r(b),j=r(k,!0);t(k);var H=i(k,2),E=i(r(H),2),q=i(r(E),2);va(q,{variant:"ghost",get disabled(){return e(c)},$$events:{click:o},children:(a,v)=>{fa(a,{name:"retry"})},$$slots:{default:!0}}),t(E);var B=i(E,2);{var M=a=>{na(a,{as:"p",class:"text-xs text-secondary",get dateTime(){return e(d)}})};N(B,a=>{e(d)&&a(M)})}t(H),t(b),t(y);var W=i(y,2),O=r(W);ia(O,()=>e($),a=>{Q(a,{class:"p-3",overrideTheme:"background",get content(){return e($)}})}),t(W),t(h),U(a=>I(j,a),[()=>D("workflows.current-details")]),w(x,h),F(),m()}var ka=_('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),$a=_('<span class="text-sm"> </span>'),ba=_('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Ma=_('<!> <div class="flex flex-col gap-2"></div>',1);function Ra(x,f){A(f,!0);const[n,m]=S(),s=()=>G(V,"$workflowRun",n),u=()=>G(ga,"$fullEventHistory",n),l=p(()=>s().workflow),R=p(()=>xa(u(),"ascending",e(l)===null||e(l)===void 0?void 0:e(l).pendingActivities,e(l)===null||e(l)===void 0?void 0:e(l).pendingNexusOperations).filter(d=>{var o;return(o=d.userMetadata)===null||o===void 0?void 0:o.summary}));var P=Ma(),g=Z(P);{var $=d=>{var o=ka();w(d,o)};N(g,d=>{e(R).length||d($)})}var c=i(g,2);ma(c,21,()=>e(R),pa,(d,o)=>{var T=ba(),h=r(T),y=r(h),b=r(y,!0);t(y);var k=i(y,2);const j=p(()=>D("events.decode-failed"));wa(k,{get value(){return e(o).userMetadata.summary},get fallback(){return e(j)},children:ea,$$slots:{default:(E,q)=>{const B=p(()=>q.decodedValue);var M=$a(),W=r(M,!0);t(M),U(()=>I(W,e(B))),w(E,M)}}}),t(h);var H=i(h,2);_a(H,{get status(){return e(o).finalClassification}}),t(T),U(()=>I(b,e(o).label)),w(d,T)}),t(c),w(x,P),F(),m()}var Pa=_('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ta=_('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ea=_('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function Wa(x,f){A(f,!0);const[n,m]=S(),s=()=>G(V,"$workflowRun",n);var u,l;const R=p(()=>(u=s()===null||s()===void 0?void 0:s().userMetadata)===null||u===void 0?void 0:u.summary),P=p(()=>(l=s()===null||s()===void 0?void 0:s().userMetadata)===null||l===void 0?void 0:l.details);var g=Ea(),$=r(g),c=r($),d=r(c),o=r(d,!0);t(d),t(c);var T=i(c,2);{var h=a=>{Q(a,{class:"p-3",overrideTheme:"primary",get content(){return e(R)}})},y=a=>{var v=Pa(),C=r(v),z=r(C,!0);t(C),t(v),U(J=>I(z,J),[()=>D("workflows.no-summary-available")]),w(a,v)};N(T,a=>{e(R)?a(h):a(y,!1)})}t($);var b=i($,2),k=r(b),j=r(k),H=r(j,!0);t(j),t(k);var E=i(k,2);{var q=a=>{Q(a,{class:"p-3",overrideTheme:"primary",get content(){return e(P)}})},B=a=>{var v=Ta(),C=r(v),z=r(C,!0);t(C),t(v),U(J=>I(z,J),[()=>D("workflows.no-details-available")]),w(a,v)};N(E,a=>{e(P)?a(q):a(B,!1)})}t(b);var M=i(b,2),W=i(r(M),2),O=r(W);Ra(O,{}),t(W),t(M),t(g),U((a,v)=>{I(o,a),I(H,v)},[()=>D("workflows.summary"),()=>D("workflows.details")]),w(x,g),F(),m()}var Da=_('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ia(x){var f=Da(),n=r(f);Wa(n,{});var m=i(n,2);ya(m,{}),t(f),w(x,f)}var ja=_("<!> <!>",1);function se(x,f){A(f,!1),ra();var n=ja(),m=Z(n);const s=ta(()=>`${D("workflows.user-metadata-tab")} | ${K.params.workflow}`);sa(m,{get title(){return e(s)},get url(){return K.url.href}});var u=i(m,2);Ia(u),w(x,n),F()}export{se as component};
