import"../chunks/Bzak7iHL.js";import"../chunks/69_IOA4Y.js";import{p as O,u as x,ag as X,t as p,i as t,r as e,c as d,j as q,e as u,b as z,aG as ea,g as a,s as L,K as Y,f as Z,q as ta,o as ra}from"../chunks/CeuSLZ0_.js";import{i as sa}from"../chunks/Bs0RATCS.js";import{p as N}from"../chunks/CslYezbY.js";import{P as oa}from"../chunks/ROT02nYq.js";import{t as H}from"../chunks/BXv1jDVW.js";import{e as ia,s as T}from"../chunks/BWPCX_-J.js";import{i as V}from"../chunks/CRQEv5x5.js";import{k as la}from"../chunks/BFDJKWtF.js";import{s as S,a as U,e as da}from"../chunks/BqQLnCe4.js";import{o as na}from"../chunks/B9uAqm1w.js";import{B as va}from"../chunks/DtcLjaX3.js";import{I as fa}from"../chunks/ClThC-d1.js";import{P as Q}from"../chunks/CB8kzcf1.js";import{a as ca}from"../chunks/BUJwHAzh.js";import{a as ma}from"../chunks/CkEyQ5RX.js";import{f as ua,r as pa,t as _a}from"../chunks/BZkzaUf0.js";import{w as A}from"../chunks/BxRFk-Ph.js";import{e as wa,i as xa}from"../chunks/BDegIHXr.js";import{M as ga}from"../chunks/CNa3fx5_.js";import{W as ha}from"../chunks/Au-6LebN.js";import{g as $a}from"../chunks/DHzURD_j.js";import{f as ya}from"../chunks/BZ41BKT8.js";var ka=p('<p class="text-xs text-secondary"> </p>'),ba=p('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function Ma(g,f){O(f,!0);const[l,_]=S(),o=()=>U(A,"$workflowRun",l),c=()=>U(ma,"$authUser",l),v=()=>U(_a,"$timeFormat",l),D=()=>U(pa,"$relativeTime",l);var h;const R=x(()=>N.params),E=x(()=>a(R).namespace),$=x(()=>o().workflow),n=x(()=>((h=o()===null||o()===void 0?void 0:o().metadata)===null||h===void 0?void 0:h.currentDetails)||"");let i=X(!1),y=X(null);const k=async()=>{if(!a(i)){L(i,!0);try{const{settings:r}=N.data,w=await ca({namespace:a(E),workflow:{id:a($).id,runId:a($).runId}},r,c()===null||c()===void 0?void 0:c().accessToken);da(A,Y(o).metadata=w,Y(o)),L(y,new Date,!0)}catch(r){console.error("Error fetching current details:",r)}finally{L(i,!1)}}};na(()=>{k()});const W=r=>{(r.key==="r"||r.key==="R")&&(r.preventDefault(),k())};var b=ba();ia("keydown",ea,W);var M=t(b),F=t(M),I=t(F),G=t(I,!0);e(I);var B=d(I,2),j=d(t(B),2),P=d(t(j),2);va(P,{variant:"ghost",get disabled(){return a(i)},$$events:{click:k},children:(r,w)=>{fa(r,{name:"retry"})},$$slots:{default:!0}}),e(j);var C=d(j,2);{var J=r=>{var w=ka(),K=t(w,!0);e(w),q(aa=>T(K,aa),[()=>ua(a(y),v(),{relative:D()})]),u(r,w)};V(C,r=>{a(y)&&r(J)})}e(B),e(F),e(M);var s=d(M,2),m=t(s);la(m,()=>a(n),r=>{Q(r,{class:"p-3",overrideTheme:"background",get content(){return a(n)}})}),e(s),e(b),q(r=>T(G,r),[()=>H("workflows.current-details")]),u(g,b),z(),_()}var Ra=p('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),Pa=p('<span class="text-sm"> </span>'),Ta=p('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Da=p('<!> <div class="flex flex-col gap-2"></div>',1);function Ea(g,f){O(f,!0);const[l,_]=S(),o=()=>U(A,"$workflowRun",l),c=()=>U(ya,"$fullEventHistory",l),v=x(()=>o().workflow),D=x(()=>$a(c(),"ascending",a(v)===null||a(v)===void 0?void 0:a(v).pendingActivities,a(v)===null||a(v)===void 0?void 0:a(v).pendingNexusOperations).filter(n=>{var i;return(i=n.userMetadata)===null||i===void 0?void 0:i.summary}));var h=Da(),R=Z(h);{var E=n=>{var i=Ra();u(n,i)};V(R,n=>{a(D).length||n(E)})}var $=d(R,2);wa($,21,()=>a(D),xa,(n,i)=>{var y=Ta(),k=t(y),W=t(k),b=t(W,!0);e(W);var M=d(W,2);const F=x(()=>H("events.decode-failed"));ga(M,{get value(){return a(i).userMetadata.summary},get fallback(){return a(F)},children:ta,$$slots:{default:(G,B)=>{const j=x(()=>B.decodedValue);var P=Pa(),C=t(P,!0);e(P),q(()=>T(C,a(j))),u(G,P)}}}),e(k);var I=d(k,2);ha(I,{get status(){return a(i).finalClassification}}),e(y),q(()=>T(b,a(i).label)),u(n,y)}),e($),u(g,h),z(),_()}var Wa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Fa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ia=p('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function ja(g,f){O(f,!0);const[l,_]=S(),o=()=>U(A,"$workflowRun",l);var c,v;const D=x(()=>(c=o()===null||o()===void 0?void 0:o().userMetadata)===null||c===void 0?void 0:c.summary),h=x(()=>(v=o()===null||o()===void 0?void 0:o().userMetadata)===null||v===void 0?void 0:v.details);var R=Ia(),E=t(R),$=t(E),n=t($),i=t(n,!0);e(n),e($);var y=d($,2);{var k=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(D)}})},W=s=>{var m=Wa(),r=t(m),w=t(r,!0);e(r),e(m),q(K=>T(w,K),[()=>H("workflows.no-summary-available")]),u(s,m)};V(y,s=>{a(D)?s(k):s(W,!1)})}e(E);var b=d(E,2),M=t(b),F=t(M),I=t(F,!0);e(F),e(M);var G=d(M,2);{var B=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(h)}})},j=s=>{var m=Fa(),r=t(m),w=t(r,!0);e(r),e(m),q(K=>T(w,K),[()=>H("workflows.no-details-available")]),u(s,m)};V(G,s=>{a(h)?s(B):s(j,!1)})}e(b);var P=d(b,2),C=d(t(P),2),J=t(C);Ea(J,{}),e(C),e(P),e(R),q((s,m)=>{T(i,s),T(I,m)},[()=>H("workflows.summary"),()=>H("workflows.details")]),u(g,R),z(),_()}var Ha=p('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ua(g){var f=Ha(),l=t(f);ja(l,{});var _=d(l,2);Ma(_,{}),e(f),u(g,f)}var qa=p("<!> <!>",1);function de(g,f){O(f,!1),sa();var l=qa(),_=Z(l);const o=ra(()=>`${H("workflows.user-metadata-tab")} | ${N.params.workflow}`);oa(_,{get title(){return a(o)},get url(){return N.url.href}});var c=d(_,2);Ua(c),u(g,l),z()}export{de as component};
