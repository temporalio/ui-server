import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as F,f as p,t as U,e as c,b as K,aM as aa,h as i,j as r,g as e,al as X,s as L,u as m,G as Y,r as t,c as Z,q as ea,o as ta}from"../chunks/yn9lut7I.js";import{i as ra}from"../chunks/Bk16Yghv.js";import{p as N}from"../chunks/CcthVPor.js";import{P as sa}from"../chunks/DUSMGXax.js";import{t as D}from"../chunks/DEjs8ZrU.js";import{o as oa}from"../chunks/D12POdU-.js";import{e as ia,s as I}from"../chunks/B95CcGmx.js";import{i as V}from"../chunks/Bw1cG9kR.js";import{k as la}from"../chunks/CfWyzvfP.js";import{s as S,a as G,e as da}from"../chunks/C6jR5PNA.js";import{T as na}from"../chunks/s8ol0nR7.js";import{B as va}from"../chunks/B-XX65Ry.js";import{I as fa}from"../chunks/CX6FZu_7.js";import{P as Q}from"../chunks/BxQqgmUt.js";import{a as ua}from"../chunks/cJaSB0P2.js";import{a as ca}from"../chunks/j5XEhUQM.js";import{w as A}from"../chunks/CtmWgi5e.js";import{e as ma,i as pa}from"../chunks/B0gjW5Lu.js";import{M as wa}from"../chunks/Un4jl7A8.js";import{W as _a}from"../chunks/CzufdFBJ.js";import{g as xa}from"../chunks/Bwr3uHvu.js";import{f as ha}from"../chunks/7BpYeHof.js";var ga=p('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function ya(w,f){F(f,!0);const s=()=>G(A,"$workflowRun",_),n=()=>G(ca,"$authUser",_),[_,x]=S();var l;const R=m(()=>N.params),P=m(()=>e(R).namespace),h=m(()=>s().workflow),k=m(()=>((l=s()===null||s()===void 0?void 0:s().metadata)===null||l===void 0?void 0:l.currentDetails)||"");let u=X(!1),d=X(null);const o=async()=>{if(!e(u)){L(u,!0);try{const{settings:a}=N.data,v=await ua({namespace:e(P),workflow:{id:e(h).id,runId:e(h).runId}},a,n()===null||n()===void 0?void 0:n().accessToken);da(A,Y(s).metadata=v,Y(s)),L(d,new Date,!0)}catch(a){console.error("Error fetching current details:",a)}finally{L(u,!1)}}};oa(()=>{o()});const T=a=>{(a.key==="r"||a.key==="R")&&(a.preventDefault(),o())};var g=ga();ia("keydown",aa,T);var y=r(g),b=r(y),$=r(b),j=r($,!0);t($);var H=i($,2),E=i(r(H),2),q=i(r(E),2);va(q,{variant:"ghost",get disabled(){return e(u)},$$events:{click:o},children:(a,v)=>{fa(a,{name:"retry"})},$$slots:{default:!0}}),t(E);var B=i(E,2);{var M=a=>{na(a,{as:"p",class:"text-xs text-secondary",get dateTime(){return e(d)}})};V(B,a=>{e(d)&&a(M)})}t(H),t(b),t(y);var W=i(y,2),O=r(W);la(O,()=>e(k),a=>{Q(a,{class:"p-3",overrideTheme:"background",get content(){return e(k)}})}),t(W),t(g),U(a=>I(j,a),[()=>D("workflows.current-details")]),c(w,g),K(),x()}var $a=p('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),ka=p('<span class="text-sm"> </span>'),ba=p('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Ma=p('<!> <div class="flex flex-col gap-2"></div>',1);function Ra(w,f){F(f,!0);const s=()=>G(A,"$workflowRun",_),n=()=>G(ha,"$fullEventHistory",_),[_,x]=S(),l=m(()=>s().workflow),R=m(()=>xa(n(),"ascending",e(l)===null||e(l)===void 0?void 0:e(l).pendingActivities,e(l)===null||e(l)===void 0?void 0:e(l).pendingNexusOperations).filter(d=>{var o;return(o=d.userMetadata)===null||o===void 0?void 0:o.summary}));var P=Ma(),h=Z(P);{var k=d=>{var o=$a();c(d,o)};V(h,d=>{e(R).length||d(k)})}var u=i(h,2);ma(u,21,()=>e(R),pa,(d,o)=>{var T=ba(),g=r(T),y=r(g),b=r(y,!0);t(y);var $=i(y,2);{let H=m(()=>D("events.decode-failed"));wa($,{get value(){return e(o).userMetadata.summary},get fallback(){return e(H)},children:ea,$$slots:{default:(E,q)=>{const B=m(()=>q.decodedValue);var M=ka(),W=r(M,!0);t(M),U(()=>I(W,e(B))),c(E,M)}}})}t(g);var j=i(g,2);_a(j,{get status(){return e(o).finalClassification}}),t(T),U(()=>I(b,e(o).label)),c(d,T)}),t(u),c(w,P),K(),x()}var Pa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ta=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ea=p('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function Wa(w,f){F(f,!0);const s=()=>G(A,"$workflowRun",n),[n,_]=S();var x,l;const R=m(()=>(x=s()===null||s()===void 0?void 0:s().userMetadata)===null||x===void 0?void 0:x.summary),P=m(()=>(l=s()===null||s()===void 0?void 0:s().userMetadata)===null||l===void 0?void 0:l.details);var h=Ea(),k=r(h),u=r(k),d=r(u),o=r(d,!0);t(d),t(u);var T=i(u,2);{var g=a=>{Q(a,{class:"p-3",overrideTheme:"primary",get content(){return e(R)}})},y=a=>{var v=Pa(),C=r(v),z=r(C,!0);t(C),t(v),U(J=>I(z,J),[()=>D("workflows.no-summary-available")]),c(a,v)};V(T,a=>{e(R)?a(g):a(y,!1)})}t(k);var b=i(k,2),$=r(b),j=r($),H=r(j,!0);t(j),t($);var E=i($,2);{var q=a=>{Q(a,{class:"p-3",overrideTheme:"primary",get content(){return e(P)}})},B=a=>{var v=Ta(),C=r(v),z=r(C,!0);t(C),t(v),U(J=>I(z,J),[()=>D("workflows.no-details-available")]),c(a,v)};V(E,a=>{e(P)?a(q):a(B,!1)})}t(b);var M=i(b,2),W=i(r(M),2),O=r(W);Ra(O,{}),t(W),t(M),t(h),U((a,v)=>{I(o,a),I(H,v)},[()=>D("workflows.summary"),()=>D("workflows.details")]),c(w,h),K(),_()}var Da=p('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ia(w){var f=Da(),s=r(f);Wa(s,{});var n=i(s,2);ya(n,{}),t(f),c(w,f)}var ja=p("<!> <!>",1);function se(w,f){F(f,!1),ra();var s=ja(),n=Z(s);{let x=ta(()=>`${D("workflows.user-metadata-tab")} | ${N.params.workflow}`);sa(n,{get title(){return e(x)},get url(){return N.url.href}})}var _=i(n,2);Ia(_),c(w,s),K()}export{se as component};
