import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as K,ac as x,ah as X,t as p,i as t,r as e,c as d,j as q,e as u,b as O,aH as ea,g as a,s as L,J as Y,f as Z,q as ta,o as ra}from"../chunks/U_G9-AHJ.js";import{i as sa}from"../chunks/D2UjXFL6.js";import{p as A}from"../chunks/CM_2JwtB.js";import{P as oa}from"../chunks/Ck2hqwTx.js";import{t as j}from"../chunks/D2OY9xdY.js";import{e as ia,s as T}from"../chunks/CVVZ9xwv.js";import{i as G}from"../chunks/DIFdH0Rm.js";import{k as la}from"../chunks/C7kHQaHu.js";import{s as S,a as U,e as da}from"../chunks/DNW1xCX_.js";import{o as na}from"../chunks/D1QWZ-ZU.js";import{B as va}from"../chunks/BtZegsbD.js";import{I as fa}from"../chunks/DP_ar0SN.js";import{P as Q}from"../chunks/CqV3xujW.js";import{a as ca}from"../chunks/CCP6o_xi.js";import{a as ma}from"../chunks/brOJZyi7.js";import{f as ua,r as pa,t as _a}from"../chunks/CqYY455h.js";import{w as J}from"../chunks/DzLug7L5.js";import{e as wa,i as xa}from"../chunks/CbnBDLOu.js";import{M as ha}from"../chunks/D2y_otou.js";import{W as ga}from"../chunks/HxYhkKgM.js";import{g as $a}from"../chunks/BD8nsNRL.js";import{f as ya}from"../chunks/C5uP_BhQ.js";var ka=p('<p class="text-xs text-secondary"> </p>'),ba=p('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function Ma(h,f){K(f,!0);const[l,_]=S(),o=()=>U(J,"$workflowRun",l),c=()=>U(ma,"$authUser",l),v=()=>U(_a,"$timeFormat",l),D=()=>U(pa,"$relativeTime",l);var g;const R=x(()=>A.params),E=x(()=>a(R).namespace),$=x(()=>o().workflow),n=x(()=>((g=o()===null||o()===void 0?void 0:o().metadata)===null||g===void 0?void 0:g.currentDetails)||"");let i=X(!1),y=X(null);const k=async()=>{if(!a(i)){L(i,!0);try{const{settings:r}=A.data,w=await ca({namespace:a(E),workflow:{id:a($).id,runId:a($).runId}},r,c()===null||c()===void 0?void 0:c().accessToken);da(J,Y(o).metadata=w,Y(o)),L(y,new Date,!0)}catch(r){console.error("Error fetching current details:",r)}finally{L(i,!1)}}};na(()=>{k()});const W=r=>{(r.key==="r"||r.key==="R")&&(r.preventDefault(),k())};var b=ba();ia("keydown",ea,W);var M=t(b),F=t(M),H=t(F),N=t(H,!0);e(H);var B=d(H,2),I=d(t(B),2),P=d(t(I),2);va(P,{variant:"ghost",get disabled(){return a(i)},$$events:{click:k},children:(r,w)=>{fa(r,{name:"retry"})},$$slots:{default:!0}}),e(I);var C=d(I,2);{var z=r=>{var w=ka(),V=t(w,!0);e(w),q(aa=>T(V,aa),[()=>ua(a(y),v(),{relative:D()})]),u(r,w)};G(C,r=>{a(y)&&r(z)})}e(B),e(F),e(M);var s=d(M,2),m=t(s);la(m,()=>a(n),r=>{Q(r,{class:"p-3",overrideTheme:"background",get content(){return a(n)}})}),e(s),e(b),q(r=>T(N,r),[()=>j("workflows.current-details")]),u(h,b),O(),_()}var Ra=p('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),Pa=p('<span class="text-sm"> </span>'),Ta=p('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Da=p('<!> <div class="flex flex-col gap-2"></div>',1);function Ea(h,f){K(f,!0);const[l,_]=S(),o=()=>U(J,"$workflowRun",l),c=()=>U(ya,"$fullEventHistory",l),v=x(()=>o().workflow),D=x(()=>$a(c(),"ascending",a(v)===null||a(v)===void 0?void 0:a(v).pendingActivities,a(v)===null||a(v)===void 0?void 0:a(v).pendingNexusOperations).filter(n=>{var i;return(i=n.userMetadata)===null||i===void 0?void 0:i.summary}));var g=Da(),R=Z(g);{var E=n=>{var i=Ra();u(n,i)};G(R,n=>{a(D).length||n(E)})}var $=d(R,2);wa($,21,()=>a(D),xa,(n,i)=>{var y=Ta(),k=t(y),W=t(k),b=t(W,!0);e(W);var M=d(W,2);const F=x(()=>j("events.decode-failed"));ha(M,{get value(){return a(i).userMetadata.summary},get fallback(){return a(F)},children:ta,$$slots:{default:(N,B)=>{const I=x(()=>B.decodedValue);var P=Pa(),C=t(P,!0);e(P),q(()=>T(C,a(I))),u(N,P)}}}),e(k);var H=d(k,2);ga(H,{get status(){return a(i).finalClassification}}),e(y),q(()=>T(b,a(i).label)),u(n,y)}),e($),u(h,g),O(),_()}var Wa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Fa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ha=p('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function Ia(h,f){K(f,!0);const[l,_]=S(),o=()=>U(J,"$workflowRun",l);var c,v;const D=x(()=>(c=o()===null||o()===void 0?void 0:o().userMetadata)===null||c===void 0?void 0:c.summary),g=x(()=>(v=o()===null||o()===void 0?void 0:o().userMetadata)===null||v===void 0?void 0:v.details);var R=Ha(),E=t(R),$=t(E),n=t($),i=t(n,!0);e(n),e($);var y=d($,2);{var k=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(D)}})},W=s=>{var m=Wa(),r=t(m),w=t(r,!0);e(r),e(m),q(V=>T(w,V),[()=>j("workflows.no-summary-available")]),u(s,m)};G(y,s=>{a(D)?s(k):s(W,!1)})}e(E);var b=d(E,2),M=t(b),F=t(M),H=t(F,!0);e(F),e(M);var N=d(M,2);{var B=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(g)}})},I=s=>{var m=Fa(),r=t(m),w=t(r,!0);e(r),e(m),q(V=>T(w,V),[()=>j("workflows.no-details-available")]),u(s,m)};G(N,s=>{a(g)?s(B):s(I,!1)})}e(b);var P=d(b,2),C=d(t(P),2),z=t(C);Ea(z,{}),e(C),e(P),e(R),q((s,m)=>{T(i,s),T(H,m)},[()=>j("workflows.summary"),()=>j("workflows.details")]),u(h,R),O(),_()}var ja=p('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ua(h){var f=ja(),l=t(f);Ia(l,{});var _=d(l,2);Ma(_,{}),e(f),u(h,f)}var qa=p("<!> <!>",1);function de(h,f){K(f,!1),sa();var l=qa(),_=Z(l);const o=ra(()=>`${j("workflows.user-metadata-tab")} | ${A.params.workflow}`);oa(_,{get title(){return a(o)},get url(){return A.url.href}});var c=d(_,2);Ua(c),u(h,l),O()}export{de as component};
