import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as G,az as x,aC as X,t as p,h as t,r as e,c as d,i as U,d as u,b as K,aL as ea,g as a,s as J,O as Y,f as Z,o as ta,j as ra}from"../chunks/CtXwlho8.js";import{i as sa}from"../chunks/D4D3ThYu.js";import{p as q}from"../chunks/BEuqZ1rz.js";import{P as oa}from"../chunks/BYpUB0sF.js";import{t as C}from"../chunks/D2OY9xdY.js";import{e as ia,s as T}from"../chunks/BXc8M6y4.js";import{i as z}from"../chunks/yjFgoZ2z.js";import{k as la}from"../chunks/CmcpgAEn.js";import{s as S,a as H,e as da}from"../chunks/CI9zuxJp.js";import{o as na}from"../chunks/BBGlwGsK.js";import{B as va}from"../chunks/maNLw4C2.js";import{I as fa}from"../chunks/Cey4-U3a.js";import{P as Q}from"../chunks/DlchHudH.js";import{a as ca}from"../chunks/BYgZJi2H.js";import{a as ma}from"../chunks/Ip-blrGX.js";import{f as ua,r as pa,t as _a}from"../chunks/cq7hwzrg.js";import{w as A}from"../chunks/D9pSO_rq.js";import{e as wa,i as xa}from"../chunks/DN_bdWMP.js";import{M as ha}from"../chunks/DbkrAw40.js";import{W as ga}from"../chunks/Bk85UM9I.js";import{g as $a}from"../chunks/CZt_OS68.js";import{f as ya}from"../chunks/p5AdjKFc.js";var ka=p('<p class="text-xs text-secondary"> </p>'),ba=p('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function Ma(h,f){G(f,!0);const[l,_]=S(),o=()=>H(A,"$workflowRun",l),c=()=>H(ma,"$authUser",l),v=()=>H(_a,"$timeFormat",l),D=()=>H(pa,"$relativeTime",l);var g;const R=x(()=>q.params),E=x(()=>a(R).namespace),$=x(()=>o().workflow),n=x(()=>((g=o()===null||o()===void 0?void 0:o().metadata)===null||g===void 0?void 0:g.currentDetails)||"");let i=X(!1),y=X(null);const k=async()=>{if(!a(i)){J(i,!0);try{const{settings:r}=q.data,w=await ca({namespace:a(E),workflow:{id:a($).id,runId:a($).runId}},r,c()===null||c()===void 0?void 0:c().accessToken);da(A,Y(o).metadata=w,Y(o)),J(y,new Date,!0)}catch(r){console.error("Error fetching current details:",r)}finally{J(i,!1)}}};na(()=>{k()});const W=r=>{(r.key==="r"||r.key==="R")&&(r.preventDefault(),k())};var b=ba();ia("keydown",ea,W);var M=t(b),F=t(M),I=t(F),O=t(I,!0);e(I);var B=d(I,2),j=d(t(B),2),P=d(t(j),2);va(P,{variant:"ghost",get disabled(){return a(i)},$$events:{click:k},children:(r,w)=>{fa(r,{name:"retry"})},$$slots:{default:!0}}),e(j);var N=d(j,2);{var L=r=>{var w=ka(),V=t(w,!0);e(w),U(aa=>T(V,aa),[()=>ua(a(y),v(),{relative:D()})]),u(r,w)};z(N,r=>{a(y)&&r(L)})}e(B),e(F),e(M);var s=d(M,2),m=t(s);la(m,()=>a(n),r=>{Q(r,{class:"p-3",overrideTheme:"background",get content(){return a(n)}})}),e(s),e(b),U(r=>T(O,r),[()=>C("workflows.current-details")]),u(h,b),K(),_()}var Ra=p('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),Pa=p('<span class="text-sm"> </span>'),Ta=p('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Da=p('<!> <div class="flex flex-col gap-2"></div>',1);function Ea(h,f){G(f,!0);const[l,_]=S(),o=()=>H(A,"$workflowRun",l),c=()=>H(ya,"$fullEventHistory",l),v=x(()=>o().workflow),D=x(()=>$a(c(),"ascending",a(v)===null||a(v)===void 0?void 0:a(v).pendingActivities,a(v)===null||a(v)===void 0?void 0:a(v).pendingNexusOperations).filter(n=>{var i;return(i=n.userMetadata)===null||i===void 0?void 0:i.summary}));var g=Da(),R=Z(g);{var E=n=>{var i=Ra();u(n,i)};z(R,n=>{a(D).length||n(E)})}var $=d(R,2);wa($,21,()=>a(D),xa,(n,i)=>{var y=Ta(),k=t(y),W=t(k),b=t(W,!0);e(W);var M=d(W,2);const F=x(()=>C("events.decode-failed"));ha(M,{get value(){return a(i).userMetadata.summary},get fallback(){return a(F)},children:ta,$$slots:{default:(O,B)=>{const j=x(()=>B.decodedValue);var P=Pa(),N=t(P,!0);e(P),U(()=>T(N,a(j))),u(O,P)}}}),e(k);var I=d(k,2);ga(I,{get status(){return a(i).finalClassification}}),e(y),U(()=>T(b,a(i).label)),u(n,y)}),e($),u(h,g),K(),_()}var Wa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Fa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Ia=p('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function ja(h,f){G(f,!0);const[l,_]=S(),o=()=>H(A,"$workflowRun",l);var c,v;const D=x(()=>(c=o()===null||o()===void 0?void 0:o().userMetadata)===null||c===void 0?void 0:c.summary),g=x(()=>(v=o()===null||o()===void 0?void 0:o().userMetadata)===null||v===void 0?void 0:v.details);var R=Ia(),E=t(R),$=t(E),n=t($),i=t(n,!0);e(n),e($);var y=d($,2);{var k=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(D)}})},W=s=>{var m=Wa(),r=t(m),w=t(r,!0);e(r),e(m),U(V=>T(w,V),[()=>C("workflows.no-summary-available")]),u(s,m)};z(y,s=>{a(D)?s(k):s(W,!1)})}e(E);var b=d(E,2),M=t(b),F=t(M),I=t(F,!0);e(F),e(M);var O=d(M,2);{var B=s=>{Q(s,{class:"p-3",overrideTheme:"primary",get content(){return a(g)}})},j=s=>{var m=Fa(),r=t(m),w=t(r,!0);e(r),e(m),U(V=>T(w,V),[()=>C("workflows.no-details-available")]),u(s,m)};z(O,s=>{a(g)?s(B):s(j,!1)})}e(b);var P=d(b,2),N=d(t(P),2),L=t(N);Ea(L,{}),e(N),e(P),e(R),U((s,m)=>{T(i,s),T(I,m)},[()=>C("workflows.summary"),()=>C("workflows.details")]),u(h,R),K(),_()}var Ca=p('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ha(h){var f=Ca(),l=t(f);ja(l,{});var _=d(l,2);Ma(_,{}),e(f),u(h,f)}var Ua=p("<!> <!>",1);function de(h,f){G(f,!1),sa();var l=Ua(),_=Z(l);const o=ra(()=>`${C("workflows.user-metadata-tab")} | ${q.params.workflow}`);oa(_,{get title(){return a(o)},get url(){return q.url.href}});var c=d(_,2);Ha(c),u(h,l),K()}export{de as component};
