import"../chunks/CWj6FrbW.js";import{p as se,f as F,c as le,j as m,r as u,h as l,n as C,k as D,t as $,e as v,s as p,al as B,g as e,u as g,b as ie}from"../chunks/yn9lut7I.js";import{s as d}from"../chunks/B95CcGmx.js";import{i as ge}from"../chunks/Bw1cG9kR.js";import{p as h,s as xe,a as ee}from"../chunks/C6jR5PNA.js";import{g as O}from"../chunks/DBa0Svn_.js";import{p as _e}from"../chunks/B1RK_Lla.js";import{P as he}from"../chunks/DUSMGXax.js";import{L as $e}from"../chunks/Bz5qys8Y.js";import{t as s}from"../chunks/DEjs8ZrU.js";import{B as Z}from"../chunks/BJd__fGa.js";import{I as Ne}from"../chunks/T_u5RcG7.js";import{M as ye}from"../chunks/OdAIJEiz.js";import{N as we,e as Pe}from"../chunks/Dm9IDWNf.js";import{d as be,u as Le}from"../chunks/KRyY_vpO.js";import{n as ke}from"../chunks/CESQ3O9F.js";import{e as He}from"../chunks/BWpXZTUS.js";import{l as te,m as Ee}from"../chunks/XQ-tjww_.js";var Te=F('<h3 slot="title"> </h3>'),Ce=F('<div slot="content" class="flex flex-col gap-4"><p> <strong class="select-all"> </strong> </p> <p> <strong class="select-all"> </strong> </p> <!></div>'),De=F('<div class="flex flex-col gap-8"><div class="flex flex-col gap-1"><h1 data-testid="namespace-selector-title"> </h1></div> <!> <div class="flex w-full flex-row items-center justify-between gap-4 max-sm:flex-col xl:w-1/2"><div class="flex w-full flex-row items-center gap-4 max-sm:flex-col"><!> <!></div> <!> <!></div></div> <!>',1);function Fe(U,a){se(a,!0);let J=h(a,"targetNamespaceList",19,()=>[]),q=h(a,"callerNamespaceList",19,()=>[]),w=h(a,"error",3,void 0),P=h(a,"loading",3,!1),G=h(a,"isCloud",3,!1),c=h(a,"nameRegexPattern",3,/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/),N=h(a,"nameHintText",19,()=>s("nexus.endpoint-name-hint-with-dash")),x=h(a,"cancelHref",3,"/nexus"),b=B(!1),H=B("");var M=De(),L=le(M),k=m(L),A=m(k),K=m(A,!0);u(A),u(k);var t=l(k,2);we(t,{get endpoint(){return a.endpoint},get nameHintText(){return N()},get nameRegexPattern(){return c()},get targetNamespaceList(){return J()},get callerNamespaceList(){return q()},get error(){return w()},get isCloud(){return G()},nameDisabled:!0});var n=l(t,2),f=m(n),I=m(f);Z(I,{class:"max-sm:w-full",get loading(){return P()},$$events:{click(...o){var _;(_=a.onUpdate)==null||_.apply(this,o)}},children:(o,_)=>{C();var i=D();$(r=>d(i,r),[()=>s("common.save")]),v(o,i)},$$slots:{default:!0}});var E=l(I,2);Z(E,{class:"max-sm:hidden",variant:"ghost",$$events:{click:()=>O(x())},children:(o,_)=>{C();var i=D();$(r=>d(i,r),[()=>s("common.cancel")]),v(o,i)},$$slots:{default:!0}}),u(f);var S=l(f,2);Z(S,{class:"max-sm:w-full",variant:"destructive",$$events:{click:()=>p(b,!0)},children:(o,_)=>{C();var i=D();$(r=>d(i,r),[()=>s("common.delete")]),v(o,i)},$$slots:{default:!0}});var ae=l(S,2);Z(ae,{class:"w-full sm:hidden",variant:"ghost",$$events:{click:()=>O(x())},children:(o,_)=>{C();var i=D();$(r=>d(i,r),[()=>s("common.cancel")]),v(o,i)},$$slots:{default:!0}}),u(n),u(L);var j=l(L,2);{let o=g(()=>s("common.delete")),_=g(()=>s("common.cancel")),i=g(()=>{var r;return e(H)!==((r=a.endpoint.spec)==null?void 0:r.name)});ye(j,{id:"delete-endpoint-modal",get loading(){return P()},confirmType:"destructive",get confirmText(){return e(o)},get cancelText(){return e(_)},get confirmDisabled(){return e(i)},get open(){return e(b)},set open(r){p(b,r,!0)},$$events:{confirmModal(...r){var z;(z=a.onDelete)==null||z.apply(this,r)},cancelModal:()=>p(b,!1)},$$slots:{title:(r,z)=>{var y=Te(),T=m(y,!0);u(y),$(R=>d(T,R),[()=>s("nexus.delete-modal-title")]),v(r,y)},content:(r,z)=>{var y=Ce(),T=m(y),R=m(T),Q=l(R),de=m(Q,!0);u(Q);var ce=l(Q);u(T);var V=l(T,2),re=m(V),W=l(re),me=m(W,!0);u(W);var ue=l(W);u(V);var pe=l(V,2);{let X=g(()=>s("nexus.delete-endpoint"));Ne(pe,{id:"delete-endpoint",labelHidden:!0,get label(){return e(X)},get value(){return e(H)},set value(Y){p(H,Y,!0)}})}u(y),$((X,Y,fe,ve)=>{var ne,oe;d(R,`${X??""} `),d(de,((ne=a.endpoint.spec)==null?void 0:ne.name)||""),d(ce,`?
      ${Y??""}`),d(re,`${fe??""} `),d(me,((oe=a.endpoint.spec)==null?void 0:oe.name)||""),d(ue,` ${ve??""}`)},[()=>s("nexus.delete-modal-confirmation-preface"),()=>s("nexus.delete-modal-confirmation-postface"),()=>s("nexus.type-confirm-preface"),()=>s("nexus.type-confirm-postface")]),v(r,y)}}})}$(()=>{var o;return d(K,((o=a.endpoint.spec)==null?void 0:o.name)||"")}),v(U,M),ie()}var Me=F('<div class="flex flex-col gap-4"><!> <!></div>'),Ae=F("<!> <!>",1);function et(U,a){se(a,!0);const J=()=>ee(Pe,"$endpointForm",P),q=()=>ee(ke,"$namespaces",P),w=()=>ee(_e,"$page",P),[P,G]=xe(),c=g(()=>a.data.endpoint);let N=B(void 0),x=B(!1);const b=async()=>{if(!e(c))return;p(N,void 0),p(x,!0);const t={...J()};if(t.id=e(c).id,t.version=e(c).version,t.spec){const n=await He({input:JSON.stringify(t.spec.descriptionString),encoding:"json/plain"});t.spec.description=n==null?void 0:n[0],delete t.spec.allowedCallerNamespaces,delete t.spec.descriptionString}try{await Le(e(c).id,t),O(te(e(c).id),{invalidateAll:!0})}catch(n){p(N,n,!0),console.error("Error updating endpoint",n)}finally{p(x,!1)}},H=async()=>{if(e(c)){p(N,void 0),p(x,!0);try{await be(e(c).id,String(e(c).version)),O(Ee())}catch(t){p(N,t,!0),console.error("Error deleting endpoint",t)}finally{p(x,!1)}}},M=g(()=>q().map(t=>{var n,f;return{namespace:(f=(n=t.namespaceInfo)===null||n===void 0?void 0:n.name)!==null&&f!==void 0?f:""}}));var L=Ae(),k=le(L);{let t=g(()=>`Edit ${s("nexus.nexus-endpoint",{id:w().params.id})}`);he(k,{get title(){return e(t)},get url(){return w().url.href}})}var A=l(k,2);{var K=t=>{var n=Me(),f=m(n);{let E=g(()=>te(w().params.id));$e(f,{get href(){return e(E)},icon:"chevron-left",children:(S,ae)=>{C();var j=D();$(o=>d(j,o),[()=>s("nexus.back-to-endpoint")]),v(S,j)},$$slots:{default:!0}})}var I=l(f,2);{let E=g(()=>te(w().params.id));Fe(I,{get endpoint(){return e(c)},get loading(){return e(x)},get targetNamespaceList(){return e(M)},onUpdate:b,onDelete:H,get error(){return e(N)},get cancelHref(){return e(E)}})}u(n),v(t,n)};ge(A,t=>{e(c)&&t(K)})}v(U,L),ie(),G()}export{et as component};
