import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as ye,l as J,a as De,f as S,e as y,b as ke,az as l,g as e,m as n,K as i,s as a,j as x,r as b,o,h as R,t as le,O as m,c as V,i as Ee,n as pe,k as ge,aT as Oe}from"../chunks/DZ1-1a5q.js";import{i as he}from"../chunks/Bby3K3wO.js";import{a as X,s as xe,e as Ue}from"../chunks/TaaIktnz.js";import{p as be}from"../chunks/P-60DauF.js";import{P as Le}from"../chunks/BvHFjIFb.js";import{t}from"../chunks/DEjs8ZrU.js";import{o as Me}from"../chunks/D7JzDj9r.js";import{s as ne}from"../chunks/DxwvfIkW.js";import{a as Qe}from"../chunks/Ave-ZrbK.js";import{i as ze}from"../chunks/DnKg3jxh.js";import{e as Ae,i as Fe}from"../chunks/DGhzC9On.js";import{P as Ke}from"../chunks/DD2HlIgN.js";import{B as Ne}from"../chunks/50GSh07Q.js";import{C as Ge}from"../chunks/uGY2KSKF.js";import{C as He}from"../chunks/DRZCEzQy.js";import{E as _e}from"../chunks/DEyS7vMf.js";import{L as Je}from"../chunks/DW6uis09.js";import{S as Ve,O as Xe}from"../chunks/BwGUWM7j.js";import{T as Ye}from"../chunks/BZoQ2uf-.js";import{a as Ze,b as et}from"../chunks/BoGCB19E.js";import{a as tt}from"../chunks/urDygoU8.js";import{w as $e}from"../chunks/D3HmRl1U.js";import{e as rt}from"../chunks/BAUAFOHM.js";import{s as we}from"../chunks/ikbOq2O5.js";var at=S('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),ot=S('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),st=S('<div class="ml-auto"><!></div> <!>',1),lt=S('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),nt=S("<section><!></section>");function it(Y,Z){ye(Z,!1);const T=()=>X(be,"$page",B),c=()=>X($e,"$workflowRun",B),k=()=>X(tt,"$authUser",B),[B,O]=xe(),g=n(),U=n(),f=n();var L=n(),M=n(),Q=n(),z=n(),A=n(),F=n();const{namespace:ie,workflow:ue,run:ce}=T().params,qe={id:ue,runId:ce};let _=n(),ee=n(),q=n(""),te=n(""),K=n(!1),N=n(!0),re=n(),G=n();const Pe=r=>[...r].sort((s,u)=>{const v=s.name.startsWith("__"),$=u.name.startsWith("__");return v&&!$?1:!v&&$?-1:s.name.localeCompare(u.name)});Me(()=>{c().metadata||Te()});const Te=async()=>{const{settings:r}=T().data,s=await Ze({namespace:ie,workflow:{id:ue,runId:ce}},r,k()===null||k()===void 0?void 0:k().accessToken);Ue($e,i(c).metadata=s,i(c))},de=()=>{a(K,!1),a(ee,e(_)),a(te,e(q))},Ie=async r=>{var s;a(K,!0);let u;try{a(G,e(q)?rt({input:e(q),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),u=await e(G)}catch{de();return}a(re,et({namespace:ie,workflow:qe,queryType:r,queryArgs:u?{payloads:u}:null},(s=T().data)===null||s===void 0?void 0:s.settings,k()===null||k()===void 0?void 0:k().accessToken).finally(()=>{de()}))};J(()=>(l(A),l(z),l(Q),c()),()=>{a(f,Pe((a(A,a(z,a(Q,c()===null||c()===void 0?void 0:c().metadata)===null||l(Q)===void 0?void 0:l(Q).definition)===null||l(z)===void 0?void 0:l(z).queryDefinitions)===null||l(A)===void 0?void 0:l(A).filter(r=>(r==null?void 0:r.name)!=="__stack_trace"))||[]))}),J(()=>(e(_),l(F),e(f)),()=>{a(_,e(_)||(a(F,e(f)===null||e(f)===void 0?void 0:e(f)[0])===null||l(F)===void 0?void 0:l(F).name))}),J(()=>(e(ee),e(_),e(q),e(te)),()=>{a(g,e(ee)!==e(_)||e(q)!==e(te))}),J(()=>(l(M),l(L),c()),()=>{a(U,a(M,a(L,c().metadata)===null||l(L)===void 0?void 0:l(L).error)===null||l(M)===void 0?void 0:l(M).message)}),De(),he();var ae=nt(),We=x(ae);{var je=r=>{{let s=o(()=>(m(t),i(()=>t("common.error-occurred")))),u=o(()=>(m(t),i(()=>t("workflows.no-workers-running-message")))),v=o(()=>(c(),i(()=>{var $,p;return(p=($=c().metadata)==null?void 0:$.error)==null?void 0:p.message})));_e(r,{get title(){return e(s)},get content(){return e(u)},get error(){return e(v)}})}},Ce=r=>{var s=at(),u=x(s);Je(u,{});var v=R(u,2),$=x(v,!0);b(v),b(s),le(p=>ne($,p),[()=>(m(t),i(()=>t("workflows.no-workers-failure-message")))]),y(r,s)},Re=r=>{var s=lt(),u=x(s);Ge(u,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(p,D)=>{var I=ot(),w=V(I);{let P=o(()=>(m(t),i(()=>t("workflows.query-type"))));Ve(w,{id:"query-select",get label(){return e(P)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(_)},set value(d){a(_,d)},children:(d,j)=>{var E=Ee(),C=V(E);Ae(C,1,()=>e(f),Fe,(se,me)=>{let fe=()=>e(me).name,Se=o(()=>Oe(e(me).description,""));Xe(se,{get value(){return fe()},get description(){return e(Se)},children:(Be,ct)=>{pe();var ve=ge();le(()=>ne(ve,fe())),y(Be,ve)},$$slots:{default:!0}})}),y(d,E)},$$slots:{default:!0},$$legacy:!0})}var h=R(w,2),H=x(h);{let P=o(()=>(m(t),i(()=>t("workflows.query-arg"))));Ke(H,{get label(){return e(P)},get input(){return e(q)},set input(d){a(q,d)},$$legacy:!0})}b(h);var W=R(h,2),oe=x(W);{let P=o(()=>e(g)?"primary":"secondary"),d=o(()=>e(g)?null:"retry");Ne(oe,{get loading(){return e(K)},get variant(){return e(P)},get leadingIcon(){return e(d)},get disabled(){return e(K)},$$events:{click:()=>Ie(e(_))},children:(j,E)=>{pe();var C=ge();le(se=>ne(C,se),[()=>(e(g),m(t),i(()=>e(g)?t("workflows.run-query"):t("workflows.refresh-query")))]),y(j,C)},$$slots:{default:!0}})}b(W),y(p,I)},$$slots:{default:!0}});var v=R(u,2),$=x(v);Qe($,()=>(e(re),e(G),i(()=>Promise.all([e(re),e(G)]))),null,(p,D)=>{var I=o(()=>{var[d,j]=e(D);return{result:d,_:j}}),w=o(()=>e(I).result);const h=o(()=>(m(e(w)),m(we),i(()=>typeof e(w)!="string"?we(e(w)):e(w))));var H=st(),W=V(H),oe=x(W);{let d=o(()=>(m(t),i(()=>t("workflows.json-formatting"))));Ye(oe,{get label(){return e(d)},labelPosition:"left",id:"json-formatting",get checked(){return e(N)},$$events:{change:()=>a(N,!e(N))}})}b(W);var P=R(W,2);{let d=o(()=>e(N)?"json":"text"),j=o(()=>(m(t),i(()=>t("common.copy-icon-title")))),E=o(()=>(m(t),i(()=>t("common.copy-success-icon-title")))),C=o(()=>e(g)&&"opacity-50");He(P,{get content(){return e(h)},get language(){return e(d)},get copyIconTitle(){return e(j)},get copySuccessIconTitle(){return e(E)},testId:"query-result",get class(){return e(C)}})}y(p,H)},(p,D)=>{{let I=o(()=>(m(t),i(()=>t("common.error-occurred")))),w=o(()=>(m(e(D)),i(()=>{var h;return(h=e(D))==null?void 0:h.message})));_e(p,{get title(){return e(I)},get error(){return e(w)}})}}),b(v),b(s),y(r,s)};ze(We,r=>{e(U)?r(je):(e(f),i(()=>!e(f).length)?r(Ce,1):r(Re,!1))})}b(ae),y(Y,ae),ke(),O()}var ut=S("<!> <!>",1);function Ot(Y,Z){ye(Z,!1);const T=()=>X(be,"$page",c),[c,k]=xe(),B=T().params.workflow;he();var O=ut(),g=V(O);{let f=o(()=>`${t("workflows.queries-tab")} | ${B}`);Le(g,{get title(){return e(f)},get url(){return T().url.href}})}var U=R(g,2);it(U,{}),y(Y,O),ke(),k()}export{Ot as component};
