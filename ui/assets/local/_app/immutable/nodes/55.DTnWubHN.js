import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as Ie,l as ee,a as Qe,f as D,e as v,b as Te,av as o,g as e,m as s,I as l,s as r,j as k,r as h,o as a,i as ye,c as Q,M as d,h as B,t as de,n as ke,k as he,aP as Ae}from"../chunks/UnFCzZBm.js";import{i as We}from"../chunks/BBLBidKq.js";import{a as te,s as je,e as Fe}from"../chunks/GmGfGY7t.js";import{p as Ce}from"../chunks/aJg2w3Uz.js";import{P as Ne}from"../chunks/Bu3uT3O7.js";import{t}from"../chunks/DEjs8ZrU.js";import{o as ze}from"../chunks/CDMQnRTF.js";import{s as fe}from"../chunks/CX2avYX0.js";import{a as Ge}from"../chunks/DX0XWFAv.js";import{i as xe}from"../chunks/pI5hk1MB.js";import{e as He,i as Je}from"../chunks/DMsHiW-d.js";import{P as Ke}from"../chunks/gxD-UOHS.js";import{B as Ve}from"../chunks/tE7jlgr_.js";import{C as Xe}from"../chunks/svSl5Q80.js";import{C as Ye}from"../chunks/DnI2hVrg.js";import{E as be}from"../chunks/C2OodUaI.js";import{L as Ze}from"../chunks/gXUEJ3Qb.js";import{S as et,O as tt}from"../chunks/Cv5alNsv.js";import{T as rt}from"../chunks/E1oxHDTl.js";import{a as at,b as ot}from"../chunks/sbkSBbDj.js";import{a as st}from"../chunks/Bt9FnE2Z.js";import{w as qe}from"../chunks/BuXSPDAs.js";import{e as lt}from"../chunks/MPA5yz1T.js";import{s as Pe}from"../chunks/ikbOq2O5.js";var nt=D('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),it=D('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),ut=D('<div class="ml-auto"><!></div> <!>',1),ct=D('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),dt=D("<section><!></section>");function ft(re,ae){Ie(ae,!1);const T=()=>te(Ce,"$page",E),i=()=>te(qe,"$workflowRun",E),w=()=>te(st,"$authUser",E),[E,A]=je(),p=s(),F=s(),f=s();var N=s(),z=s(),G=s(),H=s(),J=s(),K=s();const{namespace:me,workflow:ve,run:pe}=T().params,Re={id:ve,runId:pe};let g=s(),oe=s(),x=s(""),se=s(""),V=s(!1),X=s(!0),le=s(),Y=s();const Se=n=>[...n].sort((u,m)=>{const W=u.name.startsWith("__"),b=m.name.startsWith("__");return W&&!b?1:!W&&b?-1:u.name.localeCompare(m.name)});ze(()=>{i().metadata||Be()});const Be=async()=>{const{settings:n}=T().data,u=await at({namespace:me,workflow:{id:ve,runId:pe}},n,w()===null||w()===void 0?void 0:w().accessToken);Fe(qe,l(i).metadata=u,l(i))},ge=()=>{r(V,!1),r(oe,e(g)),r(se,e(x))},De=async n=>{var u;r(V,!0);let m;try{r(Y,e(x)?lt({input:e(x),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),m=await e(Y)}catch{ge();return}r(le,ot({namespace:me,workflow:Re,queryType:n,queryArgs:m?{payloads:m}:null},(u=T().data)===null||u===void 0?void 0:u.settings,w()===null||w()===void 0?void 0:w().accessToken).finally(()=>{ge()}))};ee(()=>(o(J),o(H),o(G),i()),()=>{r(f,Se((r(J,r(H,r(G,i()===null||i()===void 0?void 0:i().metadata)===null||o(G)===void 0?void 0:o(G).definition)===null||o(H)===void 0?void 0:o(H).queryDefinitions)===null||o(J)===void 0?void 0:o(J).filter(n=>(n==null?void 0:n.name)!=="__stack_trace"))||[]))}),ee(()=>(e(g),o(K),e(f)),()=>{r(g,e(g)||(r(K,e(f)===null||e(f)===void 0?void 0:e(f)[0])===null||o(K)===void 0?void 0:o(K).name))}),ee(()=>(e(oe),e(g),e(x),e(se)),()=>{r(p,e(oe)!==e(g)||e(x)!==e(se))}),ee(()=>(o(z),o(N),i()),()=>{r(F,r(z,r(N,i().metadata)===null||o(N)===void 0?void 0:o(N).error)===null||o(z)===void 0?void 0:o(z).message)}),Qe(),We();var ne=dt(),Ee=k(ne);{var Me=n=>{{let u=a(()=>(d(t),l(()=>t("common.error-occurred")))),m=a(()=>(d(t),l(()=>t("workflows.no-workers-running-message")))),W=a(()=>(i(),l(()=>{var b,_;return(_=(b=i().metadata)==null?void 0:b.error)==null?void 0:_.message})));be(n,{get title(){return e(u)},get content(){return e(m)},get error(){return e(W)}})}},Ue=n=>{var u=ye(),m=Q(u);{var W=_=>{var q=nt(),M=k(q);Ze(M,{});var U=B(M,2),ie=k(U,!0);h(U),h(q),de(P=>fe(ie,P),[()=>(d(t),l(()=>t("workflows.no-workers-failure-message")))]),v(_,q)},b=_=>{var q=ct(),M=k(q);Xe(M,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(P,L)=>{var j=it(),$=Q(j);{let I=a(()=>(d(t),l(()=>t("workflows.query-type"))));et($,{id:"query-select",get label(){return e(I)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(g)},set value(c){r(g,c)},children:(c,R)=>{var O=ye(),S=Q(O);He(S,1,()=>e(f),Je,(ce,_e)=>{let $e=()=>e(_e).name,Le=a(()=>Ae(e(_e).description,""));tt(ce,{get value(){return $e()},get description(){return e(Le)},children:(Oe,vt)=>{ke();var we=he();de(()=>fe(we,$e())),v(Oe,we)},$$slots:{default:!0}})}),v(c,O)},$$slots:{default:!0},$$legacy:!0})}var y=B($,2),Z=k(y);{let I=a(()=>(d(t),l(()=>t("workflows.query-arg"))));Ke(Z,{get label(){return e(I)},get input(){return e(x)},set input(c){r(x,c)},$$legacy:!0})}h(y);var C=B(y,2),ue=k(C);{let I=a(()=>e(p)?"primary":"secondary"),c=a(()=>e(p)?null:"retry");Ve(ue,{get loading(){return e(V)},get variant(){return e(I)},get leadingIcon(){return e(c)},get disabled(){return e(V)},$$events:{click:()=>De(e(g))},children:(R,O)=>{ke();var S=he();de(ce=>fe(S,ce),[()=>(e(p),d(t),l(()=>e(p)?t("workflows.run-query"):t("workflows.refresh-query")))]),v(R,S)},$$slots:{default:!0}})}h(C),v(P,j)},$$slots:{default:!0}});var U=B(M,2),ie=k(U);Ge(ie,()=>(e(le),e(Y),l(()=>Promise.all([e(le),e(Y)]))),null,(P,L)=>{var j=a(()=>{var[c,R]=e(L);return{result:c,_:R}}),$=a(()=>e(j).result);const y=a(()=>(d(e($)),d(Pe),l(()=>typeof e($)!="string"?Pe(e($)):e($))));var Z=ut(),C=Q(Z),ue=k(C);{let c=a(()=>(d(t),l(()=>t("workflows.json-formatting"))));rt(ue,{get label(){return e(c)},labelPosition:"left",id:"json-formatting",get checked(){return e(X)},$$events:{change:()=>r(X,!e(X))}})}h(C);var I=B(C,2);{let c=a(()=>e(X)?"json":"text"),R=a(()=>(d(t),l(()=>t("common.copy-icon-title")))),O=a(()=>(d(t),l(()=>t("common.copy-success-icon-title")))),S=a(()=>e(p)&&"opacity-50");Ye(I,{get content(){return e(y)},get language(){return e(c)},get copyIconTitle(){return e(R)},get copySuccessIconTitle(){return e(O)},testId:"query-result",get class(){return e(S)}})}v(P,Z)},(P,L)=>{{let j=a(()=>(d(t),l(()=>t("common.error-occurred")))),$=a(()=>(d(e(L)),l(()=>{var y;return(y=e(L))==null?void 0:y.message})));be(P,{get title(){return e(j)},get error(){return e($)}})}}),h(U),h(q),v(_,q)};xe(m,_=>{e(f),l(()=>!e(f).length)?_(W):_(b,!1)},!0)}v(n,u)};xe(Ee,n=>{e(F)?n(Me):n(Ue,!1)})}h(ne),v(re,ne),Te(),A()}var mt=D("<!> <!>",1);function Qt(re,ae){Ie(ae,!1);const T=()=>te(Ce,"$page",i),[i,w]=je(),E=T().params.workflow;We();var A=mt(),p=Q(A);{let f=a(()=>`${t("workflows.queries-tab")} | ${E}`);Ne(p,{get title(){return e(f)},get url(){return T().url.href}})}var F=B(p,2);ft(F,{}),v(re,A),Te(),w()}export{Qt as component};
