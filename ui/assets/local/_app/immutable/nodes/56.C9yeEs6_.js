import"../chunks/CWj6FrbW.js";import{p as K,f as M,e as _,b as U,h as k,j as A,k as z,t as R,g as n,u as x,n as S,r as T,c as ee,al as O,s as H}from"../chunks/yn9lut7I.js";import{s as Z}from"../chunks/B95CcGmx.js";import{p as r,s as V,a as B}from"../chunks/C6jR5PNA.js";import{g as W}from"../chunks/CeAjTHDf.js";import{p as Q}from"../chunks/DC-MPJ9t.js";import{P as te}from"../chunks/DUSMGXax.js";import{L as ae}from"../chunks/Ch7msofI.js";import{t as h}from"../chunks/DEjs8ZrU.js";import{B as q}from"../chunks/CyYV_Hhv.js";import{N as re,e as X}from"../chunks/D0mBEx-Z.js";import{c as ne}from"../chunks/Jb0HS2Gu.js";import{n as oe}from"../chunks/DXPYlj9A.js";import{e as se}from"../chunks/BiXdKuSl.js";import{m as G}from"../chunks/DqHSrrUP.js";var ie=M('<div class="flex w-full flex-col gap-8"><!> <div class="flex flex-row items-center gap-4 max-sm:flex-col"><!> <!></div></div>');function le(j,t){K(t,!0);const c=()=>B(X,"$endpointForm",C),[C,$]=V();var m,o,l,s,i,u,p;let N=r(t,"targetNamespaceList",19,()=>[]),w=r(t,"callerNamespaceList",19,()=>[]),L=r(t,"error",3,void 0),P=r(t,"loading",3,!1),F=r(t,"isCloud",3,!1),e=r(t,"nameRegexPattern",3,/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/),a=r(t,"nameHintText",19,()=>h("nexus.endpoint-name-hint-with-dash")),d=r(t,"cancelHref",3,"/nexus");r(t,"projectId",3,void 0);const y=x(()=>!(!((m=c().spec)===null||m===void 0)&&m.name)||!(!((s=(l=(o=c().spec)===null||o===void 0?void 0:o.target)===null||l===void 0?void 0:l.worker)===null||s===void 0)&&s.namespace)||!(!((p=(u=(i=c().spec)===null||i===void 0?void 0:i.target)===null||u===void 0?void 0:u.worker)===null||p===void 0)&&p.taskQueue));var v=ie(),E=A(v);re(E,{get nameRegexPattern(){return e()},get nameHintText(){return a()},get error(){return L()},get targetNamespaceList(){return N()},get callerNamespaceList(){return w()},get isCloud(){return F()}});var D=k(E,2),J=A(D);q(J,{variant:"primary",get disabled(){return n(y)},class:"max-sm:w-full",get loading(){return P()},$$events:{click(...f){var b;(b=t.onCreate)==null||b.apply(this,f)}},children:(f,b)=>{S();var g=z();R(I=>Z(g,I),[()=>h("nexus.create-endpoint")]),_(f,g)},$$slots:{default:!0}});var Y=k(J,2);q(Y,{variant:"ghost",class:"max-sm:w-full",$$events:{click:()=>W(d())},children:(f,b)=>{S();var g=z();R(I=>Z(g,I),[()=>h("common.cancel")]),_(f,g)},$$slots:{default:!0}}),T(D),T(v),_(j,v),U(),$()}var de=M('<!> <div class="flex flex-col gap-4"><!> <!></div>',1);function ye(j,t){K(t,!0);const c=()=>B(X,"$endpointForm",$),C=()=>B(oe,"$namespaces",$),[$,m]=V();var o;let l=O(void 0),s=O(!1);const i=x(()=>(o=Q.url.searchParams.get("projectId"))!==null&&o!==void 0?o:void 0),u=async()=>{H(s,!0);try{const e={...c()};if(e.spec){const a=await se({input:JSON.stringify(e.spec.descriptionString),encoding:"json/plain"});e.spec.description=a==null?void 0:a[0],delete e.spec.allowedCallerNamespaces,delete e.spec.descriptionString}n(i)&&(e.projectId=n(i)),await ne(e),W(G(),{invalidateAll:!0})}catch(e){H(l,e,!0),console.error("Error creating endpoint",e)}finally{H(s,!1)}},p=x(()=>C().map(e=>{var a,d;return{namespace:(d=(a=e.namespaceInfo)===null||a===void 0?void 0:a.name)!==null&&d!==void 0?d:""}}));var N=de(),w=ee(N);{let e=x(()=>h("nexus.create-endpoint"));te(w,{get title(){return n(e)},get url(){return Q.url.href}})}var L=k(w,2),P=A(L);{let e=x(G);ae(P,{get href(){return n(e)},icon:"chevron-left",children:(a,d)=>{S();var y=z();R(v=>Z(y,v),[()=>h("nexus.back-to-endpoints")]),_(a,y)},$$slots:{default:!0}})}var F=k(P,2);le(F,{onCreate:u,get targetNamespaceList(){return n(p)},get error(){return n(l)},get loading(){return n(s)},get projectId(){return n(i)}}),T(L),_(j,N),U(),m()}export{ye as component};
