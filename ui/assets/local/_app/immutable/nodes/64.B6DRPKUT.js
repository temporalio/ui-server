import"../chunks/CWj6FrbW.js";import{p as oe,f as F,c as le,j as m,r as u,h as l,n as C,k as D,t as $,e as g,s as p,at as B,g as e,v as x,b as ie}from"../chunks/DPYmeJXN.js";import{s as d}from"../chunks/DtOlEDQN.js";import{i as ge}from"../chunks/DqIiO-ir.js";import{p as v,s as xe,a as ee}from"../chunks/BkgVXhYA.js";import{g as O}from"../chunks/B79Qy02h.js";import{p as _e}from"../chunks/DnQDqIc7.js";import{P as he}from"../chunks/DiTxmex0.js";import{L as $e}from"../chunks/CvGPoQvt.js";import{t as o}from"../chunks/DEjs8ZrU.js";import{B as Z}from"../chunks/DX56QH8A.js";import{I as Ne}from"../chunks/TuMWvkM6.js";import{M as ye}from"../chunks/jes_gMPF.js";import{N as we,e as Pe}from"../chunks/BV7dxADz.js";import{d as be,u as Le}from"../chunks/Drxun1zj.js";import{n as He}from"../chunks/Ba9WNY6S.js";import{e as ke}from"../chunks/DKJ0Xb4B.js";import{l as te,m as Ee}from"../chunks/DTJ3saZ4.js";var Te=F('<h3 slot="title"> </h3>'),Ce=F('<div slot="content" class="flex flex-col gap-4"><p> <strong class="select-all"> </strong> </p> <p> <strong class="select-all"> </strong> </p> <!></div>'),De=F('<div class="flex flex-col gap-8"><div class="flex flex-col gap-1"><h1 data-testid="namespace-selector-title"> </h1></div> <!> <div class="flex w-full flex-row items-center justify-between gap-4 max-sm:flex-col xl:w-1/2"><div class="flex w-full flex-row items-center gap-4 max-sm:flex-col"><!> <!></div> <!> <!></div></div> <!>',1);function Fe(U,a){oe(a,!0);let J=v(a,"targetNamespaceList",19,()=>[]),q=v(a,"callerNamespaceList",19,()=>[]),w=v(a,"error",3,void 0),P=v(a,"loading",3,!1),G=v(a,"isCloud",3,!1),c=v(a,"nameRegexPattern",3,/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/),N=v(a,"nameHintText",19,()=>o("nexus.endpoint-name-hint-with-dash")),_=v(a,"cancelHref",3,"/nexus");v(a,"successHref",3,void 0),v(a,"deleteSuccessHref",3,void 0);let b=B(!1),k=B("");var M=De(),L=le(M),H=m(L),S=m(H),K=m(S,!0);u(S),u(H);var t=l(H,2);we(t,{get endpoint(){return a.endpoint},get nameHintText(){return N()},get nameRegexPattern(){return c()},get targetNamespaceList(){return J()},get callerNamespaceList(){return q()},get error(){return w()},get isCloud(){return G()},nameDisabled:!0});var n=l(t,2),f=m(n),A=m(f);Z(A,{class:"max-sm:w-full",get loading(){return P()},$$events:{click(...s){var h;(h=a.onUpdate)==null||h.apply(this,s)}},children:(s,h)=>{C();var i=D();$(r=>d(i,r),[()=>o("common.save")]),g(s,i)},$$slots:{default:!0}});var E=l(A,2);Z(E,{class:"max-sm:hidden",variant:"ghost",$$events:{click:()=>O(_())},children:(s,h)=>{C();var i=D();$(r=>d(i,r),[()=>o("common.cancel")]),g(s,i)},$$slots:{default:!0}}),u(f);var I=l(f,2);Z(I,{class:"max-sm:w-full",variant:"destructive",$$events:{click:()=>p(b,!0)},children:(s,h)=>{C();var i=D();$(r=>d(i,r),[()=>o("common.delete")]),g(s,i)},$$slots:{default:!0}});var ae=l(I,2);Z(ae,{class:"w-full sm:hidden",variant:"ghost",$$events:{click:()=>O(_())},children:(s,h)=>{C();var i=D();$(r=>d(i,r),[()=>o("common.cancel")]),g(s,i)},$$slots:{default:!0}}),u(n),u(L);var j=l(L,2);{let s=x(()=>o("common.delete")),h=x(()=>o("common.cancel")),i=x(()=>{var r;return e(k)!==((r=a.endpoint.spec)==null?void 0:r.name)});ye(j,{id:"delete-endpoint-modal",get loading(){return P()},confirmType:"destructive",get confirmText(){return e(s)},get cancelText(){return e(h)},get confirmDisabled(){return e(i)},get open(){return e(b)},set open(r){p(b,r,!0)},$$events:{confirmModal(...r){var z;(z=a.onDelete)==null||z.apply(this,r)},cancelModal:()=>p(b,!1)},$$slots:{title:(r,z)=>{var y=Te(),T=m(y,!0);u(y),$(R=>d(T,R),[()=>o("nexus.delete-modal-title")]),g(r,y)},content:(r,z)=>{var y=Ce(),T=m(y),R=m(T),Q=l(R),de=m(Q,!0);u(Q);var ce=l(Q);u(T);var V=l(T,2),re=m(V),W=l(re),me=m(W,!0);u(W);var ue=l(W);u(V);var pe=l(V,2);{let X=x(()=>o("nexus.delete-endpoint"));Ne(pe,{id:"delete-endpoint",labelHidden:!0,get label(){return e(X)},get value(){return e(k)},set value(Y){p(k,Y,!0)}})}u(y),$((X,Y,fe,ve)=>{var ne,se;d(R,`${X??""} `),d(de,((ne=a.endpoint.spec)==null?void 0:ne.name)||""),d(ce,`?
      ${Y??""}`),d(re,`${fe??""} `),d(me,((se=a.endpoint.spec)==null?void 0:se.name)||""),d(ue,` ${ve??""}`)},[()=>o("nexus.delete-modal-confirmation-preface"),()=>o("nexus.delete-modal-confirmation-postface"),()=>o("nexus.type-confirm-preface"),()=>o("nexus.type-confirm-postface")]),g(r,y)}}})}$(()=>{var s;return d(K,((s=a.endpoint.spec)==null?void 0:s.name)||"")}),g(U,M),ie()}var Me=F('<div class="flex flex-col gap-4"><!> <!></div>'),Se=F("<!> <!>",1);function et(U,a){oe(a,!0);const J=()=>ee(Pe,"$endpointForm",P),q=()=>ee(He,"$namespaces",P),w=()=>ee(_e,"$page",P),[P,G]=xe(),c=x(()=>a.data.endpoint);let N=B(void 0),_=B(!1);const b=async()=>{if(!e(c))return;p(N,void 0),p(_,!0);const t={...J()};if(t.id=e(c).id,t.version=e(c).version,t.spec){const n=await ke({input:JSON.stringify(t.spec.descriptionString),encoding:"json/plain"});t.spec.description=n==null?void 0:n[0],delete t.spec.allowedCallerNamespaces,delete t.spec.descriptionString}try{await Le(e(c).id,t),O(te(e(c).id),{invalidateAll:!0})}catch(n){p(N,n,!0),console.error("Error updating endpoint",n)}finally{p(_,!1)}},k=async()=>{if(e(c)){p(N,void 0),p(_,!0);try{await be(e(c).id,String(e(c).version)),O(Ee())}catch(t){p(N,t,!0),console.error("Error deleting endpoint",t)}finally{p(_,!1)}}},M=x(()=>q().map(t=>{var n,f;return{namespace:(f=(n=t.namespaceInfo)===null||n===void 0?void 0:n.name)!==null&&f!==void 0?f:""}}));var L=Se(),H=le(L);{let t=x(()=>`Edit ${o("nexus.nexus-endpoint",{id:w().params.id})}`);he(H,{get title(){return e(t)},get url(){return w().url.href}})}var S=l(H,2);{var K=t=>{var n=Me(),f=m(n);{let E=x(()=>te(w().params.id));$e(f,{get href(){return e(E)},icon:"chevron-left",children:(I,ae)=>{C();var j=D();$(s=>d(j,s),[()=>o("nexus.back-to-endpoint")]),g(I,j)},$$slots:{default:!0}})}var A=l(f,2);{let E=x(()=>te(w().params.id));Fe(A,{get endpoint(){return e(c)},get loading(){return e(_)},get targetNamespaceList(){return e(M)},onUpdate:b,onDelete:k,get error(){return e(N)},get cancelHref(){return e(E)}})}u(n),g(t,n)};ge(S,t=>{e(c)&&t(K)})}g(U,L),ie(),G()}export{et as component};
