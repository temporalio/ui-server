import"../chunks/CWj6FrbW.js";import{p as K,f as M,e as _,b as U,h as k,j as A,k as z,t as R,g as n,v as x,n as S,r as T,c as ee,at as O,s as I}from"../chunks/DPYmeJXN.js";import{s as Z}from"../chunks/DtOlEDQN.js";import{p as r,s as V,a as B}from"../chunks/BkgVXhYA.js";import{g as W}from"../chunks/D26llIGR.js";import{p as Q}from"../chunks/EVVWzxIs.js";import{P as te}from"../chunks/DiTxmex0.js";import{L as ae}from"../chunks/BYTvtcID.js";import{t as h}from"../chunks/DEjs8ZrU.js";import{B as q}from"../chunks/B0BOtbkl.js";import{N as re,e as X}from"../chunks/vXDm0Yu_.js";import{c as ne}from"../chunks/ClgRMia8.js";import{n as se}from"../chunks/Ba9WNY6S.js";import{e as oe}from"../chunks/rIu01lhn.js";import{m as G}from"../chunks/BAvmKnJX.js";var ie=M('<div class="flex w-full flex-col gap-8"><!> <div class="flex flex-row items-center gap-4 max-sm:flex-col"><!> <!></div></div>');function le(j,t){K(t,!0);const c=()=>B(X,"$endpointForm",C),[C,N]=V();var m,s,l,o,i,u,p;let $=r(t,"targetNamespaceList",19,()=>[]),w=r(t,"callerNamespaceList",19,()=>[]),L=r(t,"error",3,void 0),P=r(t,"loading",3,!1),F=r(t,"isCloud",3,!1),e=r(t,"nameRegexPattern",3,/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/),a=r(t,"nameHintText",19,()=>h("nexus.endpoint-name-hint-with-dash")),d=r(t,"cancelHref",3,"/nexus");r(t,"successHref",3,void 0),r(t,"projectId",3,void 0);const y=x(()=>!(!((m=c().spec)===null||m===void 0)&&m.name)||!(!((o=(l=(s=c().spec)===null||s===void 0?void 0:s.target)===null||l===void 0?void 0:l.worker)===null||o===void 0)&&o.namespace)||!(!((p=(u=(i=c().spec)===null||i===void 0?void 0:i.target)===null||u===void 0?void 0:u.worker)===null||p===void 0)&&p.taskQueue));var v=ie(),E=A(v);re(E,{get nameRegexPattern(){return e()},get nameHintText(){return a()},get error(){return L()},get targetNamespaceList(){return $()},get callerNamespaceList(){return w()},get isCloud(){return F()}});var D=k(E,2),J=A(D);q(J,{variant:"primary",get disabled(){return n(y)},class:"max-sm:w-full",get loading(){return P()},$$events:{click(...f){var b;(b=t.onCreate)==null||b.apply(this,f)}},children:(f,b)=>{S();var g=z();R(H=>Z(g,H),[()=>h("nexus.create-endpoint")]),_(f,g)},$$slots:{default:!0}});var Y=k(J,2);q(Y,{variant:"ghost",class:"max-sm:w-full",$$events:{click:()=>W(d())},children:(f,b)=>{S();var g=z();R(H=>Z(g,H),[()=>h("common.cancel")]),_(f,g)},$$slots:{default:!0}}),T(D),T(v),_(j,v),U(),N()}var de=M('<!> <div class="flex flex-col gap-4"><!> <!></div>',1);function ye(j,t){K(t,!0);const c=()=>B(X,"$endpointForm",N),C=()=>B(se,"$namespaces",N),[N,m]=V();var s;let l=O(void 0),o=O(!1);const i=x(()=>(s=Q.url.searchParams.get("projectId"))!==null&&s!==void 0?s:void 0),u=async()=>{I(o,!0);try{const e={...c()};if(e.spec){const a=await oe({input:JSON.stringify(e.spec.descriptionString),encoding:"json/plain"});e.spec.description=a==null?void 0:a[0],delete e.spec.allowedCallerNamespaces,delete e.spec.descriptionString}n(i)&&(e.projectId=n(i)),await ne(e),W(G(),{invalidateAll:!0})}catch(e){I(l,e,!0),console.error("Error creating endpoint",e)}finally{I(o,!1)}},p=x(()=>C().map(e=>{var a,d;return{namespace:(d=(a=e.namespaceInfo)===null||a===void 0?void 0:a.name)!==null&&d!==void 0?d:""}}));var $=de(),w=ee($);{let e=x(()=>h("nexus.create-endpoint"));te(w,{get title(){return n(e)},get url(){return Q.url.href}})}var L=k(w,2),P=A(L);{let e=x(G);ae(P,{get href(){return n(e)},icon:"chevron-left",children:(a,d)=>{S();var y=z();R(v=>Z(y,v),[()=>h("nexus.back-to-endpoints")]),_(a,y)},$$slots:{default:!0}})}var F=k(P,2);le(F,{onCreate:u,get targetNamespaceList(){return n(p)},get error(){return n(l)},get loading(){return n(o)},get projectId(){return n(i)}}),T(L),_(j,$),U(),m()}export{ye as component};
